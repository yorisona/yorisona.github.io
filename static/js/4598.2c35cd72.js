"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[4598],{74751:function(e,t,i){i.d(t,{Z:function(){return b}});var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tg-live-display-dialog-data-input tg-dialog-vcenter"},[i("el-dialog",{staticClass:"tg-dialog-classic tg-live-display-form-dialog",attrs:{visible:e.visible,width:"440px",top:"15vh","close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:e.onCancelBtnClick},scopedSlots:e._u([{key:"title",fn:function(){return[i("span",[e._v("直播数据录入")])]},proxy:!0},{key:"footer",fn:function(){return[i("tg-button",{on:{click:e.onCancelBtnClick}},[e._v("取消")]),i("tg-button",{attrs:{type:"primary"},on:{click:e.onSaveBtnClick}},[e._v("保存")])]},proxy:!0}])},[i("div",{staticClass:"dialog-content"},[i("el-form",{ref:"formRef",attrs:{"label-position":"top",size:"small","label-width":"106px",rules:e.DisplayDataFormRules,model:e.DisplayDataForm},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-form-item",{attrs:{label:"直播开始时间",prop:"real_start_time"}},[i("el-date-picker",{staticStyle:{width:"187px"},attrs:{type:"date",placeholder:"开始日期"},model:{value:e.DateTimeField.start_date,callback:function(t){e.$set(e.DateTimeField,"start_date",t)},expression:"DateTimeField.start_date"}}),i("el-time-picker",{staticStyle:{width:"187px","margin-left":"18px"},attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"开始时间"},model:{value:e.DateTimeField.start_time,callback:function(t){e.$set(e.DateTimeField,"start_time",t)},expression:"DateTimeField.start_time"}})],1),i("el-form-item",{attrs:{label:"直播结束时间",prop:"real_end_time"}},[i("el-date-picker",{staticStyle:{width:"187px"},attrs:{type:"date",placeholder:"结束日期"},model:{value:e.DateTimeField.end_date,callback:function(t){e.$set(e.DateTimeField,"end_date",t)},expression:"DateTimeField.end_date"}}),i("el-time-picker",{staticStyle:{width:"187px","margin-left":"18px"},attrs:{"value-format":"HH:mm",format:"HH:mm",placeholder:"结束时间"},model:{value:e.DateTimeField.end_time,callback:function(t){e.$set(e.DateTimeField,"end_time",t)},expression:"DateTimeField.end_time"}})],1),i("el-form-item",{attrs:{label:"直播时长",prop:"real_duration"}},[i("el-input",{attrs:{maxlength:4,disabled:"disabled",placeholder:"请输入直播时长"},on:{input:e.inputPositiveInteger},model:{value:e.DisplayDataForm.real_duration,callback:function(t){e.$set(e.DisplayDataForm,"real_duration",t)},expression:"DisplayDataForm.real_duration"}},[i("template",{slot:"append"},[e._v("小时")])],2)],1),i("el-form-item",{attrs:{label:"直播链接"}},[i("el-input",{attrs:{maxlength:180,placeholder:"请输入直播链接"},model:{value:e.DisplayDataForm.live_url,callback:function(t){e.$set(e.DisplayDataForm,"live_url",t)},expression:"DisplayDataForm.live_url"}})],1),i("div",{staticClass:"upload-flex-container"},[i("el-form-item",{attrs:{label:"直播时长截图"}},[i("div",{staticStyle:{position:"relative",width:"90px",height:"90px",display:"inline-block"}},[i("el-upload",{staticClass:"img-uploader",attrs:{action:"","http-request":e.uploadDisplayTimeImage,accept:".jpeg,.jpg,.png",multiple:!1,"show-file-list":!1}},[i("div",{staticStyle:{width:"90px",padding:"4px",height:"90px"}},[e.DisplayDataForm.duration_screenshot?i("img",{staticClass:"avatar",attrs:{src:e.DisplayTimeImageUrl}}):i("i",{staticClass:"el-icon-plus img-uploader-icon"}),i("div",{staticStyle:{"margin-top":"46px",color:"#999","font-size":"12px","line-height":"17px"}},[e._v(" 上传图片 ")])])]),e.DisplayDataForm.duration_screenshot?i("tg-icon",{staticStyle:{position:"absolute",top:"-10px",right:"-10px","font-size":"20px",cursor:"pointer"},attrs:{name:"ico-cross-sm","hover-name":"ico-cross-red-sm"},on:{click:e.removeDurationScreenshot}}):e._e()],1),i("div",{staticStyle:{"margin-left":"6px","line-height":"16px","font-size":"12px",display:"inline-block",color:"#cccccc",position:"absolute",bottom:"9px"}},[e._v(" 大小不超过2M ")])]),i("el-form-item",{attrs:{label:"直播数据截图"}},[i("div",{staticStyle:{position:"relative",width:"90px",height:"90px",display:"inline-block"}},[i("el-upload",{staticClass:"img-uploader",attrs:{action:"","http-request":e.uploadDisplayDataImage,multiple:!1,accept:".jpeg,.jpg,.png","show-file-list":!1}},[i("div",{staticStyle:{width:"90px",padding:"4px",height:"90px"}},[e.DisplayDataForm.data_screenshot?i("img",{staticClass:"avatar",attrs:{src:e.DisplayDataImageUrl}}):i("i",{staticClass:"el-icon-plus img-uploader-icon"}),i("div",{staticStyle:{"margin-top":"46px",color:"#999","font-size":"12px","line-height":"17px"}},[e._v(" 上传图片 ")])])]),e.DisplayDataForm.data_screenshot?i("tg-icon",{staticStyle:{position:"absolute",top:"-10px",right:"-10px","font-size":"20px",cursor:"pointer"},attrs:{name:"ico-cross-sm","hover-name":"ico-cross-red-sm"},on:{click:e.removeDataScreenshot}}):e._e()],1),i("div",{staticStyle:{"margin-left":"6px","line-height":"16px","font-size":"12px",display:"inline-block",color:"#cccccc",position:"absolute",bottom:"9px"}},[e._v(" 大小不超过2M ")])])],1)],1)],1)])],1)},l=[],s=(i(21703),i(26699),i(97484)),o=i(74750),n=i(97434),r=i(53451),_=i.n(r),d=i(3293),c=i(8581),u=i(41572),m=i(6933),p=i.n(m),f=i(85937),v=i.n(f);const{debounce:h}=_(),g=(e,t)=>{const i=p()(e).toDate(),a=p()(t).toDate(),l=(a.getTime()-i.getTime())/36e5,s=new(v())(l.toString()).toFixed(1);return s};var k=(0,n.defineComponent)({name:"TgLiveDisplayDataInputDialog",props:{visible:{type:Boolean,required:!0},DisplayInfo:{type:Object,required:!1}},setup(e,t){const i=(0,n.ref)(null),a=(0,n.inject)("liveDisplay"),l=(0,n.ref)({start_date:"",start_time:"",end_date:"",end_time:""}),r=(0,n.ref)({real_start_time:"",real_end_time:""}),_=(0,n.ref)({id:a?.value.id??-1,real_start_time:r.value.real_start_time,real_end_time:r.value.real_end_time,real_duration:"",live_url:"",duration_screenshot:"",data_screenshot:""}),m=()=>{if(e.DisplayInfo?.real_start_time){_.value.real_start_time=e.DisplayInfo?.real_start_time;const t=(0,c.WU)(p()(1e3*parseInt(e.DisplayInfo.real_start_time,10)).valueOf(),"YYYY-mm-dd HH:ii");r.value.real_start_time=t;const[i,a]=t.split(" ");l.value.start_date=i,l.value.start_time=a,_.value.real_start_time=i+" "+a}else{const e=a?.value.live_start_time??"";if(e){const[t,i]=e.split(" ");l.value.start_date=t,l.value.start_time=i,_.value.real_start_time=e}}if(e.DisplayInfo?.real_end_time){_.value.real_end_time=e.DisplayInfo?.real_end_time;const t=(0,c.WU)(p()(1e3*parseInt(e.DisplayInfo.real_end_time,10)).valueOf(),"YYYY-mm-dd HH:ii");r.value.real_end_time=t;const[i,a]=t.split(" ");l.value.end_date=i,l.value.end_time=a,_.value.real_end_time=i+" "+a}else{const e=a?.value.live_end_time??"";if(e){const[t,i]=e.split(" ");l.value.end_date=t,l.value.end_time=i,_.value.real_end_time=e}}f()},f=()=>{_.value.real_start_time&&_.value.real_end_time&&(_.value.real_duration=g(_.value.real_start_time,_.value.real_end_time))};m();const v=(0,n.ref)(""),k=(0,n.ref)(""),y=e=>{const t=/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]*\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/;return t.test(e)},D=(0,n.ref)({real_duration:[{required:!0,message:"请输入直播时长",trigger:"blur"},{validator:(e,t,i)=>{t<=0?i(new Error("只能是正数")):i()},trigger:"change"}],real_start_date:[{required:!0,message:"请输入直播开始时间",trigger:"change"}],real_start_time:[{required:!0,message:"请输入直播开始时间",trigger:"change"}],real_end_time:[{required:!0,message:"请输入直播结束时间",trigger:"change"}]}),w=()=>{_.value.real_start_time="",_.value.real_end_time="",_.value.real_duration="",_.value.live_url="",_.value.duration_screenshot="",_.value.data_screenshot="",l.value.start_date="",l.value.start_time="",l.value.end_date="",l.value.end_time=""},b=(0,o.LP)();(0,n.watch)((()=>e.visible),(t=>{i.value?.clearValidate(),t&&(e.DisplayInfo?.id&&-1!==e.DisplayInfo?.id&&(_.value.id=e.DisplayInfo?.id),_.value.real_duration=e.DisplayInfo?.real_duration??"",_.value.live_url=e.DisplayInfo?.live_url,_.value.duration_screenshot=e.DisplayInfo?.duration_screenshot,_.value.data_screenshot=e.DisplayInfo?.data_screenshot,k.value=_.value.duration_screenshot+`?Authorization=${b}`,v.value=_.value.data_screenshot+`?Authorization=${b}`,m())})),(0,n.watch)((()=>[l.value.start_date,l.value.start_time,l.value.end_date,l.value.end_time].join(",")),(e=>{if(l.value.start_date){const e=(0,c.WU)(p()(l.value.start_date).valueOf(),"YYYY-mm-dd");e&&l.value.start_time?_.value.real_start_time=e+" "+l.value.start_time:_.value.real_start_time=""}else _.value.real_start_time="";if(l.value.end_date){const e=(0,c.WU)(p()(l.value.end_date).valueOf(),"YYYY-mm-dd");e&&l.value.end_time?_.value.real_end_time=e+" "+l.value.end_time:_.value.real_end_time=""}else _.value.real_end_time="";e&&f()}));const x=()=>{t.emit("dialog:close"),w()},T=async e=>{C("time",e)},Y=async e=>{C("data",e)},C=async(e,i)=>{const a=e=>["image/jpeg","image/jpg","image/png"].includes(e.type)?!(e.size>2097152)||(t.root.$message.error(`${e.name} ${(e.size/1024/1024).toFixed(2)}MB 请限制在2MB以内`),!1):(t.root.$message.warning("文件格式不正确，请使用 png / jpg/ jpeg"),!1);if(!a(i.file))return;const l=new FormData;l.append("file",i.file),l.append("type","shop_live_screenshot");const{data:n}=await(0,s.cT)(l);if(n.success){const t=n.data.source;"time"===e?(k.value=t+`?Authorization=${(0,o.LP)()}`,_.value.duration_screenshot=t):(v.value=t+`?Authorization=${(0,o.LP)()}`,_.value.data_screenshot=t)}else t.root.$message.error("上传失败！")},$=async()=>{if(void 0===_?.value)return;const l=await new Promise((e=>i.value?.validate((t=>e(t)))));if(!l)return;if(_.value.real_start_time===_.value.real_end_time)return void t.root.$message.error("直播结束时间需晚于开始时间");if(""!==_.value.live_url&&!y(_.value.live_url??""))return void t.root.$message.error("请输入有效的链接");if(!_.value.real_start_time||!_.value.real_end_time)return void t.root.$message.error("请选择直播时间");if(-1===_.value.id)return void t.root.$message.error("请求失败，无效的场次ID");const s=(0,n.ref)({data_screenshot:_.value.data_screenshot??"",duration_screenshot:_.value.duration_screenshot??"",real_duration:_.value.real_duration??"",live_url:_.value.live_url??"",real_start_time:_.value.real_start_time,real_end_time:_.value.real_end_time,business_type:a?.value?.business_type}),o=(0,n.computed)((()=>e.DisplayInfo?.id??-1));-1!==o.value?s.value.id=o.value:s.value.shop_live_id=a?.value.id;const{data:r}=await(0,d.Mv)(s.value);r.success?(t.root.$message.success(r.message),t.emit("dialog:close",r.data)):t.root.$message.error(r.message)},H=h($,200),S=e=>(/\d+(?:\.\d{0,1})?|\.\d{0,1}/u.exec(e.replace(u.qM,""))??[""])[0],I=e=>{_.value.real_duration=S(e)},F=()=>{_.value.data_screenshot=""},j=()=>{_.value.duration_screenshot=""};return{removeDurationScreenshot:j,removeDataScreenshot:F,inputPositiveInteger:I,formRef:i,DateTimeField:l,DisplayDataForm:_,DisplayDataFormRules:D,onCancelBtnClick:x,onSaveBtnClick:H,DisplayTimeImageUrl:k,DisplayDataImageUrl:v,uploadDisplayTimeImage:T,uploadDisplayDataImage:Y}}}),y=k,D=i(1001),w=(0,D.Z)(y,a,l,!1,null,null,null),b=w.exports},22112:function(e,t,i){i.d(t,{Z:function(){return g}});var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tg-live-project-user-schedule-dialog"},[i("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter-new",attrs:{visible:e.visible,width:"528px",title:e.dialogTitle,"close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:e.closeDialog}},[i("div",{staticClass:"content-container"},[i("el-form",{attrs:{"label-width":"60px",size:"small","label-position":"top"}},[i("div",{staticClass:"content"},["anchor"===e.type?i("el-timeline",[e._l(e.kol_schedule_infos,(function(t,a){return i("el-timeline-item",{key:a,attrs:{placement:"top"}},[1===e.kol_schedule_infos.length||e.isAutoObtain?e._e():i("i",{staticClass:"delete-btn-time el-icon-error",on:{click:function(t){return e.deleteAnchorTime(a)}}}),i("div",{staticClass:"timeline-back"},[i("el-form-item",{attrs:{label:"直播时间："}},[i("div",[i("el-date-picker",{staticStyle:{width:"176px"},attrs:{type:"datetime",disabled:0===a||e.isAutoObtain,clearable:!1,format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","picker-options":t.limitDate,placeholder:"选择日期时间"},on:{change:function(t){return e.kolWorkTime(a)}},model:{value:t.start_time,callback:function(i){e.$set(t,"start_time",i)},expression:"item.start_time"}}),i("span",[e._v(" ~ "+e._s(t.end_time||"待设置"))])],1)]),i("el-form-item",{attrs:{label:"排班人员："}},[i("div",[i("el-select",{attrs:{clearable:"",multiple:"","reserve-keyword":"",filterable:"",disabled:e.isAutoObtain,value:t.kol_ids,placeholder:"请输入并选择排班人员"},on:{change:function(t){return e.onSelectUserChanged(t,a)}}},e._l(e.anchorKolList,(function(e){return i("el-option",{key:e.kol_id,attrs:{label:e.kol_name+"("+e.real_name+")",value:e.kol_id}})})),1)],1)])],1),a===e.kol_schedule_infos.length-1?i("div",{staticClass:"add-timeline",attrs:{disabled:e.isAutoObtain},on:{click:function(){return e.addTimeLine(!0)}}},[i("i",{staticClass:"el-icon-circle-plus",staticStyle:{"font-size":"16px"}}),e._v("添加时间点 ")]):e._e()])})),i("el-timeline-item",{staticStyle:{height:"18px"},attrs:{placement:"top"}})],2):e._e(),"assistant"===e.type?i("el-timeline",[e._l(e.kol_schedule_infos,(function(t,a){return i("el-timeline-item",{key:a,attrs:{placement:"top"}},[1!==e.kol_schedule_infos.length?i("i",{staticClass:"delete-btn-time el-icon-error",on:{click:function(t){return e.deleteAnchorTime(a)}}}):e._e(),i("div",{staticClass:"timeline-back"},[i("el-form-item",{attrs:{label:"直播时间："}},[i("div",[i("el-date-picker",{staticStyle:{width:"176px"},attrs:{type:"datetime",disabled:0===a,clearable:!1,format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","picker-options":t.limitDate,placeholder:"选择日期时间"},on:{change:function(t){return e.kolWorkTime(a)}},model:{value:t.start_time,callback:function(i){e.$set(t,"start_time",i)},expression:"item.start_time"}}),i("span",[e._v(" ~ "+e._s(t.end_time||"待设置"))])],1)]),i("el-form-item",{attrs:{label:"排班人员："}},[i("div",[i("el-select",{attrs:{clearable:"",multiple:"","reserve-keyword":"",filterable:"",value:t.kol_ids,placeholder:"请输入并选择排班人员"},on:{change:function(t){return e.onSelectUserChanged(t,a)}}},e._l(e.oprateList,(function(e){return i("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})})),1)],1)])],1),a===e.kol_schedule_infos.length-1?i("div",{staticClass:"add-timeline",on:{click:e.addTimeLine}},[i("i",{staticClass:"el-icon-circle-plus"}),e._v("添加时间点 ")]):e._e()])})),i("el-timeline-item",{staticStyle:{height:"18px"},attrs:{placement:"top"}})],2):e._e()],1)])],1),i("div",{staticClass:"dialog-footer"},[i("tg-button-line",{attrs:{justifyContent:"center"}},[i("tg-button",{on:{click:e.closeDialog}},[e._v("取消")]),i("tg-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("保存")])],1)],1)])],1)},l=[],s=(i(26699),i(97434)),o=i(47583),n=i(41651),r=i(8581),_=i(3293),d=i(64236),c=i(82741),u=i(6933),m=i.n(u),p=(0,s.defineComponent)({name:"AnchorArrangeForm",emits:["childClose"],props:{visible:{type:Boolean,default:!1},detailData:{type:Object,required:!0},type:{type:String,required:!0},schedules:{type:Object}},setup(e,t){const i=(0,s.ref)("排班"),a=(0,s.computed)((()=>e.detailData)),l=(0,s.ref)(!1),u=(0,s.ref)([]),p=(0,s.computed)((()=>{const{live_start_time:e,live_end_time:t}=a.value,[i,l]=[e,t].map((e=>e.split(" ")[0]));return i===l})),f=(0,s.reactive)({kol_schedule_infos:[{start_time:a.value.live_start_time,start_time_data:a.value.live_start_time.split(" ")[0],start_time_temp:a.value.live_start_time.split(" ")[1],end_time:a.value.live_end_time,limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}],check_kol_schedule_infos:[],anchorKolList:[],oprateList:[]}),v=async()=>{if(await g(),void 0===e.schedules||0===e.schedules.kol.length&&0===e.schedules.operator.length)return;const t="anchor"===e.type?e.schedules.kol:e.schedules.operator,i=(0,d.Tw)(t.map((e=>[e.start_time,e.end_time])).flat()).map((e=>new Date(e).getTime())).sort();i.shift(),i.forEach(((e,t)=>{t<i.length-1&&(C(),f.kol_schedule_infos[t+1].start_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii"),f.kol_schedule_infos[t+1].start_time_data=(0,r.WU)(e,"YYYY-mm-dd"),f.kol_schedule_infos[t+1].start_time_temp=(0,r.WU)(e,"HH:ii")),f.kol_schedule_infos[t].end_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii")})),f.kol_schedule_infos.forEach((i=>{const a=t.filter((e=>e.start_time===i.start_time)).map((e=>e.id));i.kol_ids="anchor"===e.type?u.value.filter((e=>a.includes(e.kol_id))).map((e=>e.kol_id)):f.oprateList.filter((e=>a.includes(e.id))).map((e=>e.id)),0===i.kol_ids.length&&(i.kol_ids=[]),i.kol_ids_verify=new Array(i.kol_ids.length).fill(0).map((e=>({info:{},show:!1})))})),f.kol_schedule_infos[f.kol_schedule_infos.length-1].end_time=a.value.live_end_time},h=(e,t)=>f.kol_schedule_infos[e].kol_ids.includes(t),g=async()=>{if("anchor"===e.type){const{data:e}=await(0,_.Sx)({});e.success?(u.value=e.data,f.anchorKolList=e.data.filter((e=>e.kol_id<0))):f.anchorKolList=[]}else{const e=await(0,o.uZ)({roles:"1001"});e.data.success?f.oprateList=e.data.data:f.oprateList=[]}},k=(0,s.ref)([]),y=async(i,s,o)=>{f.kol_schedule_infos[s].kol_ids[o]=i;const n=f.kol_schedule_infos[f.kol_schedule_infos.length-1];if(!n.start_time)return f.kol_schedule_infos[s].kol_ids.splice(o,1,null),void t.root.$message.warning("请先选择时间");if("anchor"===e.type){const{data:e}=await(0,_.Jl)({shop_live_id:a.value.id,check_kol_schedule_infos:[{start_time:f.kol_schedule_infos[s].start_time,end_time:f.kol_schedule_infos[s].end_time,kol_ids:[i]}]});if(e.success)if(e.data?.length>0){const t=e.data[0].conflict_kol_items[0],{start_time:i,end_time:a,studio_name:l}=t,[n,_]=[i,a].map((e=>new Date(e))),d=[(0,r.WU)(n,"YYYY.mm.dd HH:ii"),(0,r.WU)(_,(n.getDate()!==_.getDate()?"次日":"")+"HH:ii")].join("~");f.kol_schedule_infos[s].kol_ids_verify.splice(o,1,{show:!0,info:{conflictTime:d,start_time:i,end_time:a,studio_name:l}})}else f.kol_schedule_infos[s].kol_ids_verify.splice(o,1,{show:!1,info:{conflictTime:"",start_time:"",end_time:"",studio_name:""}});else t.root.$message.error(e.message)}else{const{data:e}=await(0,_.fV)({shop_live_id:a.value.id,check_operator_schedule_infos:[{start_time:f.kol_schedule_infos[s].start_time,end_time:f.kol_schedule_infos[s].end_time,operator_ids:[i]}]});if(e.success)if(e.data.length>0){k.value=e.data,l.value=!0;const t=e.data[0].conflict_operator_items[0],{start_time:i,end_time:a,studio_name:n}=t,[_,d]=[i,a].map((e=>new Date(e))),c=[(0,r.WU)(_,"YYYY.mm.dd HH:ii"),(0,r.WU)(d,(_.getDate()!==d.getDate()?"次日":"")+"HH:ii")].join("~");f.kol_schedule_infos[s].kol_ids_verify.splice(o,1,{show:!0,info:{conflictTime:c,start_time:i,end_time:a,studio_name:n}})}else l.value=!1,f.kol_schedule_infos[s].kol_ids_verify.splice(o,1,{show:!1,info:{conflictTime:"",start_time:"",end_time:"",studio_name:""}});else t.root.$message.error(e.message)}},D=(e,t)=>{f.kol_schedule_infos[e].kol_ids.splice(t,1)},w=e=>{const i=e===f.kol_schedule_infos.length-1;if(2!==f.kol_schedule_infos.length||0!==e||f.kol_schedule_infos[e+1].start_time)if(f.kol_schedule_infos.splice(e,1),i)f.kol_schedule_infos[e-1].end_time=a.value.live_end_time;else{f.kol_schedule_infos[e-1].end_time=f.kol_schedule_infos[e].start_time;const[t,i]=f.kol_schedule_infos[e].start_time.split(" ");f.kol_schedule_infos[f.kol_schedule_infos.length-1].start_time_data=t,f.kol_schedule_infos[f.kol_schedule_infos.length-1].start_time_temp=i}else t.root.$message.warning("请选择直播时间")},b=()=>{f.kol_schedule_infos.forEach((e=>{e.start_time===e.end_time&&t.root.$message.error(`${e.start_time} ~ ${e.end_time} 排班时长为零，请重新选择`)}))},x=e=>{f.kol_schedule_infos[e].start_time_temp="",b()},T=e=>{const t=f.kol_schedule_infos.length;e===t-1&&"待设置"===f.kol_schedule_infos[e].end_time&&(f.kol_schedule_infos[e].end_time=f.kol_schedule_infos[e-1].end_time),t>1&&(f.kol_schedule_infos[e-1].end_time=f.kol_schedule_infos[e].start_time,f.kol_schedule_infos[e].start_time_data=f.kol_schedule_infos[e].start_time.split(" ")[0],f.kol_schedule_infos[e].start_time_temp=f.kol_schedule_infos[e].start_time.split(" ")[1]),b()},Y=(e,t)=>{f.kol_schedule_infos[t].start_time_data&&(f.kol_schedule_infos[t].start_time=f.kol_schedule_infos[t].start_time_data+" "+f.kol_schedule_infos[t].start_time_temp,f.kol_schedule_infos[t].start_time=e),void 0!==f.kol_schedule_infos[t-1]&&(f.kol_schedule_infos[t-1].end_time=f.kol_schedule_infos[t].start_time_data+" "+f.kol_schedule_infos[t].start_time),(t===f.kol_schedule_infos.length-1||f.kol_schedule_infos[t+1].start_time)&&(f.kol_schedule_infos[t].end_time=a.value.live_end_time),b()},C=(i=!1)=>{if(L.value&&i&&"anchor"===e.type)return;const{live_end_time:l}=a.value,s=f.kol_schedule_infos[f.kol_schedule_infos.length-1];if(!s.start_time)return void t.root.$message.warning("请先选择时间");const o=p.value?l.split(" ")[0]:"";f.kol_schedule_infos.push({start_time:m()(f.kol_schedule_infos[0].start_time).format("YYYY-MM-DD")+" 00:00",start_time_data:o,start_time_temp:"",end_time:"待设置",limitDate:{disabledDate(e){const t=(0,r.WU)(new Date(l),"HH:ii"),i="00:00"===t;return e.getTime()<new Date(s.start_time_data).getTime()-n.MU||(i?e.getTime()>new Date(l).getTime()-1e3:e.getTime()>new Date(l).getTime())}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]})},$=e=>{if(0===e)return{start:"00:00",step:"00:30",end:"23:30"};{const t=f.kol_schedule_infos[e],{start_time:i}=f.kol_schedule_infos[e-1];if(""===t.start_time_data)return{start:"00:00",step:"00:30",end:"23:30"};const l=new Date(t.start_time_data),s=new Date(i),o=new Date(a.value.live_end_time),_=o.getTime()-n.l/2;if(l.getDate()===s.getDate()){const e=s.getTime()+n.l/2,t=(0,r.WU)(e,"HH:ii");return o.getDate()!==l.getDate()?{start:t,step:"00:30",end:"23:30"}:{start:t,step:"00:30",end:(0,r.WU)(_,"HH:ii")}}return o.getDate()!==l.getDate()?{start:"00:00",step:"00:30",end:"23:30"}:{start:"00:00",step:"00:30",end:(0,r.WU)(_,"HH:ii")}}},H=(0,s.inject)("reload"),S=async()=>{const i=f.kol_schedule_infos.some((e=>"待设置"===e.end_time));if(i)return void t.root.$message.error("请填写完整信息");const n=f.kol_schedule_infos.every((e=>e.start_time!==e.end_time));if(!n)return void t.root.$message.error("直播结束时间必须晚于开始时间");const r=(0,s.ref)(!1),_=(0,s.ref)(!1),d=f.kol_schedule_infos.map((e=>{0===e.kol_ids.length&&(r.value=!0),e.start_time_data&&e.start_time_temp&&e.end_time||(_.value=!0);const t=e.start_time_data+" "+e.start_time_temp,i=e.kol_ids.filter((e=>null!==e));return{start_time:t,end_time:e.end_time,kol_ids:i}}));d.forEach(((e,t)=>{t<d.length-1&&(e.end_time=d[t+1].start_time)}));const u=f.kol_schedule_infos.map((e=>{const t=e.start_time_data+" "+e.start_time_temp;return e.start_time_data&&e.start_time_temp&&e.end_time||(_.value=!0),0===e.kol_ids.length&&(r.value=!0),{start_time:t,end_time:e.end_time,operator_ids:e.kol_ids}}));if(r.value)return void t.root.$message.error("请选择排班人员");if(_.value)return void t.root.$message.error("请填写直播时间");u.forEach(((e,t)=>{t<u.length-1&&(e.end_time=u[t+1].start_time)}));let m=!0;if(!0===l.value&&"anchor"!==e.type){const e=k.value.map((e=>e.conflict_operator_items.map((e=>f.oprateList.find((t=>t.id===e.operator_id))?.username)))).flat();m=await(0,c.I)(t,{title:"排班存在冲突",content:e.join("、")+"的排班和其他场次冲突",confirmText:"继续提交",cancelText:"放弃提交"})}if(m){const i="anchor"===e.type?await(0,o.js)({shop_live_id:a.value.id,kol_schedule_infos:d}):await(0,o.xZ)({shop_live_id:a.value.id,operator_schedule_infos:u});if(i.data.success)f.anchorKolList=i.data.data,t.root.$message.success(i.data.message),H&&H(),I(),t.emit("succeed");else if(t.root.$message.error(i.data.message),i.data.data?.length>0)for(const t of i.data.data){let i;i="anchor"===e.type?t.conflict_kol_items:t.conflict_operator_items;for(const e of i)f.kol_schedule_infos[e.date_index].kol_ids_verify.splice(e.kol_index,1,{show:!0,info:e})}}},I=()=>{t.emit("close"),t.emit("update:visible",!1)},F=()=>{const i="anchor"===e.type?"/live/roster-query":"/live/roster-query/operator",[a,l]=e.detailData.live_start_time.split(" "),s=new Date(a),o=(0,r.WU)(s.getTime()+6*n.MU,"YYYY-mm-dd"),_={start_date:a,end_date:o},{href:d}=t.root.$router.resolve({path:i,query:_});window.open(d,"_blank")};(0,s.watch)([()=>e.visible],(([t])=>{t&&(i.value="anchor"===e.type?"主播排班":"运营排班",f.kol_schedule_infos=[{start_time:a.value.live_start_time,start_time_data:a.value.live_start_time.split(" ")[0],start_time_temp:a.value.live_start_time.split(" ")[1],end_time:a.value.live_end_time,limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}],f.check_kol_schedule_infos=[],f.anchorKolList=[],f.oprateList=[],v())}));const j=e=>u.value.find((t=>t.kol_id===e))?.kol_name;v();const U=(e,t)=>{f.kol_schedule_infos[t].kol_ids=e},L=(0,s.computed)((()=>!e.detailData.allow_update_kol_schedule&&!!e.detailData.compass_shop_live_room_id));return{onSelectUserChanged:U,dialogTitle:i,conflict_data:k,...(0,s.toRefs)(f),isOptDisabled:h,liveDisplay:a,getKolList:g,deleteAnchor:D,addTimeLine:C,changeDate:x,kolWorkTime:T,changeTime:Y,deleteAnchorTime:w,verifyAnchor:y,save:S,closeDialog:I,getLimitTimeSetting:$,scheduleQuery:F,kol_name:j,isAutoObtain:L}}}),f=p,v=i(1001),h=(0,v.Z)(f,a,l,!1,null,"c463a53a",null),g=h.exports},47583:function(e,t,i){i.d(t,{Fy:function(){return r},S:function(){return s},U_:function(){return l},Yd:function(){return n},a$:function(){return o},js:function(){return _},uZ:function(){return d},xZ:function(){return c}});var a=i(76012);function l(e){return(0,a.ZP)({url:"/api/shop_live/end_project",method:"post",data:e})}function s(e){return(0,a.ZP)({url:"/api/shop_live/end_common_project",method:"post",data:e})}function o(e){return(0,a.ZP)({url:"/api/shop_live/update_project_try_live",method:"post",data:e})}function n(e){return(0,a.ZP)({url:"/api/medium/get_company_name_and_id",method:"get",params:e})}function r(e){return(0,a.ZP)({url:"/api/shop_live/update_area_execute",method:"post",data:e})}function _(e){return(0,a.ZP)({url:"/api/shop_live/save_kol_schedule",method:"post",data:e})}function d(e){return(0,a.ZP)({url:"/api/auth/get_user_by_role",method:"get",params:e})}function c(e){return(0,a.ZP)({url:"/api/shop_live/save_operator_schedule",method:"post",data:e})}},66870:function(e,t,i){var a;i.d(t,{Ix:function(){return o},dr:function(){return s},en:function(){return l},wG:function(){return a}}),function(e){e[e["waitingSchedule"]=1]="waitingSchedule",e[e["waitingLive"]=2]="waitingLive",e[e["waitingTypeIn"]=3]="waitingTypeIn",e[e["lived"]=4]="lived"}(a||(a={}));const l=new Map([[a.waitingSchedule,"待排班"],[a.waitingLive,"待直播"],[a.waitingTypeIn,"待录入"],[a.lived,"已直播"]]);new Map([[a.waitingSchedule,"yellow"],[a.waitingLive,"green"],[a.waitingTypeIn,"yellow"],[a.lived,"gray"]]);var s,o;(function(e){e[e["brand_name"]=1]="brand_name",e[e["studio_name"]=2]="studio_name",e[e["shop_name"]=3]="shop_name",e[e["project_uid"]=4]="project_uid",e[e["live_title"]=5]="live_title",e[e["kol_name"]=6]="kol_name",e[e["operation_assistant_name"]=7]="operation_assistant_name",e[e["project_name"]=8]="project_name"})(s||(s={})),function(e){e[e["Month"]=1]="Month",e[e["Week"]=2]="Week"}(o||(o={}))},82741:function(e,t,i){i.d(t,{I:function(){return l},u:function(){return s}});var a=i(71340);const l=(e,t)=>{const i="string"===typeof t?{title:t}:t;return new Promise((t=>{e.root.$TDialog({...i,onConfirm:()=>t(!0),onCancel:()=>t(!1)})}))},s=e=>{const t="string"===typeof e?{title:e}:e;return new Promise(((e,i)=>{(0,a.t)({...t,onConfirm:()=>e(!0),onCancel:()=>i()})}))}},44928:function(e,t,i){i.d(t,{t:function(){return l}});var a=i(86834);const l=()=>{const e=new Proxy({},{get(e,t){return Reflect.get(a.Z,t)}});return e}}}]);