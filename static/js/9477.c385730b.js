"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[9477],{80972:function(e,t,a){a.d(t,{Z:function(){return T}});a(26699);var n,o,i=a(36568),l=a.n(i),s=a(97434),r=a(11676),c=a(61282),u=a(57046),m=a(85937),d=a.n(m),p=a(6933),_=a.n(p),v=a(43773),f=a(79443),b=a(48606),y=a(28440),g=(0,s.defineComponent)({setup:(e,t)=>{const a=[{type:"selection",width:32,className:"selection"},{label:"项目名称",minWidth:116,prop:"project_name",showOverflowTooltip:!0},{label:"项目类型",minWidth:110,prop:"business_type",align:"center",formatter:e=>y.YW.get(e.business_type)},{label:"结算单号",minWidth:140,prop:"settlement_uid",align:"center"},{label:"结算周期",minWidth:168,align:"center",formatter:e=>{const t=_()(1e3*e.start_date).format("YYYY.MM.DD"),a=_()(1e3*e.end_date).format("YYYY.MM.DD");return h("div",[t," ～ ",a])}},{label:"结算金额 (元)",minWidth:120,align:"right",prop:"tax_included_amount",formatter:e=>{let t="";return e.tax_included_amount<0&&(t="color:#ED3434"),h("span",{style:t},[(0,c.dN)(e.tax_included_amount,"None")])}},{label:"未开票金额 (元)",minWidth:120,prop:"",align:"right",formatter:e=>{let t=e.tax_included_amount;const a=e.write_off_amount;1===e.has_refund_settlement&&(t=e.tax_included_amount-e.refund_amount);const n=t-a;return(0,c.dN)(n,"None")}}],n=(0,s.reactive)({data:[],loading:!1});let o=[];const i=()=>{0!==o.length?(t.emit("close"),t.emit("select",o)):b.Message.warning("未选择记录")},l=e=>{o.length=0,r(e)},r=e=>{n.loading=!0,(0,f.fO)("customer_company",{search_value:e,num:1e3,page_num:1,no_reverse:1,settlement_kind:1,search_type:6,is_tmp:0,is_estimate:0,status:2,invoice_write_off_type:1}).then((e=>{n.loading=!1,n.data=e.data.data.data})).catch((()=>{n.loading=!1}))},u=e=>{o=e};return{selectionChange:u,columns:a,tableData:n,onSaveBtnClick:i,show:l}},render(){const e=arguments[0];return e("div",{class:"quick-add-container"},[e("tg-table",{on:{"selection-change":this.selectionChange},attrs:{columns:this.columns,data:this.tableData.data,stripe:!0,border:!0,height:"100%"},directives:[{name:"loading",value:this.tableData.loading}]})])}}),w=g,k=a(1001),F=(0,k.Z)(w,n,o,!1,null,"1b25c4e8",null),j=F.exports,A=a(51351),x=a(3346),D=a(22895);const S=e=>{const t=(0,s.ref)(!1),a=(0,s.ref)([]),n=(0,s.ref)([]),o=(0,s.ref)([]),i=(0,s.ref)({company_name:"",num:1e5,page_num:1}),l=(0,s.ref)({collecting_company:"",tax_number:"",address:"",phone:"",bank_of_deposit:"",bank_card_number:"",approval_type:4,remark:"",attachment:[]}),r={project_name:""},c=async(t,a)=>{if(!(t+"".trim()))return r.project_name="",void a([]);if(r.project_name===t)return void a(n.value);r.project_name=t;const{data:o}=await(0,A.Fe)(r);o.success?(n.value=o.data,a(o.data)):(a([]),e.root.$message({type:"warning",message:o.message??"查询失败，稍后重试",duration:2e3,showClose:!0}))},u=async(t,n)=>{if(!t.trim())return n([]),i.value.company_name="",l.value.tax_number="",l.value.address="",l.value.phone="",l.value.bank_of_deposit="",void(l.value.bank_card_number="");if(i.value.company_name===t)return void n(a.value);i.value.company_name=t;const{data:o}=await(0,x.kg)(i.value);o.success?(a.value=o.data.data,n(o.data.data)):(n([]),e.root.$message({type:"warning",message:o.message??"查询失败，稍后重试",duration:2e3,showClose:!0}))},m=async(t,a=!1,n)=>{const{data:i}=await(0,f.fO)("approval",{page_num:1,num:1e4,no_confirmed_reverse:D.w.YES,project_id:t,is_estimate:0,is_tmp:0,is_confirmed:1,no_unity_settlement:1});i.success?a?n?.(i.data.data):o.value=i.data.data:a||e.root.$message({type:"warning",message:i.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},d=async a=>{t.value=!0;const{data:n}=await(0,A.c3)(a);return t.value=!1,n.success?(e.root.$message({type:"success",message:"开票成功",duration:2e3,showClose:!0}),Promise.resolve()):(e.root.$message({type:"warning",message:n.message??"申请失败，稍后重试",duration:2e3,showClose:!0}),Promise.reject())};return{submit:d,companyList:a,loadCompany:u,saveLoading:t,companyForm:l,settlementList:o,loadCooperation:c,cooperationList:n,companyQueryParams:i,loadSettlementData:m}};var M=a(64236);const Y=[{label:"快递寄送",value:1},{label:"自行送达",value:2}],C=[{label:"否",value:0},{label:"是",value:1}],B=[{label:"增值税普通发票",value:1},{label:"增值税专用发票",value:2},{label:"电子发票",value:3},{label:"收据",value:4}];var P,q,R=(0,s.defineComponent)({components:{},props:{confirm:{type:Function},edit:{type:Boolean,default:!1},data:{type:Object,default:()=>({})},reload:{type:Boolean,default:!1}},setup(e,t){const a=S(t),n=(0,s.ref)(!1),o=(0,s.computed)((()=>t.root.$store.getters["user/getUserInfo"].department_name)),i={invoice_type:[{required:!0,message:"请选择发票类型",trigger:"change"}],invoice_send_type:[{required:!0,message:"请选择寄送方式",trigger:"change"}],is_received:[{required:!0,message:"请选择是否收到款项",trigger:"change"}],received_date:[{required:!0,message:"请选择收款日期",trigger:"change"}]},l={collecting_company:[{required:!0,message:"请选择公司",trigger:"change"}],tax_number:[{required:!0,message:"请至客户管理功能完善信息",trigger:"blur"}],phone:[{required:!0,message:"请至客户管理功能完善信息",trigger:"blur"}],bank_of_deposit:[{required:!0,message:"请至客户管理功能完善信息",trigger:"blur"}],bank_card_number:[{required:!0,message:"请至客户管理功能完善信息",trigger:"blur"}],address:[{required:!0,message:"请至客户管理功能完善信息",trigger:"blur"}]},r=(0,s.ref)({invoice_amount:0,invoice_type:2,invoice_send_type:1,is_received:0,received_date:void 0,achievement_uid:""}),m=(0,s.ref)([{component:"el-select",prop:"invoice_type",label:"发票类型：",children:{key:"invoice_type",attrs:{placeholder:"请选择发票类型"}},selectOptions:{data:B,key:"label",val:"value",className:"send-type-option"}},{component:"el-select",prop:"invoice_send_type",label:"寄送方式：",children:{key:"invoice_send_type",attrs:{placeholder:"请选择寄送方式"}},selectOptions:{data:Y,key:"label",val:"value",className:"send-type-option"}}]),p=(0,s.ref)([{component:"el-select",prop:"is_received",label:"收到款项：",children:{key:"is_received",attrs:{placeholder:"请选择是否收到款项"}},on:{change:function(e){m.value[3].label=1===e?"收款时间：":"预计收款时间："}},selectOptions:{data:C,key:"label",val:"value",className:"send-type-option"}},{component:"el-date-picker",prop:"received_date",label:"预计收款日期：",children:{key:"received_date",type:"date"}}]),h=(0,s.computed)((()=>{const e=[...m.value];return 1!==w.value&&e.push(...p.value),e})),y=(0,s.ref)([{component:"el-autocomplete",prop:"collecting_company",label:"公司名称：",children:{key:"collecting_company",attrs:{placeholder:"请输入并选择公司名称",debounce:500}},on:{select:e=>{const{id:t,company_name:n,bank_account:o,address:i,bank_sub_name:l,cw_info_contact_phone:s,tax_id:r}=e;a.companyQueryParams.value.company_name=n,a.companyForm.value.company_id=t,a.companyForm.value.tax_number=r,a.companyForm.value.address=i,a.companyForm.value.phone=s,a.companyForm.value.bank_of_deposit=l,a.companyForm.value.bank_card_number=o,R()}}},{component:"el-input",prop:"tax_number",label:"纳税人识别号：",children:{key:"tax_number",attrs:{placeholder:"请输入纳税人识别号",disabled:!0}}},{component:"el-input",prop:"phone",label:"电话：",children:{key:"phone",attrs:{placeholder:"请输入电话",disabled:!0}}},{component:"el-input",prop:"bank_of_deposit",label:"开户支行：",children:{key:"bank_of_deposit",attrs:{placeholder:"请输入开户支行",disabled:!0}}},{component:"el-input",prop:"bank_card_number",label:"账号：",children:{key:"bank_card_number",attrs:{placeholder:"请输入账号",disabled:!0}}},{component:"el-input",prop:"address",label:"地址：",children:{key:"address",attrs:{placeholder:"请输入地址",disabled:!0}}}]),g=(0,s.ref)({head:[{text:"项目",required:!0},{text:"结算单编号",required:!0},{text:"结算金额"},{text:"开票金额",required:!0}],body:[{project_id:"",project_name:"",settlement_no:"",settlement_amount:"",invoice_amount:"",invoice_max_amount:"",write_off_amount:"0",business_type:0,settlement_no_disabled:!0}]}),w=(0,s.ref)(1),k=(t,o=0)=>{if(w.value=o,t){if(1!==o){const e=g.value.body[0];e.project_id=t.project_id+"",e.project_name=t.project_name,e.settlement_no=t.settlement_uid,e.settlement_amount=t.tax_included_amount?t.tax_included_amount+"":"0",1===t.has_refund_settlement&&(e.settlement_amount=String(t.tax_included_amount-t.refund_amount)),e.write_off_amount=t.write_off_amount?t.write_off_amount+"":"0",e.invoice_amount=new(d())(e.settlement_amount).sub(new(d())(e.write_off_amount)).toString(),e.business_type=t.business_type,e.settlement_no_disabled=!1,(0,f.aX)({settlement_no:t.settlement_uid}).then((t=>{t.data.success&&(e.invoice_amount=String(t.data.data.surplus_invoice_amount),e.invoice_max_amount=String(t.data.data.surplus_invoice_amount))}))}a.companyForm.value.company_id=t?.company_id,1!==o&&(a.companyForm.value.collecting_company=t?.company_detail?.company_name),a.companyForm.value.tax_number=t?.company_detail?.tax_id,a.companyForm.value.address=t?.company_detail?.address,a.companyForm.value.phone=t?.company_detail?.contact_phone,a.companyForm.value.bank_of_deposit=t?.company_detail?.bank_sub_name,a.companyForm.value.bank_card_number=t?.company_detail?.bank_account,a.companyForm.value.remark=void 0,a.companyForm.value.attachment=[],1!==o&&(0,x.fO)({settlement_ids:t.id}).then((e=>{if(e.data.success){const t=e.data.data;void 0===t.achievement_uid?(r.value.is_received=0,r.value.received_date=null):(r.value.is_received=1,r.value.received_date=new Date(t.write_off_time),r.value.achievement_uid=t.achievement_uid)}}))}else if(e.edit&&e.data){g.value.body=[],r.value.invoice_amount=e.data.invoice_amount,r.value.invoice_type=e.data.level_two_types,r.value.invoice_send_type=e.data.invoice_send_type,r.value.is_received=e.data.is_received,r.value.received_date=e.data.received_date,r.value.achievement_uid=e.data.achievement_uid;for(let t=0;t<e.data.details.length;t++){const n=e.data.details[t],o={project_id:n.project_id,project_name:n.project_name,settlement_no:n.settlement_no,settlement_amount:n.settlement_amount,invoice_amount:n.invoice_amount,invoice_max_amount:"",write_off_amount:n.write_off_amount,business_type:n.business_type,settlement_no_disabled:!0};g.value.body.push(o),a.loadSettlementData(n.project_id,!0,(e=>{const t=e.find((e=>e.id===n.settlement_id));t&&(o.settlement_amount=t.tax_included_amount,o.write_off_amount=t.write_off_amount,o.invoice_amount=new(d())(o.settlement_amount?o.settlement_amount:0).sub(new(d())(o.write_off_amount?o.write_off_amount:0)).toString(),T())}))}a.companyForm.value.company_id=e.data.company_id,a.companyForm.value.collecting_company=e.data.collecting_company,a.companyForm.value.tax_number=e.data.tax_number,a.companyForm.value.address=e.data.address,a.companyForm.value.phone=e.data.phone,a.companyForm.value.bank_of_deposit=e.data.bank_of_deposit,a.companyForm.value.bank_card_number=e.data.bank_card_number,a.companyForm.value.approval_type=e.data.approval_type,a.companyForm.value.remark=e.data.remark,a.companyForm.value.attachment=e.data.attachment}n.value=!0,T()},F=()=>{n.value=!1,g.value.body=[{project_id:"",project_name:"",settlement_no:"",settlement_amount:"",invoice_amount:"",invoice_max_amount:"",write_off_amount:"0",business_type:0,settlement_no_disabled:!0}],r.value.invoice_amount=0,r.value.invoice_type=2,r.value.invoice_send_type=1,r.value.is_received=0,r.value.received_date=void 0,r.value.achievement_uid="",a.companyForm.value.collecting_company="",a.companyForm.value.tax_number="",a.companyForm.value.address="",a.companyForm.value.phone="",a.companyForm.value.bank_of_deposit="",a.companyForm.value.bank_card_number="",a.companyForm.value.approval_type=4,a.companyForm.value.remark="",a.companyForm.value.attachment=[],t.refs.projectFormRef.resetFields(),t.refs.formRef.resetFields()},A=e=>{g.value.body.length<=1||(g.value.body.splice(e,1),T())},D=()=>{g.value.body.unshift({project_id:"",project_name:"",settlement_no:"",settlement_amount:"",invoice_amount:"",invoice_max_amount:"",write_off_amount:"0",business_type:0,settlement_no_disabled:!0})},P=(e,t,n)=>{e?(g.value.body[t].settlement_no_disabled=!1,a.loadSettlementData(e),g.value.body[t].settlement_no="",g.value.body[t].settlement_amount="",g.value.body[t].invoice_amount="",g.value.body[t].write_off_amount="0",g.value.body[t].project_id=e+"",g.value.body[t].business_type=n):(a.settlementList.value=[],g.value.body[t].settlement_no_disabled=!0)},q=()=>{if(!g.value.body.length)return Promise.reject();const e=g.value.body.filter((e=>e.invoice_amount));if(e.length===g.value.body.length){const e=(0,u.I8)(g.value.body),t=e.map((e=>{const{invoice_amount:t,project_id:a,settlement_no:n,business_type:o,shop_id:i}=e;return{invoice_amount:t,project_id:a,business_type:o,settlement_no:n,shop_id:i}}));return Promise.resolve(t)}return Promise.reject("请完善费用明细")},R=async()=>{try{return await t.refs.projectFormRef.validate(),Promise.resolve()}catch(e){return Promise.reject("请至客户管理功能完善信息")}},G=async()=>{try{await t.refs.formRef.validate();const n=await q();await R(),r.value.achievement_uid=r.value.is_received?r.value.achievement_uid:"";const o=(0,u.I8)(r.value);o.details=n,Object.assign(o,a.companyForm.value),o.attachment=a.companyForm.value.attachment.toString(),1===w.value&&(o.is_received=void 0,o.received_date=void 0),await a.submit(o),Promise.resolve().then((()=>{e.edit&&e.confirm()})).then((()=>{F()})).then((()=>{e.reload&&t.emit("success")}))}catch(n){if(n&&n.received_date){const e=n&&n.received_date?n.received_date[0]:"请完善表单信息";t.root.$message.warning(e)}else"请完善费用明细"!==n&&"请至客户管理功能完善信息"!==n||t.root.$message.warning(n)}},O=e=>{const t=_()(1e3*(e.start_date??0)).format("YYYY.MM.DD"),a=_()(1e3*(e.end_date??0)).format("YYYY.MM.DD"),n=(0,c.dN)(e.tax_included_amount);return`${e.settlement_uid} (${t} ~ ${a} ${n})`},T=()=>{const e=g.value.body.reduce(((e,t)=>e.add(new(d())(t.invoice_amount?t.invoice_amount:"0"))),new(d())(0));r.value.invoice_amount=e.toString()},N=(0,v.R)({title:"快速添加",component:j,width:"879px",okText:"确认",on:{select(e){let t;e.forEach((e=>{t={project_id:"",project_name:"",settlement_no:"",settlement_amount:"",invoice_amount:"",write_off_amount:"0",business_type:0,settlement_no_disabled:!0,...e},t.settlement_amount=e?.tax_included_amount,t.write_off_amount=e?.write_off_amount,t.settlement_no=e.settlement_uid,e&&1===e.has_refund_settlement&&(t.settlement_amount=e.tax_included_amount-e.refund_amount),t.invoice_amount=new(d())(t.settlement_amount?t.settlement_amount:"0").sub(new(d())(t.write_off_amount?t.write_off_amount:"0")).toString();const a=g.value.body.find((e=>e.settlement_no===t.settlement_no));a||g.value.body.unshift(t)})),g.value.body=g.value.body.filter((e=>e.settlement_no)),T()}}}),z=()=>{N.show(a.companyForm.value.company_id)},I=(0,s.reactive)({cycle:[],shop_id:"",match:async()=>{if(!(I.cycle&&I.cycle.length>1))return;const e=_()(I.cycle[0]).format("YYYY-MM"),t=_()(I.cycle[1]).format("YYYY-MM"),a=I.shop_id,n=await(0,x.eA)({start_month:e,end_month:t,shop_id:a});if(!n.data.success)return;const o=n.data.data;if(0===o.length)return void b.Message.success("未匹配到记录");let i;o.forEach((e=>{i={project_id:"",project_name:"",settlement_no:"",settlement_amount:"",invoice_amount:"",write_off_amount:"0",business_type:0,settlement_no_disabled:!0,...e},i.settlement_no=e.settlement_uid,i.settlement_amount=e.amount,i.write_off_amount=e.invoice_amount,i.invoice_amount=e.not_invoice_amount;const t=g.value.body.find((e=>e.settlement_no===i.settlement_no&&e.shop_id===i.shop_id));t||g.value.body.unshift(i)})),g.value.body=g.value.body.filter((e=>e.settlement_no)),T(),I.cycle=[],I.shop_id="",b.Message.success("匹配成功")}}),X=async e=>{const[t,{data:a}]=await Promise.all([await(0,M._v)(500),await(0,f.aX)({settlement_no:e})]);return a};return{onQuickAdd:z,show:k,hide:F,rules:i,visible:n,saveForm:G,projectForm:r,basicColumn:h,companyRules:l,projectChange:P,companyColumn:y,handleBrandAdd:D,department_name:o,chargeTableData:g,...a,handleBrandDelete:A,settlementInfoLabelStr:O,reset_invoice_amount:T,openBillType:w,openBillData:I,getSurplusInvoiceAmount:X}},render(){const e=arguments[0],t=e("el-form",l()([{},{attrs:{model:this.projectForm}},{attrs:{rules:this.rules,size:"small",inline:!0,"label-width":"106px"},ref:"formRef"}]),[e("el-form-item",{attrs:{label:"部门名称：",rules:[{required:!0,trigger:"change"}]},class:"common-input"},[e("el-input",{attrs:{disabled:!0},model:{value:this.department_name,callback:e=>{this.department_name=e}}})]),e("el-form-item",{attrs:{label:"开票金额：",rules:[{required:!0,trigger:"change"}]},class:"common-input"},[e("el-input",{attrs:{disabled:!0},model:{value:this.projectForm.invoice_amount,callback:e=>{this.$set(this.projectForm,"invoice_amount",e)}}})]),this.basicColumn.map((t=>{if("el-input"===t.component){const{label:a,className:n="",prop:o,children:i}=t;return e("el-form-item",{attrs:{label:a,prop:o},class:"common-input "+n},[e("el-input",l()([{},i,{model:{value:this.projectForm[i.key],callback:e=>{this.$set(this.projectForm,i.key,e)}}}]))])}if("el-select"===t.component){const{label:a,className:n="",prop:o,children:i,selectOptions:s,on:r}=t;return e("el-form-item",{attrs:{label:a,prop:o},class:"common-select "+n},[e("el-select",l()([{},{attrs:{...i.attrs}},{},{on:{...r}},{model:{value:this.projectForm[i.key],callback:e=>{this.$set(this.projectForm,i.key,e)}}}]),[s.data.map((t=>e("el-option",{class:s.className,key:t[s.key],attrs:{label:t[s.key],value:t[s.val]}})))])])}if("el-date-picker"===t.component){const{label:a,className:n="",prop:o,children:i}=t;return e("el-form-item",{attrs:{label:a,prop:o},class:"common-date-picker "+n,style:"width: 286px !important;margin-right: 0px;"},[e("el-date-picker",l()([{attrs:{placeholder:"请选择日期","value-format":"yyyy-MM-dd"}},i,{model:{value:this.projectForm[i.key],callback:e=>{this.$set(this.projectForm,i.key,e)}}}]))])}})),1===this.projectForm.is_received&&e("el-form-item",{attrs:{label:"收款编号：",prop:"achievement_uid",rules:[{required:!0,message:"请输入收款编号",trigger:"blur"}]},class:"common-input",style:"margin-right: 18px;"},[e("el-input",{attrs:{placeholder:"请输入收款编号"},model:{value:this.projectForm.achievement_uid,callback:e=>{this.$set(this.projectForm,"achievement_uid",e)}}})])]),a=e("div",{class:"charge-company"},[e("div",{class:"title"},["开票信息"]),e("el-form",l()([{},{attrs:{model:this.companyForm}},{attrs:{rules:this.companyRules,size:"small",inline:!0,"label-width":"106px"},ref:"projectFormRef"}]),[this.companyColumn.map((t=>{if("el-input"===t.component){const{label:a,className:n="",prop:o,children:i}=t;return e("el-form-item",{attrs:{label:a,prop:o},class:"common-input "+n},[e("el-input",l()([{},i,{},{attrs:{...i.attrs}},{model:{value:this.companyForm[i.key],callback:e=>{this.$set(this.companyForm,i.key,e)}}}]))])}if("el-autocomplete"===t.component){const{label:a,className:n="",prop:o,children:i,on:s}=t;return e("el-form-item",{attrs:{label:a,prop:o},class:"common-select "+n},[e("el-autocomplete",l()([{attrs:{"popper-class":"qnmlgb-sss","fetch-suggestions":this.loadCompany,"value-key":"company_name"}},{attrs:{...i.attrs}},{},{on:{...s}},{model:{value:this.companyForm[i.key],callback:e=>{this.$set(this.companyForm,i.key,"string"===typeof e?e.trim():e)}}}]))])}}))])]);return e("el-dialog",{class:"tg-dialog-classic tg-dialog-vcenter-new tg-invoice-dialog",attrs:{width:"940px",visible:this.visible,"close-on-click-modal":!1,"close-on-press-escape":!1,wrapperClosable:!1},on:{close:this.hide}},[e("template",{slot:"title"},["开票申请"]),e("div",{class:"new-initiate-invoice"},[e("div",{class:"basic-info"},[e("div",{class:"title"},["基本信息"]),t,a,e("div",{class:"charge-details"},[e("div",{class:"title"},["费用明细",this.companyForm.company_id&&1!==this.openBillType&&e("tg-button",{attrs:{type:"link"},style:"font-size:14px",on:{click:this.onQuickAdd}},["快速添加"])]),e("div",[1===this.openBillType&&e("div",{class:"charge-tools"},[e("div",["开票结算周期："]),e("div",[e("el-date-picker",{attrs:{"range-separator":"~",size:"small",type:"monthrange"},style:"width:100%",model:{value:this.openBillData.cycle,callback:e=>{this.$set(this.openBillData,"cycle",e)}}})]),e("div",["开票商家ID："]),e("div",[e("el-input",{attrs:{size:"small"},style:"width:100%",model:{value:this.openBillData.shop_id,callback:e=>{this.$set(this.openBillData,"shop_id",e)}}})]),e("div",[e("tg-button",{attrs:{type:"primary"},style:"width:100%",on:{click:this.openBillData.match}},["匹配"])])])]),e("div",{class:"charge-table"},[e("div",{class:"charge-table-head"},[e("div",{class:"charge-table-tr"},[this.chargeTableData.head.map((t=>"结算单编号"===t.text?e("div",{class:"charge-table-td"},[this.chargeTableData.body.some((e=>5===e.business_type))?"":e("span",{class:"required"},["*"]),e("span",{class:"label"},[t.text])]):e("div",{class:"charge-table-td"},[e("span",{class:"required"},["*"]),e("span",{class:"label"},[t.text])]))),e("div",{class:"charge-table-td delete"},[e("span",{class:"label"},["操作"])])])]),e("div",{class:"charge-table-body"},[this.chargeTableData.body.map(((t,a)=>e("div",{class:"charge-table-tr"},[e("div",{class:"charge-table-td"},[e("el-autocomplete",{attrs:{size:"small","fetch-suggestions":(e,t)=>{this.loadCooperation(e,t),e+"".trim()||(this.chargeTableData.body[a].settlement_no="",this.chargeTableData.body[a].settlement_amount="",this.chargeTableData.body[a].invoice_amount="",this.chargeTableData.body[a].business_type=0,this.chargeTableData.body[a].write_off_amount="0",this.settlementList=[])},"value-key":"project_name",placeholder:"请输入并选择项目"},on:{select:e=>{this.projectChange(e.id,a,e.business_type)}},model:{value:t.project_name,callback:e=>{this.$set(t,"project_name","string"===typeof e?e.trim():e)}}})]),e("div",{class:"charge-table-td"},[e("el-select",{attrs:{placeholder:"请选择结算编号",disabled:t.settlement_no_disabled,size:"small"},on:{change:async e=>{const a=await this.getSurplusInvoiceAmount(t.settlement_no),n=this.settlementList.find((t=>e.includes(t.settlement_uid)));t.settlement_amount=n?.tax_included_amount,t.write_off_amount=n?.write_off_amount,n&&1===n.has_refund_settlement&&(t.settlement_amount=n.tax_included_amount-n.refund_amount),a.success&&a.data?(t.invoice_amount=a.data.surplus_invoice_amount,t.invoice_max_amount=a.data.surplus_invoice_amount):t.invoice_amount=new(d())(t.settlement_amount?t.settlement_amount:"0").sub(new(d())(t.write_off_amount?t.write_off_amount:"0")).toString(),this.reset_invoice_amount()}},model:{value:t.settlement_no,callback:e=>{this.$set(t,"settlement_no",e)}}},[this.settlementList.map((t=>{const a=this.chargeTableData.body.map((e=>e.settlement_no));return e("el-option",{class:"send-type-option",attrs:{disabled:a.includes(t.settlement_uid),label:this.settlementInfoLabelStr(t),value:t.settlement_uid},key:t.settlement_uid})}))])]),e("div",{class:"charge-table-td"},[e("el-input",{attrs:{disabled:!0,placeholder:"请输入结算金额",size:"small"},model:{value:t.settlement_amount,callback:e=>{this.$set(t,"settlement_amount",e)}}})]),e("div",{class:"charge-table-td"},[e("el-input",{attrs:{placeholder:"请输入开票金额",size:"small",value:t.invoice_amount},on:{input:e=>{if(!Number(e))return t.invoice_amount="",this.reset_invoice_amount(),!1;let a=new(d())(t.settlement_amount?t.settlement_amount:0).sub(new(d())(t.write_off_amount?t.write_off_amount:0));t.invoice_max_amount&&(a=new(d())(t.invoice_max_amount)),new(d())(e||"0").greaterThan(a)&&(this.$message.warning(`开票金额最多是${a.toNumber()}`),t.invoice_amount=a.toString()),t.invoice_amount=new(d())(e||0).greaterThanOrEqualTo(new(d())(a||0))?a.toNumber():(0,c.nA)(e),this.reset_invoice_amount()}}})]),e("div",{class:"charge-table-td delete"},[e("tg-icon",{attrs:{disabled:this.chargeTableData.body.length<=1,name:"ico-btn-delete"},class:"ico-btn",on:{click:()=>{this.handleBrandDelete(a)}}})])])))]),e("div",{class:"charge-table-btn"},[e("el-button",{attrs:{disabled:this.chargeTableData.body.length>=7,size:"mini",type:"text",icon:"el-icon-plus"},on:{click:()=>{this.handleBrandAdd()}}},["添加明细"])])])]),e("div",{class:"charge-company"},[e("el-form",{attrs:{size:"small",inline:!0,"label-width":"106px"}},[e("el-form-item",{attrs:{label:"备注："},class:"common-input-textarea",style:"display:block;width:800px !important"},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",maxlength:"50","show-word-limit":!0},style:"width: 484px",model:{value:this.companyForm.remark,callback:e=>{this.$set(this.companyForm,"remark",e)}}})]),e("el-form-item",{attrs:{label:"附件："},style:"margin-right:0;display:block;width:900px !important"},[e("tg-upload",{attrs:{action:"/api/approval/upload_approval_attachment","show-file-list":!1,disabled:this.companyForm.attachment.length>=5,beforeUpload:r.Z.ValidationFileUpload({file:!0,image:!0,excel:!0,fileSize:30}),success:e=>{this.companyForm.attachment.push(e.data.source)}}},[e("tg-button",{attrs:{disabled:this.companyForm.attachment.length>=5,name:"ico-upload",icon:"ico-btn-upload",size:"small"}},["上传附件"]),e("span",{class:"file-tips"},["支持扩展名：.docx .doc .xls .xlsx .jpg .png； 最多上传5个文件（单个文件大小不超过30M）"])]),e("upload-file-list",{class:"invoice-upload-list",attrs:{inline:!0},model:{value:this.companyForm.attachment,callback:e=>{this.$set(this.companyForm,"attachment",e)}}})])])])])]),e("template",{slot:"footer"},[e("tg-button",{on:{click:this.hide}},["取消"]),e("tg-button",{attrs:{type:"primary"},on:{click:this.saveForm},directives:[{name:"loading",value:this.saveLoading}]},["保存"])])])}}),G=R,O=(0,k.Z)(G,P,q,!1,null,"263b25e6",null),T=O.exports},34137:function(e,t,a){a.d(t,{G1:function(){return m},GF:function(){return d},Jr:function(){return c},KY:function(){return s},QC:function(){return l},S8:function(){return u},pt:function(){return r},vf:function(){return p}});var n=a(76012),o=a(42963),i=a(74750);function l(e){return(0,n.ZP)({url:"/api/shop_live/get_shop_live_project_id_list",method:"get",params:e})}function s(e){const t=o.stringify(e),a=(0,i.LP)();window.open(`https://data.goumee.com/api/financial/export_pay_list?${t}&Authorization=${a}`)}function r(e){return(0,n.ZP)({url:"/api/financial/cost_split",method:"post",data:e})}function c(e){return(0,n.ZP)({url:"/api/financial/save_cost_invoice_list",method:"post",data:e})}function u(e){return(0,n.ZP)({url:"/api/financial/confirm_pay",method:"post",data:e})}const m=e=>(0,n.SO)("/api/resources/upload_certificate",e);function d(e){return(0,n.ZP)({url:"/api/financial/associate",method:"post",data:e})}const p=e=>(0,n.SO)("/api/financial/save_invoice_tmp",e)},25702:function(e,t,a){a.d(t,{Bp:function(){return u},Hz:function(){return d},KR:function(){return c},MI:function(){return i},YB:function(){return o},YG:function(){return p},bg:function(){return r},cW:function(){return s},es:function(){return m},lX:function(){return l},s2:function(){return n}});const n="/api/approval/save_transfer_apply",o="/api/approval/query_approval_list",i="/api/approval/query_approval_info",l="/api/approval/update_approval_info",s="/api/approval/query_approval_id_list",r="/api/approval/save_invoice_apply",c="/api/approval/save_refund_apply",u="/api/approval/save_borrowing_apply",m="/api/approval/query_all_projects",d="/api/approval/delete",p="/api/approval/save_not_contract_use_seal"},28440:function(e,t,a){a.d(t,{AR:function(){return l},Mi:function(){return s},PP:function(){return i},YW:function(){return n},qZ:function(){return o}});const n=new Map([[1,"营销业务"],[3,"抖音店播"],[2,"淘宝店播"],[4,"基地业务"],[5,"S2B2C"],[6,"区域店播"]]),o=new Map([[2,"淘宝"],[1,"抖音"]]),i=new Map([[1,"直播"],[2,"视频"],[3,"图文"]]),l=new Map([[1,"V任务"],[2,"支付宝"],[3,"对公银行"],[4,"阿里妈妈"],[5,"巨量百应"]]),s=new Map([[1,"银行卡"],[2,"V任务"],[3,"对公银行"],[4,"支付宝"]])},3346:function(e,t,a){a.d(t,{Ln:function(){return c},Me:function(){return p},OV:function(){return s},Ou:function(){return u},Pp:function(){return h},Tf:function(){return v},_F:function(){return f},eA:function(){return b},fO:function(){return y},hk:function(){return d},kg:function(){return r},mb:function(){return m},qC:function(){return _},vt:function(){return l}});var n=a(76012),o=a(10762),i=a(64236);const l=async(e,t)=>(0,n.dX)(o.y9,{params:{...(0,i.jG)({company_name:e,company_id:t})}}),s=async e=>(0,n.dX)(o.CH,{params:{...(0,i.jG)({project_uid:e})}}),r=async e=>(0,n.dX)(o.hV,{params:{...(0,i.jG)(e)}}),c=async e=>(0,n.dX)(o.yp,{params:{...(0,i.jG)(e)}}),u=async e=>(0,n.SO)(o.IY,{...(0,i.jG)(e)}),m=async e=>(0,n.SO)(o.Gs,{...(0,i.jG)(e)}),d=async e=>(0,n.SO)(o.Gs,{...e}),p=async e=>(0,n.dX)(o.S$.replace(":id",e)),_=async e=>(0,n.dX)(o.ii,{params:{...(0,i.jG)(e)}}),v=async e=>(0,n.dX)(o.AP,{params:{...(0,i.jG)(e)}}),h=async e=>(0,n.dX)(o.L6,{params:{...(0,i.jG)(e)}}),f=async e=>(0,n.SO)("/api/shop_live/save_withdraw",{...e}),b=async e=>(0,n.dX)("/api/settlement/get_settlement_by_shop_id",{params:{...(0,i.jG)(e)}}),y=async e=>(0,n.dX)("/api/settlement/query_settlements_last_achievement",{params:{...(0,i.jG)(e)}})},51351:function(e,t,a){a.d(t,{Fe:function(){return d},OC:function(){return s},Qv:function(){return _},RA:function(){return v},aM:function(){return u},c3:function(){return p},kX:function(){return l},qL:function(){return c},t:function(){return r},z3:function(){return m}});var n=a(76012),o=a(25702),i=a(64236);const l=async e=>(0,n.dX)(o.YB,{params:{...(0,i.jG)(e)}}),s=async e=>(0,n.dX)(o.MI,{params:{...(0,i.jG)(e)}}),r=async e=>(0,n.SO)(o.Hz,{approval_id:e}),c=async e=>(0,n.SO)(o.lX,{...(0,i.jG)(e)}),u=async e=>(0,n.SO)(o.s2,{...(0,i.jG)(e)}),m=async e=>(0,n.SO)(o.KR,{...(0,i.jG)(e)}),d=async e=>(0,n.dX)(o.es,{params:{...(0,i.jG)(e)}}),p=async e=>(0,n.SO)(o.bg,{...(0,i.jG)(e)}),_=async e=>(0,n.SO)(o.Bp,{...(0,i.jG)(e)}),v=async e=>(0,n.SO)(o.YG,{...(0,i.jG)(e)})},17496:function(e,t,a){a.d(t,{Im:function(){return m},M4:function(){return d},Mi:function(){return i},d:function(){return c},e5:function(){return l},h2:function(){return o},lQ:function(){return u},q6:function(){return s},rw:function(){return n},xN:function(){return r}});const n=e=>{let t="";switch(e){case 1:t="普通发票";break;case 2:t="专用发票";break;case 3:t="电子发票";break;case 4:t="收据";break}return t},o=e=>{let t="";switch(e){case 1:t="待审批";break;case 2:t="审批成功";break;case 3:t="审批失败";break;case 4:t="审批中";break;case 5:t="作废";break}return t},i=e=>{let t="";switch(e){case 1:t="对公银行";break;case 2:t="支付宝";break;case 3:t="V任务";break;case 4:t="淘宝联盟";break;case 5:t="巨量百应";break}return t},l=e=>{let t="";switch(e){case 1:t="不用印章";break;case 2:t="公章";break;case 3:t="合同章";break}return t},s=e=>{const t=[{value:"",label:"全部"},{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},r=e=>{const t=[{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},c=e=>{const t=[{value:"",label:"全部",img:a(4275)},{value:1,label:"正常",img:a(4275)},{value:2,label:"停用",img:a(59463)}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},u=e=>{const t=[{value:1,label:"正常",img:a(4275)},{value:2,label:"停用",img:a(59463)}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},m=e=>{const t=[{value:3,label:"执行结束"},{value:1,label:"正常结束"},{value:2,label:"意外终止"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},d=e=>{const t=[{value:1,label:"退款"},{value:2,label:"其他"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t}},57046:function(e,t,a){a.d(t,{I8:function(){return o},X1:function(){return i},mr:function(){return n}});a(26699);function n(e,t="yyyy-MM-dd"){var a=new Date(e),n={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var o in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+o+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[o]:("00"+n[o]).substr((""+n[o]).length)));return t}function o(e){const t=e.constructor===Array?[]:{};for(let a in e)e.hasOwnProperty(a)&&(e[a]&&"object"===typeof e[a]?(t[a]=e[a].constructor===Array?[]:{},t[a]=o(e[a])):t[a]=e[a]);return t}function i(e,t,a){const n=e.target.value,o=/^[1-9]\d*$/;e.target.value=o.test(n)?n:"",t[a]=o.test(n)?n:""}},4275:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAACY0lEQVRIS72WS2gTURSG/39molB1owgmEcSFr6UFwQpFXLhzIWg3gpKpQlGxmK5FsLjO2BZEgpqu3PhAcaMIPlCwYLVb68ZNphGhGysuTGaO3Mmjk0ySmSQyWWRzzznfvf95zCEi/M7P2gfdCk4CMipgmkRKuYlghRAb4HvNwNN7k+mlsHDsZmBapdOAe1NE9oUFUucklwHtWiGbfNTJvi3wwtyP3ZVy5QGAw1FAbWwWjIRx5u6VHd9bzwJAc7Z0VBz3MUS29QmrupGr1LVThcnkO3+cJqCCwXFeiSAxEKzmTKIMXT/uhzaAnowV59PALwtoyFXD0A/V5W0AM7nixwFyFibIwvzUzhFPafWnqlHEeRjmNcg5qY+p6q0B7a9RSz8MSnIR4BNAzorIgbq9aplCNr2fqqmdinwJCxTlnOSzxFBqLD/BsmmtDIu4n/1+usFhmjn7hkCuRwnYzcYP89J0q3hCXDxvbglO08wVXwtwbBBgKywz83MP3b9vRaojsCEr8IaZnL0MyN4AUDUusORdRkTvdKGosNo0+EbTstdEZHPTTYhyAht35bPbS+aMfQQOXghkS7DF1nOmzjq9zFc4v9sCQf7aMMRkfiL1RxmPW8UREb70Q3t7We194FpnSTXtzvzV1MX67fzQfmDrknYpGg28fX8qfbkZikuJTelxVfpRZAwUTVhbtEL9AcJyFsg5OB2p8dtBe4UpuNf4XpNa4aPND+0H1hhtVWC04U3yg0AWKTgnwNZehkXT8PaSH+fnSQFj/wB70sa5YtTzEesSVYfGuib6Ky+2Rbi13P/nqv8P5s5/9F7zttAAAAAASUVORK5CYII="},59463:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAABoklEQVRIS8WWvS9DYRTGn3OvsojFIkyWspJIGEQMdomPoU3tiP4DREr4B26DXdMOPhK7hIiBRMKqXUzEYlELde8jb79cba9708rrjvd93vPLOe/5EgT4uLcwhII9DWAcwj4AveVrT6A8ArhEyDyRxf07P3Pym4A70VnY2CI44GdInQskCxNrspw+8tI3BDIZ6wedDMHRIKBajUCuIUZEVlIP9Wc1f7gbm4DtHJPsbgZWuSMiLzCNGVlKXbjt/PCwDDslGWoF5oIWYBpTbmgVWAwjnJtWPasLofIUxkglvN9AK3rV7Jv5RUO9qcTTY6XEAqCykTYP/S62ci6mzKnsLQGt6L1X6guMVZhdFuzXOOFsN4IG00hW4ulBUUXNwuetZ930hDtkPvHBg0Q7n3PvDYEBNMVwhtqGhVZ0g+C6F9CIZ6rv7FgRNtIF0ZQbw6YCnhGc1AQ8FyYjWRJhLUBBTgHzJDo1Ad/0AiH5fwip9qTRXha6C197a/uX5l32Ut94KgJ1D+AitLTP6FkxKq1N6xJVhepcE91NXNsiXDs5/nLV/wKlVVvrwv5A5wAAAABJRU5ErkJggg=="}}]);