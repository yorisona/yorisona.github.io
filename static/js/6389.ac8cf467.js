"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[6389],{73297:function(e,t,a){a.d(t,{Z:function(){return T}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic settlement-investment-dialog tg-dialog-vcenter-new",attrs:{visible:e.dialogVisible,width:e.dialogWidth,"before-close":e.beforeClose,"lock-scroll":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:e.close},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("招商结算")]},proxy:!0}])},[a("div",{staticClass:"settlement-dialog-content",style:{width:e.dialogWidth}},[a("div",{staticClass:"steps-line",style:{width:e.dialogWidth}},[a("div",{staticClass:"steps",class:e.is_virtual_receipt?"plus":"normal"},[e._l(e.steps,(function(t,n){return[a("div",{key:n,staticClass:"step",class:{finish:n<e.activeNumber,process:n===e.activeNumber,wait:n>e.activeNumber}},[n<e.activeNumber?a("div",{staticClass:"step-icon"},[a("tg-icon",{attrs:{name:"ico-right"}})],1):a("div",{staticClass:"step-icon"},[e._v(e._s(n+1))]),a("div",{staticClass:"step-title"},[e._v(e._s(t.title))])]),n<2?[a("div",{key:"line-"+n,staticClass:"step-line"})]:e._e()]}))],2)]),a(e.formComponent,{ref:"stepCompRef",tag:"component",staticClass:"settlement-dialog-content-base",on:{cancel:e.close,prev:e.prev,next:e.next,"submit:success":e.onSubmitSuccess}})],1)])},o=[],s=a(97434),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-income-investment-settlement-step1-container"},[a("el-form",{ref:"formRef",attrs:{model:e.dataForm,"label-width":"70px",size:"small"}},[a("el-form-item",{attrs:{label:"招商人员"}},[a("div",{staticClass:"value"},[e._v(e._s(e.merchant_user))])]),a("el-form-item",{staticStyle:{margin:"11px 0"},attrs:{label:"执行场次",prop:"shop_live_id",rules:[{required:!0,message:"请选择执行场次",trigger:"change"}]}},[a("el-select",{staticStyle:{width:"328px"},model:{value:e.dataForm.shop_live_id,callback:function(t){e.$set(e.dataForm,"shop_live_id",t)},expression:"dataForm.shop_live_id"}},e._l(e.shop_live_list,(function(e){return a("el-option",{key:e.id,attrs:{label:e.live_title,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"结算周期"}},[a("div",{staticClass:"value"},[e._v(e._s(e.settlement_cycle_str))])])],1),a("div",{staticClass:"bottom-button-line"},[a("tg-button",{on:{click:e.prev}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")])],1),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"正在保存，请稍候..."}})],1)},l=[],u=a(71963),r=a(28348),c=(0,s.defineComponent)({setup(e,t){const a=(0,s.inject)("merchant_goods")??(0,s.ref)(void 0),n=(0,s.inject)("settlement")??(0,s.ref)(void 0),o=(0,s.ref)(!1),i=(0,s.ref)(void 0),l=(0,s.ref)({shop_live_id:n.value?.shop_live_info_id}),c=(0,s.computed)((()=>{const e=a.value?.add_by_name||n.value?.merchant_add_by_username;return e||"--"})),d=(0,s.ref)([]),_=(0,s.computed)((()=>{const e=d.value.find((e=>e.id===l.value.shop_live_id));return e?`${e?.live_start_time.replace(/-/g,".")} - ${e?.live_end_time.replace(/-/g,".")}`:"--"})),m={prev:()=>{t.emit("cancel")},next:async()=>{m.isModify?i.value?.validate((e=>{e&&m.saveBaseInfoRequest()})):t.emit("next")},confirmBeforeClose:()=>!1,isModify:()=>!0,saveBaseInfoRequest:async()=>{const e=d.value.find((e=>e.id===l.value.shop_live_id)),a={id:n.value?.id,step:r.br.step_two,shop_live_info_id:l.value.shop_live_id,shop_live_live_goods_id:e?.shop_live_live_goods_id};o.value=!0;const s=await(0,u.eD)(a);o.value=!1,s.data.success?(t.root.$message.success(s.data.message??"保存成功"),t.emit("next",s.data.data)):t.root.$message.error(s.data.message??"保存失败")},querySettlementShopLiveRequest:async()=>{const e=await(0,u.jJ)(a.value?.id||n.value?.json_data?.goods_id);e.data.success?(d.value=e.data.data.data??[],l.value.shop_live_id||(l.value.shop_live_id=d.value[0]?.id)):d.value=[]}};return(0,s.onMounted)((()=>{m.querySettlementShopLiveRequest()})),{formRef:i,dataForm:l,settlement:n,saveLoading:o,merchant_user:c,shop_live_list:d,settlement_cycle_str:_,...m}}}),d=c,_=a(1001),m=(0,_.Z)(d,i,l,!1,null,null,null),v=m.exports,p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SettlementStep2Layout",{staticClass:"tg-income-investment-settlement-step2-container",attrs:{leftItemExpand:!0},scopedSlots:e._u([{key:"top",fn:function(){return[a("top-card",{attrs:{amount:e.total_amount,taxed:e.dataForm.is_include_tax,type:"value1",tax_rate_disabled:!1,tax_rate:e.dataForm.tax_rate},on:{taxRateChanged:e.taxRateChanged,taxedChanged:e.taxedChangedHandler,valueChange:e.taxValueChangeHandler}})]},proxy:!0},{key:"left",fn:function(){return[a("CardLayout",{staticClass:"settlement-left-block",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.25)"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.company_name))]},proxy:!0}])},[a("el-form",{attrs:{size:"small","label-position":"top"}},[a("div",{staticStyle:{color:"#6a7b92"}},[a("div",[a("span",[e._v("商品编码")]),a("span",{staticStyle:{"margin-left":"10px",color:"#3c5269"}},[e._v(e._s(e.dataForm.json_data.product_code))])]),a("div",{staticClass:"mgt-18"},[a("span",[e._v("商品名称")]),a("span",{staticStyle:{"margin-left":"10px",color:"#3c5269"}},[e._v(e._s(e.dataForm.json_data.product_name))])])]),a("el-form-item",{staticClass:"mgt-18",attrs:{label:"招商项目结算收入"}},[a("el-input",{staticStyle:{width:"306px"},attrs:{value:e.merchants_project.income_amount},on:{input:function(t){return e.onMerchantsInputChanged(t)}}})],1),a("el-form-item",{attrs:{label:e.execute_project.project_name+"项目结算收入"}},[a("el-input",{staticStyle:{width:"306px"},attrs:{value:e.execute_project.income_amount},on:{input:function(t){return e.onExecuteInputChanged(t)}}})],1)],1)],1)]},proxy:!0},{key:"right",fn:function(){return[a("el-form",{attrs:{size:"small"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("TgAdjustAccountForm",{attrs:{ExtendItem:"project",ExtendItemSelectOptions:e.selectedPrjectList,adjust_info:e.dataForm.adjust_info},on:{DataChange:e.onAdjustAccountDataChange}})],1)]},proxy:!0},{key:"button",fn:function(){return[a("tg-button",{on:{click:e.prev}},[e._v("上一步")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")])]},proxy:!0},{key:"mask",fn:function(){return[a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"正在保存，请稍候..."}})]},proxy:!0}])})},f=[],g=a(32851),x=a(94559),h=a(99048),y=a(97457),b=a(57046),j=a(85937),C=a.n(j),S=a(41572),k=(0,s.defineComponent)({components:{TopCard:x.Z,CardLayout:h.Z,TgAdjustAccountForm:y.Z,SettlementStep2Layout:g.Z},setup(e,t){const a=(0,s.inject)("settlement")??(0,s.ref)(void 0),n=(0,s.ref)({json_data:a.value?.json_data??{company_info_list:[],product_code:void 0,product_name:void 0},adjust_info:a.value?.adjust_info??[],is_include_tax:void 0!==a.value?.is_include_tax&&null!==a.value?.is_include_tax?a.value.is_include_tax:1,tax_amount:a.value?.tax_amount?`${a.value.tax_amount}`:"",tax_excluded_amount:a.value?.tax_excluded_amount?`${a.value.tax_excluded_amount}`:"",tax_included_amount:a.value?.tax_included_amount?`${a.value.tax_included_amount}`:"",tax_rate:void 0===a.value?.tax_rate||null===a.value?.tax_rate?"6":`${a.value.tax_rate}`}),o=(0,s.ref)((0,b.I8)(n.value)),i=(0,s.computed)((()=>a.value?.company_name?a.value?.company_name:"--")),l=(0,s.computed)((()=>n.value.json_data.company_info_list.find((e=>e.type===r.Cy.merchant_project)))),c=(0,s.computed)((()=>n.value.json_data.company_info_list.find((e=>e.type===r.Cy.execute_project)))),d=(0,s.ref)(!1),_=(0,s.computed)((()=>{let e=new(C())(0);return n.value.adjust_info?.forEach((t=>{let a=t.adjust_amount?t.adjust_amount:0;a=isNaN(Number(a))?0:a,e=new(C())(a).add(e)})),n.value.json_data.company_info_list?.forEach((t=>{let a=t.income_amount?t.income_amount:0;a=isNaN(Number(a))?0:a,e=new(C())(a).add(e)})),e.toFixed(2)})),m=(0,s.ref)([{type:r.Cy.execute_project,name:"执行项目"},{type:r.Cy.merchant_project,name:"招商项目"}]),v={prev:()=>{v.isModified()?v.saveSettlementDataRequest(r.GG.prev):t.emit("prev")},next:async()=>{v.saveSettlementDataRequest()},confirmBeforeClose:async()=>v.isModified(),saveBeforeClose:()=>v.saveSettlementDataRequest(r.GG.close),taxRateChanged:e=>{n.value.tax_rate=e},taxedChangedHandler:e=>{n.value.is_include_tax=e?1:0},taxValueChangeHandler:e=>{n.value.is_include_tax=0===e.is_include_tax?0:1,n.value.tax_included_amount=e.tax_included_amount?.toString()??"",n.value.tax_excluded_amount=e.tax_excluded_amount?.toString()??"",n.value.tax_amount=e.tax_amount?.toString()??""},onAdjustAccountDataChange:e=>{n.value.adjust_info=e},isModified:()=>{const e=JSON.stringify(o.value),t=JSON.stringify(n.value);return e!==t},getAdjustInputNumber:e=>(/(?:(?:0|[1-9]\d{0,7})(?:\.\d{0,2})?)?/u.exec(e.replace(/[^-.\d]+/gu,"").replace(S.Pj,""))??[""])[0],onMerchantsInputChanged:e=>{l.value&&(l.value.income_amount=v.getAdjustInputNumber(e))},onExecuteInputChanged:e=>{c.value&&(c.value.income_amount=v.getAdjustInputNumber(e))},checkDataForSave:()=>n.value.adjust_info?.find((e=>isNaN(Number(e.adjust_amount))))?(t.root.$message.warning("请输入正确的调整金额"),!1):n.value.adjust_info?.find((e=>0===Number(e.adjust_amount)&&e.adjust_amount))?(t.root.$message.warning("调整金额不能为0"),!1):n.value.adjust_info?.find((e=>!e.adjust_amount&&e.adjust_reason||e.adjust_amount&&!e.adjust_reason))?(t.root.$message.warning("请完善手工调账信息"),!1):!(Number(_.value)<=0)||(t.root.$message.warning("总结算金额不能小于等于0"),!1),saveSettlementDataRequest:async(e=r.GG.next)=>{if(e===r.GG.next){if(!v.checkDataForSave())return;if(!v.isModified()&&(0===a.value?.is_include_tax||1===a.value?.is_include_tax))return void t.emit("next")}const o={id:a.value?.id,step:e===r.GG.next?r.br.step_three:r.br.step_two,total_settle_amount:_.value,adjust_info:n.value.adjust_info?.filter((e=>e.adjust_amount||e.adjust_reason))??[],is_include_tax:n.value.is_include_tax,tax_amount:n.value.tax_amount,tax_rate:""===n.value.tax_rate?"0":n.value.tax_rate??"0",tax_included_amount:n.value.tax_included_amount,tax_excluded_amount:n.value.tax_excluded_amount,json_data:n.value.json_data};d.value=!0;const s=await(0,u.We)(o);if(d.value=!1,s.data.success){switch(e){case r.GG.next:t.emit("next",s.data.data),t.root.$message.success("保存成功");break;case r.GG.prev:t.emit("prev",s.data.data);break;default:t.root.$message.success("保存成功");break}return!0}return t.root.$message.error(s.data.message??"保存失败"),!1}};return(0,s.onMounted)((()=>{o.value=(0,b.I8)(n.value)})),{company_name:i,saveLoading:d,total_amount:_,selectedPrjectList:m,dataForm:n,merchants_project:l,execute_project:c,...v}}}),$=k,w=(0,_.Z)($,p,f,!1,null,null,null),G=w.exports,q=a(87425),D=a(82741),F=a(46024),N=a(22895),R=(0,s.defineComponent)({name:"TgInvestmentSettlementDialog",components:{Step1:v,Step2:G,Step3:q.Z},setup(e,t){const a=(0,s.ref)(!1),n=(0,s.ref)(void 0),o=(0,s.ref)(void 0);(0,s.provide)("settlement",n),(0,s.provide)("merchant_goods",o);const i=(0,s.ref)(0),l=(0,s.ref)(0),u=(0,s.ref)(0),r=(0,s.ref)(null);(0,s.watch)((()=>i.value),((e,a)=>{e!==a&&t.root.$nextTick((()=>{r.value?.fillForm?.(n.value,u.value)}))})),(0,s.watch)((()=>l.value),((e,a)=>{e!==a&&t.root.$nextTick((()=>{r.value?.fillForm?.(n.value)}))}));const c=(0,F.or)((0,F.xD)((0,F.or)((0,s.computed)((()=>void 0===n.value)),(0,s.computed)((()=>n.value?.is_tmp===N.w.YES))))),d=(0,s.computed)((()=>[{title:"基本信息"},{title:"结算数据"},c.value?{title:"生成结算单"}:{title:"提交"}])),_=(0,s.ref)(0),m=(0,s.computed)((()=>"942px")),v=(0,s.computed)((()=>0===_.value?"Step1":1===_.value?"Step2":2===_.value?"Step3":"")),p={setDialogVisible:(e=!1)=>{a.value=e,e||setTimeout((()=>{_.value=-1}),300)},toggleDialogVisible:()=>{p.setDialogVisible(!a.value)},resetData:()=>{p.setData()},setData:e=>{_.value=0,n.value=void 0===e?void 0:{...e}},open:(e,a,n)=>{o.value=a,p.setData(e),p.setDialogVisible(!0),u.value=1===n?1:0,t.root.$nextTick((()=>{void 0===e?(_.value=0,i.value++):(_.value=e.step,l.value++)}))},close:()=>{t.emit("close"),p.resetData(),p.setDialogVisible()},beforeClose:async e=>{if(void 0===n.value)return void e();const a=await(r.value?.confirmBeforeClose());if(!1===a)return void e();const o=await(0,D.I)(t,{title:"退出前需要保存吗？",content:"选择不保存将丢失当前的改动",confirmText:"保存并退出",cancelText:"不保存，直接退出"});if(o){const e=await(r.value?.saveBeforeClose());if(!e)return}e()},prev:async e=>{void 0!==e&&(n.value={...e}),_.value=Math.max(_.value-1,0),t.root.$nextTick((()=>{r.value?.fillForm?.(n.value)}))},next:async e=>{void 0!==e&&(n.value={...e}),_.value=Math.min(_.value+1,2),t.root.$nextTick((()=>{r.value?.fillForm?.(n.value)}))},onSubmitSuccess:()=>{p.close()}};return{is_virtual_receipt:c,dialogWidth:m,dialogVisible:a,stepCompRef:r,settlement:n,merchantGoods:o,steps:d,activeNumber:_,formComponent:v,...p}}}),I=R,L=(0,_.Z)(I,n,o,!1,null,null,null),T=L.exports},83626:function(e,t,a){a.d(t,{TR:function(){return N},Cv:function(){return D},eF:function(){return G},R5:function(){return M},Fb:function(){return I},Ll:function(){return R},$q:function(){return j},fX:function(){return b},cm:function(){return q},LE:function(){return w},ME:function(){return k},Iq:function(){return T},gY:function(){return E},ij:function(){return C},yT:function(){return $},x$:function(){return X},AT:function(){return F},Il:function(){return A},Lt:function(){return Z},i1:function(){return S},nY:function(){return O},YP:function(){return L}});const n="/api/shop_live/query_common_project",o="/api/shop_live/get_common_project/:id/",s="/api/shop_live/save_common_project",i="/api/payable/query_common_payables",l="/api/common_business/save_cost",u="/api/common_business/query_cost",r="/api/common_business/del_cost",c="/api/shop_live/query_mcn_shop_live",d="/api/shop_live/merchant_goods/",_="/api/shop_live/merchant_goods_v2",m="/api/shop_live/update_shop_live_common_project_team_members",v="/api/shop_live/get_live_goods",p="/api/shop_live/get_shop_live_common_project_profit_stat_data",f="/api/common_business/query_s2b2c_douyin_daily_report",g="/api/common_business/query_s2b2c_douyin_live_report",x="/api/shop_live/save_project_douyin_goal_info";var h=a(64236),y=a(76012);const b=async e=>(0,y.dX)(n,{params:{...(0,h.jG)(e)}}),j=async e=>(0,y.dX)(o.replace(":id",e)),C=async e=>(0,y.dX)("/api/receivable/query_common_receivables",{params:{...(0,h.jG)(e)}}),S=async e=>(0,y.SO)(s,{...(0,h.jG)(e)}),k=(e,t,a,n)=>(0,y.dX)("/api/common_business/query_daily_report",{params:{begin_time:e,end_time:t,project_id:a,business_type:n}}),$=e=>(0,y.SO)("/api/common_business/save_daily_report",(0,h.jG)(e)),w=async e=>(0,y.dX)(i,{params:e}),G=e=>(0,y.SO)(l,(0,h.jG)(e)),q=async e=>(0,y.dX)(u,{params:{project_id:e}}),D=e=>(0,y.SO)(r,{cost_id:e}),F=async e=>(0,y.dX)(c,{params:{...(0,h.jG)(e??"")}}),N=e=>(0,y.SO)(d,(0,h.jG)(e)),R=(e,t)=>(0,y.qb)(`/api/shop_live/merchant_goods/${t}/`,(0,h.jG)(e)),I=e=>(0,y.HG)(`/api/shop_live/merchant_goods/${e}/`),L=async(e,t)=>(0,y.qb)(`${m}/${e}/`,{...t}),T=async e=>(0,y.dX)(v,{params:{...(0,h.jG)(e??"")}}),M=e=>(0,y.HG)(`/api/shop_live/delete_live_goods/${e}/`),E=async e=>(0,y.dX)(_,{params:{...(0,h.jG)(e??"")}}),X=async e=>(0,y.dX)(`${p}/${e}/`),A=async e=>(0,y.dX)(f,{params:{...(0,h.jG)(e)}}),Z=async e=>(0,y.dX)(g,{params:{...(0,h.jG)(e)}}),O=e=>(0,y.SO)(x,(0,h.jG)(e))},20809:function(e,t,a){var n=a(97434),o=a(58302);t["Z"]=()=>{const e=32,t=34,a=36,s=31,i=(0,n.ref)(0),l=e=>{i.value=e.height},u=(0,o.Z)({compensation:(0,n.computed)((()=>e+t+a+s)),fixedBlockHeightRefs:[i,25],tableMinHeight:100});return{tableHeightLogic:u,onTopCardRectUpdate:l}}}}]);