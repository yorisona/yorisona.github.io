"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[718],{80718:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var a,r=n(36568),i=n.n(r),o=n(97434),c=n(56045),s=n(42386),u=n(3293),l=n(26895),p=n(61282),d=n(6933),m=n.n(d),_=n(64236);(function(e){e["gmv"]="gmv",e["gmv_increase_rate"]="gmv_increase_rate",e["settlement_gmv"]="settlement_gmv",e["income"]="income",e["service_amount"]="service_amount",e["commission_amount"]="commission_amount",e["others_income"]="others_income",e["income_to_settlement_gmv_percent"]="income_to_settlement_gmv_percent",e["cost"]="cost",e["star_cost"]="star_cost",e["delivery_cost"]="delivery_cost",e["employee_cost"]="employee_cost",e["others_cost"]="others_cost",e["tax_cost"]="tax_cost",e["profit"]="profit"})(a||(a={}));var f,y,v=(0,o.defineComponent)({setup(e,t){const n=()=>({department_id:void 0,department_name:void 0,project_id:void 0}),r=[{key:a.gmv,name:"GMV",value:[]},{key:a.gmv_increase_rate,name:"月度增长率",value:[]},{key:a.settlement_gmv,name:"结算GMV",value:[]},{key:a.income,name:"收入",value:[],children:[{key:a.service_amount,name:"服务费",value:[]},{key:a.commission_amount,name:"佣金",value:[]},{key:a.others_income,name:"其它收入",value:[]}]},{key:a.income_to_settlement_gmv_percent,name:"收入占结算GMV",value:[]},{key:a.cost,name:"成本",value:[],children:[{key:a.star_cost,name:"主播成本",value:[]},{key:a.delivery_cost,name:"投放成本",value:[]},{key:a.employee_cost,name:"人员成本",value:[]},{key:a.others_cost,name:"其它成本费用",value:[]},{key:a.tax_cost,name:"营业税金及附加",value:[]}]},{key:a.profit,name:"项目利润",value:[]}],i=e=>{const t=[],n=()=>{const e={key:void 0,name:void 0,value:[]};return e};for(let a=0;a<e.length;a++){const r=n(),o=e[a];r.name=e[a].name,r.key=e[a].key,o.children&&(r.children=i(o.children)),t.push(r)}return t},d=(0,o.computed)((()=>{const e="yyyy-MM-DD",t=m()().startOf("year"),n=m()().endOf("year");return[t.format(e),n.format(e)]})),f=(0,o.ref)(!1),y=(0,o.ref)(void 0),v=(0,o.computed)((()=>y.value?m()(1e3*y.value).format("yyyy-MM-DD HH:mm"):"--")),g=(0,o.ref)(void 0),h=(0,o.ref)([]),j=(0,o.ref)([]),k=(0,o.ref)(n()),G=(0,o.ref)(i(r)),b={initColumns:()=>{const e=[];for(let t=0;t<14;t++)0===t?e.push({label:"指标",fixed:"left",prop:"name",minWidth:150}):13===t?e.push({label:"合计",fixed:"right",align:"right",minWidth:150,formatter:e=>{const t=e.value?.[12];return e.key===a.income_to_settlement_gmv_percent||e.key===a.gmv_increase_rate?t?`${t}%`:t:t?(0,p.dN)((t/100).toFixed(2),"¥ "):t}}):e.push({label:`${t}月`,minWidth:150,align:"right",formatter:e=>{const n=e.value?.[t-1];return e.key===a.income_to_settlement_gmv_percent||e.key===a.gmv_increase_rate?n?`${n}%`:n:n?(0,p.dN)((n/100).toFixed(2),"¥ "):n}});return e},async getFeishuDepartmentList(e=!1){const n=await(0,u.o1)({});if(n.data.success){const t=n.data.data.data;if((0,l.$S)(t,!0,3),h.value=t,e){const e=b.getDPRuningDepartment(h.value);k.value.department_id=e?.id,k.value.department_name=e?.name,k.value.department_id&&g.value?.setCheckedKeys([k.value.department_id])}}else t.root.$message.error(n.data.message??"请求失败，请重试")},async getCommonDouyinProjectList(){const e={department_id:k.value.department_id},n=await(0,s.I2)(e);n.data.success?j.value=n.data.data??[]:t.root.$message.error(n.data.message??"请求失败，请重试")},async queryProfitLossDetail(){const[e,n]=d.value;f.value=!0;const[a]=await(0,_.Dc)(500,(0,s.hE)({start_date:e,end_date:n,project_ids:k.value.project_id?`${k.value.project_id}`:j.value.map((e=>e.project_id)).join(",")}));if(f.value=!1,a.data.success){G.value=i(r);const e=a.data.data.datas;y.value=a.data.data.update_time,G.value=G.value.map((t=>{t.children&&(t.children=t.children.map((t=>{const n=e?.find((e=>e.key===t.key));return n&&(t.value=n.value),t})));const n=e?.find((e=>e.key===t.key));return n&&(t.value=n.value),t}))}else t.root.$message.error(a.data.message??"请求失败，请重试")},onQuery(){b.queryProfitLossDetail()},async onReset(){k.value=n(),await b.getFeishuDepartmentList(!0),await b.getCommonDouyinProjectList(),await b.queryProfitLossDetail()},handleCheckChange:e=>{g.value?.setCheckedKeys([]),k.value.department_id===e.id?(k.value.department_id=void 0,k.value.department_name=void 0):(k.value.department_id=e.id,k.value.department_name=e.name,g.value?.setCheckedKeys([e.id])),k.value.project_id=void 0,b.getCommonDouyinProjectList()},getDPRuningDepartment(e){for(let t=0;t<e?.length;t++){const n=e[t];if("品牌运营一部"===n.name)return n;{const e=b.getDPRuningDepartment(n.sons);if(e)return e}}},ondepartmentCleaar(e){g.value?.setCheckedKeys([]),k.value.department_id=void 0,k.value.department_name=void 0,b.getCommonDouyinProjectList(),e&&e.stopPropagation()}},X=(0,o.ref)(b.initColumns());return(0,o.onMounted)((async()=>{await b.getFeishuDepartmentList(!0),await b.getCommonDouyinProjectList(),await b.queryProfitLossDetail()})),{department_tree:g,popoverShow:c.en,popoverHide:c.EG,selectControlPopoverHide:c.TP,columns:X,feishuDepartmentList:h,projectList:j,queryForm:k,tableData:G,loading:f,updateStr:v,...b}},render(){const e=arguments[0],t={label:"name",children:"sons"};return e("div",{class:"tg-profix-loss-statement-page-container"},[e("section",{class:"filter-field"},[e("div",{style:"display: flex; align-items: center; margin-top: 12px; margin-right: 24px;"},[e("span",["归属部门："]),e("el-popover",{attrs:{placement:"bottom-start",trigger:"click",width:"370","popper-class":"profit-loss-statement-department-tree-popper"}},[e("div",{slot:"reference",class:"department-tree-select",style:"display: block; cursor: pointer;"},[this.queryForm.department_name&&e("div",{class:"depart-select-box"},[e("span",[this.queryForm.department_name]),e("i",{style:"margin-top: 8px; color: white",class:"el-icon-circle-close",on:{click:this.ondepartmentCleaar}})]),!this.queryForm.department_name&&e("div",{class:"depart-select-box"},[e("span",{style:"color:rgba(164, 178, 194, 1)"},["请选择项目所属部门"]),e("i",{style:"margin-top: 8px; color: #c0c4cc",class:"el-icon-arrow-down"})])]),e("div",{class:"department-tree"},[e("el-tree",i()([{ref:"department_tree"},{props:{props:t}},{attrs:{"check-strictly":!0,"node-key":"id",data:this.feishuDepartmentList,"show-checkbox":!0,"check-on-click-node":!0,"default-expanded-keys":this.queryForm.department_id?[this.queryForm.department_id]:[]},on:{check:this.handleCheckChange}}]))])])]),e("li",{style:"display: none",class:"controlPopoverHide"}),e("div",{style:"margin-top: 12px; margin-right: 24px;"},[e("span",["项目名称："]),e("el-select",{attrs:{size:"small",filterable:!0},style:"width: 244px",on:{focus:this.selectControlPopoverHide},model:{value:this.queryForm.project_id,callback:e=>{this.$set(this.queryForm,"project_id",e)}}},[e("el-option",{attrs:{label:"全部",value:void 0},key:"undefined"}),this.projectList.map((t=>e("el-option",{attrs:{label:t.project_name,value:t.project_id},key:t.project_id})))])]),e("div",{style:"margin-top: 12px;"},[e("tg-button",{attrs:{type:"primary"},on:{click:this.onQuery}},["搜索"]),e("tg-button",{class:"mgl-12",on:{click:this.onReset}},["重置"])])]),e("section",{class:"update-time"},["数据更新时间：",this.updateStr]),e("section",{class:"table-field",directives:[{name:"loading",value:this.loading}]},[e("div",{class:"table-container"},[e("el-table",i()([{attrs:{border:!0,"row-key":"name",height:"100%","default-expand-all":!0}},{attrs:{data:this.tableData}},{attrs:{"tree-props":{children:"children",hasChildren:"hasChildren"}}}]),[this.columns.map(((t,n)=>e("el-table-column",i()([{key:n},{props:{...t}}]))))])])])])}}),g=v,h=n(1001),j=(0,h.Z)(g,f,y,!1,null,"3856620e",null),k=j.exports},50709:function(e,t,n){n.d(t,{AY:function(){return p},Cm:function(){return M},Dd:function(){return $},Dl:function(){return l},Do:function(){return W},ED:function(){return k},EG:function(){return q},EJ:function(){return h},EN:function(){return d},ER:function(){return R},HW:function(){return s},Hn:function(){return I},L7:function(){return B},LS:function(){return _},Oo:function(){return g},Ou:function(){return m},Q9:function(){return X},TL:function(){return E},Ui:function(){return r},V5:function(){return o},VE:function(){return a},Vv:function(){return T},Zp:function(){return j},_2:function(){return c},bf:function(){return v},bp:function(){return U},cR:function(){return P},ed:function(){return x},ei:function(){return w},g8:function(){return i},gC:function(){return f},gV:function(){return z},gh:function(){return u},hv:function(){return Z},jH:function(){return b},kJ:function(){return C},li:function(){return O},ly:function(){return V},m0:function(){return K},oE:function(){return Q},po:function(){return y},qM:function(){return L},rm:function(){return D},td:function(){return J},u8:function(){return F},us:function(){return H},vr:function(){return S},xn:function(){return G},y$:function(){return A},y8:function(){return N},zI:function(){return Y}});const a="/api/settlement/refuse_settlement/:id",r="/api/settlement/approve_settlement/:id",i="/api/receivable/query_financial_receivables",o="/api/payable/query_financial_payables",c="/api/financial/query_invoice",s="/api/shop_live/query_project_uid",u="/api/financial/void_invoice",l="/api/financial/write_off_invoice",p="/api/financial/red_invoice_approval",d="/api/financial/upload_invoice_approval",m="/api/financial/query_daily_pay",_="/api/data_center/operating/overview",f="/api/data_center/operating/gmv_percent_sunburst",y="/api/data_center/operating/gmv_team_trend",v="/api/data_center/operating/profit_margin_statistics",g="/api/data_center/operating/labor_efficiency_trend",h="/api/data_center/operating/project_distribution_bubble",j="/api/data_center/operating/gmv_completion_rate",k="/api/data_center/operating/gmv_completion_trend",G="/api/data_center/operating/cost_percent_sunburst",b="/api/data_center/operating/income_percent_sunburst",X="/api/data_center/operating/profit_percent_sunburst",D="/api/data_center/operating/cost_team_trend",w="/api/data_center/operating/income_team_trend",q="/api/data_center/operating/profit_team_trend",x="/api/data_center/operating/cost_project_detail",C="/api/data_center/operating/income_project_detail",$="/api/data_center/operating/profit_project_detail",L="/api/data_center/operating/profit_loss_detail",S="/api/shop_live/query_operating_projects",P="/api/data_center/operating/gmv_project_detail",H="/api/financial/statistics/finance_overview",E="/api/financial/statistics/finance_pie",O="/api/financial/statistics/finance_trends",F="/api/financial/statistics/account_details",V="/api/financial/financing/query_financial_ledger",R="/api/financial/financing/add_financial_ledger",M="/api/financial/financing/delete_financial_ledger",T="/api/financial/statistics/project_project_fund",W="/api/financial/statistics/department_fund",N="/api/financial/statistics/unpaid_cost",U="/api/financial/statistics/pending_income_claim",z="/api/financial/statistics/capital_daily_report",I="/api/financial/statistics/capital_year_report",J="/api/financial/revenue/query_revenue_flow",K="/api/settlement/query_revenue_flow",Q="/api/financial/revenue/get_revenue_flow_detail",Z="/api/settlement/get_revenue_flow_detail",B="/api/financial/revenue/claim_revenue_flow",Y="/api/financial/revenue/delete_revenue_flow_detail",A="/api/financial/parse_bank_excel_data"},42386:function(e,t,n){n.d(t,{$W:function(){return U},BN:function(){return b},BT:function(){return j},Bu:function(){return x},DR:function(){return $},FT:function(){return K},Hw:function(){return M},Hz:function(){return v},I2:function(){return L},JQ:function(){return G},KH:function(){return O},LZ:function(){return I},Ml:function(){return Y},NW:function(){return X},Oi:function(){return q},R5:function(){return k},R7:function(){return H},Sg:function(){return E},T_:function(){return P},Tu:function(){return d},UI:function(){return p},UW:function(){return l},Un:function(){return f},Ux:function(){return h},V$:function(){return s},XV:function(){return u},XY:function(){return z},Xz:function(){return m},_:function(){return W},_u:function(){return Z},aH:function(){return _},b:function(){return w},cN:function(){return N},ce:function(){return F},f2:function(){return D},g8:function(){return c},h:function(){return V},hE:function(){return S},k:function(){return o},k6:function(){return y},kf:function(){return T},md:function(){return g},oY:function(){return C},or:function(){return B},qp:function(){return R},w1:function(){return Q},xW:function(){return J}});var a=n(76012),r=n(50709),i=n(64236);const o=async({id:e,refuse_reason:t})=>(0,a.SO)(r.VE.replace(":id",`${e}`),{refuse_reason:t}),c=async e=>(0,a.dX)(r.Ui.replace(":id",`${e}`)),s=async e=>(0,a.dX)(`/api/settlement/approve_cost_settlement/${e}`),u=({id:e,refuse_reason:t})=>(0,a.SO)(`/api/settlement/refuse_cost_settlement/${e}`,{refuse_reason:t}),l=async e=>(0,a.dX)(r.g8,{params:{...(0,i.jG)(e)}}),p=async e=>(0,a.dX)(r.V5,{params:{...(0,i.jG)(e)}}),d=async e=>(0,a.SO)("/api/financial/reverse",e),m=async e=>(0,a.SO)("/api/financial/reverse_again",e),_=async e=>(0,a.SO)("/api/financial/confirm_reverse",{...(0,i.jG)(e)}),f=async e=>(0,a.SO)("/api/financial/merchant_confirm_reverse",{...(0,i.jG)(e)}),y=async e=>(0,a.dX)("/api/financial/query_our_bank_accounts",{params:{...(0,i.jG)(e??{})}}),v=async e=>(0,a.dX)(r.Ou,{params:{...(0,i.jG)(e)}}),g=async e=>(0,a.SO)("/api/financial/add_manually_pay_info",{...(0,i.jG)(e)}),h=async(e,t)=>(0,a.dX)("/api/financial/query_all_project",{params:{...(0,i.jG)({...e,...t})}}),j=async e=>(0,a.dX)(r.LS,{params:{...(0,i.jG)(e)}}),k=async e=>(0,a.dX)(r.gC,{params:{...(0,i.jG)(e)}}),G=async e=>(0,a.dX)(r.po,{params:{...(0,i.jG)(e)}}),b=async e=>(0,a.dX)(r.bf,{params:{...(0,i.jG)(e)}}),X=async e=>(0,a.dX)(r.Oo,{params:{...(0,i.jG)(e)}}),D=async e=>(0,a.dX)(r.EJ,{params:{...(0,i.jG)(e)}}),w=async e=>(0,a.dX)(r.Zp,{params:{...(0,i.jG)(e)}}),q=async e=>(0,a.dX)(r.ED,{params:{...(0,i.jG)(e)}}),x=async(e,t)=>2===t?(0,a.dX)(r.xn,{params:{...(0,i.jG)(e)}}):1===t?(0,a.dX)(r.jH,{params:{...(0,i.jG)(e)}}):(0,a.dX)(r.Q9,{params:{...(0,i.jG)(e)}}),C=async(e,t)=>2===t?(0,a.dX)(r.rm,{params:{...(0,i.jG)(e)}}):1===t?(0,a.dX)(r.ei,{params:{...(0,i.jG)(e)}}):(0,a.dX)(r.EG,{params:{...(0,i.jG)(e)}}),$=async(e,t)=>2===t?(0,a.dX)(r.ed,{params:{...(0,i.jG)(e)}}):1===t?(0,a.dX)(r.kJ,{params:{...(0,i.jG)(e)}}):3===t?(0,a.dX)(r.Dd,{params:{...(0,i.jG)(e)}}):(0,a.dX)(r.cR,{params:{...(0,i.jG)(e)}}),L=async e=>(0,a.dX)(r.vr,{params:{...(0,i.jG)(e)}}),S=async e=>(0,a.dX)(r.qM,{params:{...(0,i.jG)(e)}}),P=async()=>(0,a.dX)(r.us),H=async()=>(0,a.dX)(r.TL),E=async()=>(0,a.dX)(r.li),O=async()=>(0,a.dX)(r.u8),F=async e=>(0,a.dX)(r.gV,{params:{...(0,i.jG)(e)}}),V=async()=>(0,a.dX)(r.Hn),R=async e=>(0,a.dX)(r.ly,{params:{...(0,i.jG)(e)}}),M=async e=>(0,a.SO)(r.ER,{...(0,i.jG)(e)}),T=async e=>(0,a.HG)(`${r.Cm}/${e}`),W=async e=>(0,a.dX)(r.Vv,{params:{...(0,i.jG)(e)}}),N=async()=>(0,a.dX)(r.Do),U=async e=>(0,a.dX)(r.y8,{params:{...(0,i.jG)(e)}}),z=async e=>(0,a.dX)(r.bp,{params:{...(0,i.jG)(e)}}),I=async e=>(0,a.dX)(r.td,{params:{...(0,i.jG)(e)}}),J=async e=>(0,a.dX)(`${r.hv}/${e}`),K=async e=>(0,a.dX)(r.m0,{params:{...(0,i.jG)(e)}}),Q=async e=>(0,a.dX)(`${r.oE}/${e}`),Z=async e=>(0,a.SO)(r.L7,{...(0,i.jG)(e)}),B=async e=>(0,a.HG)(`${r.zI}/${e}`),Y=e=>(0,a.SO)(r.y$,e)},56045:function(e,t,n){n.d(t,{EG:function(){return r},TP:function(){return i},en:function(){return a}});const a=(e="select-icon")=>{document.querySelector(`.${e}`).className+=" select-icon-rotate"},r=(e="select-icon")=>{document.querySelector(`.${e}`).classList.remove("select-icon-rotate")},i=()=>{document.querySelector(".controlPopoverHide").click()}}}]);