"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[6283],{6283:function(e,a,r){r.d(a,{Z:function(){return p}});var n=function(){var e=this,a=e.$createElement,r=e._self._c||a;return r("div",{staticClass:"refund-dialog-wrapper"},[r("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter-new refund-dialog",attrs:{"close-on-press-escape":!1,"close-on-click-modal":!1,visible:e.visible,isAppendToBody:!0,isfooter:!0,width:"930px"},on:{close:e.emitClose},scopedSlots:e._u([{key:"title",fn:function(){return[r("span",[e._v("退款申请")])]},proxy:!0},{key:"footer",fn:function(){return[r("tg-button",{attrs:{type:"default"},on:{click:e.handleDialogCancel}},[e._v("取消")]),r("tg-button",{attrs:{type:"primary"},on:{click:function(a){return e.handleDialogSubmit()}}},[e._v("保存")])]},proxy:!0}])},[r("div",{staticClass:"form-wrapper"},[r("el-form",{ref:"refundFormRef",attrs:{rules:e.refundFormRules,model:e.refundForm,inline:"","label-width":"106px"}},[r("el-form-item",{attrs:{label:"部门：",prop:"department"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{disabled:"",size:"small",placeholder:"请输入部门"},model:{value:e.refundForm.department,callback:function(a){e.$set(e.refundForm,"department","string"===typeof a?a.trim():a)},expression:"refundForm.department"}})],1),r("el-form-item",{attrs:{label:"项目：",prop:"project_name"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{disabled:"",size:"small",placeholder:"请输入项目"},model:{value:e.refundForm.project_name,callback:function(a){e.$set(e.refundForm,"project_name","string"===typeof a?a.trim():a)},expression:"refundForm.project_name"}})],1),r("el-form-item",{attrs:{label:"收款编号：",prop:"achievement_uid"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{disabled:"",size:"small",placeholder:"请输入收款编号"},model:{value:e.refundForm.achievement_uid,callback:function(a){e.$set(e.refundForm,"achievement_uid","string"===typeof a?a.trim():a)},expression:"refundForm.achievement_uid"}})],1),r("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"退款金额：",prop:"refund_amount"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入退款金额"},on:{input:function(a){return e.inputAmount(a,"refund_amount")}},model:{value:e.refundForm.refund_amount,callback:function(a){e.$set(e.refundForm,"refund_amount","string"===typeof a?a.trim():a)},expression:"refundForm.refund_amount"}})],1),r("el-form-item",{attrs:{label:"退款事由：",prop:"refund_reason"}},[r("el-input",{staticStyle:{width:"476px","padding-bottom":"6px"},attrs:{type:"textarea",rows:3,size:"small",placeholder:"请输入退款事由",maxlength:"100","show-word-limit":""},model:{value:e.refundForm.refund_reason,callback:function(a){e.$set(e.refundForm,"refund_reason","string"===typeof a?a.trim():a)},expression:"refundForm.refund_reason"}})],1),r("el-form-item",{attrs:{label:e.isrealpay?"退款方式：":"收款方式：",prop:"refund_way"}},[r("el-radio-group",{staticStyle:{width:"800px","margin-top":"14px"},model:{value:e.refundForm.refund_way,callback:function(a){e.$set(e.refundForm,"refund_way",a)},expression:"refundForm.refund_way"}},[r("el-radio",{attrs:{label:3}},[e._v("对公账户")]),r("el-radio",{attrs:{label:4}},[e._v("银行卡")]),r("el-radio",{attrs:{label:2}},[e._v("支付宝")]),r("el-radio",{attrs:{label:1}},[e._v("V任务")])],1)],1),3===e.refundForm.refund_way?[r("el-form-item",{key:"company_name",attrs:{label:"公司名称：",prop:"company_name"}},[r("el-select",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入公司名称",filterable:"",remote:"","reserve-keyword":"","remote-method":e.getAllCompanyName},on:{change:e.handleCompanySelect},model:{value:e.refundForm.company_name,callback:function(a){e.$set(e.refundForm,"company_name","string"===typeof a?a.trim():a)},expression:"refundForm.company_name"}},e._l(e.companyList,(function(a,n){return r("el-option",{key:n,attrs:{label:a.bank_account,value:a.id}},[r("span",[e._v(e._s(a.bank_account))])])})),1)],1),r("el-form-item",{key:"bank_account",attrs:{label:"银行账号：",prop:"bank_account"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入银行账号",onkeyup:"value=value.replace(/[^\\d]/g, '')"},on:{blur:function(a){return e.blurFun("bank_account",a)}},model:{value:e.refundForm.bank_account,callback:function(a){e.$set(e.refundForm,"bank_account","string"===typeof a?a.trim():a)},expression:"refundForm.bank_account"}})],1),r("el-form-item",{key:"bank",attrs:{label:"开户支行：",prop:"bank"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入开户支行"},model:{value:e.refundForm.bank,callback:function(a){e.$set(e.refundForm,"bank","string"===typeof a?a.trim():a)},expression:"refundForm.bank"}})],1)]:e._e(),4===e.refundForm.refund_way?[r("el-form-item",{key:"bank_card_number",attrs:{label:"卡号：",prop:"bank_card_number"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入卡号",onkeyup:"value=value.replace(/[^\\d]/g, '')"},on:{blur:function(a){return e.blurFun("bank_card_number",a)}},model:{value:e.refundForm.bank_card_number,callback:function(a){e.$set(e.refundForm,"bank_card_number","string"===typeof a?a.trim():a)},expression:"refundForm.bank_card_number"}})],1),r("el-form-item",{key:"bank_card_person",attrs:{label:"户名：",prop:"bank_card_person"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入户名"},model:{value:e.refundForm.bank_card_person,callback:function(a){e.$set(e.refundForm,"bank_card_person","string"===typeof a?a.trim():a)},expression:"refundForm.bank_card_person"}})],1),r("el-form-item",{key:"bank_card_name",attrs:{label:"开户行：",prop:"bank_card_name"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入开户行"},model:{value:e.refundForm.bank_card_name,callback:function(a){e.$set(e.refundForm,"bank_card_name","string"===typeof a?a.trim():a)},expression:"refundForm.bank_card_name"}})],1)]:e._e(),2===e.refundForm.refund_way?[r("el-form-item",{key:"name",attrs:{label:e.isrealpay?"付款人：":"收款人：",prop:"name"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:e.isrealpay?"请输入付款人姓名":"请输入收款人姓名"},model:{value:e.refundForm.name,callback:function(a){e.$set(e.refundForm,"name","string"===typeof a?a.trim():a)},expression:"refundForm.name"}})],1),r("el-form-item",{key:"account",attrs:{label:"支付宝账号：",prop:"account"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入支付宝账号"},model:{value:e.refundForm.account,callback:function(a){e.$set(e.refundForm,"account","string"===typeof a?a.trim():a)},expression:"refundForm.account"}})],1)]:e._e(),1===e.refundForm.refund_way?[r("el-form-item",{key:"wangwang_name",attrs:{label:"旺旺名：",prop:"wangwang_name"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入旺旺名"},model:{value:e.refundForm.wangwang_name,callback:function(a){e.$set(e.refundForm,"wangwang_name","string"===typeof a?a.trim():a)},expression:"refundForm.wangwang_name"}})],1),r("el-form-item",{key:"v_task_id",attrs:{label:"V任务ID：",prop:"v_task_id"}},[r("el-input",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请输入V任务ID"},model:{value:e.refundForm.v_task_id,callback:function(a){e.$set(e.refundForm,"v_task_id","string"===typeof a?a.trim():a)},expression:"refundForm.v_task_id"}})],1)]:e._e(),r("el-form-item",{attrs:{label:"备注："}},[r("el-input",{staticStyle:{width:"476px","padding-bottom":"6px"},attrs:{type:"textarea",rows:2,size:"small",placeholder:"请输入备注",maxlength:"50","show-word-limit":""},model:{value:e.refundForm.remark,callback:function(a){e.$set(e.refundForm,"remark","string"===typeof a?a.trim():a)},expression:"refundForm.remark"}})],1),r("el-form-item",{attrs:{label:"附件："}},[r("div",{staticClass:"upload-box"},[r("tg-upload",{attrs:{disabled:e.refundForm.attachment.length>=5,action:"/api/approval/upload_approval_attachment","show-file-list":!1,beforeUpload:e.beforeUpload,success:e.successHandle}},[r("tg-button",{attrs:{disabled:e.refundForm.attachment.length>=5,icon:"ico-upload-lite"}},[e._v("上传附件")])],1),r("span",{staticClass:"file-tips"},[e._v(" 支持扩展名：.docx .doc .pdf .jpg .png；最多上传5个文件（单个文件大小不超过30M） ")])],1),r("div",{staticClass:"file-list-box"},[r("upload-file-list",{model:{value:e.refundForm.attachment,callback:function(a){e.$set(e.refundForm,"attachment",a)},expression:"refundForm.attachment"}})],1)])],2)],1)]),r("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在提交，请稍候..."}})],1)},t=[],l=(r(21703),r(97434)),o=r(11676),u=r(3346),i=r(58061),s=r(64236),d=(0,l.defineComponent)({name:"refundDialog",props:{visible:{type:Boolean,required:!0,default:!1},row:{type:Object,default:()=>({})},edit:{type:Boolean,required:!1,default:!1},info:{type:Object,required:!1,default:()=>({})},isrealpay:{type:Boolean,required:!1,default:!1}},components:{},setup(e,a){const r=(0,l.ref)(!1),n=(0,l.computed)((()=>a.root.$store.getters["user/getUserInfo"].department_name)),t=(0,l.ref)({department:n,project_name:"",achievement_id:"",refund_amount:"",refund_reason:"",refund_way:3,company_name:"",bank_account:"",bank:"",bank_card_number:"",bank_card_name:"",bank_card_person:"",name:"",account:"",wangwang_name:"",v_task_id:"",remark:"",attachment:[],...e.row}),d=(0,l.ref)([]),m=async()=>{const a={business_type:e.row.business_type,project_id:e.row.project_id},{data:r}=await(0,u.Tf)(a);if(r.success){const e=r.data;t.value.company_name=e.bank_account,t.value.bank=e.bank_of_deposit,t.value.bank_account=e.bank_card_number}};m();const c=()=>{t.value.department="",t.value.project_name="",t.value.achievement_id="",t.value.refund_amount="",t.value.refund_reason="",t.value.refund_way="",t.value.company_name="",t.value.bank_account="",t.value.bank="",t.value.bank_card_number="",t.value.bank_card_name="",t.value.bank_card_person="",t.value.name="",t.value.account="",t.value.wangwang_name="",t.value.v_task_id="",t.value.remark="",t.value.attachment=[]},_=(0,l.ref)({department:[{required:!0,message:"请输入部门名称",trigger:["blur","change"]}],project_name:[{required:!0,message:"请输入项目名称",trigger:["blur","change"]}],achievement_id:[{required:!0,message:"请输入收款编号",trigger:["blur","change"]}],refund_amount:[{required:!0,message:"请输入退款金额",trigger:["blur","change"]},{validator:(e,a,r)=>{Number(a)>t.value.gather_amount?r(new Error("退款金额不能超过实收金额")):"0"===a?r(new Error("退款金额不能为0")):r()},trigger:["blur","change"]}],refund_reason:[{required:!0,message:"请输入退款理由",trigger:["blur","change"]}],refund_way:[{required:!0,message:"请选择退款方式",trigger:["blur","change"]}],company_name:[{required:!0,message:"请输入公司名称",trigger:["blur","change"]}],bank_account:[{required:!0,message:"请输入银行账号",trigger:["blur","change"]}],bank:[{required:!0,message:"请输入开户行",trigger:["blur","change"]}],bank_card_number:[{required:!0,message:"请输入卡号",trigger:["blur","change"]}],bank_card_name:[{required:!0,message:"请输入开户行",trigger:["blur","change"]}],bank_card_person:[{required:!0,message:"请输入户名",trigger:["blur","change"]}],name:[{required:!0,message:"请输入收款人",trigger:["blur","change"]}],account:[{required:!0,message:"请输入支付宝账号",trigger:["blur","change"]}],wangwang_name:[{required:!0,message:"请输入旺旺名",trigger:["blur","change"]}],v_task_id:[{required:!0,message:"请输入V任务ID",trigger:["blur","change"]}]}),p=(e,a)=>{const r=e.replace(/[^\d.]+/gu,"").replace(/^0+(?=\d)/gu,"")??"",n=/\d+(?:\.\d{0,2})?/gu.exec(r)??[""];"refund_amount"===a&&(t.value.refund_amount=n[0])},f=async e=>{const{data:a}=await(0,u.Pp)({keyword:e});d.value=a.success?a.data:[]},b=e=>{const a=d.value.filter((a=>{if(a.id===e)return a}));t.value.company_name=a[0].bank_account,t.value.bank=a[0].bank_of_deposit,t.value.bank_account=a[0].bank_card_number},g=(e=!1)=>a.emit("dialog:close",e),v=()=>{g()},k=async()=>{const n=await new Promise((e=>a.refs.refundFormRef.validate((a=>e(a)))));if(!n)return;r.value=!0;const l={approval_type:2,achievement_id:e.row.achievement_id,business_type:e.row.business_type,refund_amount:t.value.refund_amount+"",project_id:e.row.project_id,level_two_types:1,level_three_types:t.value.refund_way,refund_reason:t.value.refund_reason,remark:t.value.remark,v_task_id:1===t.value.refund_way?t.value.v_task_id:"",wangwang_name:1===t.value.refund_way?t.value.wangwang_name:"",name:2===t.value.refund_way?t.value.name:"",account:2===t.value.refund_way?t.value.account:"",bank_card_number:4===t.value.refund_way?t.value.bank_card_number:3===t.value.refund_way?t.value.bank_account:"",bank_account:4===t.value.refund_way?t.value.bank_card_person:"",bank_of_deposit:4===t.value.refund_way?t.value.bank_card_name:3===t.value.refund_way?t.value.bank:"",company_name:3===t.value.refund_way?t.value.company_name:"",attachment:t.value.attachment},[{data:o},u]=await Promise.all([await(0,i.AU)(l),await(0,s._v)(200)]);r.value=!1,o.success?(a.root.$message.success(o.message),g(),e.edit&&a.emit("dialog:reClose")):a.root.$message.error(o.message??"保存失败")},y=e=>(0,o.K)({file:!0,image:!0,fileSize:30})(e),w=e=>{t.value.attachment.push(e.data.source)},h=(e,a)=>{"bank_account"===e?t.value.bank_account=a.target.value:"bank_card_number"===e&&(t.value.bank_card_number=a.target.value)};return(0,l.onBeforeMount)((()=>{e.edit&&(t.value.refund_amount=e.info.refund_amount,t.value.refund_reason=e.info.refund_reason,t.value.remark=e.info.remark,t.value.refund_way=e.info.level_three_types,3===e.info.level_three_types?(t.value.company_name=e.info.refund_way_detail.company_name,t.value.bank_account=e.info.refund_way_detail.bank_card_number,t.value.bank=e.info.refund_way_detail.bank_of_deposit):2===e.info.level_three_types?(t.value.name=e.info.refund_way_detail.name,t.value.account=e.info.refund_way_detail.account):4===e.info.level_three_types?(t.value.bank_card_number=e.info.refund_way_detail.bank_card_number,t.value.bank_card_person=e.info.refund_way_detail.bank_account,t.value.bank_card_name=e.info.refund_way_detail.bank_of_deposit):(t.value.wangwang_name=e.info.refund_way_detail.wangwang_name,t.value.v_task_id=e.info.refund_way_detail.v_task_id),e.info.attachment&&e.info.attachment.length>0&&(t.value.attachment=e.info.attachment))})),{saveLoading:r,refundForm:t,resetForm:c,refundFormRules:_,emitClose:g,beforeUpload:y,successHandle:w,handleDialogCancel:v,handleDialogSubmit:k,getAllCompanyName:f,handleCompanySelect:b,companyList:d,inputAmount:p,blurFun:h}}}),m=d,c=r(1001),_=(0,c.Z)(m,n,t,!1,null,"4b6cd44e",null),p=_.exports}}]);