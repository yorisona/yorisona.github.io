"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[8560],{98560:function(e,t,a){a.d(t,{Z:function(){return x}});var r=a(36568),i=a.n(r),l=a(97434),s=a(83005),o=a(78066),n=a(97484),c=a(48606),u=a(74511),d=a(29625),m=a(42386),p=a(67578),_=a(61282),g=a(6933),h=a.n(g);const v=[{label:"服务费",value:1},{label:"佣金",value:2},{label:"其他",value:3}],f={achievement_id:void 0,achievement_name:"",gather_type:1,gather_amount:"",settlement_no_write_off_amount:"",gather_way:1,pay_company_name:"",task_id:"",order_wangwang_id:"",order_date:"",contract_id:null,is_invoice:0,gather_certificate_pic:null,revenue_flow_id:void 0};var b,y,A=(0,l.defineComponent)({props:{type:{type:Number,default:null}},setup(e,t){const a=(0,l.inject)("project")??(0,l.ref)(void 0),r=(0,l.ref)(void 0),i=(0,l.reactive)({...f}),u=(0,l.ref)(!1),g=(0,l.ref)(!1),v=(0,l.ref)([]),b=(0,l.ref)(void 0),y=(0,l.ref)({isMcn:!1,isBrand:!1,isMarketing:!1,isMerchant:!1}),A=(0,l.ref)(!1),w=(0,l.ref)(!1),M=async e=>{if(!e)return;const t=await(0,m.xW)(e);t.data.success&&(b.value=t.data.data)},k=(e={},t={},a)=>{y.value=t,A.value=a;const{gather_amount:l,search_contract_list_value:s,search_invoice_apply_value:o,company_name:n,revenue_flow_id:c}=e;if(M(c),y.value.isMcn&&(r.value=n),x.value=[],e.contract_id&&e.contract_uid){const t={label:e.contract_uid,value:e.contract_id};w.value=!0,i.contract_id=e.contract_id,x.value=[t]}else s?(w.value=!1,x.value=s):w.value=!1;j.value=o||[],i.gather_amount=l||"",setTimeout((()=>{Object.entries({...f,...e}).forEach((([e,t])=>{if("gather_certificate_pic"===e&&t){const e=Object(t),a=decodeURI(String(e.name));i.gather_certificate_pic={name:a,value:e.value}}else i[e]=t})),0!==i.contract_id&&"0"!==i.contract_id||(i.contract_id=void 0)}),10),a&&D(""),u.value=!0},x=(0,l.ref)([]),D=async e=>{const t=await(0,s.z0)({partner_type:1,search:e,project_type:d.kA.live});if(t.data.success){const e=t.data.data.data.map((e=>({label:e.contract_uid,value:e.contract_id})));x.value=e}},j=(0,l.ref)([]),z=async e=>{const t=await(0,n.BA)({approval_type:4,achievement_id:i.achievement_id,approval_uid:e});t.data.success&&(j.value=t.data.data.map((e=>({label:e.approval_uid,value:e.id}))))},T=async e=>{const t=new FormData;t.append("file",e.file,e.file.name),t.append("type","certificate/achievement_gather_certificate");try{const a=await(0,n.mg)(t);a.data.success||c.Message.warning(a.data.message),i.gather_certificate_pic={name:e.file.name,value:a.data.data.source}}catch(a){c.Message.error("上传失败")}},E=(0,l.ref)(void 0),N=(e=!1)=>{t.emit("close",e),u.value=!1},B=()=>{t.emit("ok"),u.value=!1},q=()=>{E.value?.validate((e=>{if(!e)return!1;const t=a?a.value.id:-1;if(-1===t)return c.Message.error("项目ID错误"),!1;const r={project_id:t,...i};r.is_invoice,r.gather_certificate_pic&&(r.gather_certificate_pic=r.gather_certificate_pic.value),Promise.resolve().then((()=>{g.value=!0;const{achievement_name:e,gather_amount:l,gather_type:s,gather_way:n,is_invoice:c,pay_company_name:u,task_id:d,order_wangwang_id:m,order_date:p,gather_certificate_pic:_,achievement_id:h,contract_id:v,revenue_flow_id:f}=i,b={settlement_id:r.id,achievement_name:e,gather_amount:l,gather_type:s,gather_way:n,is_invoice:c,pay_company_name:u,task_id:d,order_wangwang_id:m,order_date:p,contract_id:v,gather_certificate_pic:_?.value??"",achievement_id:h,revenue_flow_id:f};return y.value.isMerchant?(b.project_id=t,(0,o.KH)(b)):y.value.isMcn?(b.project_id=t,(0,o.Kn)(b)):y.value.isBrand?(b.project_id=t,(0,o.xR)(b)):(b.cooperation_id=a?.value.cooperation_id,(0,o.R_)(b))})).then((e=>{if(g.value=!1,!e.data.success)return c.Message.error(e.data.message);c.Message.success(e.data.message),setTimeout(B,1e3)})).catch((e=>{g.value=!1,c.Message.error(e.message)}))}))},C=async e=>{const t=await(0,m.FT)({num:1e3,page_num:1,status:p.XB.watigingClaim,account_type:e});t.data.success&&(v.value=t.data.data.data??[])};(0,l.watch)((()=>i.gather_way),(e=>{2===e?C(p.Qm.zfb):3===e&&C(p.Qm.bank)}));const Q=e=>e?h()(e).format("M.D"):"--";return{flowList:v,isdisable_contract_id:w,saveLoading:g,project:a,mcn_douuyin_company:r,form:i,formRef:E,emitClose:N,businessType:y,search_contract_list:x,search_contract:D,search_invoice_apply:j,search_invoice:z,uploadAttachmenFile:T,submit:q,visible:u,show:k,formatAmount:_.dN,revenueDate:Q,oldFlowModel:b,isLiveDouyin:A}},render(e){const{visible:t,form:r,isdisable_contract_id:l}=this,s=this.project;if(!s)return e("div");let o;this.businessType.isMcn?2===s.platform_type?o="阿里巴巴网络科技有限公司":1===s.platform_type&&(o=this.mcn_douuyin_company):o=s.customer_company_name||s.company_name;const n=this.businessType.isMcn?"560px":"478px",c=this.oldFlowModel?[this.oldFlowModel,...this.flowList]:this.flowList;return e("div",[e("el-dialog",{class:"customer-dialog el-dialog-center-rewrite achievement-tsx-dialog",attrs:{width:n,visible:t,title:"收款登记","close-on-click-modal":!1},on:{close:this.emitClose}},[e("div",{class:"achievement-container"},[e("el-form",i()([{attrs:{labelWidth:"78px",size:"medium"},ref:"formRef"},{attrs:{model:this.form}},{on:{input:()=>{}}}]),[e("div",{class:"form-block-header"},["客户信息"]),!this.businessType.isMcn&&e("el-form-item",{attrs:{label:"客户名称："}},[e("el-input",{attrs:{value:s.shop_name,disabled:!0}})]),!this.businessType.isMcn&&e("el-form-item",{attrs:{label:"客户经理："}},[e("el-input",{attrs:{value:s.customer_manager||s.manager_name,disabled:!0}})]),e("el-form-item",{attrs:{label:"公司名称："}},[e("el-input",{attrs:{value:o,disabled:!0}})]),e("div",{class:"form-block-header"},["客户信息"]),e("el-form-item",{attrs:{label:"业绩名称：",prop:"achievement_name",rules:{required:!0,message:"请输入业绩名称",trigger:"blur"}}},[e("el-input",{attrs:{placeholder:"请输入业绩名称",value:r.achievement_name,maxLength:15},on:{input:e=>r.achievement_name=e}})]),e("el-form-item",{attrs:{label:"收款类型：",prop:"gather_type",rules:{required:!0,message:"请输入收款类型",trigger:"blur"}}},[e("el-select",{style:"width:210px",attrs:{placeholder:"请输入收款类型",value:r.gather_type},on:{input:e=>r.gather_type=e}},[v.map(((t,a)=>e("el-option",{key:a,attrs:{label:t.label,value:t.value}})))])]),e("el-form-item",{class:"mgb0",attrs:{label:"收款方式：",rules:{required:!0,message:"请输入跟踪事项",trigger:"blur"}}},[e("el-radio-group",{style:{display:"inline-flex"},attrs:{value:this.form.gather_way},on:{input:e=>{this.form.gather_way=e},change:()=>{r.revenue_flow_id=void 0,this.form.pay_company_name="",this.formRef?.clearValidate()}}},[e("el-radio",{attrs:{label:3}},["对公银行"]),e("el-radio",{attrs:{label:2}},["支付宝"]),e("el-radio",{attrs:{label:1}},["V任务"]),this.businessType.isMcn&&e("fragments",[e("el-radio",{attrs:{label:4}},["阿里妈妈"]),e("el-radio",{attrs:{label:5}},["巨量百应"])])])]),(3===this.form.gather_way||2===this.form.gather_way)&&!1===this.businessType.isMarketing&&e("el-form-item",{class:"mgt-16",attrs:{label:"关联流水：",prop:"revenue_flow_id",rules:{required:!0,message:"请选择关联收入流水",trigger:"change"}}},[e("el-select",{attrs:{placeholder:"请选择关联收入流水"},style:"width:210px",on:{change:e=>{const t=c.find((t=>t.id===e));t?.payer&&(this.form.pay_company_name=t?.payer)}},model:{value:r.revenue_flow_id,callback:e=>{this.$set(r,"revenue_flow_id",e)}}},[c.map(((t,a)=>e("el-option",{key:t.id,attrs:{value:t.id,label:`${this.revenueDate(t.revenue_date)} ${3===this.form.gather_way?t.payer??"":t.payment_account??""}: ${this.formatAmount((t.income??0)/100,"None")}元`}})))])]),(1===this.form.gather_way||2===this.form.gather_way||this.businessType.isMarketing)&&e("div",{class:"radio-form-item-children"},[(2===this.form.gather_way||this.businessType.isMarketing&&1!==this.form.gather_way)&&e("div",[e("el-form-item",{attrs:{label:"打款公司：",labelWidth:"98px",prop:"pay_company_name",rules:{required:!0,message:"请输入打款公司",trigger:"blur"}}},[e("el-input",{attrs:{placeholder:"请输入打款公司",value:r.pay_company_name},on:{input:e=>r.pay_company_name=e}})])]),1===this.form.gather_way&&e("div",[e("el-form-item",{attrs:{label:"V任务ID：",labelWidth:"98px",prop:"task_id",rules:{required:!0,message:"请输入V任务ID",trigger:"blur"}}},[e("el-input",{attrs:{placeholder:"请输入V任务ID",value:r.task_id},on:{input:e=>r.task_id=e}})]),e("el-form-item",{attrs:{label:"下单旺旺名：",labelWidth:"98px",prop:"order_wangwang_id",rules:{required:!0,message:"请输入下单旺旺名",trigger:"blur"}}},[e("el-input",{attrs:{placeholder:"请输入下单旺旺名",value:r.order_wangwang_id},on:{input:e=>r.order_wangwang_id=e}})]),e("el-form-item",{attrs:{label:"接单时间：",prop:"order_date",labelWidth:"98px",rules:{required:!0,message:"请输入接单时间",trigger:"blur"}},class:"order_date"},[e("el-date-picker",{attrs:{clearable:!1,placeholder:"请选择接单时间","value-format":"yyyy-MM-dd",value:r.order_date},on:{input:e=>r.order_date=e}})])])]),(1===this.form.gather_way||4===this.form.gather_way||5===this.form.gather_way||this.businessType.isMarketing)&&e("el-form-item",{style:"margin-top: 16px;",attrs:{label:"收款金额：",prop:"gather_amount",rules:[{required:!0,message:"请输入收款金额",trigger:"blur"},{validator:u.Z.price(),trigger:"blur"},{validator:u.Z.number_range(),trigger:"blur"}]}},[e("el-input-extend",{attrs:{placeholder:"请输入收款金额",value:r.gather_amount,maxLength:14,inputType:"price"},on:{input:e=>r.gather_amount=e}})]),e("el-form-item",{attrs:{label:"打款凭证："}},[e("div",{class:"upload-operation"},[e("el-upload",{attrs:{action:"xxx",className:"upload-btn-wrap","show-file-list":!1,multiple:!1,accept:".jpg,.jpeg,.png","http-request":this.uploadAttachmenFile}},[e("tg-button",["上传文件"])]),e("span",{class:"upload-tips mgl-16"},["支持扩展名：.jpg .jpeg .png"])]),this.form.gather_certificate_pic&&e("div",{class:"uploaded-list"},[e("div",{class:"upload-item"},[e("img",{class:"attachment-icon",attrs:{src:a(72104)}}),e("span",{class:"attachment-name"},[this.form.gather_certificate_pic.name]),e("img",{on:{click:()=>{this.form.gather_certificate_pic=null}},attrs:{src:a(42891)},class:"clear-uploaded-file"})])])]),this.isLiveDouyin?e("el-form-item",{attrs:{label:"关联合同：",prop:"contract_id",rules:{required:!0,message:"请选择供应商合同",trigger:["change"]}}},[e("el-select",{attrs:{placeholder:"请选择供应商合同",value:r.contract_id,filterable:!0,remote:!0,disabled:l,"remote-method":this.search_contract},style:"width:210px",on:{input:e=>r.contract_id=e}},[this.search_contract_list.map(((t,a)=>e("el-option",{key:a,attrs:{value:t.value,label:t.label}})))])]):e("el-form-item",{attrs:{label:"关联合同：",prop:"contract_id"}},[e("el-select",{attrs:{placeholder:"请选择关联合同",value:r.contract_id,filterable:!0,remote:!0,clearable:!0,"remote-method":this.search_contract,disabled:l},style:"width:210px",on:{input:e=>r.contract_id=e}},[this.search_contract_list.map(((t,a)=>e("el-option",{key:a,attrs:{value:t.value,label:t.label}})))])]),e("el-form-item",{attrs:{label:"是否开票：",rules:{required:!0,message:"请选择是否开票",trigger:"blur"}}},[e("el-select",{style:"width:210px",attrs:{value:r.is_invoice},on:{input:e=>r.is_invoice=e}},[e("el-option",{attrs:{value:1,label:"是"}}),e("el-option",{attrs:{value:0,label:"否"}})])])])]),e("template",{slot:"footer"},[e("tg-button",{on:{click:this.emitClose}},["取消"]),e("tg-button",{attrs:{type:"primary"},on:{click:this.submit}},["提交"])])]),e("tg-mask-loading",{attrs:{visible:this.saveLoading,content:"正在保存，请稍候..."}})])}}),w=A,M=a(1001),k=(0,M.Z)(w,b,y,!1,null,null,null),x=k.exports},74511:function(e,t,a){a(21703);t["Z"]={price(e=2){return(t,a,r)=>{if(isNaN(a))return r(new Error("无效金额"));const i=/\.(\d+)/g,l=i.exec(a);return l?l[1].length>2?r(new Error(`只能输入${e}位小数`)):void r():r()}},number_range(e,t=9999999999999,a=""){return(r,i,l)=>{if(isNaN(i))return l(new Error("无效金额"));const s=Number(i);return void 0!==e&&s<e?l(new Error(`${a}金额不能小于${e}`)):void 0!==t&&s>t?l(new Error(`${a}金额不能大于${t}`)):void l()}}}},42891:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOBAMAAADtZjDiAAAAJ1BMVEUAAADOzs7Q0NDMzMzQ0NDLy8vMzMzMzMzMzMzMzMzMzMzNzc3MzMzARFk0AAAADHRSTlMAFStGRlOCz9Px8v2algISAAAAT0lEQVQI12NgYExfVSbAwMAQeebMmakMDKx7gPTpAAbJMyAwkSHnjMeZ5jPHGGrONHVonDnOsObMCaWeM6fgNEw854wFWB1MH8wcmLlQewCpsTV1kKqzYQAAAABJRU5ErkJggg=="},72104:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAOCAQAAAC1QeVaAAAAzUlEQVQYGQXBO0tCYQAA0HPta/CWBUIgmuAiPRBnJXJriYaIGqOigl4mURFEgyaVITgEeXve/mrnAEDWgyYAAJDVc2cSAABifbeCvFOJTx0FgFjfjaDoXduCqkNfCjDlybWgZGwbwJFLgq4rE8oSWyAPFiWsexHM+7AJVqSmUffGsyYe7YBVv2qI3NvjTwnfKmhJLSNyYihmrIp9Ix0/lpBxZmgWLuwi0rBhDhnnXs0AZak6gKBtIAdAQ+pATUXLQE8OACg6NpLoWhMA+AeSEiYWSon8LQAAAABJRU5ErkJggg=="}}]);