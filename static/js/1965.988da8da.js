"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[1965],{43345:function(e,t,a){a.r(t),a.d(t,{default:function(){return A}});var s=a(1763),n=a(97434),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"345px",width:"100%"},attrs:{id:"ProjectrendChart"+e.index}},[e.date.length>0?a("base-echarts",{attrs:{options:e.baseOptions}}):a("Empty")],1)},i=[],r=a(32200),o=a(45781),c=a(99197),d=a(8136),p=a(6933),y=a.n(p),u=a(59760),h=a(61282);const{formatPriceFormYuan:m}=o.Z,{tranNumber:f}=o.Z;var v,g={components:{BaseEcharts:r.Z,Empty:c.Z},props:{loading:{type:Boolean,default:!1},date:{type:Array,default:()=>[]},list:{type:Array,default:()=>[]},originDataList:{type:Array,efault:()=>[]},legend:{type:Boolean,default:!0},color:{type:Array},percentage:{type:Boolean,default:!1},index:{type:Number,default:0}},data(){const e=this.index,t=this.originDataList,a=u;return{baseOptions:{grid:{left:73,right:73,top:10,bottom:84},tooltip:{trigger:"axis",backgroundColor:"#fff",padding:0,renderMode:"html",appendToBody:!0,position:function(t,a,s,n,l){const i=document.getElementById(`ProjectrendChart${e}`),r=window.innerHeight,o=i.getBoundingClientRect().top,c=l.viewSize[0],d=s.clientWidth,p=o+t[1]+s.clientHeight,y=r-p,u=y<0?y-24:0;return c/2>=t[0]?[t[0]+30,t[1]+u]:[t[0]-d-30,t[1]+u]},formatter:e=>{const s=({change_tip:e})=>{let t,a,s;switch(`${e}`){case"1":t="#556FF6",a="#556ff614",s="硬装";break;case"2":t="#00F7E9",a="#00f7e914",s="灯光";break;case"3":t="#FF6A39",a="#ff6a3914",s="机位";break;case"4":t="#FFBD00",a="#ffbd0014",s="陈列";break;case"5":t="#00CE59",a="#00ce5914",s="贴片";break;case"6":t="#FF6FCD",a="#ff6fcd14",s="调色";break;default:break}return{color:t,backgroundColor:a,text:s}},n=e=>{if(!e.start_date)return"--";if(1===e.statistics_cycle){const t=y()(e.start_date).format("yyyy.MM.DD");return t}if(2===e.statistics_cycle){let t=y()(e.start_date).format("yyyy 第 ww 周");return t=`${t}（${e.start_date.replace(/-/g,".")} - ${e.end_date.replace(/-/g,".")}）`,t}if(3===e.statistics_cycle){const t=y()(e.start_date).format("yyyy.MM");return t}},l=e[0].dataIndex,i=t[l],r=i?.change_tips??[],o=0===r.length?"--":r.map((e=>{const t=s(e),a=`<span style="margin-left: 4px;font-size: 12px;">(${e.username?e.username:""})</span>`;return`<span style="margin-left: 4px; background-color: ${t.backgroundColor}; color: ${t.color}; border-radius: 2px; padding: 2px 4px; font-size: 12px;">${t.text}</span>${e.username?a:""}`})).join(""),c=n(i),d=`<div style="padding: 18px">\n              <p>\n                <span>${c}</span>\n                <span style="float:right;"></span>\n              </p>\n              <div style="display: grid; grid-template-columns: repeat(1, auto); column-gap: 8px; row-gap: 8px; font-weight: 500; margin-top: 16px;">\n                <div style="height: 16px; line-height: 16px;">\n                  <span style="font-size: 12px; color: #606974;display: inline-block;width: 95px;text-align: right;">平均进入率(人数): </span>\n                  <span style="font-size: 12px; color: #19232D;">${i.exposure_watch_ucnt_ratio}%</span>\n                </div>\n                <div style="height: 16px; line-height: 16px;">\n                  <span style="font-size: 12px; color: #606974;display: inline-block;width: 95px;text-align: right;">平均进入率(人次): </span>\n                  <span style="font-size: 12px; color: #19232D;">${i.exposure_watch_times_ratio}%</span>\n                </div>\n                <div style="height: 16px; line-height: 16px;">\n                  <span style="font-size: 12px; color: #606974;display: inline-block;width: 95px;text-align: right;">直播销售额(元): </span>\n                  <span style="font-size: 12px; color: #19232D;">${m(i.sum_gmv,2,!1)}</span>\n                </div>\n              </div>\n              <div style="height: 1px; border-top: 1px dashed rgba(164,178,194,0.30); margin: 12px 0;"></div>\n              <div style="font-size: 12; font-weight: 400;">\n                <span style="color: #606974;">变更信息: </span>\n                <div style="width:320px; display: flex;align-items: center;flex-wrap: wrap;margin-top:5px;">\n                  ${o}\n                </div>\n              </div>\n              <div style="margin-top: 16px; width: 320px; height: 505px; display: flex; align-items: center; justify-content: center; background-color: #F5F9FC;">\n                <img src="${(0,h.E)(i.live_screenshot)}" style="width: 100%; height: 100%; object-fit: contain; display: ${i.live_screenshot?void 0:"none"}" />\n                <img src="${a}" style="width: 160px; height: 160px; display: ${i.live_screenshot?"none":void 0}"/>\n              </div>\n            </div>`;return d},textStyle:{color:"#343F4C",fontSize:14,fontWeight:"bold"},extraCssText:"box-shadow: 1px 2px 8px 0px rgba(0, 0, 0, 0.26);"},legend:{show:this.legend,bottom:26,left:"153"},xAxis:{type:"category",data:[],axisLine:{lineStyle:{color:"rgba(52,63,76,0.30)"}},axisTick:{lineStyle:{opacity:0}},axisLabel:{color:"#606974",fontSize:11},splitLine:{show:!1}},color:this.color?this.color:d.nA,yAxis:[{type:"value",scale:!0,nameTextStyle:{color:"#666",fontSize:14},min:0,splitLine:{show:!0,lineStyle:{color:["#eee"],type:"dashed"}},axisTick:{lineStyle:{opacity:0}},axisLabel:{color:"#606974",formatter:(...e)=>{const t=f(...e);return!0===this.percentage?`${e[0]}%`:t}},axisLine:{lineStyle:{type:"solid",color:"rgba(52,63,76,0.30)",width:"1"}}},{type:"value",scale:!0,position:"right",nameTextStyle:{color:"#666",fontSize:14},min:0,splitLine:{show:!1,lineStyle:{color:["#eee"],type:"dashed"}},axisTick:{lineStyle:{opacity:0}},axisLabel:{color:"#606974",formatter:(...e)=>{const t=f(...e);return t}},axisLine:{lineStyle:{type:"solid",color:"rgba(52,63,76,0.30)",width:"1"}}}],series:[]}}},created(){this.init()},watch:{date:{handler(){this.init()},deep:!0},list:{handler(){this.init()},deep:!0}},methods:{init(){const e=JSON.parse(JSON.stringify(this.list));for(let t=0;t<e.length;t++)for(let a=0;a<e[t].data.length;a++)e[t].data[a]||(e[t].data[a]=0);this.baseOptions.xAxis.data=this.date,this.baseOptions.series=e}}},k=g,_=a(1001),w=(0,_.Z)(k,l,i,!1,null,null,null),x=w.exports,b=a(99575),D=a(91907),j=a(14587),M=a(23168),S=a(99933),$=a(759),O=a(24183),P=a(59141);(function(e){e[e["custom"]=0]="custom",e[e["early7"]=1]="early7",e[e["early30"]=2]="early30"})(v||(v={}));var C,z,T=(0,n.defineComponent)({components:{TrendChart:x,ChangeTip:D.Z},setup(e,t){const a="yyyy-MM-DD",l=()=>{const e=y()().subtract(1,"day"),t=e.clone().subtract(6,"day");return[t.format(a),e.format(a)]},i=()=>{const e=y()().subtract(1,"day"),t=e.clone().subtract(29,"day");return[t.format(a),e.format(a)]},r=()=>{const e="yyyy-MM-DD",t=y()().subtract(1,"month").endOf("month"),a=t.clone().subtract(11,"month").startOf("month");return[a.format(e),t.format(e)]},o=()=>{const e="yyyy-MM-DD",t=y()().subtract(1,"weeks").endOf("week"),a=t.clone().subtract(9,"weeks").startOf("week");return[a.format(e),t.format(e)]},c=()=>({project_ids:[],trend_cycle:"day",dates:l()}),d=(0,n.ref)({num:10,page_num:1}),p=(0,n.ref)(c()),u=(0,n.ref)(!0),h=(0,n.ref)(!1),m=(0,n.ref)([]),f=(0,n.ref)([]),g=(0,n.computed)((()=>f.value.filter(((e,t)=>t<(d.value.num??0)*(d.value.page_num??0))))),k=(0,n.ref)(void 0),_=(0,n.ref)(void 0),w=(0,n.ref)(v.early7),x=(0,n.ref)({start_week:void 0,end_week:void 0}),D={onTrendCycle(e){if(p.value.trend_cycle=e,"day"===e)D.onEarlySevenDays();else if("week"===e){const[e,t]=o();x.value.start_week=e,x.value.end_week=t,D.onEndWeekBlurred()}else"month"===e&&(p.value.dates=r())},onDetail(e){const a=f.value[e].project_id;t.root.$router.push({name:s.xx.ctrDataAnalysisDetail,params:{id:`${a}`}})},onEarlySevenDays(){w.value=v.early7,p.value.dates=l()},onEarlyOnMonthDays(){w.value=v.early30,p.value.dates=i()},onDateChange(){w.value=v.custom},async queryCTRProjects(){const e=await(0,b.gV)();e.data.success&&(m.value=e.data.data)},async queryShopLiveStatisticalTrends(e){h.value=!0;const a=await(0,b.R0)(e);h.value=!1,a.data.success?f.value=a.data.data:t.root.$message.error(a.data.message??"请求失败，清稍后重试")},onStartWeekChanged(){x.value.end_week=void 0,_.value?.focus()},onEndWeekBlurred(){if(!x.value.start_week||!x.value.end_week)return void(x.value={start_week:p.value.dates[0],end_week:p.value.dates[1]});const e=y()(x.value.start_week),t=y()(x.value.end_week);if(e.isAfter(t)){const e=x.value.start_week;x.value.start_week=x.value.end_week,x.value.end_week=e}p.value.dates=[x.value.start_week,x.value.end_week]},chartDate(e){return(e.data_list??[]).map((e=>{if(1===e.statistics_cycle){const t=y()(e.start_date).format("MM.DD");return t}if(2===e.statistics_cycle){const t=y()(e.start_date).format("yyyy 第 ww 周");return t}if(3===e.statistics_cycle){const t=y()(e.start_date).format("yyyy.MM");return t}}))},reload(){const e=()=>{const e="yyyy-MM-DD";let t=[];const[a,s]=p.value.dates;return"day"===p.value.trend_cycle?t=[a,s]:"week"===p.value.trend_cycle?t=[y()(a).startOf("week").format(e),y()(s).endOf("week").format(e)]:"month"===p.value.trend_cycle&&(t=[y()(a).startOf("month").format(e),y()(s).endOf("month").format(e)]),t};if(0===(p.value.project_ids?.length??0))return void(f.value=[]);const[t,a]=e(),s={project_ids:p.value.project_ids?.join(","),statistics_cycle:"day"===p.value.trend_cycle?1:"week"===p.value.trend_cycle?2:3,start_date:t,end_date:a};D.queryShopLiveStatisticalTrends(s)},async loadLocalMoreData(e){const t=e.target,a=t.scrollTop,s=t.clientHeight,n=t.scrollHeight;if(a+s===n){if(f.value.length<=g.value.length)return;h.value=!0,setTimeout((async()=>{d.value.page_num&&(d.value.page_num+=1),h.value=!1}),300)}},onAllProject(e){p.value.project_ids=e?m.value.map((e=>e.project_id)):[]}};(0,n.onBeforeMount)((async()=>{await D.queryCTRProjects()}));const C=(0,n.ref)(void 0);(0,n.watchEffect)((()=>{C.value?.addEventListener("scroll",D.loadLocalMoreData)})),(0,n.watchEffect)((()=>{p.value.project_ids=m.value.map((e=>e.project_id))})),(0,n.watchEffect)((()=>{D.reload()}));const z=(0,n.ref)(void 0),T={onPick({maxDate:e,minDate:t}){z.value=e?void 0:t},disabledDate(e){if(!z.value)return!1;const t=y()(z.value),a=y()(e),s=t.clone().subtract(29,"day"),n=t.clone().add(29,"day");return!(!a.isBefore(s)&&!a.isAfter(n))}},E=(0,n.ref)(void 0),L={onPick({maxDate:e,minDate:t}){E.value=e?void 0:t},disabledDate(e){if(!E.value)return!1;const t=y()(E.value),a=y()(e),s=t.clone().subtract(11,"month"),n=t.clone().add(11,"month");return!(!a.isBefore(s,"month")&&!a.isAfter(n,"month"))}},A={disabledDate(e){if(!x.value.start_week)return!1;const t=y()(x.value.start_week),a=y()(e),s=t.clone().subtract(9,"week"),n=t.clone().add(9,"week");return!(!a.isBefore(s,"week")&&!a.isAfter(n,"week"))},firstDayOfWeek:1},F=[j,M,S,$,O,P],W=e=>{const t=[];return(e.data_list??[]).forEach(((e,a)=>{(e.change_tips??[]).forEach(((e,s)=>{t.push({coord:[a,0],name:`${e.change_tip}`,value:e.change_tip,symbolOffset:[0,-10*s-7],symbol:`image://${F[e.change_tip-1]}`})}))})),t.reverse()};return(0,n.onActivated)((()=>{u.value=!0,d.value.page_num=1})),(0,n.onDeactivated)((()=>{u.value=!1})),{...F,projectListRef:C,shouldShow:u,tipsData:W,loading:h,pickDate:z,dayPickerOptions:T,monthPickerOptions:L,weekhPickerOptions:A,startWeekPickerRef:k,endWeekPickerRef:_,ctrProjectTrendData:g,week_cycle:x,projectList:m,dateRange:w,queryForm:p,...D}},render(){const e=arguments[0],{queryForm:t,projectList:a}=this;return e("div",{class:"datacenter-ctr-page-container"},[e("div",{class:"filter-contaainer"},[e("div",{class:"filter-item"},[e("span",{class:"label"},["选择项目："]),e("div",{class:"content"},[e("el-select",{class:"project-select",attrs:{filterable:!0,size:"small",multiple:!0,placeholder:"请选择项目",pickerOptions:this.dayPickerOptions},style:"width: 100%;",model:{value:t.project_ids,callback:e=>{this.$set(t,"project_ids",e)}}},[a.map((t=>e("el-option",{attrs:{label:t.project_name,value:t.project_id},key:t.project_id})))])]),e("div",{style:"flex-shrink: 0;"},[e("tg-button",{style:"margin-left: 16px;",attrs:{type:"link"},on:{click:()=>this.onAllProject(!1)}},["清除"]),e("tg-button",{class:"mgl-12",attrs:{type:"link"},on:{click:()=>this.onAllProject(!0)}},["全选"])])]),e("div",{class:"filter-item mgt-16"},[e("span",{class:"label"},["趋势周期："]),e("div",{class:"content trend"},[e("tg-button",{attrs:{size:"small",type:"default",selected:"day"===t.trend_cycle},on:{click:()=>this.onTrendCycle("day")}},["按天"]),e("tg-button",{attrs:{size:"small",type:"default",selected:"week"===t.trend_cycle},on:{click:()=>this.onTrendCycle("week")}},["按周"]),e("tg-button",{attrs:{size:"small",type:"default",selected:"month"===t.trend_cycle},on:{click:()=>this.onTrendCycle("month")}},["按月"])])]),e("div",{class:"filter-item mgt-16"},[e("span",{class:"label"},["时间范围："]),e("div",{class:"content"},[e("div",{class:"date-range",style:"day"===t.trend_cycle?"":"display: none;"},[e("el-date-picker",{attrs:{type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",size:"small",editable:!1,clearable:!1,format:"yyyy.MM.dd","value-format":"yyyy-MM-dd",pickerOptions:this.dayPickerOptions},style:"width: 268px;",on:{change:this.onDateChange,blur:()=>{this.pickDate=void 0}},model:{value:t.dates,callback:e=>{this.$set(t,"dates",e)}}}),e("tg-button",{attrs:{selected:this.dateRange===v.early7,type:"link"},class:"mgl-16",on:{click:this.onEarlySevenDays}},["近7天"]),e("tg-button",{attrs:{selected:this.dateRange===v.early30,type:"link"},class:"mgl-12",on:{click:this.onEarlyOnMonthDays}},["近30天"])]),e("div",{style:"month"===t.trend_cycle?"":"display: none;"},[e("el-date-picker",{attrs:{type:"monthrange","range-separator":"~","start-placeholder":"开始月份","end-placeholder":"结束月份",size:"small",editable:!1,clearable:!1,format:"yyyy.MM","value-format":"yyyy-MM",pickerOptions:this.monthPickerOptions},model:{value:t.dates,callback:e=>{this.$set(t,"dates",e)}}})]),e("div",{style:"week"===t.trend_cycle?"":"display: none;"},[e("el-date-picker",{ref:"startWeekPickerRef",attrs:{type:"week",placeholder:"选择周",size:"small",editable:!1,clearable:!1,format:"yyyy 第 WW 周","value-format":"yyyy-MM-dd",pickerOptions:{firstDayOfWeek:1}},style:"width: 168px;",on:{change:this.onStartWeekChanged},model:{value:this.week_cycle.start_week,callback:e=>{this.$set(this.week_cycle,"start_week",e)}}}),e("span",{style:"margin: 0 8px; display: inline-block;"},["~"]),e("el-date-picker",{ref:"endWeekPickerRef",attrs:{type:"week",placeholder:"选择周",size:"small",editable:!1,clearable:!1,format:"yyyy 第 WW 周","value-format":"yyyy-MM-dd",pickerOptions:this.weekhPickerOptions},style:"width: 168px;",on:{blur:this.onEndWeekBlurred},model:{value:this.week_cycle.end_week,callback:e=>{this.$set(this.week_cycle,"end_week",e)}}})])])])]),e("div",{class:"data-container",directives:[{name:"loading",value:this.loading}]},[this.ctrProjectTrendData.length>0&&this.shouldShow&&e("div",{class:"project-ctr",ref:"projectListRef"},[this.ctrProjectTrendData.map(((t,a)=>e("div",{class:"chart",style:0===a?"":"margin-top: 24px;",key:`${JSON.stringify(t.data_list??"")}-${a}`},[e("div",{style:"padding-left: 30px;"},[e("span",{style:"font-weight: 600;"},[t.project_name??"--"]),e("tg-button",{attrs:{type:"link"},class:"mgl-12",on:{click:()=>this.onDetail(a)}},["查看详情"])]),e("trendChart",{class:"mgt-12",attrs:{index:a,percentage:!0,originDataList:t.data_list??[],date:this.chartDate(t),list:[{name:"进入率 (人数)",type:"line",smooth:!0,data:(t.data_list??[]).map((e=>e.exposure_watch_ucnt_ratio)),markPoint:{symbolSize:[12,17],label:{show:!1},data:this.tipsData(t)}},{name:"进入率 (人次)",type:"line",smooth:!0,data:(t.data_list??[]).map((e=>e.exposure_watch_times_ratio)),markPoint:{symbolSize:[12,17],label:{show:!1},data:this.tipsData(t)}},{name:"直播销售额 (元)",type:"line",smooth:!0,data:(t.data_list??[]).map((e=>e.sum_gmv)),yAxisIndex:1,markPoint:{symbolSize:[12,17],label:{show:!1},data:this.tipsData(t)}}]}}),(t.data_list??[]).length>0&&e("change-tip",{style:"position: absolute; left: 530px; bottom: 30px;"})])))]),0===this.ctrProjectTrendData.length&&e("div",{class:"chart-empty"},[e("empty-common",{attrs:{"detial-text":"暂无数据"}})])])])}}),E=T,L=(0,_.Z)(E,C,z,!1,null,"63c1f0a9",null),A=L.exports}}]);