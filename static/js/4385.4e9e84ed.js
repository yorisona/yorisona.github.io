"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[4385],{67663:function(e,t,a){a.d(t,{Z:function(){return v}});var l,i,s=a(36568),o=a.n(s),r=a(97434),n=a(23624),c=a(59563),d=a(15681),u=a(70437),p=(0,r.defineComponent)({props:{autoClose:{type:Boolean,default:()=>!0}},setup(e,t){const a=(0,r.ref)(),l=(0,r.ref)([]),i=(e,t=[])=>{l.value=t,s()},s=()=>{const e={...h.value};void 0===e.indicator_type&&(e.indicator_type=l.value.join(",")),f.runAsync({num:20,page_num:1},e)},o=(0,r.ref)(),d=(0,r.ref)(),u=(0,c.Q)(n.bl),p=(0,c.Q)(n.vv,{manual:!0}),m=()=>{t.emit("submit",b.value),e.autoClose&&t.emit("close")},h=(0,r.ref)({}),f=(0,c.h)(n.nQ,{manual:!0}),v=(0,r.ref)([]),b=(0,r.ref)([]),g=s;return{name:a,onSaveBtnClick:m,show:i,reqSaveTag:p,formData:h,formRef:d,reqIndicators:f,selected:b,selectedHistory:v,tableRef:o,reqQueryTag:u,filter:g,dimension_type_list:l}},render(){const e=arguments[0],{formData:t,dimension_type_list:a}=this;return e("div",{class:"page-container"},[e("el-form",o()([{attrs:{inline:!0,size:"small","hide-required-asterisk":!0},ref:"formRef"},{attrs:{model:this.formData}}]),[e("el-form-item",{attrs:{label:"指标名称："}},[e("el-input",{attrs:{placeholder:"请输入维度名称"},style:"width:100%",model:{value:this.formData.name,callback:e=>{this.$set(this.formData,"name",e)}}})]),e("el-form-item",{attrs:{label:"指标标签："}},[e(u.Z,{attrs:{showAll:!0,placeholder:"请选择",options:this.reqQueryTag.data?.map((e=>({value:e.tag_id,label:e.name}))),clearable:!0},model:{value:t.tag_id,callback:e=>{this.$set(t,"tag_id",e)}}})]),e("el-form-item",{attrs:{label:"指标类型："}},[e(u.Z,{attrs:{placeholder:"请选择",showAll:!0,options:d.ts.map((e=>({...e,disabled:!a.some((t=>t===e.value))}))),clearable:!1},model:{value:t.indicator_type,callback:e=>{this.$set(t,"indicator_type",e)}}})]),e("tg-button",{attrs:{type:"primary",size:"small"},on:{click:this.filter}},["查询"])]),e("div",{class:"content-box"},[e("div",{class:"library-box"},[e("tg-table",{ref:"tableRef",attrs:{height:"100%",border:!0,"show-header":!0,data:this.reqIndicators.data},on:{"select-all":e=>{const t=e.length>0;if(t)e.forEach((e=>{const t=this.selected.findIndex((t=>t.id===e.id));-1===t&&this.selected.push(e)}));else{const e=this.reqIndicators.data;e.forEach((e=>{const t=this.selected.findIndex((t=>t.id===e.id));-1!==t&&this.selected.splice(t,1)}))}}}},[e("el-table-column",{attrs:{type:"selection",width:"42px",align:"center",selectable:e=>!this.selectedHistory.some((t=>t.id===e.id))},scopedSlots:{default:({row:t,isSelected:a})=>{const l=this.selected.some((e=>e.id===t.id)),i=this.selectedHistory.some((e=>e.id===t.id));return a!==l&&setTimeout((()=>{this.tableRef?.tableRef.toggleRowSelection(t)})),e("el-checkbox",{on:{input:()=>{l?this.selected=this.selected.filter((e=>e.id!==t.id)):this.selected.push(t)}},attrs:{value:l,disabled:i}})}}}),e("el-table-column",{attrs:{label:"指标",prop:"name","class-name":"table-column",align:"left"}}),e("el-table-column",{attrs:{label:"权重",prop:"weight",width:"76px",align:"right"},scopedSlots:{default:({row:e})=>e.weight?`${e.weight}%`:"--"}})]),e("div",{class:"pagination"},[e("el-pagination",{attrs:{small:!0,layout:"prev,pager,next",total:this.reqIndicators.pagination.total,"current-page":this.reqIndicators.pagination.page_num,"page-size":this.reqIndicators.pagination.page_size},on:{"current-change":this.reqIndicators.pagination.onCurrentChange}})])]),e("div",{class:"select-box"},[e("div",{class:"selected-info"},[e("span",["已选：",this.selected.length," 个指标"]),e("a",{on:{click:()=>{this.selected=[]}}},["清空选中"])]),e("div",{class:"selected-people"},[e("div",{class:"selected-people-list"},[this.selected.map(((t,a)=>e("span",[t.name,e("i",{class:"el-input__icon el-icon-close",on:{click:()=>{this.selected.splice(a,1)}}})])))])])])])])}}),m=p,h=a(1001),f=(0,h.Z)(m,l,i,!1,null,"96b78c1a",null),v=f.exports},24206:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var l,i,s=a(36568),o=a.n(s),r=a(97434),n=a(15681),c=a(23624),d=a(59563),u=a(48606),p=a(70437),m=a(88721),h=a(64236),f=(0,r.defineComponent)({props:{disabledSubmit:{type:Boolean}},setup(e,t){const a=(0,r.ref)({indicator_type:n.F2.RATION}),l=(0,r.ref)(),i=(0,r.ref)([]),s=(0,d.Q)(c.Dr,{manual:!0}),o=(0,d.Q)(c.bl,{manual:e.disabledSubmit,transform(e){return e.map((e=>({label:e.name,value:e.tag_id})))}}),p=(e,t=[])=>{i.value=t,e?a.value=e:t.length>0&&(a.value.indicator_type=t[0])},m=()=>{l.value?.validate((async l=>{if(!l)return;const i={...a.value};i.indicator_type===n.F2.RATION?(i.is_target=!0,i.is_result=!0):i.indicator_type!==n.F2.BONUS&&i.indicator_type!==n.F2.DEDUCT||(i.weight=void 0),(0,h.xb)(i.weight)&&(i.weight=null),(0,h.xb)(i.increase_limit)&&(i.increase_limit=null),(0,h.xb)(i.decrease_limit)&&(i.decrease_limit=null),e.disabledSubmit?t.emit("submit",i):s.runAsync(i).then((()=>{u.Message.success("新增成功 "),t.emit("submit"),t.emit("close")}))}))};return{formData:a,formRef:l,reqTag:o,reqSaveIndicator:s,onSaveBtnClick:m,show:p,dismension_type_list:i}},render(){const e=arguments[0],{formData:t}=this;return e("div",{class:"tg-page-container page-content-container"},[e("div",{class:"content"},[e("el-form",o()([{ref:"formRef",attrs:{size:"small"}},{attrs:{model:this.formData}}]),[!this.disabledSubmit&&e("el-form-item",{attrs:{label:"指标标签："}},[e(p.Z,{style:"width:100%",attrs:{options:this.reqTag.data,filterable:!0,clearable:!0},model:{value:t.tag_id,callback:e=>{this.$set(t,"tag_id",e)}}})]),e("el-form-item",{attrs:{label:"指标类型",prop:"indicator_type","label-position":"top"}},[e("el-radio-group",{style:"width:100%;height:24px; display: flex;align-items: center;",model:{value:this.formData.indicator_type,callback:e=>{this.$set(this.formData,"indicator_type",e)}}},[n.ts.map((t=>{let a=!1;return this.dismension_type_list.length>0&&(a=!this.dismension_type_list.some((e=>e===t.value))),e("el-radio",{attrs:{size:"small",disabled:a,name:"indiactor_type",label:t.value}},[t.label])}))])]),e("el-form-item",{attrs:{label:"指标名称",prop:"name","label-position":"top",rules:[{required:!0,message:"请输入指标名称"}]}},[e("el-input",{attrs:{maxlength:100,placeholder:"请输入指标名称"},model:{value:this.formData.name,callback:e=>{this.$set(this.formData,"name",e)}}})]),e("el-form-item",{attrs:{label:"指标定义","label-position":"top"}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入指标定义",maxlength:350,"show-word-limit":!0},model:{value:t.remark,callback:e=>{this.$set(t,"remark",e)}}})]),e("el-form-item",{attrs:{label:"考核标准",prop:"check_standard","label-position":"top",rules:[{required:!0,message:"请输入考核标准"}]}},[e("el-input",{attrs:{placeholder:"请输入考核标准",type:"textarea",maxlength:350,"show-word-limit":!0},model:{value:t.check_standard,callback:e=>{this.$set(t,"check_standard",e)}}})]),t.indicator_type===n.F2.RATION&&e("el-form-item",{attrs:{label:"目标值：",prop:"increase_limit"},class:"content-flex"},[e("el-switch",{attrs:{value:!0,disabled:!0}})]),t.indicator_type===n.F2.RATION&&e("el-form-item",{attrs:{label:"结果值：",prop:"increase_limit"},class:"content-flex"},[e("el-switch",{attrs:{value:!0,disabled:!0}})]),t.indicator_type===n.F2.BONUS&&e("el-form-item",{attrs:{label:"加分上限","label-position":"top",prop:"increase_limit"}},[e("el-input",{model:{value:t.increase_limit,callback:e=>{this.$set(t,"increase_limit",e)}}})]),t.indicator_type===n.F2.DEDUCT&&e("el-form-item",{attrs:{label:"扣分上限","label-position":"top",prop:"decrease_limit"}},[e("el-input",{model:{value:t.decrease_limit,callback:e=>{this.$set(t,"decrease_limit",e)}}})]),t.indicator_type!==n.F2.DEDUCT&&t.indicator_type!==n.F2.BONUS&&e("el-form-item",{attrs:{label:"权重",prop:"check_standard","label-position":"top"}},[e("el-input",{attrs:{maxlength:"3",placeholder:"请输入权重"},on:{input:e=>{t.weight=m.Z.Interger(e)}},model:{value:t.weight,callback:e=>{this.$set(t,"weight",e)}}},[e("span",{slot:"append"},["%"])])]),e("el-form-item",{attrs:{label:"评分方式："}},[e("div",{class:"sheng"},["直接输入分数 "])]),e("el-form-item",{attrs:{label:"指定评分人："}},[e("el-switch",{style:"position: relative; top: -2px;",model:{value:t.is_assign_scorer,callback:e=>{this.$set(t,"is_assign_scorer",e)}}}),e("div",{class:"sheng"},["开启后，该指标如被引用，则被考核人需在考核表设置指定评分人。 "])])])])])}}),v=f,b=a(1001),g=(0,b.Z)(v,l,i,!1,null,"21bc63a9",null),_=g.exports},59563:function(e,t,a){a.d(t,{Q:function(){return s},h:function(){return o}});a(21703);var l=a(97434),i=a(48606);const s=(e,{manual:t,onError:a,onSuccess:s,defaultParams:o,transform:r}={})=>{const n=(0,l.ref)(),c=(0,l.ref)(),d=(0,l.ref)(!1),u=(0,l.ref)([]),p=()=>{m(...u.value)},m=(...t)=>Promise.resolve(t||o).then((()=>{d.value=!0})).then((()=>0===t.length&&o&&o.length>0?o:t)).then((e=>(u.value=e,e))).then((t=>e(...t))).then((e=>{if(!e.data.success)throw new Error(e.data.message);return n.value=r?r(e.data.data):e.data.data,s&&s(n.value,e.data),e})).then((()=>{d.value=!1})).catch((e=>{throw d.value=!1,c.value=e.message,a&&a(e),i.Message.error(e.message),e})),h=m;return t||m(...o||[]),(0,l.reactive)({data:n,error:c,loading:d,reload:p,run:m,runAsync:h,params:u})},o=(e,t={})=>{const{defaultPageSize:a=20,defaultParams:i=[],transform:o,...r}=t,n=(0,l.ref)(),c=(0,l.reactive)({total:0,page_num:1,page_size:a,onCurrentChange:e=>{const t=[...p.params];t[0]?t[0].page_num=e:t[0]={num:a,page_num:e},p.runAsync(...t).then((()=>{c.page_num=e}))},refresh:()=>c.onCurrentChange(1),reQuery(...e){const t=[];return p.params[0]?(t[0]=p.params[0],t[0].page_num=1,c.page_num=1):(t[0]={num:a,page_num:1},c.page_num=1),t.push(...e),p.runAsync(...t)}}),[d={num:a,page_num:1},...u]=i,p=s(e,{defaultParams:[d,...u],...r,onSuccess(e,a){n.value=o?o(e):e.data,c.total=e.total,t.onSuccess&&t.onSuccess(n.value,a)}}),{data:m,...h}=(0,l.toRefs)(p);return(0,l.reactive)({...h,data:n,pagination:c})}},70437:function(e,t,a){var l=a(36568),i=a.n(l);const s={functional:!0,render:(e,t)=>{const{props:a}=t,{showAll:l=!1,showAllText:s="全部",clearable:o=!0}=a,r={props:{...t.value,clearable:o},on:t.listeners,attrs:t.data.attrs};return e("el-select",i()([{},r]),[l&&e("el-option",{attrs:{label:s,value:void 0}}),a.options?.map(((t,a)=>e("el-option",{attrs:{disabled:t.disabled,label:t.label,value:t.value},key:a})))])}};t["Z"]=s},43773:function(e,t,a){a.d(t,{R:function(){return p},y:function(){return m}});var l=a(36568),i=a.n(l),s=a(97434),o=a(64923),r=a(77944);let n=1;const c=()=>{const e=document.createElement("div");return e.id="dialog_"+n++,document.body.appendChild(e),e},d=new Function,u=(e,t)=>{let a=e;return void 0===a&&(a={}),Object.keys(t).forEach((e=>{const l=a[e]||d,i=t[e];a[e]=(...e)=>{if(!1!==i(...e))return l(...e)}})),a},p=(e={})=>{const t=(0,s.ref)(),a=(0,s.reactive)({visible:!1,title:void 0,width:void 0,footer:!0,okText:"提交",cancelText:"取消",disabledOK:!0}),l=(0,s.ref)(!0),n=e=>{Object.keys(e).forEach((t=>{a.hasOwnProperty.call(a,t)&&(a[t]=e[t])}))};n(e);const d=(0,s.ref)(u(e.on,{close(){a.visible=!1},updateDialog(e={}){n(e)}})),p=()=>{const e=t.value.$refs&&t.value.$refs.dialogRef||{};e.dialogSubmit?e.dialogSubmit():e.onSaveBtnClick?e.onSaveBtnClick():console.log("子组件没有dialogSubmit或onSaveBtnClick")};t.value=new o["default"]({el:c(),store:r.Z,setup(){void 0!==e.provide&&Object.keys(e.provide).forEach((t=>{(0,s.provide)(t,e.provide[t])}))},render(t){if(l.value&&a.visible)return t("el-dialog",i()([{class:`customer-dialog el-dialog-center-rewrite tg-body-container  ${e.class}`},{props:a},{attrs:{"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,wrapperClosable:!1}},{on:d.value},{attrs:{isDialog:!0}}]),[a.visible&&t(e.component,{ref:"dialogRef",props:{...e.props,isDialog:!0},on:d.value}),a.footer&&t("fragments",{slot:"footer"},[t("tg-button",{on:{click:()=>a.visible=!1}},[a.cancelText]),a.disabledOK&&t("tg-button",{attrs:{type:"primary"},on:{click:p}},[a.okText])])])}});const m=(...e)=>{a.visible||(a.visible=!0,(0,s.nextTick)((()=>{const a=t.value.$refs&&t.value.$refs.dialogRef;a?a.dialogShow?a.dialogShow(...e):a.show&&a.show(...e):console.log("未找到子组件请检查代码")})))},h=e=>(n(e),b),f=()=>{a.visible=!1},v=(e,t,a=!1)=>(!0===a?d.value[e]=t:u(d.value,{[e]:t}),b);(0,s.onUnmounted)((()=>{l.value=!1,a.visible=!1}));const b=(0,s.reactive)({show:m,update:h,on:v,close:f,config:e,data:e.data});return b},m=(e={})=>{const t=(0,s.ref)(),a=(0,s.reactive)({visible:!1,title:void 0,width:void 0,footer:!0,okText:"提交",cancelText:"取消",disabledOK:!0}),l=(0,s.ref)(!0),n=e=>{Object.keys(e).forEach((t=>{a.hasOwnProperty.call(a,t)&&(a[t]=e[t])}))};n(e);const d=(0,s.ref)(u(e.on,{close(){a.visible=!1},updateDialog(e={}){n(e)}})),p=()=>{const e=t.value.$refs&&t.value.$refs.dialogRef||{};e.dialogSubmit?e.dialogSubmit():e.onSaveBtnClick?e.onSaveBtnClick():console.log("子组件没有dialogSubmit或onSaveBtnClick")};t.value=new o["default"]({el:c(),store:r.Z,setup(){void 0!==e.provide&&Object.keys(e.provide).forEach((t=>{(0,s.provide)(t,e.provide[t])}))},render(t){if(!l.value)return;if(!a.visible)return;const{width:s,...o}=a;return t("el-drawer",i()([{class:`tg-drawer-rewrite ${e.class}`},{props:{...o,size:s}},{attrs:{"append-to-body":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,wrapperClosable:!1}},{on:d.value},{attrs:{isDialog:!0}}]),[t("div",{class:"tg-drawer-content"},[a.visible&&t(e.component,{ref:"dialogRef",props:{...e.props,isDialog:!0},on:d.value})]),a.footer&&t("div",{class:"tg-drawer-footer"},[t("tg-button",{on:{click:()=>a.visible=!1}},[a.cancelText]),a.disabledOK&&t("tg-button",{class:"mgl-12",attrs:{type:"primary"},on:{click:p}},[a.okText])])])}});const m=(...e)=>{a.visible||(a.visible=!0,(0,s.nextTick)((()=>{const a=t.value.$refs&&t.value.$refs.dialogRef;a?a.dialogShow?a.dialogShow(...e):a.show&&a.show(...e):console.log("未找到子组件请检查代码")})))},h=e=>(n(e),b),f=()=>{a.visible=!1},v=(e,t,a=!1)=>(!0===a?d.value[e]=t:u(d.value,{[e]:t}),b);(0,s.onUnmounted)((()=>{l.value=!1,a.visible=!1}));const b=(0,s.reactive)({show:m,update:h,on:v,close:f,config:e});return b}}}]);