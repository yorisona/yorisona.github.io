"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[3553],{93295:function(e,t,a){a.d(t,{Z:function(){return u}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tree-container"},[a("el-tree",{ref:"single_tree",attrs:{data:e.c_treeData,"check-strictly":!0,"show-checkbox":"","node-key":"id",props:e.defaultProps},on:{check:e.check}})],1)},n=[],o=a(97434),l={props:{c_treeData:{type:Array}},emits:["handleTreeDataCall"],setup(e,t){const a=(0,o.reactive)({defaultProps:{label:"department_name",children:"sub_nodes"}}),r=e=>{t.refs.single_tree.setCheckedKeys([]),t.refs.single_tree.setCheckedKeys([e.id]),t.emit("handleTreeDataCall",e)},n=e=>{t.refs.single_tree.setCheckedKeys([e.department_info.id])},l=()=>{t.refs.single_tree.setCheckedKeys([])};return{...(0,o.toRefs)(a),check:r,editCheck:n,resetCheck:l}}},s=l,i=a(1001),c=(0,i.Z)(s,r,n,!1,null,null,null),u=c.exports},23553:function(e,t,a){a.r(t),a.d(t,{default:function(){return rt}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-user-page"},[a("tg-block",{staticClass:"flex-none",staticStyle:{height:"48px"},attrs:{bodyStyle:{padding:"0"}}},[a("tg-tabs",{attrs:{tabs:e.tabs},on:{change:e.onTabChange},model:{value:e.checkedTab,callback:function(t){e.checkedTab=t},expression:"checkedTab"}})],1),a(e.tabPane,{tag:"component",staticClass:"flex-auto"})],1)},n=[],o=a(97434),l=a(23812),s=a(1763),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.lock",value:e.loading,expression:"loading",modifiers:{lock:!0}}],staticClass:"tg-user-page-tab-user"},[a("tg-card",{staticClass:"flex-none",attrs:{padding:[18,0,0]},on:{"rect:update":e.onTopCardRectUpdate}},[a("userSearch",{on:{transmitSearchCallback:function(t){return e.p_transmitSearchCallback(t)},transmitResetCallback:function(t){return e.p_transmitResetCallback()}}})],1),a("tg-card",e._b({staticClass:"con-list-wrap flex-auto mgt-12",on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("div",{staticClass:"mgt-12",class:e.Permission.canEditUser?"mgb-12":"mgb-6"},[e.Permission.canEditUser?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:function(t){e.operateType="新增",e.$refs.addUser.isDialog=!0}}},[e._v(" 新增用户 ")]):e._e()],1),e.Permission.canViewUserList?a("el-table",e._b({attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common")]},proxy:!0}],null,!1,215544232)},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,r){return a("el-table-column",e._b({key:r},"el-table-column",t,!1))})),1):e._e(),e.total>0&&e.Permission.canViewUserList?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.search_params.page_num,"page-sizes":[10,20,50,100,200],"page-size":e.search_params.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"current-change":function(t){return e.p_currentChange(t)},"size-change":e.handlePageSizeChange}}):e._e()],1),a("addUser",{ref:"addUser",attrs:{id:e.id,type:e.operateType},on:{"save:done":function(t){e.id=null},cancel:function(t){e.id=null}}})],1)},c=[],u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"system-search system-search-ns"},[a("ul",{staticClass:"arrange"},[a("li",[a("span",{staticClass:"s-title"},[e._v("用户信息：")]),a("el-input",{staticClass:"info-name-input",staticStyle:{width:"204px"},attrs:{size:"small",placeholder:"请输入关键词"},model:{value:e.search_params.search_value,callback:function(t){e.$set(e.search_params,"search_value",t)},expression:"search_params.search_value"}},[a("el-select",{staticClass:"info-name-select",staticStyle:{height:"32px"},attrs:{slot:"prepend",size:"small",placeholder:"请选择"},on:{focus:e.selectControlPopoverHide},slot:"prepend",model:{value:e.search_params.search_type,callback:function(t){e.$set(e.search_params,"search_type",t)},expression:"search_params.search_type"}},[a("el-option",{attrs:{value:1,label:"手机号"}}),a("el-option",{attrs:{value:2,label:"花名"}})],1)],1)],1),a("li",[a("span",{staticClass:"s-title"},[e._v("所属部门：")]),a("el-popover",{attrs:{placement:"bottom-start",width:"204",trigger:"click","popper-class":"user-serch-popper"},on:{show:e.popoverShow,hide:e.popoverHide}},[a("div",{staticClass:"repain-select250",attrs:{slot:"reference"},slot:"reference"},[e.search_other_params.department_name?a("el-button",{attrs:{size:"small"}},[e._v(e._s(e.search_other_params.department_name))]):a("el-button",{staticStyle:{color:"#a4b2c2",width:"204px","font-size":"14px"},attrs:{size:"small"}},[e._v("请选择部门")]),a("i",{staticClass:"select-icon el-icon-arrow-down"})],1),a("singleTrees",{ref:"singleTree",attrs:{c_treeData:e.treeData},on:{handleTreeDataCall:function(t){return e.p_handleTreeDataCall(t)}}})],1)],1),a("li",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"controlPopoverHide"}),a("li",[a("span",{staticClass:"s-title"},[e._v("所属岗位：")]),a("el-select",{staticStyle:{width:"204px"},attrs:{clearable:"",filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入并选择岗位","remote-method":e.getJobLists,size:"small"},on:{change:e.onJobIdChange},model:{value:e.search_other_params.job_name,callback:function(t){e.$set(e.search_other_params,"job_name",t)},expression:"search_other_params.job_name"}},e._l(e.search_other_params.job_list,(function(e){return a("el-option",{key:e.id,attrs:{label:e.job_name,value:e.id}})})),1)],1),a("li",[a("span",{staticClass:"s-title"},[e._v("业务类型：")]),a("el-select",{staticStyle:{width:"204px"},attrs:{size:"small",placeholder:"请选择业务类型"},on:{focus:e.selectControlPopoverHide},model:{value:e.search_params.business_type,callback:function(t){e.$set(e.search_params,"business_type",t)},expression:"search_params.business_type"}},e._l(e.enumBussinessType(),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("li",[a("span",{staticClass:"s-title"},[e._v("状态：")]),a("el-select",{staticStyle:{width:"204px"},attrs:{size:"small",placeholder:"请选择状态"},on:{focus:e.selectControlPopoverHide},model:{value:e.search_params.is_checked,callback:function(t){e.$set(e.search_params,"is_checked",t)},expression:"search_params.is_checked"}},e._l(e.enumUserStatus(),(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("li",{staticStyle:{"margin-left":"0"}},[a("tg-button",{attrs:{type:"primary"},on:{click:e.transmitSearch}},[e._v("搜索")]),a("tg-button",{staticStyle:{"margin-left":"12px"},on:{click:e.transmitReset}},[e._v("重置")])],1)])])},d=[],m=a(17496),p=a(64236),f=a(76012);function g(){return(0,f.ZP)({url:"/api/auth/get_department_tree",method:"get"})}function h(e){return(0,f.ZP)({url:"/api/auth/get_job_list",method:"get",params:{...(0,p.jG)(e)}})}function v(e){return(0,f.ZP)({url:"/api/auth/save_user",method:"post",data:e})}function _(e){return(0,f.ZP)({url:`/api/auth/del_department/${e}/`,method:"post"})}var b=a(56045),y=a(93295),k=(0,o.defineComponent)({components:{singleTrees:y.Z},emits:["transmitSearchCallback","transmitResetCallback"],setup(e,t){const a=(0,o.reactive)({search_params:{num:20,page_num:1,search_type:2,search_value:null,department_id:null,job_id:"",business_type:"",is_checked:""},search_other_params:{job_name:"",department_name:"",job_list:[]},treeData:[]});(0,o.onMounted)((()=>{r()}));const r=async()=>{const e=await g();e.data.success&&(a.treeData=e.data.data)},n=e=>{a.search_other_params.department_name=e.department_name,a.search_params.department_id=e.id},l=async e=>{const t=await h({job_name:e});t.data.success&&(a.search_other_params.job_list=t.data.data)},s=e=>{a.search_params.job_id=e},i=Object.assign({},a.search_params),c=Object.assign({},a.search_other_params),u=()=>{a.search_params.page_num=1,t.emit("transmitSearchCallback",a.search_params)},d=()=>{Object.assign(a.search_params,i),Object.assign(a.search_other_params,c),r(),t.emit("transmitResetCallback"),t.refs.singleTree.resetCheck()};return{onJobIdChange:s,...(0,o.toRefs)(a),enumBussinessType:m.q6,enumUserStatus:m.d,transmitSearch:u,transmitReset:d,p_handleTreeDataCall:n,getDepartmenttree:r,getJobLists:l,selectControlPopoverHide:b.TP,popoverShow:b.en,popoverHide:b.EG}}}),C=k,w=a(1001),x=(0,w.Z)(C,u,d,!1,null,"0f1a2b50",null),j=x.exports,R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-user-create-dialog tg-dialog-vcenter"},[a("el-dialog",{staticClass:"customer-dialog",attrs:{title:e.type+"用户",visible:e.isDialog,"destroy-on-close":!0,"close-on-click-modal":!1,width:"440px"},on:{"update:visible":function(t){e.isDialog=t},close:e.closeDialog},scopedSlots:e._u([{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onCancelClick}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"dialog-content dialog-content-form360 pdt-24 pdb-24 pdl-24 pdr-24"},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"98px","label-position":"top",size:"small"}},[a("el-form-item",{attrs:{label:"花名",prop:"username"}},[a("el-input",{ref:"usernameRef",attrs:{placeholder:"请输入用户花名",maxlength:10},on:{input:function(t){return e.form.username=t.replace(/[^\u4E00-\u9FA5]/g,"")}},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),a("el-form-item",{attrs:{label:"手机号",prop:"phone"}},[a("el-input",{attrs:{placeholder:"请输入手机号",maxlength:11},on:{input:function(t){return e.form.phone=t.replace(/[^\d]/g,"")}},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),a("div",{staticClass:"form-verify-position-flex"},[a("el-form-item",{staticClass:"form-verify-position",attrs:{label:"部门岗位",prop:"department_id"}},[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click","popper-class":"popper-class"},on:{show:function(t){return e.popoverShow("select-icon-user-add")},hide:function(t){return e.popoverHide("select-icon-user-add")}}},[a("div",{staticClass:"repain-select",staticStyle:{display:"inline-block"},attrs:{slot:"reference"},slot:"reference"},[e.form_other.department_name?a("el-input",{class:e.form_other.isVerify?"color-error":"",attrs:{value:e.form_other.department_name,readonly:""},scopedSlots:e._u([{key:"suffix",fn:function(){return[a("i",{staticClass:"select-icon select-icon-user-add el-icon-arrow-down"})]},proxy:!0}])}):a("el-input",{class:e.form_other.isVerify?"color-error":"",staticStyle:{color:"#999"},attrs:{placeholder:"请选择部门",readonly:""},scopedSlots:e._u([{key:"suffix",fn:function(){return[a("i",{staticClass:"select-icon select-icon-user-add el-icon-arrow-down"})]},proxy:!0}],null,!1,1521177668)})],1),a("singleTrees",{ref:"singleTree",staticStyle:{"overflow-y":"auto"},attrs:{c_treeData:e.treeData},on:{handleTreeDataCall:function(t){return e.p_handleTreeDataCall(t)}}})],1)],1),a("el-form-item",{staticClass:"form-job-item mgl-18",attrs:{label:"岗位",prop:"job_id"}},[a("el-select",{staticClass:"form-select-two",attrs:{placeholder:"请选择岗位"},on:{focus:e.selectControlPopoverHide},model:{value:e.form.job_id,callback:function(t){e.$set(e.form,"job_id",t)},expression:"form.job_id"}},e._l(e.form_other.job_list,(function(e){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.job_name}})})),1)],1)],1),a("label",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"controlPopoverHide"}),a("el-form-item",{staticClass:"form-item-business-type",attrs:{label:"业务类型",prop:"business_type"}},[a("el-checkbox-group",{staticStyle:{height:"32px"},model:{value:e.form.business_type,callback:function(t){e.$set(e.form,"business_type",t)},expression:"form.business_type"}},e._l(e.enumBussinessType(),(function(t){return a("el-checkbox",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label)+" ")])})),1)],1),"新增"===e.type?a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(t){return e.form.password=t.replace(/\s/g,"")}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1):a("el-form-item",{attrs:{label:"重置密码"}},[a("el-input",{attrs:{type:"password",placeholder:"请输入密码"},on:{input:function(t){return e.form.password=t.replace(/\s/g,"")}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),a("el-form-item",{attrs:{label:"状态",prop:"is_checked"}},e._l(e.enumUserStatus(),(function(t){return a("el-radio",{key:t.value,attrs:{label:t.value},model:{value:e.form.is_checked,callback:function(t){e.$set(e.form,"is_checked",t)},expression:"form.is_checked"}},[e._v(e._s(t.label))])})),1)],1)],1)])],1)},S=[],D={components:{singleTrees:y.Z},props:{type:{type:String,default:"新增"},id:{type:Number}},setup(e,t){const a=(0,o.ref)(void 0),r=(0,o.ref)(!1),n=(0,o.reactive)({form:{username:"",phone:"",job_id:"",department_id:"",business_type:[],password:void 0,is_checked:1},form_other:{department_name:"",job_list:[],isVerify:!1},rules:{username:[{required:!0,message:"请输入用户花名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],job_id:[{required:!0,message:"请选择岗位",trigger:"change"}],department_id:[{required:!0,message:"请选择部门",trigger:"change"}],business_type:[{required:!0,message:"请选择业务类型",trigger:"change"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],is_checked:[{required:!0,message:"请选择状态",trigger:"change"}]},treeData:[]});(0,o.onMounted)((()=>{l()}));const l=async()=>{const e=await g();e.data.success&&(n.treeData=e.data.data)},s=e=>{n.form_other.department_name=e.department_name,n.form.department_id=e.id,n.form.job_id="",n.form_other.isVerify=!1,i()},i=async()=>{const e=await h({department_id:n.form.department_id});e.data.success&&(n.form_other.job_list=e.data.data)},c=e=>{n.form.username=e.username,n.form.phone=e.phone,n.form.department_id=e.department_id,n.form_other.department_name=e.department_info?.department_name||"",n.form.job_id=e.job_id,i(),n.form_other.job_name=e.job_info.job_name,e.business_type.length&&(n.form.business_type=e.business_type),n.form.is_checked=e.is_checked,setTimeout((()=>{t.refs.singleTree.editCheck(e)}),0)},u=()=>{n.form.username="",n.form.phone="",n.form.department_id="",n.form_other.department_name="",n.form.job_id="",n.form_other.job_name="",n.form.business_type=[],n.form.is_checked=1,n.form.password=void 0,n.form_other.isVerify=!1},d=a=>{n.form.department_id?n.form_other.isVerify=!1:n.form_other.isVerify=!0,t.refs[a].validate((async a=>{if(!a)return!1;{if(!/^[1][3,4,5,7,8,9][0-9]{9}$/.test(n.form.phone))return void t.root.$message({type:"error",message:"手机号格式不正确"});const a={...n.form};"编辑"===e.type&&(a.id=e.id);const o=await v(a);o.data.success?(t.root.$message({type:"success",message:"保存成功"}),t.parent.getData(),t.emit("save:done"),r.value=!1):t.root.$message({type:"error",message:o.data.message})}}))},p=()=>{u(),t.emit("cancel")},f=()=>{r.value=!1,t.emit("cancel")};return(0,o.watch)((()=>r.value),(e=>{e&&(n.form.username||(0,o.nextTick)((()=>{a.value?.focus()})))})),{usernameRef:a,isDialog:r,...(0,o.toRefs)(n),getDepartmenttree:l,editClick:c,submitForm:d,getJobLists:i,enumBussinessType:m.xN,enumUserStatus:m.lQ,resetForm:u,p_handleTreeDataCall:s,closeDialog:p,selectControlPopoverHide:b.TP,popoverShow:b.en,popoverHide:b.EG,onCancelClick:f}}},T=D,P=(0,w.Z)(T,R,S,!1,null,null,null),E=P.exports,A=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next",total:e.total},on:{"current-change":e.currentChange}})],1)},$=[],z={props:{total:{type:Number,default:()=>0}},emit:["c_currentChange"],setup(e,t){const a=(0,o.reactive)({num:10,page_num:1}),r=e=>{t.emit("c_currentChange",e)};return{...(0,o.toRefs)(a),currentChange:r}}},F=z,L=(0,w.Z)(F,A,$,!1,null,null,null),U=L.exports,q=a(74234),N=a(61282),V=a(67910),B=a(20809),O=(0,o.defineComponent)({components:{userSearch:j,addUser:E,tablePagination:U},setup(e,t){const a=(0,o.inject)("Permission"),{tableHeightLogic:r,onTopCardRectUpdate:n}=(0,B.Z)(),l=(0,o.ref)(null),s=(0,o.reactive)({id:null,search_params:{page_num:1,num:20},operateType:"新增",p_editData:{}}),i=(0,o.ref)(!1),c=(0,o.ref)([]),u=(0,o.ref)(0),d=async(e,t=!0)=>{t&&(s.search_params.page_num=1);const a={...e,...s.search_params};i.value=!0;const[{data:r}]=await Promise.all([await(0,q.L)(a),await(0,p._v)(1e3*Math.random()+500)]);i.value=!1,r.success?(c.value=r.data.data,u.value=r.data.total):(c.value=[],u.value=0)},f=e=>{s.operateType="编辑",s.p_editData=e,s.id=e.id,l.value&&(l.value.editClick(e),l.value.isDialog=!0)},g=e=>{s.search_params=e;const{department_id:t,department_ids:a,job_id:r,...n}=e,o={...n,department_ids:Array.isArray(a)&&a.length>0?a.join(","):void 0,job_id:""===r?void 0:r,department_id:""===t?void 0:t,business_type:""===e.business_type?void 0:e.business_type,is_checked:""===e.is_checked?void 0:e.is_checked};d(o)},h=()=>{s.search_params={},s.search_params.page_num=1,s.search_params.num=20,d(s.search_params)},v=e=>{s.search_params.page_num=e,d(s.search_params,!1)},_=e=>{s.search_params.num=e,d(s.search_params)};(0,o.onMounted)((()=>{d({})}));const b=e=>e.phone??"--",y=(0,V.zY)(c,"手机号",b),k=(e,t)=>{const a=e.username||"--",{is_folded:r,folded_text:n}=(0,N.zb)(a,12);return t||!r?n:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover",content:a}},[(0,o.h)("span",{slot:"reference"},[n])])},C=(0,V.zY)(c,"花名",k),w=(e,t)=>{const a=e.department_info?.department_name||"--",{is_folded:r,folded_text:n}=(0,N.zb)(a,12);return t||!r?n:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover",content:a}},[(0,o.h)("span",{slot:"reference"},[n])])},x=(0,V.zY)(c,"部门",w),j=(e,t)=>{const a=e.job_info?.job_name||"--",{is_folded:r,folded_text:n}=(0,N.zb)(a,12);return t||!r?n:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover",content:a}},[(0,o.h)("span",{slot:"reference"},[n])])},R=(0,V.zY)(c,"岗位",j),S=e=>e.business_type.map((e=>(0,m.xN)(e))).map((e=>e?.label)).join("、")||"--",D=(0,V.zY)(c,"业务类型",S),T=(0,o.computed)((()=>[{label:"手机号",minWidth:y.value,formatter:b},{label:"花名",align:"center",minWidth:C.value,formatter:e=>k(e,!1)},{label:"工号",minWidth:86,formatter:e=>e.work_id||"--"},{label:"部门",minWidth:x.value,formatter:e=>w(e,!1)},{label:"岗位",minWidth:R.value,formatter:e=>j(e,!1)},{label:"直接主管",align:"center",minWidth:80,formatter:e=>e.leader?.name},{label:"业务类型",minWidth:D.value,formatter:S},{label:"状态",minWidth:78,align:"center",formatter:e=>(0,m.lQ)(e.is_checked)?(0,o.h)("div",{style:{justifyContent:"center",width:"100%",display:"flex"}},[(0,o.h)("div",{class:2===e.is_checked?"status-style status-style-stop":"status-style",style:{justifyContent:"center"}},[(0,o.h)("img",{domProps:{src:(0,m.lQ)(e.is_checked)?.img}}),(0,o.h)("span",{style:{paddingLeft:"5px"},class:2===e.is_checked?"stop":""},[(0,m.lQ)(e.is_checked)?.label])])]):"--"},{label:"创建时间",align:"center",minWidth:158,formatter:e=>e.gmt_create.replace(/-/g,".")||"--"},{label:"最后登录",minWidth:158,align:"center",formatter:e=>e.last_login_time_str.replace(/-/g,".")||"--"},{label:"操作",minWidth:52,formatter:e=>a?.value.canEditUser?(0,o.h)("tg-button",{props:{type:"link"},on:{click:()=>f(e)}},["编辑"]):"--"}]));return{Permission:a,...(0,o.toRefs)(s),loading:i,getData:d,enumBussinessType:m.xN,enumUserStatus:m.lQ,p_transmitSearchCallback:g,p_transmitResetCallback:h,p_currentChange:v,tableRowClick:f,handlePageSizeChange:_,addUser:l,list:c,total:u,onTopCardRectUpdate:n,...r,columns:T}}}),W=O,H=(0,w.Z)(W,i,c,!1,null,"095402fe",null),I=H.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-sysmtem-user-tab-department"},[a("tg-card",e._b({directives:[{name:"loading",rawName:"v-loading.lock",value:e.isLoading,expression:"isLoading",modifiers:{lock:!0}}],staticClass:"tg-user-page-tab-department mgt-10 flex-auto",on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("tg-button-line",{staticClass:"mgt-12",class:e.Permission.canEditDepartment?"mgb-12":"mgb-6"},[e.Permission.canEditDepartment?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:function(t){return e.addSameDepartment("新增同级",!0)}}},[e._v("新增同级")]):e._e(),e.Permission.canEditDepartment?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add",disabled:void 0===e.checkedRow},on:{click:function(t){return e.addSameDepartment("新增下级",!1)}}},[e._v("新增下级")]):e._e()],1),e.Permission.canViewDepartmentList?a("el-table",e._b({ref:"tableRef",attrs:{stripe:"",data:e.list,"row-key":"id","tree-props":{children:"sub_nodes"}},on:{"row-click":function(t){return e.handleRowExpansion(t)}}},"el-table",e.tableProps,!1),[e._l(e.columns,(function(t,r){return a("el-table-column",e._b({key:r},"el-table-column",t,!1))})),a("template",{slot:"empty"},[a("empty-common")],1)],2):e._e()],1),a("addDepartment",{ref:"departmentFormRef",on:{"save:done":e.getData}})],1)},G=[],Z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic tg-dialog-vcenter dialog-sty add-department-dialog",attrs:{title:""+e.type,visible:e.isDialog,width:"440px","destroy-on-close":!0,"close-on-click-modal":!1},on:{close:e.closeDialog},scopedSlots:e._u([{key:"footer",fn:function(){return[a("tg-button",{attrs:{size:"small"},on:{click:function(t){e.isDialog=!1}}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary",size:"small"},on:{click:e.submitForm}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"dialog-content dialog-content-form360",staticStyle:{padding:"24px"}},[a("el-form",{ref:"departmentCreateFrm",attrs:{rules:e.rules,model:e.form,"label-width":"78px","label-position":"top",size:"small"}},[a("el-form-item",{attrs:{label:"上级部门"}},["新增下级"===e.type?a("el-input",{attrs:{placeholder:"2343",disabled:""},model:{value:e.superior_dep_name,callback:function(t){e.superior_dep_name=t},expression:"superior_dep_name"}}):a("el-input",{attrs:{disabled:""},model:{value:e.superior_dep_name,callback:function(t){e.superior_dep_name=t},expression:"superior_dep_name"}})],1),a("el-form-item",{attrs:{label:"部门名称",prop:"department_name"}},[a("el-input",{ref:"departmentRef",staticStyle:{height:"32px",width:"100%"},attrs:{placeholder:"请输入部门名称",maxlength:15,"show-word-limit":!0},on:{input:function(t){return e.form.department_name=t.replace(/[^\a-zA-Z0-9\u4E00-\u9FA5]/g,"")}},model:{value:e.form.department_name,callback:function(t){e.$set(e.form,"department_name",t)},expression:"form.department_name"}})],1),a("el-form-item",{attrs:{label:"关联岗位"}},[a("el-select",{staticClass:"mutiple-select",staticStyle:{height:"auto !important",width:"100%"},attrs:{"popper-class":"department-selection-popper",multiple:"",placeholder:"请选择关联岗位"},model:{value:e.form.related_job_ids,callback:function(t){e.$set(e.form,"related_job_ids",t)},expression:"form.related_job_ids"}},[a("el-checkbox-group",{model:{value:e.form.related_job_ids,callback:function(t){e.$set(e.form,"related_job_ids",t)},expression:"form.related_job_ids"}},e._l(e.form_other.job_list,(function(t){return a("el-option",{key:t.id,attrs:{label:t.job_name,value:t.id}},[a("el-checkbox",{attrs:{label:t.id},nativeOn:{click:function(e){e.preventDefault()}}}),a("span",{staticClass:"select-option-label"},[e._v(e._s(t.job_name))])],1)})),1)],1)],1)],1)],1)])},J=[];const Y="/api/auth/get_department_tree",Q="/api/auth/save_department",X=async()=>(0,f.dX)(Y),K=async e=>(0,f.SO)(Q,{...(0,p.jG)(e)});var ee,te=(0,o.defineComponent)({setup(e,t){const a=(0,o.ref)(void 0),r=(0,o.ref)(!1),n=(0,o.ref)("新增"),l=(0,o.ref)(void 0),s=(0,o.ref)("无"),i=(0,o.reactive)({form_other:{job_list:[]},rules:{department_name:[{required:!0,message:"请输入部门名称",trigger:"blur"}]}}),c=(0,o.ref)(null),u=(0,o.ref)({id:null,superior_dep_id:"",department_name:"",related_job_ids:[],department_id:""});(0,o.onMounted)((()=>{d()}));const d=async()=>{const e=await h({department_id:u.value.department_id});e.data.success&&(i.form_other.job_list=e.data.data)},m=(e,t)=>{u.value.superior_dep_id=e?.id?e?.id:"";const r="新增同级"===t?e?.superior_dep_name:e?.department_name;n.value=t,s.value=r??"无",(0,o.nextTick)((()=>{a.value?.focus()}))},p=e=>{n.value="编辑",s.value=e.superior_dep_name??"无",u.value.department_name=e.department_name,u.value.related_job_ids=e.related_jobs.map((e=>e.job_id)),u.value.superior_dep_id=e.superior_dep_id,u.value.id=e.id},f=()=>{u.value.department_name="",u.value.superior_dep_id="",u.value.related_job_ids=[]},g=async()=>{const e=await new Promise((e=>c.value?.validate((t=>{e(t)}))));if(!e)return!1;{"新增下级"===n.value?u.value.id=null:"新增同级"===n.value&&(u.value.id=null,u.value.superior_dep_id=l.value?.superior_dep_id??"");const{id:e,department_name:a,superior_dep_id:o,related_job_ids:s}=u.value,i={id:e??void 0,department_name:a,superior_dep_id:""===o?void 0:o,related_job_ids:s},c=await K(i);c.data.success?(t.root.$message.success("保存成功"),t.emit("save:done"),r.value=!1):t.root.$message.error(c.data.message??"保存失败")}},v=()=>{f(),r.value=!1},_=e=>{r.value=e};return{departmentRef:a,type:n,row:l,createNewDepartment:m,isDialog:r,setIsDialog:_,superior_dep_name:s,...(0,o.toRefs)(i),form:u,editClick:p,submitForm:g,getJobLists:d,resetForm:f,closeDialog:v,departmentCreateFrm:c}}}),ae=te,re=(0,w.Z)(ae,Z,J,!1,null,null,null),ne=re.exports,oe=a(82741),le=a(58302),se=(0,o.defineComponent)({components:{singleTrees:y.Z,addDepartment:ne},setup(e,t){const a=(0,o.inject)("Permission"),r=(0,o.ref)(void 0),n=(0,o.ref)(null),l=(0,o.reactive)({isLoading:!1,row:{},operateType:"新增同级",selectedCheckboxList:[],upSelectedIndex:null}),s=(0,o.ref)([]),i=(0,o.ref)(void 0);(0,o.onMounted)((()=>{c()}));const c=async()=>{l.isLoading=!0;const{data:e}=await X();e.success?(l.selectedCheckboxList.splice(0,l.selectedCheckboxList.length),l.upSelectedIndex=null,s.value=e.data):s.value=[],l.isLoading=!1},u=(e,t,a)=>{e?(null!==l.upSelectedIndex&&l.selectedCheckboxList.splice(l.upSelectedIndex,1),i.value=(0,p.Qc)(a),l.upSelectedIndex=t):(l.upSelectedIndex=null,i.value=void 0)},d=async e=>{const a=s.value.find((t=>t.id===e)),r=await(0,oe.I)(t,`是否确认删除部门【${a?.department_name}】？`);if(!r)return;const n=await _(e);n.data.success?(t.root.$message({type:"success",message:"删除成功"}),c()):t.root.$message({type:"error",message:n.data.message})},m=(e,t)=>{l.operateType=e,n.value?.createNewDepartment(i.value,t?"新增同级":"新增下级"),n.value?.setIsDialog(!0)},f=e=>{l.operateType="编辑",n.value?.editClick(e),n.value?.setIsDialog(!0)},g=[],h=e=>{let t=!0;if(t=!g.find((t=>e===t)),r.value?.toggleRowExpansion(e,t),t)g.push(e);else{const t=g.indexOf(e);g.splice(t,1)}},v=32,b=0,y=36,k=31,C=(0,o.ref)(26),w=(0,le.Z)({compensation:(0,o.computed)((()=>v+b+y+k)),fixedBlockHeightRefs:[C],tableMinHeight:100}),x=(0,o.computed)((()=>[{label:"部门名称",minWidth:430,formatter:(e,t,r,n)=>{const s=[];return a?.value.canEditDepartment?s.push((0,o.h)("el-checkbox",{style:0===e.sub_nodes?.length&&0===e.dep_level?"margin-left: 22px":"",props:{value:l.selectedCheckboxList[n]},on:{change:t=>u(t,n,e)}},[(0,o.h)("div",{on:{click:()=>h(e)}},[e.department_name])])):s.push((0,o.h)("span",[e.department_name])),s}},{label:"关联岗位",minWidth:606,formatter:e=>(0,o.h)("div",{style:{marginRight:"40px"},class:"line-clamp-2"},[e.related_jobs.map((e=>e.job_name)).join("、")||"无"])},{label:"操作",minWidth:a?.value.canEditDepartment&&a?.value.canDeleteDepartment?126:92,formatter:e=>{const t=[];return a?.value.canEditDepartment&&t.push((0,o.h)("tg-button",{on:{click:()=>f(e)},props:{type:"link"}},["编辑"])),a?.value.canDeleteDepartment&&t.push((0,o.h)("tg-button",{on:{click:()=>d(e.id)},props:{type:"link"}},["删除"])),0===t.length?"--":(0,o.h)("div",{style:{display:"grid",gridTemplateColumns:"auto auto",columnGap:"10px"}},t)}}]));return{columns:x,Permission:a,departmentFormRef:n,...(0,o.toRefs)(l),list:s,getData:c,changeCheckbox:u,deleteDepatment:d,addSameDepartment:m,tableRowClick:f,checkedRow:i,tableRef:r,handleRowExpansion:h,...w}}}),ie=se,ce=(0,w.Z)(ie,M,G,!1,null,"a67dc5b8",null),ue=ce.exports,de=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-user-page-tab-job"},[a("tg-card",{staticClass:"stick-top flex-none",attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[a("el-form",{attrs:{size:"small","show-message":!1,"label-width":"70px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("div",{staticClass:"filter-form-div"},[a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{label:"岗位名称："}},[a("el-input",{attrs:{placeholder:"请输入岗位名称"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reload.apply(null,arguments)}},model:{value:e.queryForm.job_name,callback:function(t){e.$set(e.queryForm,"job_name",t)},expression:"queryForm.job_name"}})],1)],1),a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"filter-form-item-btn"},[a("tg-button",{attrs:{type:"primary"},on:{click:e.reload}},[e._v("搜索")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)])],1)])])],1),a("tg-card",e._b({staticClass:"flex-auto mgt-12",on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("div",{staticClass:"mgt-12",class:e.Permission.canEditJob?"mgb-12":"mgb-6"},[e.Permission.canEditJob?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:e.onCreateJobClick}},[e._v("新增岗位")]):e._e()],1),e.Permission.canViewJobList?a("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂未添加岗位"}})]},proxy:!0}],null,!1,2518177964)},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,r){return a("el-table-column",e._b({key:r},"el-table-column",t,!1))})),1):e._e(),e.total>0&&e.Permission.canViewJobList?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.queryForm.page_num,"page-sizes":[10,20,50,100,200],"page-size":e.queryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.queryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.queryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.onSizeChange}}):e._e()],1),a("JobForm",{attrs:{visible:e.formVisible,job:e.checkedJob},on:{"dialog:close":e.onDialogClose,"jobform:save:start":function(t){return e.toggleJobFormSaveLoading(!0)},"jobform:save:end":e.toggleJobFormSaveLoading}}),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存岗位，请稍候..."}}),a("tg-mask-loading",{attrs:{visible:e.deleteLoading,content:"  正在删除岗位，请稍候..."}})],1)},me=[];(function(e){e[e["Employee"]=1]="Employee",e[e["Manager"]=2]="Manager"})(ee||(ee={}));const pe=new Map([[ee.Employee,"普通员工"],[ee.Manager,"部门管理"]]),fe=[{value:ee.Employee,label:"普通员工"},{value:ee.Manager,label:"部门管理"}],ge="/api/auth/query_job",he="/api/auth/save_job",ve="/api/auth/del_job/:id/",_e=async e=>(0,f.dX)(ge,{params:{...(0,p.jG)(e)}}),be=async e=>{const{related_dep_ids:t,...a}=e;return(0,f.SO)(he,{...(0,p.jG)(a),related_dep_ids:t})},ye=async e=>(0,f.SO)(ve.replace(":id",`${e}`));var ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic tg-job-form-dialog tg-dialog-vcenter",attrs:{width:"440px",visible:e.visible,"close-on-click-modal":!1,"label-width":"78px"},on:{close:e.onCloseBtnClick},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.title))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onCloseBtnClick}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticStyle:{padding:"24px",overflow:"hidden"}},[a("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.formRules,"label-width":"78px",size:"small","label-position":"top"}},[a("el-form-item",{attrs:{label:"岗位名称",prop:"job_name"}},[a("el-input",{ref:"jobRef",attrs:{placeholder:"请输入岗位名称",maxlength:10,"show-word-limit":""},model:{value:e.form.job_name,callback:function(t){e.$set(e.form,"job_name","string"===typeof t?t.trim():t)},expression:"form.job_name"}})],1),a("el-form-item",{staticClass:"radioGroupRow",attrs:{label:"岗位等级：",prop:"job_level"}},[a("el-radio-group",{model:{value:e.form.job_level,callback:function(t){e.$set(e.form,"job_level",t)},expression:"form.job_level"}},e._l(e.JobLevelOptions,(function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])})),1)],1),a("el-form-item",{attrs:{label:"关联部门",prop:"related_dep_ids"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{"popper-class":"job-selection-popper",multiple:"",clearable:"",placeholder:"请选择关联部门"},model:{value:e.form.related_dep_ids,callback:function(t){e.$set(e.form,"related_dep_ids",t)},expression:"form.related_dep_ids"}},[a("el-checkbox-group",{model:{value:e.form.related_dep_ids,callback:function(t){e.$set(e.form,"related_dep_ids",t)},expression:"form.related_dep_ids"}},e._l(e.depOptions,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}},[a("el-checkbox",{attrs:{label:t.value},nativeOn:{click:function(e){e.preventDefault()}}}),a("span",{staticClass:"select-option-label"},[e._v(e._s(t.label))])],1)})),1)],1)],1),a("el-form-item",{attrs:{label:"功能角色",prop:"related_role_ids"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{"popper-class":"job-selection-popper",multiple:"",placeholder:"请选择功能角色"},model:{value:e.form.related_role_ids,callback:function(t){e.$set(e.form,"related_role_ids",t)},expression:"form.related_role_ids"}},[a("el-checkbox-group",{model:{value:e.form.related_role_ids,callback:function(t){e.$set(e.form,"related_role_ids",t)},expression:"form.related_role_ids"}},e._l(e.roleOptions,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}},[a("el-checkbox",{attrs:{label:t.value},nativeOn:{click:function(e){e.preventDefault()}}}),a("span",{staticClass:"select-option-label"},[e._v(e._s(t.label))])],1)})),1)],1)],1)],1)],1)])},Ce=[],we=(0,o.defineComponent)({name:"TgJobFormDialog",props:{visible:{type:Boolean,required:!0},job:{type:Object}},setup(e,t){const a=(0,o.computed)((()=>void 0===e.job?"新增岗位":"编辑岗位")),r=(0,o.ref)(void 0),n=(0,o.ref)(null),l=(0,o.ref)({id:void 0,job_name:"",job_level:ee.Employee,related_dep_ids:[],related_role_ids:[]});(0,o.watch)((()=>e.visible),(t=>{if(t&&void 0!==e.job){const{id:t,job_name:a,job_level:r,departments:n,roles:o}=e.job;l.value.id=t,l.value.job_name=a,l.value.job_level=r,l.value.related_dep_ids=n.map((e=>e.department_id)),l.value.related_role_ids=o.map((e=>e.role_id))}else t&&!e.job&&(0,o.nextTick)((()=>{r.value?.focus()}));n.value?.clearValidate()}));const s=(0,o.ref)({job_name:[{required:!0,message:"请输入岗位名称",trigger:"blur"}],job_level:[{required:!0,message:"请选择岗位等级",trigger:"change"}],related_role_ids:[{required:!0,message:"请选择功能角色",trigger:"change"}]}),i=()=>{l.value.id=void 0,l.value.job_name="",l.value.job_level=ee.Employee,l.value.related_dep_ids=[],l.value.related_role_ids=[]},c=()=>{i(),t.emit("dialog:close")},u=async()=>{n.value?.clearValidate();const e=await new Promise((e=>n.value?.validate((t=>{e(t)}))));if(!e)return;const a=l.value;t.emit("jobform:save:start");const[{data:r}]=await Promise.all([await be(a),await(0,p._v)(500)]);t.emit("jobform:save:end"),r.success?(t.root.$message.success("岗位保存成功"),t.emit("dialog:close",!0)):t.root.$message.error(r.message??"岗位保存失败")},d=(0,o.inject)("depOptions")??(0,o.ref)([]),m=(0,o.inject)("roleOptions")??(0,o.ref)([]);return{jobRef:r,title:a,formRef:n,form:l,formRules:s,onCloseBtnClick:c,onSubmit:u,JobLevelOptions:fe,depOptions:d,roleOptions:m}}}),xe=we,je=(0,w.Z)(xe,ke,Ce,!1,null,null,null),Re=je.exports;function Se(e){return e.map((e=>{const{sub_nodes:t,...a}=e;return void 0!==t&&t.length>0?[{...a},...Se(t)]:[e]})).flat()}const De=()=>{const e=(0,o.ref)([]),t=(0,o.ref)(0),a=(0,o.ref)(!1),r=(0,o.computed)((()=>Se(e.value))),n=async()=>{a.value=!0;const{data:r}=await X();a.value=!1,r.success?(e.value=r.data,t.value=r.data.length):(e.value=[],t.value=0)};return{loadData:n,flatList:r}};var Te=a(50572),Pe=a(29625);const Ee=()=>{const e=(0,o.ref)([]),t=(0,o.ref)(0),a=(0,o.ref)(!1),r=async r=>{a.value=!0;const[{data:n}]=await Promise.all([await(0,Te.cc)(r),await(0,p._v)(500)]);a.value=!1,n.success?(e.value=n.data.data,t.value=n.data.total):(e.value=[],t.value=0)},n=async()=>{a.value=!0;const{data:r}=await(0,Te.cc)({role_type:Pe.Y$.common,page_num:1,num:20});if(r.success)if(r.data.data.length<r.data.total){const{data:a}=await(0,Te.cc)({role_type:Pe.Y$.common,page_num:1,num:r.data.total});e.value=a.data.data,t.value=r.data.total}else e.value=r.data.data,t.value=r.data.total;else e.value=[],t.value=0;a.value=!1};return{list:e,total:t,loading:a,loadData:r,loadAll:n}};var Ae=a(17099);const $e=()=>{const e=(0,o.ref)(!1),t=(t=!1)=>{e.value=t},a=()=>{t(!0)};return{formVisible:e,onCreateJobClick:a,toggleFormVisible:t}};var ze=(0,o.defineComponent)({name:"TgSystemUserTabJob",components:{JobForm:Re},setup(e,t){const a=(0,o.inject)("Permission"),{tableHeightLogic:r,onTopCardRectUpdate:n}=(0,B.Z)(),l=(0,o.ref)({page_num:1,num:20,job_name:""}),s=(0,o.ref)([]),i=(0,o.ref)(0),c=(0,o.ref)(!1),u=async e=>{c.value=!0;const[{data:t}]=await Promise.all([await _e(e),await(0,p._v)(300)]);c.value=!1,t.success?(s.value=t.data.data,i.value=t.data.total):(s.value=[],i.value=0)},d=()=>{l.value.job_name=""},m=$e(),f=e=>e.job_name,g=(e,t)=>{const a=e.departments.length?e.departments.map((e=>e.department_name)).join("、"):"--",{is_folded:r,folded_text:n}=(0,N.zb)(a,12);return t||!r?n:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover"}},[(0,o.h)("span",{slot:"reference"},[n]),(0,o.h)("div",{style:{minWidth:"20px",maxWidth:"400px"}},[e.departments.length>0?(0,o.h)("tg-tag-group",{props:{theme:"gray",tags:e.departments.filter((e=>null!==e.department_name)).map((e=>({id:e.department_id,value:e.department_name})))}}):""])])},h=(0,V.zY)(s,"关联部门",g),v=(e,t)=>{const a=e.roles.length?e.roles.map((e=>e.role_name)).join("、"):"--",{is_folded:r,folded_text:n}=(0,N.zb)(a,12);return t||!r?n:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover"}},[(0,o.h)("div",{slot:"reference"},[n]),(0,o.h)("div",{style:{minWidth:"20px",maxWidth:"400px"}},[(0,o.h)("tg-tag-group",{props:{theme:"gray",tags:e.roles.map((e=>e.role_name))}})])])},_=(0,V.zY)(s,"功能角色",v),b=(0,o.computed)((()=>[{label:"岗位名称",property:"job_name",minWidth:(0,V.zY)(s,"岗位名称",f).value+50,formatter:f},{label:"岗位等级",property:"job_level",minWidth:120,formatter:e=>pe.get(e.job_level)??(0,Ae.l)()},{label:"关联部门",property:"departments",minWidth:h.value+50,formatter:e=>g(e,!1)},{label:"功能角色",property:"roles",minWidth:_.value+50,formatter:e=>v(e,!1)},{label:"操作",align:"left",headerAlign:"left",minWidth:92,formatter:e=>(0,o.h)("div",{class:"operation"},[(0,o.h)("a",{on:{click:()=>j(e)}},["编辑"]),(0,o.h)("a",{on:{click:()=>w(e)}},["删除"])])}])),y=async(e=!0)=>{e&&(l.value.page_num=1),await u(l.value)},k=async()=>{d(),await y()},C=(0,o.ref)(!1),w=async e=>{if(C.value)return;const a=await(0,oe.I)(t,`是否确认删除岗位【${e.job_name}】？`);if(!a)return;C.value=!0;const[{data:r},n]=await Promise.all([await ye(e.id),await(0,p._v)(500)]);C.value=!1,r.success?(t.root.$message.success("删除岗位成功"),await y()):t.root.$message.error(r.message??"删除岗位失败")},x=(0,o.ref)(void 0),j=e=>{m.toggleFormVisible(!0),x.value=e},R=async e=>{m.toggleFormVisible(),x.value=void 0,e&&await y()},S=(0,o.ref)(!1),D=(e=!1)=>{S.value=e},T=async e=>{l.value.page_num=e,await y(!1)},P=async e=>{l.value.num=e,await y()},E=De(),A=Ee();(0,o.onBeforeMount)((()=>{y(),E.loadData(),A.loadAll()}));const $=(0,o.computed)((()=>E.flatList.value.map((e=>({label:e.department_name,value:e.id}))))),z=(0,o.computed)((()=>A.list.value.map((e=>({label:e.role_name,value:e.id})))));return(0,o.provide)("depOptions",$),(0,o.provide)("roleOptions",z),{list:s,total:i,loading:c,Permission:a,...m,columns:b,queryForm:l,reload:y,reset:k,handleCurrentChange:T,onSizeChange:P,onDialogClose:R,deleteLoading:C,checkedJob:x,saveLoading:S,toggleJobFormSaveLoading:D,onDeleteBtnClick:w,onTopCardRectUpdate:n,...r}}}),Fe=ze,Le=(0,w.Z)(Fe,de,me,!1,null,null,null),Ue=Le.exports,qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-user-page-tab-role"},[a("tg-card",{staticClass:"stick-top flex-none",attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[a("el-form",{attrs:{size:"small","show-message":!1,"label-width":"70px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("div",{staticClass:"filter-form-div"},[a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{label:"角色名称："}},[a("el-input",{attrs:{placeholder:"请输入角色名称"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reload.apply(null,arguments)}},model:{value:e.queryForm.role_name,callback:function(t){e.$set(e.queryForm,"role_name",t)},expression:"queryForm.role_name"}})],1)],1),a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"filter-form-item-btn"},[a("tg-button",{attrs:{type:"primary"},on:{click:e.reload}},[e._v("搜索")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)])],1)])])],1),a("tg-card",e._b({staticClass:"flex-auto mgt-12",on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("div",{staticClass:"mgt-12",class:e.Permission.canEditRole?"mgb-12":"mgb-6"},[e.Permission.canEditRole?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:e.onCreateRoleClick}},[e._v("新增角色")]):e._e()],1),e.Permission.canViewRoleList?a("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂未添加角色"}})]},proxy:!0}],null,!1,1706661302)},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,r){return a("el-table-column",e._b({key:r},"el-table-column",t,!1))})),1):e._e(),e.total>0&&e.Permission.canViewRoleList?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.queryForm.page_num,"page-sizes":[10,20,50,100,200],"page-size":e.queryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.queryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.queryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.onSizeChange}}):e._e()],1),a("RoleFormDialog",{attrs:{visible:e.formDialogVisible,role:e.checkedRole},on:{"dialog:close":e.onDialogClose,"roleform:save:start":function(t){return e.toggleRoleFormSaveLoading(!0)},"roleform:save:end":function(t){return e.toggleRoleFormSaveLoading()}}}),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"正在保存角色，请稍候..."}}),a("tg-mask-loading",{attrs:{visible:e.deleteLoading,content:"正在删除角色，请稍候..."}})],1)},Ne=[],Ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-role-form-dialog tg-dialog-classic tg-dialog-vcenter",attrs:{visible:e.visible,width:"811px","close-on-click-modal":!1},on:{close:e.onDialogClose},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.title))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onDialogClose}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.onSubmitBtnClick}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"tg-role-form-container"},[a("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.formRules,"label-width":"78px"}},[a("el-form-item",{staticClass:"el-form-item-role-name",attrs:{label:"角色名称：",prop:"role_name",size:"medium"}},[a("el-input",{ref:"autoFocuseRef",staticStyle:{width:"360px"},attrs:{placeholder:"请输入角色名称",maxlength:10,"show-word-limit":""},model:{value:e.form.role_name,callback:function(t){e.$set(e.form,"role_name","string"===typeof t?t.trim():t)},expression:"form.role_name"}})],1),a("el-form-item",{staticClass:"el-form-item-role-promiss",attrs:{label:"角色权限：",size:"small",prop:"right_codes","show-message":!1}}),a("div",{staticClass:"right-check-grid"},[a("div",{staticClass:"right-check-grid-tree-container"},[a("div",{staticClass:"right-check-grid-tree"},[e._l(e.rightTree,(function(t){return[a("div",{key:"lv1-"+t.right_code,staticClass:"tree-node lv1",class:[{active:e.isCheckedRight(t.right_code),"is-expanded":e.isExpanded(t.right_code)}],on:{click:function(a){e.setRightChecked(t),e.setExpanded(t.right_code)}}},[a("div",{staticClass:"el-icon-arrow-right lv1",attrs:{name:"ico-arrow-right"}}),a("el-checkbox",{attrs:{indeterminate:e.isRightIndeterminate(t),value:e.isRightCheckedAll(t)},on:{input:function(a){return e.setRightNodeChecked(t)}},nativeOn:{click:function(e){e.stopPropagation()}}}),a("span",[e._v(e._s(t.right_name))])],1),e._l(t.children,(function(r){return[a("div",{directives:[{name:"show",rawName:"v-show",value:e.isExpanded(t.right_code),expression:"isExpanded(right.right_code)"}],key:"lv2-"+r.right_code,staticClass:"tree-node lv2",class:[{active:e.isCheckedRight(r.right_code)}],on:{click:function(t){return e.setRightChecked(r)}}},[a("el-checkbox",{attrs:{indeterminate:e.isRightIndeterminate(r),value:e.isRightCheckedAll(r)},on:{input:function(t){return e.setRightNodeChecked(r)}},nativeOn:{click:function(e){e.stopPropagation()}}}),a("span",[e._v(e._s(r.right_name))]),a("tg-icon",{staticClass:"lv2",attrs:{name:"ico-arrow-right"}})],1)]}))]}))],2)]),a("div",{staticClass:"right-check-grid-line"}),a("div",{staticClass:"right-check-grid-codes"},[a("div",{staticClass:"rights-grid"},e._l(e.checkedRightChildren,(function(t){return a("div",{key:t.right_code,staticClass:"element-right",on:{click:function(a){return e.checkElementRight(t)}}},[a("el-checkbox",{attrs:{value:e.isElementRightChecked(t.right_code)},on:{input:function(a){return e.checkElementRight(t)}}}),a("span",[e._v(e._s(t.right_name))])],1)})),0)])])],1)],1)])},Be=[],Oe=(a(21703),a(26699),a(57680)),We=(0,o.defineComponent)({name:"TgRoleFormDialog",props:{visible:{type:Boolean,required:!0},role:{type:Object}},setup(e,t){const a=(0,o.computed)((()=>void 0!==e.role)),r=(0,o.computed)((()=>a.value?"编辑功能角色":"新增功能角色")),n=(0,o.ref)(void 0),l=()=>{t.emit("dialog:close"),t.root.$nextTick(h)};(0,o.watch)((()=>e.visible),(t=>{if(t)if(void 0!==e.role){const{id:t,role_name:a,right_code_list:r}=e.role;g.value.id=t,g.value.role_name=a,g.value.right_codes=r}else(0,o.nextTick)((()=>{n.value?.focus()}))}));const{setRightChecked:s,findChildren:i,findLeafChildren:c,rights:u,checkedRightNode:d,...m}=(0,Oe.q)();(0,o.onBeforeMount)((()=>{m.getRights()}));const f=(0,o.ref)(void 0),g=(0,o.ref)({id:void 0,role_name:"",right_codes:[]}),h=()=>{g.value.id=void 0,g.value.role_name="",g.value.right_codes=[]},v=(0,o.ref)({role_name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],right_codes:[{validator:(e,a,r)=>{0===a.length&&(r(new Error("请选择角色权限")),t.root.$message.warning("您尚未选择角色权限")),r()},trigger:"blur"},{required:!0,message:"请选择角色权限",trigger:"blur"}]}),_=e=>g.value.right_codes.includes(e),b=e=>{if(_(e.right_code)){if(g.value.right_codes=g.value.right_codes.filter((t=>t!==e.right_code)),void 0!==d.value){const{all_code:e,right_code:t}=d.value,a=(e??[]).filter((e=>g.value.right_codes.includes(e)));1===a.length&&(g.value.right_codes=g.value.right_codes.filter((e=>e!==t)))}}else g.value.right_codes.push(e.right_code,e.superior_code)},y=e=>{const t=e.all_code??[],a=t.every((e=>g.value.right_codes.includes(e)));return t.length>0&&a},k=e=>!y(e)&&(e.all_code??[]).some((e=>g.value.right_codes.includes(e))),C=e=>{const t=e.all_code??[],a=!y(e);return g.value.right_codes=a?(0,p.Tw)([...g.value.right_codes,...t]):g.value.right_codes.filter((e=>!t.includes(e))),e},w=(0,o.ref)(!1),x=async()=>{if(w.value)return;const e=await new Promise((e=>f.value?.validate((t=>{e(t)}))));if(!e)return;const{right_codes:a,...r}=g.value,n=(0,p.Tw)(a),o={...r,right_codes:n};w.value=!0,t.emit("roleform:save:start");const[{data:l}]=await(0,p.Dc)(500,(0,Te.a_)(o));t.emit("roleform:save:end"),w.value=!1,l.success?(t.root.$message.success("角色保存成功"),t.emit("dialog:close",!0),t.root.$nextTick(h)):t.root.$message.error(l.message??"角色保存失败")},j=e=>{s(e)},R=(e,t)=>{g.value.right_codes=t.checkedKeys};return{autoFocuseRef:n,title:r,onDialogClose:l,formRef:f,form:g,formRules:v,...m,rights:u,setRightChecked:s,checkElementRight:b,isElementRightChecked:_,isRightCheckedAll:y,isRightIndeterminate:k,onSubmitBtnClick:x,onTreeNodeClick:j,onTreeNodeCheck:R,setRightNodeChecked:C}}}),He=We,Ie=(0,w.Z)(He,Ve,Be,!1,null,null,null),Me=Ie.exports,Ge=(0,o.defineComponent)({name:"TgSystemUserTabRole",components:{RoleFormDialog:Me},setup(e,t){const a=(0,o.inject)("Permission"),{tableHeightLogic:r,onTopCardRectUpdate:n}=(0,B.Z)(),l=(0,o.ref)({role_type:Pe.Y$.common,role_name:"",page_num:1,num:20}),s=e=>e.role_name,i=(0,o.computed)((()=>[{label:"角色名称",align:"left",headerAlign:"left",property:"role_name",minWidth:(0,V.zY)(u.list,"角色名称",s).value+50,formatter:s},{label:"创建时间",align:"center",minWidth:302,property:"gmt_create"},{label:"操作",align:"left",headerAlign:"left",minWidth:80,formatter:e=>(0,o.h)("div",{class:"operation"},[(0,o.h)("a",{on:{click:()=>k(e)}},["编辑"]),(0,o.h)("a",{on:{click:()=>w(e)}},["删除"])])}])),{loadData:c,...u}=Ee(),d=()=>{l.value.role_name=""},m=async(e=!0)=>{e&&(l.value.page_num=1),await c(l.value)},f=async()=>{d(),m()},g=async e=>{l.value.page_num=e,await m(!1)},h=async e=>{l.value.num=e,await m()};(0,o.onBeforeMount)((()=>{m()}));const v=(0,o.ref)(!1),_=(0,o.ref)(void 0),b=(e=!1)=>{v.value=e},y=()=>{_.value=void 0,b(!0)},k=e=>{_.value=e,b(!0)},C=(0,o.ref)(!1),w=async e=>{if(C.value)return;const a=await(0,oe.I)(t,`是否确认删除角色【${e.role_name}】？`);if(!a)return;C.value=!0;const[{data:r}]=await Promise.all([await(0,Te.Fv)(e.id),await(0,p._v)(500)]);C.value=!1,r.success?(t.root.$message.success("角色删除成功"),await f()):t.root.$message.error(r.message??"角色删除失败")},x=async(e=!1)=>{v.value=!1,e&&await m()},j=(0,o.ref)(!1),R=(e=!1)=>{j.value=e};return{Permission:a,queryForm:l,columns:i,...u,handleCurrentChange:g,onSizeChange:h,onCreateRoleClick:y,reload:m,reset:f,deleteLoading:C,formDialogVisible:v,checkedRole:_,onDialogClose:x,saveLoading:j,toggleRoleFormSaveLoading:R,onDeleteBtnClick:w,onTopCardRectUpdate:n,...r}}}),Ze=Ge,Je=(0,w.Z)(Ze,qe,Ne,!1,null,null,null),Ye=Je.exports,Qe=a(78902),Xe=a(21757);const Ke=new Map([["user","TabUser"],["department","TabDepartment"],["job","TabJob"],["role","TabRole"]]);var et=(0,o.defineComponent)({name:"TgUser",components:{TabUser:I,TabDepartment:ue,TabJob:Ue,TabRole:Ye},props:{tab:{type:String,default:"user"}},setup(e,t){const a=(0,l.YE)([{label:"用户管理",value:"user"},{label:"部门管理",value:"department"},{label:"岗位管理",value:"job"},{label:"功能角色",value:"role"}],e.tab),r=e=>{a.checkedTab.value=e.value;const r=a.tabs[0].value===e.value?{name:s.Ny.user.list}:{name:s.Ny.user.listWithTab,params:{tab:e.value}};t.root.$router.push(r)},n=(0,o.computed)((()=>Ke.get(a.checkedTab.value)??"TabUser")),i=(0,o.computed)((()=>{const e=(0,Xe.kG)(Qe.HN.user_list),t=(0,Xe.kG)(Qe.HN.user_save),a=(0,Xe.kG)(Qe.HN.department_list),r=(0,Xe.kG)(Qe.HN.department_save),n=(0,Xe.kG)(Qe.HN.department_delete),o=(0,Xe.kG)(Qe.HN.job_list),l=(0,Xe.kG)(Qe.HN.job_save),s=(0,Xe.kG)(Qe.HN.job_delete),i=(0,Xe.kG)(Qe.HN.role_list),c=(0,Xe.kG)(Qe.HN.role_save),u=(0,Xe.kG)(Qe.HN.role_delete);return{canEditUser:t,canViewUserList:e,canViewRoleList:i,canEditRole:c,canDeleteRole:u,canViewJobList:o,canEditJob:l,canDeleteJob:s,canViewDepartmentList:a,canEditDepartment:r,canDeleteDepartment:n}}));return(0,o.provide)("Permission",i),{...a,onTabChange:r,tabPane:n,Permission:i}}}),tt=et,at=(0,w.Z)(tt,r,n,!1,null,null,null),rt=at.exports},6549:function(e,t,a){a.d(t,{C:function(){return n},j:function(){return r}});const r="/api/auth/query_user_v2",n="/api/auth/get_user_by_role"},50572:function(e,t,a){a.d(t,{Fv:function(){return p},Eq:function(){return h},cc:function(){return d},Pz:function(){return f},a_:function(){return m},ey:function(){return g}});var r=a(76012),n=a(64236);const o="/api/auth/query_role_v2",l="/api/auth/save_role",s="/api/auth/del_role/:id/",i="/api/auth/query_system_role",c="/api/auth/update_system_role",u="/api/auth/get_job_list",d=async e=>(0,r.dX)(o,{params:{...(0,n.jG)(e)}}),m=async e=>(0,r.SO)(l,{...(0,n.jG)(e)}),p=async e=>(0,r.SO)(s.replace(":id",`${e}`)),f=async()=>(0,r.dX)(i),g=async e=>(0,r.SO)(c,{...(0,n.jG)(e)}),h=async e=>(0,r.dX)(u,{params:{...(0,n.jG)(e)}})},74234:function(e,t,a){a.d(t,{L:function(){return s},y:function(){return l}});var r=a(76012),n=a(6549),o=a(64236);const l=async()=>(0,r.dX)("/api/auth/get_right_tree"),s=e=>(0,r.dX)(n.j,{params:{...(0,o.jG)(e)}})},29625:function(e,t,a){var r,n;a.d(t,{Bs:function(){return p},C_:function(){return s},RB:function(){return f},UN:function(){return u},WD:function(){return r},Wj:function(){return i},Y$:function(){return n},Yh:function(){return l},Zb:function(){return o},i8:function(){return m},kA:function(){return g},x3:function(){return c}}),function(e){e[e["marketing"]=1]="marketing",e[e["taobao"]=2]="taobao",e[e["douyin"]=3]="douyin",e[e["base"]=4]="base",e[e["mcn"]=5]="mcn",e[e["douyinsh"]=7]="douyinsh"}(r||(r={})),function(e){e[e["common"]=1]="common",e[e["system"]=2]="system"}(n||(n={}));const o=new Map([[r.marketing,"营销业务"],[r.douyin,"抖音店播"],[r.taobao,"淘宝店播"],[r.base,"基地业务"],[r.mcn,"S2B2C"],[r.douyinsh,"抖音店播(上海)"]]),l=[{value:r.marketing,label:"整合营销"},{value:r.douyin,label:"抖音店播"},{value:r.taobao,label:"淘宝店播"},{value:r.mcn,label:"S2B2C"},{value:r.douyinsh,label:"抖音店播(上海)"}];var s;(function(e){e[e["creation"]=1]="creation",e[e["tryLive"]=2]="tryLive",e[e["execution"]=3]="execution",e[e["regionExecution"]=4]="regionExecution",e[e["finish"]=5]="finish",e[e["executionEnd"]=6]="executionEnd"})(s||(s={}));const i=new Map([[s.creation,"项目创建"],[s.tryLive,"试播中"],[s.execution,"项目执行中"],[s.regionExecution,"区域执行中"],[s.executionEnd,"执行结束"],[s.finish,"已完结"]]);var c;(function(e){e[e["region"]=2]="region",e[e["selfSupport"]=1]="selfSupport"})(c||(c={}));const u=new Map([[c.region,"区域"],[c.selfSupport,"自营"]]);var d;(function(e){e[e["month"]=1]="month",e[e["quarter"]=2]="quarter",e[e["halfAyear"]=3]="halfAyear"})(d||(d={}));const m=new Map([[d.month,"月结"],[d.quarter,"季结"],[d.halfAyear,"半年"]]),p=new Map([[1,"美妆"],[2,"生活"],[3,"服饰"],[4,"美食"],[5,"母婴"],[6,"数码"],[7,"家装"],[8,"健康"],[9,"宠物"],[10,"时尚"],[11,"配饰"],[12,"家电"],[13,"测评"],[14,"旅行"],[15,"运动"],[16,"摄影"],[17,"情感"],[18,"汽车"],[19,"搞笑"],[20,"教育"],[21,"财经"],[22,"萌娃"],[23,"文化"],[24,"影视"],[25,"娱乐"],[26,"游戏"],[27,"海外"],[28,"才艺"],[29,"三农"],[30,"二次元"],[31,"高颜值"]]);function f(e){return 0===e?"无":p.get(e)??"无"}var g;(function(e){e[e["live"]=1]="live",e[e["marketing"]=2]="marketing",e[e["common_business"]=3]="common_business"})(g||(g={}))},82741:function(e,t,a){a.d(t,{I:function(){return n},u:function(){return o}});var r=a(71340);const n=(e,t)=>{const a="string"===typeof t?{title:t}:t;return new Promise((t=>{e.root.$TDialog({...a,onConfirm:()=>t(!0),onCancel:()=>t(!1)})}))},o=e=>{const t="string"===typeof e?{title:e}:e;return new Promise(((e,a)=>{(0,r.t)({...t,onConfirm:()=>e(!0),onCancel:()=>a()})}))}},58302:function(e,t,a){var r=a(97434),n=a(77944),o=a(52140);const l=e=>{const t=(0,r.computed)((()=>n.Z.getters["global/scrollbarSetting"])),a=(0,r.computed)((()=>void 0!==e.pagename?!0!==t.value.find((t=>t.key===e.pagename))?.value:e.disable??!1)),l=(0,r.computed)((()=>{const t=(e.fixedBlockHeightRefs??[]).map((e=>(0,r.unref)(e))).reduce(((e,t)=>(0,r.unref)(e)+(0,r.unref)(t)),0);return a.value?"max-content":`calc(100vh - ${(0,r.unref)(t)+56+36}px)`})),s=(0,r.computed)((()=>(a.value,"flex-auto"))),i=(0,r.computed)((()=>({height:l.value,overflowInBody:!a.value}))),c=(0,r.ref)(0),u=(0,r.computed)((()=>a.value?{}:{height:Math.max(c.value-(0,r.unref)((0,r.unref)(e.compensation)),e.tableMinHeight??0)})),d=a.value?()=>{}:e=>{c.value!==e&&(c.value=e,(0,o.S)())},m=a.value?()=>{}:t=>{0===c.value?setTimeout((()=>{d(t.height)}),e.delay??1200):d(t.height)};return{cardHeight:l,tableProps:u,onRectUpdate:m,rectHeight:c,cardFlexClass:s,cardProps:i}};t["Z"]=l},57680:function(e,t,a){a.d(t,{q:function(){return i},s:function(){return s}});a(26699);var r=a(37808),n=a(74234),o=a(64236),l=a(97434);const s=e=>{const t=t=>e.root.$store.getters["user/getUserRole"].includes(t);return{hasRight:t,RIGHT_CODE:r.H}},i=()=>{const e=(0,l.ref)([]),t=(0,l.ref)([]),a=(0,l.ref)([]),r=e=>e.map((e=>{const{sub_nodes:t,...a}=e;return t.length>0?[{...a},...r(t)]:[{...a}]})).flat(),s=(e,t=0)=>e.filter((e=>e.superior_code===t)),i=(e,t=0)=>s(e,t).filter((t=>0===s(e,t.right_code).length)),c=(e,t=0)=>s(e,t).filter((t=>s(e,t.right_code).length>0)),u=(e,t=0)=>e.filter((e=>e.superior_code===t)).map((t=>({...t,children:u(e,t.right_code)}))).filter((t=>1===t.level||2===t.level&&s(e,t.right_code).length>0)).map((t=>{const a=s(e,t.right_code),r=3===t.level?[t.right_code]:2===t.level?[t.right_code,...a.map((e=>e.right_code))]:[t.right_code,...a.map((e=>e.right_code)).map((t=>{const a=s(e,t);return[t,...a.map((e=>e.right_code))]})).flat()];return{...t,all_code:(0,o.Tw)(r)}})),d=async()=>{const{data:l}=await(0,n.y)();l.success?(e.value=(0,o.Qc)(l.data),t.value=r((0,o.Qc)(l.data)).sort(((e,t)=>e.level-t.level)),a.value=u((0,o.Qc)(t.value))):(e.value=[],t.value=[],a.value=[])},m=(0,l.ref)([]),p=e=>{m.value.find((t=>t===e))?m.value=m.value.filter((t=>t!==e)):m.value.push(e)},f=e=>void 0!==m.value.find((t=>t===e)),g=(0,l.ref)(void 0),h=(0,l.ref)(void 0),v=(0,l.computed)((()=>h.value?.right_code??"")),_=e=>{h.value={...e}},b=e=>e===v.value,y=(0,l.computed)((()=>""===v.value?[]:i(t.value,v.value)));return{rights:t,getRights:d,rightTree:a,checkedRightNode:h,checkedRightCode:v,setRightChecked:_,treeRef:g,checkedRightChildren:y,isCheckedRight:b,setExpanded:p,isExpanded:f,findChildren:s,findLeafChildren:i,findNonLeafChildren:c}}},23812:function(e,t,a){a.d(t,{GQ:function(){return s},YE:function(){return o},cY:function(){return i},pK:function(){return l}});var r=a(97434),n=a(44928);const o=(e,t)=>({tabs:(0,r.reactive)([...e]),checkedTab:(0,r.ref)(t??(e.length<1?"":e[0].value))}),l=(e,t)=>{const a=(0,r.isRef)(e)?e:(0,r.ref)(e),n=(0,r.isRef)(t)?(0,r.unref)(t):t,o=a.value.length<1?"":a.value[0].value,l=(0,r.ref)(n??o);return{tabs:a,checkedTab:l}},s=(e,t,a)=>{const n=(0,r.reactive)([...t]),o=(0,r.ref)(a??(t.length<1?"":`${t[0].value}`)),l=t=>{e.root.$router.push({path:e.root.$route.path,query:{tab:`${t.value}`}})};return(0,r.onBeforeMount)((()=>{const r=e.root.$route.query.tab;o.value="string"===typeof r?r:a??(t.length<1?"":`${t[0].value}`)})),{tabs:n,checkedTab:o,onTabChange:l}},i=(e,t)=>{const a=(0,r.reactive)([...e]),o=(0,r.ref)(t??(e.length<1?"":`${e[0].value}`)),l=(0,n.t)(),s=e=>{const t=l.currentRoute,a={...t.params,tab:e.value};l.push({name:t.name,params:a})};return o.value=l.currentRoute.params.tab||t||o.value,{tabs:a,checkedTab:o,onTabChange:s}}},44928:function(e,t,a){a.d(t,{t:function(){return n}});var r=a(86834);const n=()=>{const e=new Proxy({},{get(e,t){return Reflect.get(r.Z,t)}});return e}},20809:function(e,t,a){var r=a(97434),n=a(58302);t["Z"]=()=>{const e=32,t=34,a=36,o=31,l=(0,r.ref)(0),s=e=>{l.value=e.height},i=(0,n.Z)({compensation:(0,r.computed)((()=>e+t+a+o)),fixedBlockHeightRefs:[l,25],tableMinHeight:100});return{tableHeightLogic:i,onTopCardRectUpdate:s}}},52140:function(e,t,a){a.d(t,{S:function(){return r},n:function(){return n}});const r=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},n=()=>{const{width:e,height:t}=document.body.getBoundingClientRect();return{width:e,height:t}}},17496:function(e,t,a){a.d(t,{Im:function(){return d},M4:function(){return m},Mi:function(){return o},d:function(){return c},e5:function(){return l},h2:function(){return n},lQ:function(){return u},q6:function(){return s},rw:function(){return r},xN:function(){return i}});const r=e=>{let t="";switch(e){case 1:t="普通发票";break;case 2:t="专用发票";break;case 3:t="电子发票";break;case 4:t="收据";break}return t},n=e=>{let t="";switch(e){case 1:t="待审批";break;case 2:t="审批成功";break;case 3:t="审批失败";break;case 4:t="审批中";break;case 5:t="作废";break}return t},o=e=>{let t="";switch(e){case 1:t="对公银行";break;case 2:t="支付宝";break;case 3:t="V任务";break;case 4:t="淘宝联盟";break;case 5:t="巨量百应";break}return t},l=e=>{let t="";switch(e){case 1:t="不用印章";break;case 2:t="公章";break;case 3:t="合同章";break}return t},s=e=>{const t=[{value:"",label:"全部"},{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},i=e=>{const t=[{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},c=e=>{const t=[{value:"",label:"全部",img:a(4275)},{value:1,label:"正常",img:a(4275)},{value:2,label:"停用",img:a(59463)}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},u=e=>{const t=[{value:1,label:"正常",img:a(4275)},{value:2,label:"停用",img:a(59463)}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},d=e=>{const t=[{value:3,label:"执行结束"},{value:1,label:"正常结束"},{value:2,label:"意外终止"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t},m=e=>{const t=[{value:1,label:"退款"},{value:2,label:"其他"}];if(e){for(const a of t)if(a.value===e)return a;return null}return t}},67910:function(e,t,a){a.d(t,{P6:function(){return i},zY:function(){return s}});var r=a(97434),n=a(61282),o=a(85937),l=a.n(o);const s=(e,t,a,o=20)=>(0,r.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,n.QN)(a(e,!0)))),(0,n.QN)(t)))+o+6)),i=(e,t=!0)=>{let a;return a=""===e||void 0===e?"--":(0,n.SJ)(new(l())(e??0)),t?(0,r.h)("span",[`￥${a}`]):(0,r.h)("span",[`${a}`])}},56045:function(e,t,a){a.d(t,{EG:function(){return n},TP:function(){return o},en:function(){return r}});const r=(e="select-icon")=>{document.querySelector(`.${e}`).className+=" select-icon-rotate"},n=(e="select-icon")=>{document.querySelector(`.${e}`).classList.remove("select-icon-rotate")},o=()=>{document.querySelector(".controlPopoverHide").click()}},4275:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAACY0lEQVRIS72WS2gTURSG/39molB1owgmEcSFr6UFwQpFXLhzIWg3gpKpQlGxmK5FsLjO2BZEgpqu3PhAcaMIPlCwYLVb68ZNphGhGysuTGaO3Mmjk0ySmSQyWWRzzznfvf95zCEi/M7P2gfdCk4CMipgmkRKuYlghRAb4HvNwNN7k+mlsHDsZmBapdOAe1NE9oUFUucklwHtWiGbfNTJvi3wwtyP3ZVy5QGAw1FAbWwWjIRx5u6VHd9bzwJAc7Z0VBz3MUS29QmrupGr1LVThcnkO3+cJqCCwXFeiSAxEKzmTKIMXT/uhzaAnowV59PALwtoyFXD0A/V5W0AM7nixwFyFibIwvzUzhFPafWnqlHEeRjmNcg5qY+p6q0B7a9RSz8MSnIR4BNAzorIgbq9aplCNr2fqqmdinwJCxTlnOSzxFBqLD/BsmmtDIu4n/1+usFhmjn7hkCuRwnYzcYP89J0q3hCXDxvbglO08wVXwtwbBBgKywz83MP3b9vRaojsCEr8IaZnL0MyN4AUDUusORdRkTvdKGosNo0+EbTstdEZHPTTYhyAht35bPbS+aMfQQOXghkS7DF1nOmzjq9zFc4v9sCQf7aMMRkfiL1RxmPW8UREb70Q3t7We194FpnSTXtzvzV1MX67fzQfmDrknYpGg28fX8qfbkZikuJTelxVfpRZAwUTVhbtEL9AcJyFsg5OB2p8dtBe4UpuNf4XpNa4aPND+0H1hhtVWC04U3yg0AWKTgnwNZehkXT8PaSH+fnSQFj/wB70sa5YtTzEesSVYfGuib6Ky+2Rbi13P/nqv8P5s5/9F7zttAAAAAASUVORK5CYII="},59463:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAABoklEQVRIS8WWvS9DYRTGn3OvsojFIkyWspJIGEQMdomPoU3tiP4DREr4B26DXdMOPhK7hIiBRMKqXUzEYlELde8jb79cba9708rrjvd93vPLOe/5EgT4uLcwhII9DWAcwj4AveVrT6A8ArhEyDyRxf07P3Pym4A70VnY2CI44GdInQskCxNrspw+8tI3BDIZ6wedDMHRIKBajUCuIUZEVlIP9Wc1f7gbm4DtHJPsbgZWuSMiLzCNGVlKXbjt/PCwDDslGWoF5oIWYBpTbmgVWAwjnJtWPasLofIUxkglvN9AK3rV7Jv5RUO9qcTTY6XEAqCykTYP/S62ci6mzKnsLQGt6L1X6guMVZhdFuzXOOFsN4IG00hW4ulBUUXNwuetZ930hDtkPvHBg0Q7n3PvDYEBNMVwhtqGhVZ0g+C6F9CIZ6rv7FgRNtIF0ZQbw6YCnhGc1AQ8FyYjWRJhLUBBTgHzJDo1Ad/0AiH5fwip9qTRXha6C197a/uX5l32Ut94KgJ1D+AitLTP6FkxKq1N6xJVhepcE91NXNsiXDs5/nLV/wKlVVvrwv5A5wAAAABJRU5ErkJggg=="}}]);