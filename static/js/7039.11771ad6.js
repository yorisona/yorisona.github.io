"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[7039],{45781:function(t,e,n){var a=n(49187),o=n(8581),r=n(61282);const c=new a.ZP;e["Z"]={formatEmpty(t,e){return null===t||void 0===t||""===t||t instanceof Array&&t.length<=0?"--":void 0!==e?`${t}${e}`:t},formatTime(t){try{return null===t||void 0===t||""===t?"--":t.replace(/-/g,".")}catch(e){return t}},formatTimespan(t){try{if(null===t||void 0===t||""===t)return"--";const e=new Date;return e.setTime(1e3*t),(0,o.WU)(e,"YYYY.mm.dd")}catch(e){return t}},formatPrice(t,e=a.WL.Fen,n=!0){try{if(null===t||void 0===t||""===t)return"--";const a=c.format(c.parse(t,e));return n?`￥${a}`:a}catch(o){return t}},formatPriceFormYuan(t,e=2,n=!0){try{if(null===t||void 0===t||""===t)return"--";let a=t;return a=t>1e8?(t/1e8).toFixed(e)+"亿":t>1e4?(t/1e4).toFixed(e)+"w":(t-0).toFixed(e),n&&(a=`￥${a}`),a}catch(a){return t}},formatPriceToThousand(t,e=2,n=!0,a=!1){try{if(null===t||void 0===t||""===t)return"--";let o=t;return t>1e4?o=(t/1e4).toFixed(e)+"w":(o=(t-0).toFixed(e),a&&(o=(t-0).toFixed(0))),n&&(o=`￥${o}`),o}catch(o){return t}},formatPriceToThousandformatAmount(t,e=2,n=!0,a=!1){try{if(null===t||void 0===t||""===t)return"--";let o=t;return t>1e4?o=(0,r.dN)((t/1e4).toFixed(2),"None")+"w":(o=(0,r.dN)((t-0).toFixed(e),"None",0===e),a&&(o=(t-0).toFixed(0))),n&&(o=`￥${o}`),o}catch(o){return t}},tranNumber(t,e=2){if(null===t||void 0===t||""===t)return"--";if(!(t>=0))return t||"-";t+="";const n=t.toString(),a=n.split(".")[0],o=a.length;if(o<5)return n;if(o>8){const t=a.substring(a.length-8,a.length-8+e);return parseFloat(parseInt(a/1e8+"",10)+"."+t)+"亿"}if(o>4){const t=a.substring(a.length-4,a.length-4+e);return parseFloat(parseInt(a/1e4+"",10)+"."+t)+"w"}}}},40290:function(t,e,n){n.d(e,{k:function(){return o}});var a=n(1763);const o=t=>{const e={jumpProjectDetail:t=>{const n={name:a.FB.project.detail,params:{id:`${t.project_id}`,tab:t.tab??"projectInfo",liveType:t.liveType??"calendar"}},o=t.newWindow??!1;e.jump(n,o)},jumpLiveDisplayDetail:t=>{const n={name:a.FB.display.detail,params:{id:`${t.project_id}`,liveId:`${t.live_id}`,tab:"live",liveType:t.liveType??"calendar"}},o=t.newWindow??!1;e.jump(n,o)},jump:(e,n=!1)=>{if(n){const{href:n}=t.root.$router.resolve(e);window.open(n,"_blank")}else t.root.$router.push(e)}};return{...e}}},7039:function(t,e,n){n.d(e,{mO:function(){return at},dR:function(){return et},sm:function(){return X},IU:function(){return nt},gd:function(){return tt}});n(26699),n(21703);var a=n(83005),o=n(93889),r=n(97434),c=n(65122),i=n(62083),l=n(17099),s=n(17890),d=n(82741),p=n(47997),u=n(86863),m=n(48606),_=n(21757),f=n(29625),h=n(67910),g=n(61282),v=n(40290),y=n(89935),b=n(85937),w=n.n(b),C=n(45781),k=n(36568),j=n.n(k),W=n(98560),A=n(91538),M=n(32039),x=n(22910),D=n(69540),F=n(79058),S=n(63787),R=n(46673),N=n(66626),Z=n(65475),L=n(35750),T=n(44928),P=n(49998),O=n(1763),I=n(78902),$=n(58302),V=n(43773),H=n(7185),K=n(37315),B=n(47143),G=n(89852);const J=t=>{const e=t?.split("+")??[],n=e.filter((t=>{if(t.indexOf("%(主播)")>=0){const e=+t.split("%(")[0];return e>0}return!0})).join("+");return n.replace(/\+$|^\+/g,"")},q=t=>t.split("/").pop(),Y=t=>void 0===t?[]:[...t.contract_detail.attachment_url_list.map((e=>({...e,status:t.contract_info.contract_status,status_str:t.contract_info.contract_status_str,type:"合同附件"}))),...t.contract_annex_info.map((t=>t.attachment_url_list.map((e=>({file_name:q(e),url:e,status:t.contract_annex_status,status_str:t.contract_annex_status_str,type:"补充协议"}))))).flat(),...t.contract_detail.contract_scan_urls.map((e=>({...e,status:t.contract_info.contract_status,status_str:t.contract_info.contract_status_str,type:"合同扫描件"}))),...t.contract_statements_list.map((t=>t.attachment_url_list.map((e=>({file_name:q(e),url:e,status:t.contract_statements_status,status_str:t.contract_statements_status_str,type:"结算单"}))))).flat()];(0,r.defineComponent)({components:{AddAttachmentDialog:S.Z,AddAttachmentDialogSupplier:R.Z,AddSettlementDialog:Z.Z,AddStatement:N.Z,achievement:W.Z,invoicelist:A.Z,dialogContact:M.Z,addContract:x.Z,addSupplierContract:D.Z,AnnexDialog:P.Z,templateDownContractDialog:F.Z,supplierAgreementDialog:K.Z,clientAgreementDialog:B.Z},setup(t,e){const n=(0,r.computed)((()=>{const t=(0,_.kG)(I.HN.marketing_project_contract_view),e=(0,_.kG)(I.HN.marketing_project_documentary_create),n=(0,_.kG)(I.HN.marketing_project_contract_annex_create),a=(0,_.kG)(I.HN.marketing_project_contract_statement_create),o=(0,_.kG)(I.HN.live_project_contract_view),r=(0,_.kG)(I.HN.live_project_contract_create),c=(0,_.kG)(I.HN.live_project_annex_create),i=(0,_.kG)(I.HN.live_project_statements_create),l=(0,_.kG)(I.HN.common_business_project_contract_view),s=(0,_.kG)(I.HN.common_business_project_contract_create),d=(0,_.kG)(I.HN.common_business_project_contract_annex_create),p=(0,_.kG)(I.HN.common_business_project_contract_statement_create);return{canViewList:t,canCreateContract:e,canCreateAnnex:n,canCreateStatement:a,canLiveViewList:o,canLiveCreateContract:r,canLiveCreateAnnex:c,canLiveCreateStatement:i,canCommonViewList:l,canCommonCreateContract:s,canCommonCreateAnnex:d,canCommonCreateStatement:p}})),{isFromMarketing:a,isFromLive:d,isFromCommon:p}=(0,G.L)(e),u=(0,r.computed)((()=>a.value?n.value.canViewList:d.value?n.value.canLiveViewList:n.value.canCommonViewList)),m=(0,r.computed)((()=>a.value?n.value.canCreateContract:d.value?n.value.canLiveCreateContract:n.value.canCommonCreateContract)),f=(0,r.computed)((()=>a.value?n.value.canCreateAnnex:d.value?n.value.canLiveCreateAnnex:n.value.canCommonCreateAnnex)),v=(0,r.computed)((()=>a.value?n.value.canCreateStatement:d.value?n.value.canLiveCreateStatement:n.value.canCommonCreateStatement)),y=(0,r.ref)(!1),b=(0,r.ref)(!1),w=(0,r.ref)(null),C=(0,r.ref)(null),k=(0,r.ref)(null),j=(0,r.ref)(null),W=(0,r.ref)(null),A=(0,r.ref)(null),M=(0,r.ref)(!1),x=(0,r.ref)(null),D=(0,r.ref)(null),F=(0,r.ref)(null),S=(0,_.gI)(),R=(0,r.computed)((()=>a.value?"1":d.value?"2":"3")),N=L.Z.useContract(R.value),Z=(0,T.t)(),P=(0,r.ref)(!1),O=(0,r.ref)(void 0),K=(0,r.computed)((()=>Y(O.value)));(0,r.provide)("annex-data",K),(0,r.provide)("annex-dialog-visible",P),(0,r.provide)("project_add_id",Z.currentRoute.params.id),(0,r.provide)("contract",(0,r.ref)(void 0));const B=(0,r.reactive)((0,i.q)()),q=(0,r.computed)((()=>a.value?{cooperation_id:Z.currentRoute.params.id}:(d.value,{project_id:Z.currentRoute.params.id})));N.query(q.value);const E=32,z=0,U=0,Q=31,X=(0,r.ref)(251),tt=(0,$.Z)({compensation:(0,r.computed)((()=>E+z+U+Q)),fixedBlockHeightRefs:[X],tableMinHeight:100}),et=(t,e)=>{const n=t.contract_info.company_name||t.contract_info.customer_name||"--",{is_folded:a,folded_text:o}=(0,g.zb)(n,12);return e||!a?o:(0,r.h)("el-popover",{props:{placement:"right",trigger:"hover",content:n}},[(0,r.h)("div",{slot:"reference"},[o])])},nt=(0,h.zY)(N.data,"公司名称",et),at=(0,r.computed)((()=>[{label:"合同类别",align:"center",minWidth:94,formatter:t=>1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type?"客户合同":"供应商合同"},{label:"签约类型",minWidth:94,align:"center",formatter:t=>o.kV.get(t?.contract_info?.sign_type)||"--"},{label:"合同编号",minWidth:190,formatter:t=>{const{contract_info:{contract_uid:e}}=t,n=(0,r.h)("div",{},[(0,r.h)("span",{class:"hover-link"},[e])]);return n}},{label:"公司名称",minWidth:nt.value,formatter:t=>et(t,!1)},{label:"费用类型",width:130,align:"center",formatter:t=>t.getMoneytype??(0,l.l)()},{label:"合同金额",align:"left",minWidth:200,formatter:t=>{const e=[];return t.contractMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},[t.contractCommission?"服务费：":"固定服务费："]),(0,r.h)("span",{style:{color:"#19232D"}},[t.contractMoney??"--"])])),t.contractCommission&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},["佣金："]),(0,r.h)("span",{style:{color:"#19232D"}},[J(t.contractCommission)||"--"])])),t.contractOtherMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#19232D"}},[t.contractOtherMoney??"--"])])),e.length>0?e:"--"}},{label:"合作期限",minWidth:166,align:"center",formatter:({contract_info:{coop_start_date:t,coop_end_date:e}})=>{null!==t&&null===e&&(e="长期有效");const n=[t,e],a=n.filter((t=>null!==t)).join("～").replace(/-/g,".")||(0,l.l)();return a}},{label:"关联合同数",minWidth:100,align:"center",formatter:t=>{const e=t.associate_contract_count??(0,l.l)(),n=[];let a;return a=(0,r.h)("p",{class:"hover-link empty-data-line"},[e]),n.push((0,r.h)("div",{class:"line-info",on:{click:e=>{if(t.associate_contracts&&t.associate_contracts.length>0){const e=t.associate_contracts.join("|"),n={contract_uid:e};N.query(n)}e.stopPropagation()}}},[a])),n}},{label:"创建人/日期",minWidth:118,formatter:t=>[(0,r.h)("div",{style:{paddingLeft:"15px"}},[t.contract_info.add_by_name]),(0,r.h)("div",{style:{paddingLeft:"15px",color:"#a4b2c2"}},[t.contract_info.create_time_str?.split(" ")?.[0].replace(/-/g,".")??(0,l.l)()])]},{label:"合同状态",align:"center",minWidth:90,formatter:t=>{const e=t.contract_info.contract_status===s.Kb.Normal?1===t.contract_info.is_recycled?(0,r.h)("div",{style:{marginTop:"2px"}},[(0,r.h)("span",{class:["contract-recycled-tag","contract-recycled-tag-yes"]},["已收回"])]):(0,r.h)("div",{style:{marginTop:"2px"}},[(0,r.h)("span",{class:["contract-recycled-tag","contract-recycled-tag-no"]},["未收回"])]):"",n=s.yR.get(t.contract_info.contract_status)||(0,l.l)(),a=(e=!1)=>(0,r.h)("span",{class:`fg-${s.Kb[t.contract_info.contract_status]}`.toLowerCase(),...e?{slot:"reference"}:{}},[n]);if(![s.Kb.Failure,s.Kb.Processing].includes(t.contract_info.contract_status))return(0,r.h)("div",[a(!1)," ",e]);if(t.contract_info.feishu_request_id||t.contract_info.oa_request_id)return(0,r.h)("div",{on:{click:t=>{t.stopPropagation()}}},[(0,r.h)("el-popover",{props:{placement:"left-end",width:234,trigger:"hover",popperClass:"oa-approve-progress-popper",popperOptions:{boundariesElement:"body",gpuAcceleration:!1}},on:{show:()=>{B.onFlowsShow(t.contract_info.id)},hide:()=>{B.onFlowsHide()}}},[a(!0),(0,r.h)("div",{style:{"min-height":"160px"}},[...B.flowsLoading?[(0,r.h)("div",{style:{padding:"10px 20px"}},["正在查询进度..."])]:""!==B.flowsError?[B.flowsError]:[B.oaflowsRender(t.contract_info.contract_status)]])])]);const o=t.contract_work_infos.length>0&&[s.Kb.Processing,s.Kb.Failure].includes(t.contract_info.contract_status);return(0,r.h)("div",o?[(0,r.h)("el-popover",{props:{placement:"left-end",width:"246",trigger:"hover",popperClass:"approve-progress-popper"}},[a(!0),(0,r.h)(c.Z,{props:{workInfos:t.contract_work_infos,contractInfo:t}})])]:[a()])}},{label:"合同附件",minWidth:88,align:"center",formatter:t=>Y(t).length>0?(0,r.h)("span",{style:{color:"rgb(40, 119, 255)"},on:{click:e=>{e.stopPropagation(),O.value=t,P.value=!0}}},["查看"]):(0,l.l)()}])),ot=(0,V.R)({component:H.Z,title:"新增合同",width:"460px",footer:!1,on:{close:t=>{if(void 0!==t)switch(t){case 1:j.value?.show();break;case 2:k.value?.show();break}}}});return{canViewList:u,canCreateContract:m,canCreateAnnex:f,canCreateStatement:v,isFromMarketing:a,isFromLive:d,isFromCommon:p,dialogContactHook:ot,Permission:n,permission:S,router:Z,addSettlementDialog:D,addAttachmentDialog:F,AddStatementVisible:M,addAttachmentDialogRef:x,checkedRow:O,...N,visibleAchievement:y,visibleInvoiceList:b,addCustomerContractRef:W,addSupplierContractRef:A,addContractRef:w,addTemplateContractRef:C,addsupplierTemplateContractRef:k,addclientTemplateContractRef:j,annexDialogVisible:P,oaFlows:B,...tt,columns:at}},render(){const t=arguments[0],e={style:{width:"100%",marginTop:"12px"}};return t("tg-card",j()([{class:"project-collection flex-auto tg-marketing-contract",attrs:{loading:this.loading}},{directives:[{name:"loading",value:this.loading}]}]),[this.canCreateContract||this.canCreateStatement||this.canCreateAnnex?t("div",{class:"btns-line"},[this.canCreateContract?t("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:()=>{this.addContractRef?.show({title:"新增合同协议",items:[{name:"客户合同",id:1},{name:"供应商合同",id:2}]})}}},["新增合同协议"]):"",this.canCreateStatement&&this.isFromMarketing?t("tg-button",{attrs:{icon:"ico-btn-add"},on:{click:()=>{this.addContractRef?.show({title:"新增结算单",items:[{name:"客户结算单",id:3},{name:"供应商结算单",id:4}]})}}},["新增结算单"]):"",this.canCreateContract?t("tg-button",{on:{click:()=>{this.addTemplateContractRef?.show({title:"新增补充协议",items:[{name:"客户补充协议",id:5},{name:"供应商补充协议",id:6}]})}}},["合同模板下载"]):""]):"",this.canViewList?t("el-table",j()([{attrs:{stripe:!0,border:!0,height:"calc(100% - 70px - 6px)"}},e,{attrs:{data:this.data,"cell-style":{cursor:"pointer"}},on:{"row-click":t=>{if(1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type){const e=this.isFromMarketing?O.Z8.contract.customer.detailTemplate:this.isFromLive?O.FB.contract.customer.detailTemplate:O.u3.contract.customer.detailTemplate,n=this.isFromMarketing?O.Z8.contract.customer.detail:this.isFromLive?O.FB.contract.customer.detail:O.u3.contract.customer.detail;this.router.push({name:t.template_info?e:n,params:{id:`${t.contract_info.id}`},query:{parent_id:this.router?.currentRoute.params.id,parent_tab:this.router?.currentRoute.params.tab}})}else if(3===t.contract_info.contract_type||4===t.contract_info.contract_type||6===t.contract_info.contract_type){const e=this.isFromMarketing?O.Z8.contract.supplier.detailTemplate:this.isFromLive?O.FB.contract.supplier.detailTemplate:O.u3.contract.supplier.detailTemplate,n=this.isFromMarketing?O.Z8.contract.supplier.detail:this.isFromLive?O.FB.contract.supplier.detail:O.u3.contract.supplier.detail;this.router.push({name:t.template_info?e:n,params:{id:`${t.contract_info.id}`},query:{contract_type:t.contract_info.contract_type,parent_id:this.router?.currentRoute.params.id,parent_tab:this.router?.currentRoute.params.tab}})}else{const e=this.isFromMarketing?O.Z8.contract.anchor.detailTemplate:this.isFromLive?O.FB.contract.anchor.detailTemplate:O.u3.contract.anchor.detailTemplate;this.router.push({name:e,params:{id:`${t.contract_info.id}`},query:{contract_type:t.contract_info.contract_type,parent_id:this.router?.currentRoute.params.id,parent_tab:this.router?.currentRoute.params.tab}})}}},scopedSlots:{empty:()=>t("div",{class:"tg-page-empty"},[t("empty-common",{attrs:{"detial-text":"暂未添加合同协议"}})])}}]),[this.columns.map(((e,n)=>t("el-table-column",j()([{},{props:{...e}},{key:n}]))))]):"",t(W.Z,{attrs:{visible:this.visibleAchievement},on:{close:()=>{this.visibleAchievement=!1}}}),t(A.Z,{attrs:{visible:this.visibleInvoiceList},on:{close:()=>{this.visibleInvoiceList=!1},added:()=>{}}}),t(M.Z,{ref:"addContractRef",on:{close:t=>{if(void 0!==t)switch(t.id){case 1:this.addclientTemplateContractRef?.show();break;case 2:this.addsupplierTemplateContractRef?.show();break;case 3:this.AddStatementVisible=!0;break;case 4:this.addSettlementDialog?.show();break;case 5:this.addAttachmentDialogRef?.show();break;case 6:this.addAttachmentDialog?.show();break}}}}),t(x.Z,{ref:"addCustomerContractRef",on:{added:()=>this.reload()}}),t(D.Z,{ref:"addSupplierContractRef",on:{added:()=>this.reload()}}),t("annexDialog",j()([{},{on:{"dialog:close":()=>this.annexDialogVisible=!1}}])),t("addStatement",j()([{attrs:{visible:this.AddStatementVisible}},{on:{"dialog:close":()=>{this.reload(),this.AddStatementVisible=!1}}}])),t("addAttachmentDialog",{ref:"addAttachmentDialogRef",on:{added:()=>this.reload()},attrs:{editData:{}}}),t("addAttachmentDialogSupplier",{ref:"addAttachmentDialog",on:{added:()=>this.reload()}}),t("addSettlementDialog",{ref:"addSettlementDialog",on:{added:()=>this.reload()},attrs:{editData:{}}}),t(F.Z,{attrs:{type:"marketing"},ref:"addTemplateContractRef"}),t(K.Z,{ref:"addsupplierTemplateContractRef",on:{added:()=>this.reload()}}),t(B.Z,{ref:"addclientTemplateContractRef",on:{added:()=>this.reload()}})])}});const{formatEmpty:E}=C.Z,z=t=>t.split("/").pop();var U;(function(t){t[t["customer"]=1]="customer",t[t["supplier"]=2]="supplier"})(U||(U={}));const Q=t=>{if(void 0===t)return[];try{const e=t.contract_detail.attachment_url_list.map((e=>({...e,status:t.contract_info.contract_status,status_str:t.contract_info.contract_status_str,type:"合同附件"}))),n=t.contract_annex_info.map((t=>(t.attachment_url_list||[]).map((e=>({file_name:z(e),url:e,status:t.contract_annex_status,status_str:t.contract_annex_status_str,type:"补充协议"}))))).flat(),a=t.contract_detail.contract_scan_urls.map((e=>({...e,status:t.contract_info.contract_status,status_str:t.contract_info.contract_status_str,type:"合同扫描件"}))),o=t.contract_statements_list.map((t=>t.attachment_url_list.map((e=>({file_name:z(e),url:e,status:t.contract_statements_status,status_str:t.contract_statements_status_str,type:"结算单"}))))).flat();return[...e,...n,...a,...o]}catch(e){return[]}},X=(0,p.sY)(((t,{dialogProject:e})=>{const{jumpProjectDetail:n}=(0,v.k)(t),p=(0,r.ref)(!1),y=(0,r.ref)(0),b=(0,r.ref)([]);let C;const k=async e=>{C=e,b.value=[],p.value=!0;const{data:n}=await(0,a.Hz)(e);p.value=!1,n.success?(b.value=n.data.data.map((t=>{const e=t.template_info;if(e){const n=e.pay_condition;if(n)n.filter((e=>{if("收费类型"===e.key&&(t.getMoneytype=e.value,t.contractMoney="",t.contractCommission="",t.contractOtherMoney="",e.value||(t.getMoneytype="其它")),"纯佣金"===t.getMoneytype){if("佣金"===e.key&&(t.contractCommission=e.value?e.value+"%":"--"),"构美佣金"===e.key&&0!==Number(e.value)){const n=e.value?e.value+"%(构美)":"";t.contractCommission=n}if("主播佣金"===e.key){const n=e.value?e.value+"%(主播)":"";t.contractCommission=t.contractCommission?n+"+"+t.contractCommission:n}}if("服务费+佣金"===t.getMoneytype||"固定服务费+佣金"===t.getMoneytype){if(t.getMoneytype="服务费+佣金","固定服务费"===e.key&&(t.contractMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"构美佣金"===e.key&&0!==Number(e.value)){const n=e.value?e.value+"%(构美)":"";t.contractCommission=n}if("主播佣金"===e.key){const n=e.value?e.value+"%(主播)":"";t.contractCommission=t.contractCommission?n+"+"+t.contractCommission:n}if("佣金"===e.key){const n=e.value?e.value+"%":"";t.contractCommission=n}}"固定服务费"===t.getMoneytype&&"固定服务费"===e.key&&(t.contractMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"其它"===t.getMoneytype&&"其它"===e.key&&(t.contractOtherMoney="--")}));else{const n=t.contract_info;if(7===n.contract_type){const n=e.cooperation_content;n&&n.filter((e=>{if("计算方式"===e.key){const n=[{value:1,label:"小时服务费"},{value:9,label:"保底服务费"},{value:4,label:"小时服务费或提点"},{value:2,label:"保底服务费或提点"},{value:5,label:"小时服务费或阶梯式提点"},{value:6,label:"保底服务费或阶梯式提点"},{value:7,label:"保底服务费A或保底服务费B+提点"},{value:8,label:"小时服务费或保底服务费+提点"}],a=e.value;let o="--";n.map((t=>{String(t.value)===String(a)&&(o=t.label)})),t.getMoneytype=o||"--",t.contractOtherMoney="--"}"保底服务费"===t.getMoneytype&&"保底服务费"===e.key&&(t.contractOtherMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"小时服务费"===t.getMoneytype&&"小时服务费"===e.key&&(t.contractOtherMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value))+"元/小时":"")}))}else t.getMoneytype="--",t.contractOtherMoney=t.contract_detail.contract_amount||0===t.contract_detail.contract_amount?"￥"+(0,g.SJ)(new(w())(t.contract_detail.contract_amount)):"--"}}else t.getMoneytype="--",t.contractOtherMoney=t.contract_detail.contract_amount||0===t.contract_detail.contract_amount?"￥"+(0,g.SJ)(new(w())(t.contract_detail.contract_amount)):"--";return t})),y.value=n.data.total):t.root.$message({type:"warning",message:n.message??"查询合同失败，稍后重试",duration:2e3,showClose:!0})},j=(0,_.gI)(),W=(0,i.q)(),A=t=>1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type?"客户合同":"供应商合同",M=(0,h.zY)(b,"合同类别",A),x=(t,e)=>{const{contract_info:{contract_uid:n}}=t;if(e)return n;const a=(0,r.h)("div",[(0,r.h)("span",[n])]);return a},D=(0,h.zY)(b,"合同编号",x),F=(t,e)=>{const n=t.contract_info.company_name||t.contract_info.customer_name||"--",{is_folded:a,folded_text:o}=(0,g.zb)(n,12);return e||!a?o:(0,r.h)("el-popover",{props:{placement:"top",trigger:"hover",content:n}},[(0,r.h)("span",{slot:"reference"},[o])])},S=(0,h.zY)(b,"公司名称",F),R=(t,e)=>{if(t.project_infos.length<1)return"--";const a=t.project_infos[0].project_name||"--"+t.project_infos[0].project_name||0,{is_folded:o,folded_text:c}=(0,g.zb)(a,12);return e||!o?(0,r.h)("span",{class:["hover-link","empty-data-line"],on:{click:e=>{t.contract_info.business_type===f.WD.marketing?window.open("/marketing/project/"+t.project_infos[0].project_id):[f.WD.douyin,f.WD.taobao].includes(t.contract_info.business_type?t.contract_info.business_type:-1)?n({project_id:t.project_infos[0].project_id,newWindow:!0}):window.open("/commonBusiness/project/"+t.project_infos[0].project_id)}}},[c,(0,r.h)("div",{class:["hover-link","empty-data-line"],on:{click:e=>{t.contract_info.business_type===f.WD.marketing?window.open("/marketing/project/"+t.project_infos[0].project_id):[f.WD.douyin,f.WD.taobao].includes(t.contract_info.business_type?t.contract_info.business_type:-1)?n({project_id:t.project_infos[0].project_id,newWindow:!0}):window.open("/commonBusiness/project/"+t.project_infos[0].project_id)}},slot:"reference"},[t.project_infos[0].project_uid])]):(0,r.h)("el-popover",{props:{placement:"top",trigger:"hover",content:a}},[(0,r.h)("span",{class:["hover-link","empty-data-line"],on:{click:e=>{t.contract_info.business_type===f.WD.marketing?window.open("/marketing/project/"+t.project_infos[0].project_id):[f.WD.douyin,f.WD.taobao].includes(t.contract_info.business_type?t.contract_info.business_type:-1)?n({project_id:t.project_infos[0].project_id,newWindow:!0}):window.open("/commonBusiness/project/"+t.project_infos[0].project_id)}},slot:"reference"},[c,(0,r.h)("div",{class:["hover-link","empty-data-line"],on:{click:e=>{t.contract_info.business_type===f.WD.marketing?window.open("/marketing/project/"+t.project_infos[0].project_id):[f.WD.douyin,f.WD.taobao].includes(t.contract_info.business_type?t.contract_info.business_type:-1)?n({project_id:t.project_infos[0].project_id,newWindow:!0}):window.open("/commonBusiness/project/"+t.project_infos[0].project_id)}}},[t.project_infos[0].project_uid])])])},N=t=>1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type?U.customer:U.supplier,Z=(0,r.computed)((()=>[{label:"合同类别",fixed:"left",align:"center",minWidth:M.value,formatter:A},{label:"签约类型",fixed:"left",align:"center",minWidth:100,formatter:t=>o.kV.get(t?.contract_info?.sign_type)||"--"},{prop:"contract_info",label:"合同编号",fixed:"left",minWidth:D.value,formatter:t=>x(t,!1)},{label:"项目信息",minWidth:184,className:"ProjectInfoColumn",formatter:t=>R(t,!1)},{label:"业务类型",minWidth:100,align:"center",formatter:t=>void 0!==t.contract_info.business_type?f.Zb.get(t.contract_info.business_type)??"--":"--"},{prop:"contract_info",label:"公司名称",minWidth:S.value,formatter:t=>F(t,!1)},{label:"费用类型",width:130,align:"center",formatter:t=>t.getMoneytype??(0,l.l)()},{label:"合同金额",align:"left",minWidth:200,formatter:t=>{const e=[];return t.contractMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},[t.contractCommission?"服务费：":"固定服务费："]),(0,r.h)("span",{style:{color:"#19232D"}},[t.contractMoney??"--"])])),t.contractCommission&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},["佣金："]),(0,r.h)("span",{style:{color:"#19232D"}},[J(t.contractCommission)||"--"])])),t.contractOtherMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#19232D"}},[t.contractOtherMoney??"--"])])),e.length>0?e:"--"}},{label:"应收/应付",minWidth:140,align:"right",formatter:t=>{switch(N(t)){case U.customer:return null===t.settlement_info?.receivable_amount||void 0===t.settlement_info?.receivable_amount?"--":(0,g.dN)(t.settlement_info?.receivable_amount,"None");case U.supplier:return null===t.settlement_info?.payable_amount||void 0===t.settlement_info?.payable_amount?"--":(0,g.dN)(t.settlement_info?.payable_amount,"None");default:return"--"}}},{label:"实收/实付",minWidth:140,align:"right",formatter:t=>{switch(N(t)){case U.customer:return null===t.settlement_info?.receivable_write_off_amount||void 0===t.settlement_info?.receivable_write_off_amount?"--":(0,g.dN)(t.settlement_info?.receivable_write_off_amount,"None");case U.supplier:return null===t.settlement_info?.payable_write_off_amount||void 0===t.settlement_info?.payable_write_off_amount?"--":(0,g.dN)(t.settlement_info?.payable_write_off_amount,"None");default:return"--"}}},{label:"合作期限",width:166,align:"center",formatter:({contract_info:{coop_start_date:t,coop_end_date:e}})=>{null!==t&&null===e&&(e="长期有效");const n=[t,e],a=n.filter((t=>null!==t)).join("～").replace(/-/g,".")||(0,l.l)();return a}},{label:"关联合同数",width:100,align:"center",formatter:t=>{const e=t.associate_contract_count??(0,l.l)(),n=[];let a;return a=(0,r.h)("p",{class:"hover-link empty-data-line"},[e]),n.push((0,r.h)("div",{class:"line-info",on:{click:e=>{if(t.associate_contracts&&t.associate_contracts.length>0){const e=t.associate_contracts.join("|"),n={contract_uid:e};k(n)}e.stopPropagation()}}},[a])),n}},{prop:"contract_info",label:"创建人/时间",showOverflowTooltip:!0,minWidth:114,formatter:t=>[(0,r.h)("div",{style:{paddingLeft:"15px"}},[t.contract_info.add_by_name]),(0,r.h)("div",{style:{color:"#a4b2c2",paddingLeft:"15px"}},[t.contract_info.create_time_str?.split(" ")?.[0].replace(/-/g,".")??(0,l.l)()])]},{prop:"contract_info",label:"审批状态",align:"center",minWidth:90,formatter:t=>{const e=s.yR.get(t.contract_info.contract_status)||(0,l.l)(),n=(n=!1)=>(0,r.h)("span",{class:`fg-${s.Kb[t.contract_info.contract_status]}`.toLowerCase(),...n?{slot:"reference"}:{}},[e]),a=(n=!1)=>(0,r.h)("span",{class:`fg-${s.Kb[t.contract_info.contract_status]}`.toLowerCase(),...n?{slot:"reference"}:{}},[e]);if(![s.Kb.Failure,s.Kb.Processing].includes(t.contract_info.contract_status))return(0,r.h)("div",[n(!1)," "]);if(t.contract_info.feishu_request_id||t.contract_info.oa_request_id)return(0,r.h)("div",{on:{click:t=>{t.stopPropagation()}}},[(0,r.h)("el-popover",{props:{placement:"left-end",width:234,trigger:"hover",popperClass:"oa-approve-progress-popper",openDelay:300,popperOptions:{boundariesElement:"body",gpuAcceleration:!1}},on:{show:()=>{W.onFlowsShow(t.contract_info.id)},hide:()=>{W.onFlowsHide()}}},[a(!0),(0,r.h)("div",[...W.flowsLoading.value?[(0,r.h)("div",{style:{padding:"10px 20px"}},["正在查询进度..."])]:""!==W.flowsError.value?[W.flowsError.value]:[W.oaflowsRender(t.contract_info.contract_status)]])])]);const o=t.contract_work_infos.length>0&&[s.Kb.Processing,s.Kb.Failure].includes(t.contract_info.contract_status);return(0,r.h)("div",o?[(0,r.h)("el-popover",{props:{placement:"left-start",width:"246",trigger:"hover",openDelay:300,popperClass:"approve-progress-popper"}},[n(!0),(0,r.h)(c.Z,{props:{workInfos:t.contract_work_infos,contractInfo:t}})])]:[n()])}},{label:"附件/扫描件",minWidth:100,align:"center",formatter:t=>Q(t).length>0?(0,r.h)("span",{style:{color:"#2877FF"},on:{click:e=>{e.stopPropagation(),T.value=t,L.value=!0}}},["查看"]):(0,l.l)()},{label:"扫描件审批",minWidth:100,fixed:"right",formatter:t=>{const n=j.law_verify_contract_scan;if(!n)return"--";const a=s.yR.get(t.contract_info.contract_status)||(0,l.l)();if("审批成功"!==a)return"--";const c=t.contract_info?.contract_scan_status;let i="--";switch(c){case o.cC.initial:i="未上传";break;case o.cC.waiting:i="驳回";break;case o.cC.passed:i="已完成";break;case o.cC.refused:i="已驳回";break;default:i="--";break}return(0,r.h)("tg-button",{props:{type:"link",disabled:c!==o.cC.waiting},on:{click:n=>{t.contract_info.contract_scan_status===o.cC.waiting&&e.show(t.contract_info.id),n.stopPropagation()}}},i)}},{label:"操作",minWidth:76,fixed:"right",formatter:e=>{const n=j.law_contract_retrieve,a=0!==e.contract_info?.contract_scan_status&&3!==e.contract_info?.contract_scan_status;if(!n)return"";const o=1===e.contract_info.is_recycled||[s.Kb.Failure,s.Kb.Processing,s.Kb.Invalid].includes(e.contract_info.contract_status);return o||!a?"":(0,r.h)("span",{style:{color:"#2877FF"},on:{click:async n=>{n.stopPropagation();let a="";a=e.contract_detail.contract_scan_urls.length?"确认合同已收回?":"该合同尚未上传扫描件，确认合同已收回？";const o=await(0,d.I)(t,a);o&&(0,u._6)({id:e.contract_info.id,is_recycled:1}).then((t=>{const e=t.data;if(!e.success)throw new Error(e.message);return k(C)})).catch((t=>m.Message.error(t.message)))}}},["收回"])}}])),L=(0,r.ref)(!1),T=(0,r.ref)(void 0),P=(0,r.computed)((()=>Q(T.value)));(0,r.provide)("annex-data",P),(0,r.provide)("annex-dialog-visible",L);const O=()=>{L.value=!1,T.value=void 0};return{list:b,loading:p,loadData:k,total:y,columns:Z,onAnnexDialogClose:O,permission:j}})),tt=(0,p.sY)((t=>{const e=(0,r.ref)(!1),n=(0,r.ref)(0),o=(0,r.ref)([]),c=async r=>{o.value=[],e.value=!0;const{data:c}=await(0,a.m7)(r);e.value=!1,c.success?(o.value=c.data.data.map((t=>{const e=t.business_types,n=[],a=[],o=y.tv;return e.filter((t=>{const e=Number(t);o.filter((t=>{const a=Number(t.value);e===a&&n.push(t?.label||"")}));const r=e;a.push(r)})),t.business_types=a,t.busniesstype=n.join("、"),t})),n.value=c.data.total):t.root.$message({type:"warning",message:c.message??"查询合同失败，稍后重试",duration:2e3,showClose:!0})},i=(0,_.gI)(),l=(0,r.ref)(void 0),s=(0,r.computed)((()=>Q(l.value)));return(0,r.provide)("annex-data",s),{list:o,loading:e,loadData:c,total:n,permission:i}})),et=(t,{dialogProject:e})=>{const n=(0,r.ref)(!1),c=(0,r.ref)({}),i=(0,_.gI)(),p=new Map;p.set(0,"未上传"),p.set(1,"待审核"),p.set(2,"通过"),p.set(3,"已驳回");const h=(0,r.reactive)({loading:!1,saleData:[],total:0,tableColumn:[{label:"合同类别",align:"center",headerAlign:"center",formatter:t=>1===t?.contract_info?.contract_type||2===t?.contract_info?.contract_type||5===t?.contract_info?.contract_type?"客户合同":"供应商合同"},{label:"签约类型",align:"center",headerAlign:"center",formatter:t=>o.kV.get(t?.contract_info?.sign_type)||"--"},{label:"项目名称",minWidth:200,align:"left",headerAlign:"center",formatter:t=>E(t.project_infos[0].project_name)},{label:"业务类型",align:"center",headerAlign:"center",formatter:t=>void 0!==t.contract_info.business_type?f.Zb.get(t.contract_info.business_type)??"--":"--"},{label:"创建人",minWidth:90,align:"center",headerAlign:"center",formatter:t=>E(t.contract_info.add_by_name)},{label:"创建时间",minWidth:150,align:"center",headerAlign:"center",formatter:t=>t.contract_info.create_time_str?.split(" ")?.[0].replace(/-/g,".")??(0,l.l)()},{label:"附件/扫描件",align:"center",headerAlign:"center",formatter:t=>Q(t).length>0?(0,r.h)("span",{style:{color:"#2877FF",cursor:"pointer"},on:{click:e=>{e.stopPropagation(),y.value=t,v.value=!0}}},["查看"]):(0,l.l)()},{label:"扫描件审核",align:"center",headerAlign:"center",formatter:t=>{const n=i.law_verify_contract_scan;if(!n)return"--";const a=s.yR.get(t.contract_info.contract_status)||(0,l.l)();return"审批成功"!==a?"--":1===t.contract_info.contract_scan_status?(0,r.h)("div",{style:"color: rgb(40, 119, 255);cursor: pointer;",on:{click:()=>e.show(t.contract_info.id)}},["驳回"]):(0,r.h)("div",{style:"color:#A4B2C2"},[p.get(t.contract_info.contract_scan_status)])}},{label:"操作",minWidth:90,align:"center",headerAlign:"center",formatter:e=>{const n=0!==e.contract_info?.contract_scan_status&&3!==e.contract_info?.contract_scan_status,a=i.law_contract_retrieve;if(!a)return"";const o=1===e.contract_info.is_recycled||[s.Kb.Failure,s.Kb.Processing,s.Kb.Invalid].includes(e.contract_info.contract_status);return o||!n?"":(0,r.h)("div",{style:"color: rgb(40, 119, 255);cursor: pointer;",on:{click:async n=>{n.stopPropagation();let a="确认合同已收回?";a=e.contract_detail.contract_scan_urls.length?"确认合同已收回?":"该合同尚未上传扫描件，确认合同已收回？";const o=await(0,d.I)(t,a);o&&(0,u._6)({id:e.contract_info.id,is_recycled:1}).then((t=>{const e=t.data;if(!e.success)throw new Error(e.message);return g(c.value)})).catch((t=>m.Message.error(t.message)))}}},["收回"])}}]}),g=async e=>{c.value=e,h.loading=!0;try{e?.date&&(e.start_date=e?.date[0]??void 0,e.end_date=e?.date[1]??void 0,delete e.date);const t=await(0,a.It)(e);h.saleData=t.data.data.data||[],h.total=t.data.data.total||0}catch(n){t.root.$message.error("查询失败")}finally{h.loading=!1}},v=(0,r.ref)(!1),y=(0,r.ref)(void 0),b=(0,r.computed)((()=>Q(y.value)));(0,r.provide)("annex-data",b),(0,r.provide)("annex-dialog-visible",v);const w=()=>{v.value=!1,y.value=void 0};return{...(0,r.toRefs)(h),onAnnexDialogClose:w,rejectVisible:n,getData:g}},nt=t=>{const e=(0,r.reactive)({loading:!1,saleData:[],total:0,tableColumn:[{label:"项目编号",minWidth:160,align:"left",headerAlign:"center",formatter:t=>E(t.project_uid)},{label:"项目名称",minWidth:200,align:"left",headerAlign:"center",formatter:t=>E(t.project_name)},{label:"业务类型",minWidth:120,align:"center",headerAlign:"center",formatter:t=>void 0!==t.business_type?f.Zb.get(t.business_type)??"--":"--"},{label:"客户公司名称",minWidth:200,align:"left",headerAlign:"center",formatter:t=>E(t.customer_company_name)},{label:"部门",minWidth:140,align:"center",headerAlign:"center",formatter:t=>E(t.feishu_department_name)},{label:"项目阶段",minWidth:120,align:"center",headerAlign:"center",formatter:t=>E(f.Wj.get(t.business_type))},{label:"客户经理",minWidth:120,align:"center",headerAlign:"center",formatter:t=>E(t.customer_manager)},{label:"项目经理",minWidth:120,align:"center",headerAlign:"center",formatter:t=>E(t.project_manager)},{label:"创建日期",minWidth:140,align:"center",headerAlign:"center",formatter:t=>E(t.gmt_create.replace(/-/g,"."))}]}),n=async n=>{e.loading=!0;try{const t=await(0,a.cV)(n);e.saleData=t.data.data.data||[],e.total=t.data.data.total||0}catch(o){t.root.$message.error("查询失败")}finally{e.loading=!1}};return{...(0,r.toRefs)(e),getData:n}},at=t=>{const e=t=>1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type?"客户合同":"供应商合同",n=(t,e)=>{const{contract_info:{contract_uid:n}}=t;if(e)return n;const a=(0,r.h)("div",[(0,r.h)("span",[n])]);return a},c=(t,e)=>{const n=t.contract_info.company_name||t.contract_info.customer_name||"--",{is_folded:a,folded_text:o}=(0,g.zb)(n,12);return e||!a?o:(0,r.h)("el-popover",{props:{placement:"top",trigger:"hover",content:n}},[(0,r.h)("span",{slot:"reference"},[o])])},i=(0,r.reactive)({loading:!1,saleData:[],total:0,tableColumn:[{label:"合同类别",fixed:"left",align:"center",minWidth:120,formatter:t=>e(t)},{label:"签约类型",minWidth:120,align:"center",headerAlign:"center",property:"type1",formatter:t=>o.kV.get(t?.contract_info?.sign_type)||"--"},{label:"合同编号",align:"left",headerAlign:"center",minWidth:180,formatter:t=>n(t,!1)},{label:"项目名称",minWidth:200,align:"left",headerAlign:"center",formatter:t=>E(t.project_infos[0].project_name)},{label:"业务类型",minWidth:120,align:"center",headerAlign:"center",formatter:t=>void 0!==t.contract_info.business_type?f.Zb.get(t.contract_info.business_type)??"--":"--"},{label:"公司名称",minWidth:200,align:"left",headerAlign:"center",formatter:t=>c(t,!1)},{label:"费用类型",minWidth:140,align:"center",headerAlign:"center",formatter:t=>t.getMoneytype??(0,l.l)()},{label:"合同金额",minWidth:200,align:"left",headerAlign:"center",formatter:t=>{const e=[];return t.contractMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},[t.contractCommission?"服务费：":"固定服务费："]),(0,r.h)("span",{style:{color:"#19232D"}},[t.contractMoney??"--"])])),t.contractCommission&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},["佣金："]),(0,r.h)("span",{style:{color:"#19232D"}},[J(t.contractCommission)||"--"])])),t.contractOtherMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#19232D"}},[t.contractOtherMoney??"--"])])),e.length>0?e:"--"}},{label:"合作期限",minWidth:200,align:"center",formatter:({contract_info:{coop_start_date:t,coop_end_date:e}})=>{null!==t&&null===e&&(e="长期有效");const n=[t,e],a=n.filter((t=>null!==t)).join("～").replace(/-/g,".")||(0,l.l)();return a}},{label:"剩余有效天数",minWidth:100,align:"center",headerAlign:"center",formatter:({contract_info:{coop_end_date:t}})=>{const e=new Date,n=new Date(t).getTime()-e.getTime(),a=Math.ceil(n/864e5);return a>0?a:"--"}},{label:"关联合同数",minWidth:100,align:"center",headerAlign:"center",formatter:t=>{const e=t.associate_contract_count??(0,l.l)(),n=[];let a;return a=(0,r.h)("p",{class:"hover-link empty-data-line"},[e]),n.push((0,r.h)("div",{class:"line-info",on:{click:e=>{if(t.associate_contracts&&t.associate_contracts.length>0){const e=t.associate_contracts.join("|"),n={contract_uid:e};d(n)}e.stopPropagation()}}},[a])),n}},{label:"创建人",minWidth:100,align:"center",headerAlign:"center",property:"contract_info.add_by_name"},{label:"创建时间",minWidth:120,align:"center",headerAlign:"center",formatter:t=>t.contract_info.create_time_str?.split(" ")?.[0].replace(/-/g,".")??(0,l.l)()},{label:"附件/扫描件",minWidth:100,align:"center",headerAlign:"center",formatter:t=>Q(t).length>0?(0,r.h)("span",{style:{color:"#2877FF",cursor:"pointer"},on:{click:e=>{e.stopPropagation(),u.value=t,p.value=!0}}},["查看"]):(0,l.l)()}],AbnormalTableColumn:[{label:"合同类别",fixed:"left",align:"center",minWidth:100,formatter:t=>e(t)},{label:"签约类型",minWidth:100,align:"center",headerAlign:"center",property:"type1",formatter:t=>o.kV.get(t?.contract_info?.sign_type)||"--"},{label:"合同编号",align:"center",headerAlign:"center",minWidth:200,formatter:t=>n(t,!1)},{label:"项目名称",minWidth:100,align:"center",headerAlign:"center",formatter:t=>E(t.project_infos[0].project_name)},{label:"业务类型",minWidth:100,align:"center",headerAlign:"center",formatter:t=>void 0!==t.contract_info.business_type?f.Zb.get(t.contract_info.business_type)??"--":"--"},{label:"公司名称",minWidth:180,align:"center",headerAlign:"center",formatter:t=>c(t,!1)},{label:"费用类型",minWidth:140,align:"center",headerAlign:"center",formatter:t=>t.getMoneytype??(0,l.l)()},{label:"合同金额",minWidth:200,align:"left",headerAlign:"center",formatter:t=>{const e=[];return t.contractMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},[t.contractCommission?"服务费：":"固定服务费："]),(0,r.h)("span",{style:{color:"#19232D"}},[t.contractMoney??"--"])])),t.contractCommission&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#a4b2c2"}},["佣金："]),(0,r.h)("span",{style:{color:"#19232D"}},[J(t.contractCommission)||"--"])])),t.contractOtherMoney&&e.push((0,r.h)("div",[(0,r.h)("span",{style:{color:"#19232D"}},[t.contractOtherMoney??"--"])])),e.length>0?e:"--"}},{label:"合作期限",minWidth:180,align:"center",formatter:({contract_info:{coop_start_date:t,coop_end_date:e}})=>{null!==t&&null===e&&(e="长期有效");const n=[t,e],a=n.filter((t=>null!==t)).join("～").replace(/-/g,".")||(0,l.l)();return a}},{label:"关联合同数",minWidth:110,align:"center",headerAlign:"center",formatter:t=>{const e=t.associate_contract_count??(0,l.l)(),n=[];let a;return a=(0,r.h)("p",{class:"hover-link empty-data-line"},[e]),n.push((0,r.h)("div",{class:"line-info",on:{click:e=>{if(t.associate_contracts&&t.associate_contracts.length>0){const e=t.associate_contracts.join("|"),n={contract_uid:e};d(n)}e.stopPropagation()}}},[a])),n}},{label:"创建人",minWidth:80,align:"center",headerAlign:"center",property:"contract_info.add_by_name"},{label:"创建时间",minWidth:100,align:"center",headerAlign:"center",formatter:t=>t.contract_info.create_time_str?.split(" ")?.[0].replace(/-/g,".")??(0,l.l)()},{label:"附件/扫描件",minWidth:100,align:"center",headerAlign:"center",formatter:t=>Q(t).length>0?(0,r.h)("span",{style:{color:"#2877FF",cursor:"pointer"},on:{click:e=>{e.stopPropagation(),u.value=t,p.value=!0}}},["查看"]):(0,l.l)()}]}),s=(0,r.ref)({}),d=async e=>{s.value=e,i.loading=!0;try{const t=await(0,a.It)(e);i.saleData=t.data.data.data.map((t=>{const e=t.template_info;if(e){const n=e.pay_condition;if(n)n.filter((e=>{if("收费类型"===e.key&&(t.getMoneytype=e.value,t.contractMoney="",t.contractCommission="",t.contractOtherMoney="",e.value||(t.getMoneytype="其它")),"纯佣金"===t.getMoneytype){if("佣金"===e.key&&(t.contractCommission=e.value?e.value+"%":"--"),"构美佣金"===e.key&&0!==Number(e.value)){const n=e.value?e.value+"%(构美)":"";t.contractCommission=n}if("主播佣金"===e.key){const n=e.value?e.value+"%(主播)":"";t.contractCommission=t.contractCommission?n+"+"+t.contractCommission:n}}if("服务费+佣金"===t.getMoneytype||"固定服务费+佣金"===t.getMoneytype){if(t.getMoneytype="服务费+佣金","固定服务费"===e.key&&(t.contractMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"构美佣金"===e.key&&0!==Number(e.value)){const n=e.value?e.value+"%(构美)":"";t.contractCommission=n}if("主播佣金"===e.key){const n=e.value?e.value+"%(主播)":"";t.contractCommission=t.contractCommission?n+"+"+t.contractCommission:n}if("佣金"===e.key){const n=e.value?e.value+"%":"";t.contractCommission=n}}"固定服务费"===t.getMoneytype&&"固定服务费"===e.key&&(t.contractMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"其它"===t.getMoneytype&&"其它"===e.key&&(t.contractOtherMoney="--")}));else{const n=t.contract_info;if(7===n.contract_type){const n=e.cooperation_content;n&&n.filter((e=>{if("计算方式"===e.key){const n=[{value:1,label:"小时服务费"},{value:9,label:"保底服务费"},{value:4,label:"小时服务费或提点"},{value:2,label:"保底服务费或提点"},{value:5,label:"小时服务费或阶梯式提点"},{value:6,label:"保底服务费或阶梯式提点"},{value:7,label:"保底服务费A或保底服务费B+提点"},{value:8,label:"小时服务费或保底服务费+提点"}],a=e.value;let o="--";n.map((t=>{String(t.value)===String(a)&&(o=t.label)})),t.getMoneytype=o||"--",t.contractOtherMoney="--"}"保底服务费"===t.getMoneytype&&"保底服务费"===e.key&&(t.contractOtherMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value)):""),"小时服务费"===t.getMoneytype&&"小时服务费"===e.key&&(t.contractOtherMoney=e.value||0===Number(e.value)?"￥"+(0,g.SJ)(new(w())(e.value))+"元/小时":"")}))}else t.getMoneytype="--",t.contractOtherMoney=t.contract_detail.contract_amount||0===t.contract_detail.contract_amount?"￥"+(0,g.SJ)(new(w())(t.contract_detail.contract_amount)):"--"}}else t.getMoneytype="--",t.contractOtherMoney=t.contract_detail.contract_amount||0===t.contract_detail.contract_amount?"￥"+(0,g.SJ)(new(w())(t.contract_detail.contract_amount)):"--";return t})),i.total=t.data.data.total||0}catch(n){t.root.$message.error("查询失败")}finally{i.loading=!1}},p=(0,r.ref)(!1),u=(0,r.ref)(void 0),m=(0,r.computed)((()=>Q(u.value)));(0,r.provide)("annex-data",m),(0,r.provide)("annex-dialog-visible",p);const _=()=>{p.value=!1,u.value=void 0};return{...(0,r.toRefs)(i),onAnnexDialogClose:_,getData:d}}}}]);