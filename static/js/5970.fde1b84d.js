"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[5970],{8284:function(e,t,i){i.d(t,{Z:function(){return h}});var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"tg-live-display-dialog-add-page tg-dialog-vcenter"},[i("el-drawer",{staticClass:"tg-dialog-classic",attrs:{title:e.title,visible:e.visible,wrapperClosable:!1},on:{close:e.handleCloseAction}},[i("div",{staticClass:"ta-live-display-content"},[i("el-form",{ref:"formRef",attrs:{"label-position":"top",model:e.form,rules:e.formRules,size:"small","label-width":"106px"}},[i("head-lines",{staticStyle:{margin:"0px 0px 12px -10px"},attrs:{title:"场次信息"}}),i("el-form-item",{staticClass:"one-item",attrs:{label:"场次标题：",prop:"live_title"}},[i("el-input",{attrs:{placeholder:"请输入场次标题",maxlength:"20",clearable:""},model:{value:e.form.live_title,callback:function(t){e.$set(e.form,"live_title","string"===typeof t?t.trim():t)},expression:"form.live_title"}})],1),i("el-form-item",{staticClass:"one-item",attrs:{label:"场次类型：",prop:"live_type"}},[i("el-select",{attrs:{placeholder:"请选择场次类型",maxlength:"20"},model:{value:e.form.live_type,callback:function(t){e.$set(e.form,"live_type","string"===typeof t?t.trim():t)},expression:"form.live_type"}},[i("el-option",{attrs:{label:"直播",value:60}}),i("el-option",{attrs:{label:"短视频",value:61}}),i("el-option",{attrs:{label:"图文",value:62}})],1)],1),i("div",{staticClass:"four-item"},[i("el-form-item",{staticClass:"date-picker-item",staticStyle:{width:"118px"},attrs:{label:"场次开始时间：",prop:"live_start_time"}},[i("el-date-picker",{staticStyle:{width:"472px"},attrs:{clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","popper-class":"mcn-live-time-popover-display-add"},on:{change:e.onLiveTimeChange},model:{value:e.form.startTimeAndEndTime,callback:function(t){e.$set(e.form,"startTimeAndEndTime",t)},expression:"form.startTimeAndEndTime"}})],1)],1),60===e.form.live_type?i("el-form-item",{staticClass:"one-item",attrs:{label:"预计GMV：",prop:"expect_gmv"}},[i("el-input",{attrs:{placeholder:"请输入预计GMV",maxlength:"11",clearable:""},on:{input:e.limitGMV},model:{value:e.form.expect_gmv,callback:function(t){e.$set(e.form,"expect_gmv","string"===typeof t?t.trim():t)},expression:"form.expect_gmv"}})],1):e._e()],1),i("div",{staticClass:"live-display-add-footer"},[i("tg-button",{attrs:{size:"small"},on:{click:e.handleCloseAction}},[e._v("取消")]),i("tg-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSaveAction}},[e._v("保存")])],1)],1)]),i("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},s=[],l=(i(26699),i(97434)),o=i(3293),_=i(64236),r=i(8581),n=i(41651),d=i(47583);const m=()=>{const e=(0,l.ref)({kolSchedules:[],operatorSchedules:[]}),t=(0,l.ref)(!1),i=async t=>{const[{data:i}]=await(0,_.Dc)(300,(0,o.D2)(t));i.success?(e.value.kolSchedules=i.data.kol_schedule_list,e.value.operatorSchedules=i.data.operator_schedule_list):(e.value.kolSchedules=[],e.value.operatorSchedules=[])};return{loading:t,loadScheduleData:i,ScheduleData:e}};var c=i(88721),u=(0,l.defineComponent)({props:{visible:{type:Boolean,default:!1},title:{type:String,default:"新增场次"},start_date_disabled:{type:Boolean,default:!1},defaultDisplay:{type:Object},project_id:{type:Number,default:-1}},setup(e,t){const i="--",a=(0,l.ref)(void 0),s=(0,l.ref)(!1),u=(0,l.ref)(!1),p=(0,l.ref)(void 0),v=(0,l.ref)({id:void 0,start_date:"",start_time:"",end_date:"",end_time:"",live_title:"",project_id:"",studio_id:void 0,studio_name:"",remark:"",live_type:"",live_end_time:"",live_start_time:"",expect_gmv:"",startTimeAndEndTime:[]}),f=(0,l.ref)(i),h=(0,l.ref)(void 0),g=(0,l.ref)([]),y=(0,l.ref)([]),k=(0,l.ref)({project_id:{required:!0,message:"请输入项目编号",trigger:["change","blur"]},live_start_time:{required:!0,message:"请选择直播时间",trigger:"change"},start_time:{required:!0,message:"请选择开始时间",trigger:"change"},studio_id:{required:!0,message:"请选择直播间",trigger:["change","blur"]},live_title:{required:!0,message:"请输入直播标题",trigger:"blur"},expect_gmv:{required:!0,message:"请填写预期GMV",trigger:"blur"},live_type:{required:!0,message:"请选择场次类型",trigger:"change"}});async function b(e){if(""===e)return void(y.value=[]);u.value=!0;const{data:t}=await(0,o.aE)({project_uid:e});u.value=!1,t.success&&(y.value=t.data)}const w=()=>{t.emit("closeAction")},T=(0,l.reactive)({check_kol_schedule_infos:[],anchorKolList:[],oprateList:[],operate_schedule_infos:[{start_time:"",start_time_data:"",start_time_temp:"",end_time:"",limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}],kol_schedule_infos:[{start_time:"",start_time_data:"",start_time_temp:"",end_time:"",limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}]}),D=async()=>{const{id:e,live_title:i,live_end_time:a,live_start_time:l,live_type:r,expect_gmv:n}=v.value,d=v.value.project_id;if(""===d)return;if(!a||!l)return;const m={id:e?.toString()??"",project_id:d.toString(),live_title:i,live_start_time:l,live_end_time:a,live_type:r,expect_gmv:n};m.expect_gmv&&(m.expect_gmv=100*m.expect_gmv),s.value=!0;const[{data:c}]=await(0,_.Dc)(300,(0,o.MD)(m));s.value=!1,c.success?(t.emit("succeed"),t.root.$message.success(c.message)):t.root.$message.error(c.message??"保存失败")},j=async()=>{const e=await new Promise((e=>p.value?.validate((t=>e(t)))));e&&await D()},x=()=>{v.value.project_id||(y.value=[])},S=e=>{const t=g.value.filter((t=>e===t.studio_name));t.length?v.value.studio_id=t[0].id:v.value.studio_id=void 0},Y=()=>{setTimeout((()=>{v.value={start_date:"",start_time:"",end_date:"",end_time:"",live_end_time:"",startTimeAndEndTime:[],live_start_time:"",live_title:"",project_id:"",studio_id:void 0,studio_name:"",remark:"",live_type:"",expect_gmv:""},f.value=i,g.value=[],s.value=!1,T.kol_schedule_infos=[{start_time:"",start_time_data:"",start_time_temp:"",end_time:"",limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}],T.operate_schedule_infos=[{start_time:"",start_time_data:"",start_time_temp:"",end_time:"",limitDate:{disabledDate(e){return e.getTime()<Date.now()}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]}]}),200),setTimeout((()=>{p.value?.clearValidate()}),210)},{loadScheduleData:$,ScheduleData:C,...H}=m();(0,l.watch)([()=>e.visible,()=>e.defaultDisplay],(async([t,i])=>{if(t)if(i){const e=i;G(e)}else v.value.project_id=e.project_id;else Y()}));const G=t=>{v.value.id=t.id,t.live_start_time&&t.live_end_time&&(v.value.live_start_time=t.live_start_time,v.value.live_end_time=t.live_end_time,v.value.startTimeAndEndTime=[t.live_start_time,t.live_end_time]),v.value.live_title=t.live_title??"",v.value.remark=t.remark??"",f.value=t.brand_name??"--",h.value=t.business_type??void 0,v.value.live_type=t.live_type,v.value.expect_gmv="",t.expect_gmv&&(v.value.expect_gmv=(t.expect_gmv/100).toString()),t.project_id?v.value.project_id=t.project_id:v.value.project_id=e.project_id??-1},L=(0,l.computed)((()=>{const e=v.value.start_date+" "+v.value.start_time,t=v.value.end_date+" "+v.value.end_time,[i,a]=[e,t].map((e=>e.split(" ")[0]));return i===a})),q=(0,l.ref)([]),A=async()=>{const{data:e}=await(0,o.Sx)({});e.success?(q.value=e.data,T.anchorKolList=e.data.filter((e=>e.kol_id<0))):T.anchorKolList=[];const t=await(0,d.uZ)({roles:"1001",business_type:h.value});t.data.success?T.oprateList=t.data.data:T.oprateList=[]},E=()=>{const e=[{duration:0,start_time:"",end_time:"",name:"",id:0}],t=(0,_.Tw)(e.map((e=>[e.start_time,e.end_time])).flat()).map((e=>new Date(e).getTime())).sort();t.shift(),t.forEach(((e,i)=>{i<t.length-1&&(F(),T.kol_schedule_infos[i+1].start_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii"),T.kol_schedule_infos[i+1].start_time_data=(0,r.WU)(e,"YYYY-mm-dd"),T.kol_schedule_infos[i+1].start_time_temp=(0,r.WU)(e,"HH:ii")),T.kol_schedule_infos[i].end_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii")})),T.kol_schedule_infos.forEach((t=>{const i=e.filter((e=>e.start_time===t.start_time)).map((e=>e.id));t.kol_ids=q.value.filter((e=>i.includes(e.kol_id))).map((e=>e.kol_id)),0===t.kol_ids.length&&(t.kol_ids=[]),t.kol_ids_verify=new Array(t.kol_ids.length).fill(0).map((e=>({info:{},show:!1})))})),T.kol_schedule_infos[T.kol_schedule_infos.length-1].end_time="",v.value.end_date,v.value.end_time},U=()=>{const e=[{duration:0,start_time:"",end_time:"",name:"",id:-1}],t=(0,_.Tw)(e.map((e=>[e.start_time,e.end_time])).flat()).map((e=>new Date(e).getTime())).sort();t.shift(),t.forEach(((e,i)=>{i<t.length-1&&(I(),T.operate_schedule_infos[i+1].start_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii"),T.operate_schedule_infos[i+1].start_time_data=(0,r.WU)(e,"YYYY-mm-dd"),T.operate_schedule_infos[i+1].start_time_temp=(0,r.WU)(e,"HH:ii")),T.operate_schedule_infos[i].end_time=(0,r.WU)(e,"YYYY-mm-dd HH:ii")})),T.operate_schedule_infos.forEach((t=>{const i=e.filter((e=>e.start_time===t.start_time)).map((e=>e.id));t.kol_ids=T.oprateList.filter((e=>i.includes(e.id))).map((e=>e.id)),0===t.kol_ids.length&&(t.kol_ids=[]),t.kol_ids_verify=new Array(t.kol_ids.length).fill(0).map((e=>({info:{},show:!1})))})),T.operate_schedule_infos[T.operate_schedule_infos.length-1].end_time=v.value.end_date+" "+v.value.end_time},M=async()=>{await A(),E(),U()};M(),(0,l.watch)((()=>[v.value.start_date,v.value.start_time,v.value.end_date,v.value.end_time]),(e=>{e&&(T.kol_schedule_infos[0].start_time=v.value.start_date+" "+v.value.start_time,T.kol_schedule_infos[0].start_time_data=v.value.start_date,T.kol_schedule_infos[0].start_time_temp=v.value.start_time,T.kol_schedule_infos[0].end_time=v.value.end_date+" "+v.value.end_time,T.operate_schedule_infos[0].start_time=v.value.start_date+" "+v.value.start_time,T.operate_schedule_infos[0].start_time_data=v.value.start_date,T.operate_schedule_infos[0].start_time_temp=v.value.start_time,T.operate_schedule_infos[0].end_time=v.value.end_date+" "+v.value.end_time)}));const O=()=>{T.kol_schedule_infos.forEach((e=>{e.start_time===e.end_time&&t.root.$message.error(`${e.start_time} ~ ${e.end_time} 排班时长为零，请重新选择`)}))},X=()=>{T.operate_schedule_infos.forEach((e=>{e.start_time===e.end_time&&t.root.$message.error(`${e.start_time} ~ ${e.end_time} 排班时长为零，请重新选择`)}))},W=e=>{T.kol_schedule_infos[e].start_time_temp="",O()},R=e=>{T.operate_schedule_infos[e].start_time_temp="",X()},K=(e,t)=>{T.kol_schedule_infos[t].start_time_data&&(T.kol_schedule_infos[t].start_time=T.kol_schedule_infos[t].start_time_data+" "+T.kol_schedule_infos[t].start_time_temp,T.kol_schedule_infos[t].start_time=e),void 0!==T.kol_schedule_infos[t-1]&&(T.kol_schedule_infos[t-1].end_time=T.kol_schedule_infos[t].start_time_data+" "+T.kol_schedule_infos[t].start_time),(t===T.kol_schedule_infos.length-1||T.kol_schedule_infos[t+1].start_time)&&(T.kol_schedule_infos[t].end_time=v.value.end_date+" "+v.value.end_time),O()},V=(e,t)=>{T.operate_schedule_infos[t].start_time_data&&(T.operate_schedule_infos[t].start_time=T.operate_schedule_infos[t].start_time_data+" "+T.operate_schedule_infos[t].start_time_temp,T.operate_schedule_infos[t].start_time=e),void 0!==T.operate_schedule_infos[t-1]&&(T.operate_schedule_infos[t-1].end_time=T.operate_schedule_infos[t].start_time_data+" "+T.operate_schedule_infos[t].start_time),(t===T.operate_schedule_infos.length-1||T.operate_schedule_infos[t+1].start_time)&&(T.operate_schedule_infos[t].end_time=v.value.end_date+" "+v.value.end_time),O()},F=()=>{const e=v.value.end_date+" "+v.value.end_time,i=T.kol_schedule_infos[T.kol_schedule_infos.length-1];if(!i.start_time)return void t.root.$message.warning("请先选择时间");const a=L.value?e.split(" ")[0]:"";T.kol_schedule_infos.push({start_time:"",start_time_data:a,start_time_temp:"",end_time:"待设置",limitDate:{disabledDate(t){const a=(0,r.WU)(new Date(e),"HH:ii"),s="00:00"===a;return t.getTime()<new Date(i.start_time_data).getTime()-n.MU||(s?t.getTime()>new Date(e).getTime()-1e3:t.getTime()>new Date(e).getTime())}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]})},I=()=>{const e=v.value.end_date+" "+v.value.end_time,i=T.operate_schedule_infos[T.operate_schedule_infos.length-1];if(!i.start_time)return void t.root.$message.warning("请先选择时间");const a=L.value?e.split(" ")[0]:"";T.operate_schedule_infos.push({start_time:"",start_time_data:a,start_time_temp:"",end_time:"待设置",limitDate:{disabledDate(t){const a=(0,r.WU)(new Date(e),"HH:ii"),s="00:00"===a;return t.getTime()<new Date(i.start_time_data).getTime()-n.MU||(s?t.getTime()>new Date(e).getTime()-1e3:t.getTime()>new Date(e).getTime())}},kol_ids:[],kol_ids_verify:[{show:!1,info:{}}]})},P=e=>{T.kol_schedule_infos.splice(e,1)},Z=e=>{T.operate_schedule_infos.splice(e,1)},z=(e,t)=>{T.kol_schedule_infos[t].kol_ids=e},B=(e,t)=>{T.operate_schedule_infos[t].kol_ids=e},N=e=>{const t=c.Z.IntergerAndDecimals(e);return v.value.expect_gmv=t,t},J=async e=>{null===e?(v.value.live_start_time="",v.value.live_end_time=""):(v.value.live_start_time=e[0],v.value.live_end_time=e[1])},Q={disabledDate(t){return!e.defaultDisplay?.id&&t.getTime()<Date.now()-864e5}};return{limitGMV:N,pickerOptions:Q,onSelectKolUserChanged:z,onLiveTimeChange:J,onSelectOperateUserChanged:B,changeKolTime:K,changeKolDate:W,changeOperateTime:V,changeOperateDate:R,deleteKolTime:P,deleteOperateTime:Z,addKolTimeLine:F,addOperateTimeLine:I,...(0,l.toRefs)(T),autoFocuseRef:a,formRef:p,form:v,formRules:k,studioList:g,projectList:y,brand_name:f,sendGetProjectIDListRequest:b,handleCloseAction:w,handleSaveAction:j,studioChanged:S,saveLoading:s,projectListLoading:u,handleProjectUidFocus:x}}}),p=u,v=i(1001),f=(0,v.Z)(p,a,s,!1,null,null,null),h=f.exports},83626:function(e,t,i){i.d(t,{TR:function(){return G},Cv:function(){return C},eF:function(){return Y},R5:function(){return U},Fb:function(){return q},Ll:function(){return L},$q:function(){return w},fX:function(){return b},cm:function(){return $},LE:function(){return S},ME:function(){return j},Iq:function(){return E},gY:function(){return M},ij:function(){return T},yT:function(){return x},x$:function(){return O},AT:function(){return H},Il:function(){return X},Lt:function(){return W},i1:function(){return D},nY:function(){return R},YP:function(){return A}});const a="/api/shop_live/query_common_project",s="/api/shop_live/get_common_project/:id/",l="/api/shop_live/save_common_project",o="/api/payable/query_common_payables",_="/api/common_business/save_cost",r="/api/common_business/query_cost",n="/api/common_business/del_cost",d="/api/shop_live/query_mcn_shop_live",m="/api/shop_live/merchant_goods/",c="/api/shop_live/merchant_goods_v2",u="/api/shop_live/update_shop_live_common_project_team_members",p="/api/shop_live/get_live_goods",v="/api/shop_live/get_shop_live_common_project_profit_stat_data",f="/api/common_business/query_s2b2c_douyin_daily_report",h="/api/common_business/query_s2b2c_douyin_live_report",g="/api/shop_live/save_project_douyin_goal_info";var y=i(64236),k=i(76012);const b=async e=>(0,k.dX)(a,{params:{...(0,y.jG)(e)}}),w=async e=>(0,k.dX)(s.replace(":id",e)),T=async e=>(0,k.dX)("/api/receivable/query_common_receivables",{params:{...(0,y.jG)(e)}}),D=async e=>(0,k.SO)(l,{...(0,y.jG)(e)}),j=(e,t,i,a)=>(0,k.dX)("/api/common_business/query_daily_report",{params:{begin_time:e,end_time:t,project_id:i,business_type:a}}),x=e=>(0,k.SO)("/api/common_business/save_daily_report",(0,y.jG)(e)),S=async e=>(0,k.dX)(o,{params:e}),Y=e=>(0,k.SO)(_,(0,y.jG)(e)),$=async e=>(0,k.dX)(r,{params:{project_id:e}}),C=e=>(0,k.SO)(n,{cost_id:e}),H=async e=>(0,k.dX)(d,{params:{...(0,y.jG)(e??"")}}),G=e=>(0,k.SO)(m,(0,y.jG)(e)),L=(e,t)=>(0,k.qb)(`/api/shop_live/merchant_goods/${t}/`,(0,y.jG)(e)),q=e=>(0,k.HG)(`/api/shop_live/merchant_goods/${e}/`),A=async(e,t)=>(0,k.qb)(`${u}/${e}/`,{...t}),E=async e=>(0,k.dX)(p,{params:{...(0,y.jG)(e??"")}}),U=e=>(0,k.HG)(`/api/shop_live/delete_live_goods/${e}/`),M=async e=>(0,k.dX)(c,{params:{...(0,y.jG)(e??"")}}),O=async e=>(0,k.dX)(`${v}/${e}/`),X=async e=>(0,k.dX)(f,{params:{...(0,y.jG)(e)}}),W=async e=>(0,k.dX)(h,{params:{...(0,y.jG)(e)}}),R=e=>(0,k.SO)(g,(0,y.jG)(e))}}]);