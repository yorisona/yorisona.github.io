"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[553],{90553:function(e,t,a){a.d(t,{Z:function(){return y}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-common-business-project-form-dialog tg-dialog-vcenter"},[a("el-drawer",{staticClass:"tg-dialog-classic",attrs:{title:e.title,"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.visible,wrapperClosable:!1},on:{close:e.onCloseBtnClick}},[a("div",{staticClass:"tg-drawer-form-content"},[a("el-form",{ref:"formRef",attrs:{model:e.ProjectForm,rules:e.formRules,"label-position":"top",size:"small","label-width":"106px"}},[a("head-lines",{staticStyle:{margin:"12px 0px 12px -10px"},attrs:{title:"项目信息"}}),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"项目名称",prop:"project_name"}},[a("el-input",{ref:"autoFocuseRef",attrs:{maxlength:"20",placeholder:"请输入项目名称"},model:{value:e.ProjectForm.project_name,callback:function(t){e.$set(e.ProjectForm,"project_name","string"===typeof t?t.trim():t)},expression:"ProjectForm.project_name"}})],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"业务平台",prop:"platform_type"}},[a("el-select",{attrs:{placeholder:"请选择业务平台",size:"small"},on:{change:e.changeBusinessPlatform},model:{value:e.ProjectForm.platform_type,callback:function(t){e.$set(e.ProjectForm,"platform_type",t)},expression:"ProjectForm.platform_type"}},[a("el-option",{attrs:{label:"抖音平台",value:1}}),a("el-option",{attrs:{label:"淘宝平台",value:2}})],1)],1),a("el-form-item",{staticClass:"two-item-left mgb-18",attrs:{prop:"start_date",label:"开始时间"}},[a("el-date-picker",{attrs:{placeholder:"开始时间",type:"date",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.ProjectForm.start_date,callback:function(t){e.$set(e.ProjectForm,"start_date",t)},expression:"ProjectForm.start_date"}})],1),a("el-form-item",{staticClass:"two-item-right mgb-18",attrs:{prop:"end_date",label:"结束时间"}},[a("el-date-picker",{attrs:{placeholder:"结束时间",type:"date",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.ProjectForm.end_date,callback:function(t){e.$set(e.ProjectForm,"end_date",t)},expression:"ProjectForm.end_date"}})],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"项目类型",prop:"mcn_project_type"}},[a("el-select",{attrs:{disabled:!e.ProjectForm.platform_type,placeholder:"请选择项目类型",size:"small"},model:{value:e.ProjectForm.mcn_project_type,callback:function(t){e.$set(e.ProjectForm,"mcn_project_type",t)},expression:"ProjectForm.mcn_project_type"}},e._l(e.projectTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"项目经理",prop:"project_manager_id"}},[a("el-select",{attrs:{filterable:"",placeholder:"请输入并选择项目经理",size:"small"},model:{value:e.ProjectForm.project_manager_id,callback:function(t){e.$set(e.ProjectForm,"project_manager_id",t)},expression:"ProjectForm.project_manager_id"}},e._l(e.allManagerName,(function(t,r){return a("el-option",{key:r,attrs:{disabled:t.id===e.disabledProjectManagerId,label:t.username,value:t.id}},[a("span",[e._v(e._s(t.username))])])})),1)],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"项目所属部门",prop:"feishu_department_id"}},[a("el-popover",{attrs:{placement:"bottom-start",trigger:"click",width:"460","popper-class":"cb-department-tree-popper-class"}},[a("div",{staticClass:"repain-select",staticStyle:{display:"block"},attrs:{slot:"reference"},slot:"reference"},[a("el-input",{staticStyle:{color:"#999"},attrs:{value:e.ProjectForm.feishu_department_name,placeholder:"请选择项目所属部门",readonly:""},scopedSlots:e._u([{key:"suffix",fn:function(){return[a("i",{staticClass:"select-icon select-icon-user-add el-icon-arrow-down"})]},proxy:!0}])})],1),a("div",{staticClass:"department-tree"},[a("el-tree",{ref:"cb_department_tree",attrs:{props:e.treeProps,"check-strictly":!0,"node-key":"id",data:e.feishuDepartmentList,"show-checkbox":"","default-checked-keys":e.default_checked_department_ids,"default-expanded-keys":e.default_checked_department_ids},on:{check:e.handleCheckChange}})],1)])],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"团队成员",prop:"customer_id"}},[a("el-select",{attrs:{clearable:"",multiple:"",remote:"",filterable:"",value:e.selectNames,"remote-method":e.getAllOtherMembersRequest,loading:e.otherMemberLoading,placeholder:"请输入并选择其他成员"},on:{change:e.onOtherMembersChanged}},e._l(e.otherMembers,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.username}})})),1)],1),1===e.ProjectForm.platform_type?a("div",[a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"项目达人",prop:"kol_id"}},[a("el-select",{attrs:{clearable:"",remote:"",filterable:"","remote-method":e.getAllKolsRequest,loading:e.kolLoading,placeholder:"请选择项目关联达人"},on:{change:e.onKolChanged},model:{value:e.ProjectForm.kol_id,callback:function(t){e.$set(e.ProjectForm,"kol_id",t)},expression:"ProjectForm.kol_id"}},e._l(e.Kols,(function(e){return a("el-option",{key:e.kol_info.kol_id,attrs:{label:e.kol_info.kol_name,value:e.kol_info.kol_id}})})),1)],1),a("el-form-item",{staticClass:"one-item mgb-18",attrs:{label:"达人百应ID",prop:"baiying_id"}},[a("el-input",{attrs:{maxlength:"20",placeholder:"用于查询达人订单"},model:{value:e.ProjectForm.baiying_id,callback:function(t){e.$set(e.ProjectForm,"baiying_id","string"===typeof t?t.trim():t)},expression:"ProjectForm.baiying_id"}})],1),a("el-form-item",{staticClass:"one-item mgb-18",staticStyle:{"margin-right":"0px"},attrs:{label:"达人UID"}},[a("el-input",{attrs:{maxlength:"20",placeholder:"用于查询达人投放费用"},model:{value:e.ProjectForm.qianchuan_uid,callback:function(t){e.$set(e.ProjectForm,"qianchuan_uid","string"===typeof t?t.trim():t)},expression:"ProjectForm.qianchuan_uid"}})],1)],1):e._e()],1),a("div",{staticClass:"tg-drawer-footer"},[a("tg-button",{attrs:{size:"small"},on:{click:e.onCloseBtnClick}},[e._v("取消")]),a("tg-button",{attrs:{size:"small",type:"primary"},on:{click:e.onSaveBtnClick}},[e._v("保存")])],1)],1)])],1)},o=[],l=(a(21703),a(26699),a(97434)),i=a(4665),n=a(64236),s=a(83626),c=a(53451),m=a.n(c),d=a(3293),u=a(86863),p=a(57046),_=a(83468),v=a(26895);const{debounce:f}=m(),g=e=>{const t=(0,l.ref)(null),a=(0,l.ref)({id:-1,project_name:"",platform_type:"",mcn_project_type:"",project_manager_id:"",team_members:[],feishu_department_id:void 0,feishu_department_name:void 0,kol_id:void 0,kol_name:void 0,baiying_id:void 0,qianchuan_uid:void 0,end_date:void 0,start_date:void 0,feishu_department_level:void 0}),r=(0,l.ref)({start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],platform_type:[{required:!0,message:"请选择业务平台",trigger:"change"},{validator:(e,t,a)=>{-1===t?a(new Error("请选择业务平台")):a()},trigger:"change"}],mcn_project_type:[{required:!0,message:"请选择业务类型",trigger:"change"},{validator:(e,t,a)=>{-1===t?a(new Error("请选择业务类型")):a()},trigger:"change"}],kol_id:[{required:!0,message:"请选择项目关联达人",trigger:"change"}],baiying_id:[{required:!0,message:"请输入达人百应ID",trigger:"blur"}],project_manager_id:[{required:!0,message:"请选择项目经理",trigger:"change"}],feishu_department_id:[{required:!0,message:"请选择项目所属部门",trigger:"change"}]}),o=e=>{a.value.id=-1,a.value.project_name="",a.value.mcn_project_type="",a.value.platform_type="",a.value.project_manager_id="",a.value.team_members=[],a.value.feishu_department_id=void 0,a.value.feishu_department_name=void 0,a.value.kol_id=void 0,a.value.kol_name=void 0,a.value.baiying_id=void 0,a.value.qianchuan_uid=void 0,a.value.start_date=void 0,a.value.end_date=void 0,a.value.feishu_department_level=void 0,e()};return{formRef:t,formRules:r,ProjectForm:a,resetProjectForm:o}};var h=(0,l.defineComponent)({name:"TgCommonBusinessProjectDialog",props:{visible:{type:Boolean,default:!1},title:{type:String,default:"新增场次"},project:{type:Object,required:!1},isEditForm:{type:Boolean,default:!1,required:!1}},setup(e,t){const a=(0,l.ref)(!1),r=(0,l.ref)([]),o=(0,l.ref)(!1),c=(0,l.ref)(void 0),{formRef:m,formRules:h,ProjectForm:b,resetProjectForm:k}=g(e),j=(0,l.ref)([]),y=(0,l.ref)(void 0),P=(0,l.computed)((()=>b.value.feishu_department_id?[b.value.feishu_department_id]:[])),C={label:"name",children:"sons"},F=()=>{k((()=>{y.value?.setCheckedKeys([])})),t.emit("dialog:close")},w=async()=>{if(a.value)return;const e=await new Promise((e=>m.value?.validate((t=>e(t)))));if(!e)return;const r={business_type:5,project_name:b.value.project_name,platform_type:b.value.platform_type,start_date:b.value.start_date,end_date:b.value.end_date,mcn_project_type:b.value.mcn_project_type,project_manager_id:b.value.project_manager_id,team_members:b.value.team_members,feishu_department_id:b.value.feishu_department_id,kol_id:1===b.value.platform_type?b.value.kol_id:void 0,baiying_id:1===b.value.platform_type?b.value.baiying_id:void 0,qianchuan_uid:1===b.value.platform_type?b.value.qianchuan_uid:void 0,feishu_department_level:b.value.feishu_department_level};-1!==b.value.id&&(r.id=b.value.id),a.value=!0;const[{data:o},l]=await Promise.all([await(0,s.i1)(r),await(0,n._v)(200)]);a.value=!1,o.success?(t.root.$message.success(o.message),t.emit("dialog:close",!0)):t.root.$message.error(o.message??"项目保存失败")},q=f(w,200),M=(0,l.ref)(-1);(0,l.watch)((()=>e.visible),(t=>{t&&(k((()=>y.value?.setCheckedKeys([]))),m.value?.resetFields(),S(),void 0!==e.project?(b.value.id=e.project.id,b.value.project_name=e.project.project_name,b.value.mcn_project_type=e.project.mcn_project_type,b.value.platform_type=e.project.platform_type,b.value.project_manager_id=e.project.project_manager_id,b.value.team_members=e.project.team_members.map((e=>e.id)),b.value.feishu_department_id=e.project.feishu_department_id,b.value.feishu_department_name=e.project.feishu_department_name,b.value.kol_id=e.project.kol_id||void 0,b.value.kol_name=e.project.kol_name||void 0,b.value.baiying_id=e.project.baiying_id||void 0,b.value.qianchuan_uid=e.project.qianchuan_uid||void 0,b.value.start_date=e.project.start_date||void 0,b.value.end_date=e.project.end_date||void 0,b.value.feishu_department_level=e.project.feishu_department_level,e.project.kol_name&&(r.value=[{kol_info:{kol_id:e.project.kol_id,kol_name:e.project.kol_name},kol_douyin_info:{baiying_id:e.project.baiying_id||"",qianchuan_uid:e.project.qianchuan_uid||""}}]),z.value=(0,p.I8)(e.project.team_members)):(0,l.nextTick)((()=>{c.value?.focus()})))}));const x=async()=>{const e=await(0,d.o1)(),t=e.data.data.data;(0,v.$S)(t,!0,3),j.value=t},A=e=>{y.value?.setCheckedKeys([]),e.id===b.value.feishu_department_id?(b.value.feishu_department_id=void 0,b.value.feishu_department_name=void 0):(b.value.feishu_department_id=e.id,b.value.feishu_department_name=e.name,y.value?.setCheckedKeys([e.id])),b.value.feishu_department_level=e.level};x();const R=(0,l.ref)(-1),$=(0,l.ref)([]),S=async()=>{const{data:t}=await(0,u.pc)({roles:"1003"});$.value=t.success?t.data:[];const a=e.project?.project_manager_id;a&&($.value.map((e=>e.id.toString())).includes(a.toString())||(R.value=a,$.value.push({id:a,username:e.project?.project_manager??"--"})))},B=(0,l.ref)(!1),K=(0,l.ref)([]),z=(0,l.ref)([]),O=(0,l.computed)((()=>b.value.team_members.map((e=>{const t=z.value.find((t=>t.id===e));return t?.name??""})))),U=async e=>{if(""===e||void 0===e)return void(K.value=[]);B.value=!0;const t=await(0,d.em)(e);B.value=!1,t.data.success?K.value=t.data.data.user_data:K.value=[]},I=e=>{const t=[];K.value.forEach((e=>{const t=z.value.find((t=>e.id===t.id));t||z.value.push({id:e.id,name:e.username})})),e.forEach((e=>{const a=z.value.find((t=>t.name===e));a&&t.push(a.id)})),b.value.team_members=t},L=()=>{b.value.mcn_project_type=""},D=(0,l.computed)((()=>{const e=[];return 1===b.value.platform_type?(e.push({label:i.MU.get(i.kA.clothing),value:i.kA.clothing}),e.push({label:i.MU.get(i.kA.label),value:i.kA.label}),e.push({label:i.MU.get(i.kA.makeups),value:i.kA.makeups}),e.push({label:i.MU.get(i.kA.head),value:i.kA.head})):2===b.value.platform_type&&(e.push({label:i.MU.get(i.kA.taobao_cps),value:i.kA.taobao_cps}),e.push({label:i.MU.get(i.kA.v_task),value:i.kA.v_task})),e})),E=async e=>{o.value=!0;const a={kol_name:e,platform:"douyin",verify_status:1},[l,{data:i}]=await Promise.all([await(0,n._v)(500),await(0,_.W7)(a)]);o.value=!1,i.success?r.value=i.data.data:t.root.$message({type:"warning",message:i.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},N=e=>{r.value.map((t=>{t.kol_info.kol_id===e&&(b.value.kol_name=t.kol_info.kol_name,b.value.baiying_id=t.kol_douyin_info.baiying_id||"",b.value.qianchuan_uid=t.kol_douyin_info.qianchuan_uid||"")}))};return{Kols:r,kolLoading:o,onKolChanged:N,getAllKolsRequest:E,autoFocuseRef:c,disabledManagerId:M,saveLoading:a,formRef:m,formRules:h,ProjectForm:b,onCloseBtnClick:F,onSaveBtnClick:q,feishuDepartmentList:j,treeProps:C,handleCheckChange:A,cb_department_tree:y,default_checked_department_ids:P,allManagerName:$,disabledProjectManagerId:R,selectNames:O,otherMemberLoading:B,otherMembers:K,getAllOtherMembersRequest:U,onOtherMembersChanged:I,changeBusinessPlatform:L,projectTypeOptions:D}}}),b=h,k=a(1001),j=(0,k.Z)(b,r,o,!1,null,null,null),y=j.exports},83468:function(e,t,a){a.d(t,{W7:function(){return l},m1:function(){return i},vg:function(){return n}});var r=a(76012),o=a(64236);const l=async e=>(0,r.dX)("/api/kol/query_kol",{params:{...(0,o.jG)(e)}}),i=async()=>(0,r.dX)("/api/anchor/good_at_categories"),n=async e=>(0,r.SO)("/api/kol/update_kol_platform",e)},4665:function(e,t,a){var r,o,l;a.d(t,{MU:function(){return i},kA:function(){return l}}),function(e){e[e["company_name"]=7]="company_name",e[e["project_name"]=6]="project_name",e[e["shop_name"]=2]="shop_name",e[e["cooperation_uid"]=3]="cooperation_uid",e[e["customer_manager_name"]=4]="customer_manager_name",e[e["ae_name"]=5]="ae_name"}(r||(r={})),function(e){e[e["base"]=4]="base",e[e["mcn"]=5]="mcn"}(o||(o={})),function(e){e[e["clothing"]=1]="clothing",e[e["label"]=2]="label",e[e["makeups"]=3]="makeups",e[e["head"]=4]="head",e[e["taobao_cps"]=5]="taobao_cps",e[e["v_task"]=6]="v_task"}(l||(l={}));const i=new Map([[l.clothing,"服装项目"],[l.label,"标品项目"],[l.makeups,"美妆项目"],[l.head,"团长项目"],[l.taobao_cps,"淘宝CPS"],[l.v_task,"V任务"]])}}]);