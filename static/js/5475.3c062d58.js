"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[5475],{65475:function(t,e,a){a.d(e,{Z:function(){return p}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"sty-radio sty-input sty-dialog",attrs:{id:"addAttachmentDialog"}},[a("el-dialog",{attrs:{visible:t.dialogVisible,width:"822px","destroy-on-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,"custom-class":"add-attachment-dialog customer-dialog"},on:{close:t.handleDialogClose},scopedSlots:t._u([{key:"title",fn:function(){return[a("div",{staticClass:"title"},[t._v("新增供应商结算单")])]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:t.handleDialogClose}},[t._v("取 消")]),a("tg-button",{class:t.isSubmitForbid?"forbid-btn":"",attrs:{type:"primary",disabled:t.isSubmitForbid},on:{click:t.handleAttachmentSubmitClick}},[t._v("提 交 ")])]},proxy:!0}])},[a("el-form",{ref:"contract_attachment_form",staticClass:"dialog-content",attrs:{inline:"",size:"small",model:t.contract_attachment_form,rules:t.contract_attachment_rules,"label-width":"92px"}},[a("div",{staticClass:"box1"},[a("div",{staticClass:"content-block-header"},[a("span",[t._v("结算单基本信息")])]),a("div",{staticClass:"form-block"},[a("el-form-item",{attrs:{label:"合同编号：",prop:"contract_no"}},[a("el-select",{staticClass:"contract-attachment-input dsb",attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",placeholder:"请搜索并选择合同编号","remote-method":t.getCustmerByContractNo,"popper-class":"contract-select-empty"},on:{change:t.handleSelect},model:{value:t.contract_attachment_form.contract_no,callback:function(e){t.$set(t.contract_attachment_form,"contract_no",e)},expression:"contract_attachment_form.contract_no"}},t._l(t.custmerOption,(function(t){return a("el-option",{key:t.contract_uid,attrs:{label:t.contract_uid,value:t.contract_uid}})})),1)],1),a("el-form-item",{attrs:{label:"供应商：",prop:"partner_name"}},[a("el-input",{staticClass:"contract-attachment-input",attrs:{placeholder:"请先关联合同编号",disabled:""},model:{value:t.contract_attachment_form.partner_name,callback:function(e){t.$set(t.contract_attachment_form,"partner_name",e)},expression:"contract_attachment_form.partner_name"}})],1),a("el-form-item",{attrs:{label:"项目：",rules:[{required:!0}]}},[a("el-input",{staticClass:"contract-attachment-input",attrs:{placeholder:"请先关联合同编号",disabled:""},model:{value:t.cooperation_name,callback:function(e){t.cooperation_name=e},expression:"cooperation_name"}})],1),5!==t.business_type?a("el-form-item",{attrs:{label:"品牌："}},[a("el-input",{staticClass:"contract-attachment-input",attrs:{placeholder:"请先关联合同编号",disabled:""},model:{value:t.brand_name,callback:function(e){t.brand_name=e},expression:"brand_name"}})],1):t._e(),a("el-form-item",{attrs:{label:"审批金额：",prop:"approval_amount"}},[a("el-input",{staticClass:"contract-attachment-input",attrs:{placeholder:"请输入审批金额"},on:{input:function(e){return t.contract_attachment_form.approval_amount=t.getPositiveNumber(e)},blur:function(e){return 0===e.target.value?t.contract_attachment_form.approval_amount="":t.contract_attachment_form.approval_amount}},model:{value:t.contract_attachment_form.approval_amount,callback:function(e){t.$set(t.contract_attachment_form,"approval_amount",e)},expression:"contract_attachment_form.approval_amount"}})],1),a("el-form-item",{attrs:{label:"用章情况：",prop:"seal_type"}},[a("el-select",{staticClass:"contract-attachment-input",model:{value:t.contract_attachment_form.seal_type,callback:function(e){t.$set(t.contract_attachment_form,"seal_type",e)},expression:"contract_attachment_form.seal_type"}},[a("el-option",{staticStyle:{width:"158px"},attrs:{label:"公章",value:2}}),a("el-option",{staticStyle:{width:"158px"},attrs:{label:"合同章",value:3}}),a("el-option",{staticStyle:{width:"158px"},attrs:{label:"不用印章",value:1}})],1)],1),a("el-form-item",{staticStyle:{width:"580px"},attrs:{label:"申请内容："}},[a("el-input",{staticStyle:{width:"426px"},attrs:{type:"textarea","show-word-limit":"",placeholder:"请输入文本",maxlength:"100"},model:{value:t.contract_attachment_form.comment,callback:function(e){t.$set(t.contract_attachment_form,"comment",e)},expression:"contract_attachment_form.comment"}})],1),a("el-form-item",{attrs:{label:"附件单：",prop:"attachment_url"}},[a("el-upload",{staticClass:"upload-attachment",attrs:{action:"/",multiple:!1,"show-file-list":!1,"http-request":t.uploadAttachmentFile,accept:".pdf,.docx,.jpg,.xlsx,.xls",disabled:5===t.uploadedAttachmentList.length}},[a("tg-button",{attrs:{icon:"ico-btn-upload",disabled:t.uploadedAttachmentList.length>=5}},[t._v(" 上传文件 ")])],1),a("span",{staticClass:"upload-tips"},[t._v(" 最多上传5个文件（单个文件大小不超过30M），支持扩展名：.docx .pdf .jpg .xlsx .xls ")]),t.uploadedAttachmentList.length?a("div",{staticClass:"uploaded-list"},[a("upload-file-list",{attrs:{inline:""},model:{value:t.uploadedAttachmentList,callback:function(e){t.uploadedAttachmentList=e},expression:"uploadedAttachmentList"}})],1):t._e()],1)],1)])]),a("div",{staticClass:"box3"},[a("div",{staticClass:"content-header content-block-header"},[t._v("结算情况")]),a("div",{staticClass:"content-body"},[t._l(t.contract_attachment_form.settlement_detail,(function(e,n){return a("div",{key:n,staticClass:"line-status"},[1!==t.contract_attachment_form.settlement_detail.length||t.isFirstDelete?a("div",{staticClass:"delete_tr_wrap"},[a("span",{staticClass:"delete_tr",on:{click:function(e){return t.deleteTr(n)}}},[a("i",{staticClass:"el-icon-error",staticStyle:{color:"#ccc"}})])]):t._e(),a("el-form",{ref:"contract_settlement_form",refInFor:!0,attrs:{size:"small",inline:"",rules:t.settlement_status_rules,model:e,"label-width":"78px"}},[a("el-form-item",{attrs:{label:"结算方式：",prop:"settle_way"}},[a("el-radio-group",{staticStyle:{"margin-top":"9px"},model:{value:e.settle_way,callback:function(a){t.$set(e,"settle_way",a)},expression:"items.settle_way"}},[a("el-radio",{attrs:{label:1}},[t._v("对公银行")]),a("el-radio",{attrs:{label:2}},[t._v("支付宝")]),a("el-radio",{attrs:{label:3}},[t._v("V任务")]),a("el-radio",{attrs:{label:4}},[t._v("淘宝联盟")]),a("el-radio",{attrs:{label:5}},[t._v("巨量百应")])],1)],1),a("div",{staticClass:"form-grid"},[a("el-form-item",{attrs:{label:"结算金额：",prop:"settle_amount"}},[a("el-input",{attrs:{size:"small",placeholder:"0.00"},on:{input:function(a){return e.settle_amount=t.getPositiveNumber(a)},blur:function(t){return 0===t.target.value?e.settle_amount="":e.settle_amount}},model:{value:e.settle_amount,callback:function(a){t.$set(e,"settle_amount",a)},expression:"items.settle_amount"}})],1),3===e.settle_way?a("el-form-item",{attrs:{label:"店铺名称：",prop:"shop_name"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入店铺名称",maxlength:20},model:{value:e.shop_name,callback:function(a){t.$set(e,"shop_name",a)},expression:"items.shop_name"}})],1):t._e(),3===e.settle_way?a("el-form-item",{attrs:{label:"旺旺名：",prop:"wangwang_num"}},[a("el-input",{attrs:{size:"small",placeholder:"请输入下单旺旺名",maxlength:20},model:{value:e.wangwang_num,callback:function(a){t.$set(e,"wangwang_num",a)},expression:"items.wangwang_num"}})],1):t._e(),a("el-form-item",{attrs:{label:"开始日期：",prop:"start_date"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",placeholder:"请选择日期",size:"small","start-placeholder":"开始日期","value-format":"yyyy-MM-dd"},model:{value:e.start_date,callback:function(a){t.$set(e,"start_date",a)},expression:"items.start_date"}})],1),a("el-form-item",{attrs:{label:"结束日期：",prop:"end_date"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{type:"date",size:"small",placeholder:"请选择日期","start-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:e.end_date,callback:function(a){t.$set(e,"end_date",a)},expression:"items.end_date"}})],1)],1),a("el-form-item",{staticClass:"form-remark",attrs:{label:"备注：",prop:"remark"}},[a("el-input",{style:{width:t.editData&&t.editData.edit?"456px !important":"416px !important"},attrs:{"show-word-limit":"",size:"small",placeholder:"不超过20字符",maxlength:"20"},model:{value:e.remark,callback:function(a){t.$set(e,"remark",a)},expression:"items.remark"}})],1)],1)],1)})),12!==t.contract_attachment_form.settlement_detail.length?a("div",{staticClass:"add_tr",on:{click:t.addTr}},[a("tg-icon",{attrs:{name:"ico-btn-add"}}),t._v(" 点击添加 ")],1):t._e()],2)])],1),a("tg-mask-loading",{attrs:{visible:t.isSubmitForbid,content:"  正在提交数据，请稍候..."}})],1)},s=[],r=a(83005),o=a(97484),i=a(61282),c=a(84731),l=a(29625),m=a(48606),d={name:"AddSettlementDialog",inject:["project_add_id","project"],components:{},data(){return{loading:null,isSubmitForbid:!1,inputMaxL:null,radio:1,isAddingEditing:!1,dialogVisible:!1,contract_attachment_form:{contract_type:4,seal_type:2,contract_no:void 0,partner_name:void 0,contract_id:void 0,approval_amount:void 0,comment:"",attachment_url:"",contract_annex_type:2,settlement_detail:[{settle_amount:"",settle_way:1,start_date:"",end_date:"",done_amount:"",wait_amount:"",invoice_amount:"",remark:"",shop_name:"",wangwang_num:""}]},custmerOption:[],contract_attachment_rules:{contract_type:[{required:!0,message:"供应商合同",trigger:"blur"}],contract_no:[{required:!0,message:"请输入合同编号",trigger:"blur"}],approval_amount:[{required:!0,message:"请输入审批金额",trigger:"blur"}],seal_type:[{required:!0,message:"请输入选择用章情况",trigger:"change"}],comment:[{required:!0,message:"请输入申请内容",trigger:"blur"}],attachment_url:[{required:!0,message:"请上传附件",trigger:"blur"}]},settlement_status_rules:{settle_amount:[{required:!0,message:"请输入结算金额",trigger:"blur"}],settle_way:[{required:!0,message:"请选择结算方式",trigger:"blur"}],shop_name:[{required:!0,message:"请输入店铺名称",trigger:"blur"}],wangwang_num:[{required:!0,message:"请输入下单旺旺名",trigger:"blur"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"blur"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"blur"}],remark:[{message:"请输入备注",trigger:"blur"}]},uploadAttachmentUploading:!1,uploadedAttachmentList:[],isFirstDelete:!1,breadcrumb:(0,c.f)(),brand_name:"",cooperation_name:"",business_type:0}},props:{editData:{type:Object}},watch:{contract_attachment_form:{handler:function(t){if(1===this.contract_attachment_form.settlement_detail.length){let e=!1;const a=t.settlement_detail[0];for(let t in a)if("settle_way"!==t&&a[t]){e=!0;break}this.isFirstDelete=e}},deep:!0},editData:{handler:function(t){t&&t.isEdit&&(this.contract_attachment_form.contract_no=t.contract_no,this.contract_attachment_form.partner_name=t.partner_name,this.contract_attachment_form.contract_id=t.contract_id,this.contract_attachment_form.partner_id=t.partner_id,this.contract_attachment_form.approval_amount=t.approval_amount,this.contract_attachment_form.comment=t.comment,this.contract_attachment_form.attachment_url=t.attachment_url,this.contract_attachment_form.contract_type=t.contract_type,this.contract_attachment_form.settlement_detail=t.settlement_detail.map((t=>({settle_amount:t.settle_amount,settle_way:t.settle_way,start_date:t.start_date,end_date:t.end_date,done_amount:t.done_amount,wait_amount:t.wait_amount,invoice_amount:t.invoice_amount,remark:t.remark,shop_name:t.shop_name,wangwang_num:t.wangwang_num}))),this.uploadedAttachmentList=t.attachment_url.split(","))},deep:!0}},methods:{getPositiveNumber:i.nA,getPositiveNumberHaveZero:i.aV,startLoading(){this.loading=m.Loading.service({lock:!0,text:"加载中……",background:"rgba(0, 0, 0, 0.7)"})},closeLoading(){this.loading.close()},addTr(){this.contract_attachment_form.settlement_detail.push({settle_amount:"",settle_way:1,start_date:"",end_date:"",done_amount:"",wait_amount:"",invoice_amount:"",remark:"",shop_name:"",wangwang_num:""}),this.isFirstDelete=!1},deleteTr(t){this.contract_attachment_form.settlement_detail.splice(t,1),0===this.contract_attachment_form.settlement_detail.length&&this.addTr()},show(){this.dialogVisible=!0,this.project.value&&(this.brand_name=this.project.value.brand_name,this.business_type=this.project.value.business_type,this.cooperation_name=this.project.value.cooperation_name||this.project.value.project_name),this.editData&&this.editData.isEdit&&(this.contract_attachment_form.contract_no=this.editData.contract_no,this.contract_attachment_form.partner_name=this.editData.partner_name,this.contract_attachment_form.contract_id=this.editData.contract_id,this.contract_attachment_form.partner_id=this.editData.partner_id,this.contract_attachment_form.approval_amount=this.editData.approval_amount,this.contract_attachment_form.comment=this.editData.comment,this.contract_attachment_form.attachment_url=this.editData.attachment_url,this.contract_attachment_form.settlement_detail=this.editData.settlement_detail.map((t=>({settle_amount:t.settle_amount,settle_way:t.settle_way,start_date:t.start_date,end_date:t.end_date,done_amount:t.done_amount,wait_amount:t.wait_amount,invoice_amount:t.invoice_amount,remark:t.remark,shop_name:t.shop_name,wangwang_num:t.wangwang_num}))),this.uploadedAttachmentList=this.editData.attachment_url.split(","))},handleAttachmentSubmitClick(){this.isAddingEditing=!0,this.$refs.contract_attachment_form.validate((t=>{let e=!0;for(const a of this.$refs.contract_settlement_form)a.validate((t=>{t||(e=!1)}));if(!t||!e)return!1;0!==this.uploadedAttachmentList.length?(this.contract_attachment_form.attachment_url=this.uploadedAttachmentList.join(","),this.isSubmitForbid=!0,this.contract_attachment_form.current_project_id=this.project.value.id||this.project.value.cooperation_id,Promise.resolve().then((()=>this.editData&&this.editData.isEdit?this.editData.business_type===l.WD.marketing?(0,r.Zx)(this.contract_attachment_form):this.editData.business_type===l.WD.mcn?(0,r.BJ)(this.contract_attachment_form):(0,r._C)(this.contract_attachment_form):this.breadcrumb.isLiveDetail?(0,r._C)(this.contract_attachment_form):this.breadcrumb.isCommonBusinessDetail?(0,r.BJ)(this.contract_attachment_form):this.breadcrumb.isCoopDetail?(0,r.Zx)(this.contract_attachment_form):(0,r.Te)(this.contract_attachment_form))).then((t=>{t.data.success?(this.$message.success(t.data.message,{showClose:!0,duration:2e3}),this.$emit("added",!0),this.dialogVisible=!1,this.formResetFun()):this.$message.error(t.data.message,{showClose:!0,duration:2e3}),this.isSubmitForbid=!1})).catch((t=>{this.$message.error("新增合同附件失败，请稍后重试",{showClose:!0,duration:2e3}),console.error(t.message),this.isSubmitForbid=!1}))):this.$message.error("请上传附件",{showClose:!0,duration:2e3})}))},getCustmerByContractNo(t){let e=1;this.editData&&this.editData.isEdit?e=this.editData.business_type===l.WD.marketing?2:1:this.breadcrumb.isLiveDetail||this.breadcrumb.isCommonBusinessDetail?e=1:this.breadcrumb.isCoopDetail&&(e=2),""!==t&&void 0!==t&&(0,r.z0)({partner_type:2,contract_status:2,only_main:0,search:t.trim(),project_type:e}).then((t=>{t.data.success&&(this.custmerOption=t.data.data.data)})).catch((()=>{this.$message.error("根据合同编号获取合同客户名称失败，请稍后重试",{showClose:!0,duration:2e3})}))},handleSelect(t){this.isAddingEditing=!1;const e=this.custmerOption.find((e=>e.contract_uid===t));return e&&2!==e.contract_status?(this.$message.warning("合同在正常状态下才可以添加合同附件"),!1):!e||4!==e.last_annex_status&&5!==e.last_annex_status?(this.contract_attachment_form.partner_name=e?e.partner_name:void 0,this.contract_attachment_form.contract_id=e?e.contract_id:void 0,this.contract_attachment_form.partner_id=e?e.partner_id:void 0,void(this.contract_attachment_form.contract_type=e?e.contract_type:void 0)):(this.$message.warning("合同附件在审批中、已作废状态下无法继续添加合同附件"),!1)},uploadAttachmentFile(t){if(5===this.uploadedAttachmentList.length)return void this.$message.error("最多上传5个文件");if(t.file.size>31488e3)return void this.$message.error("单个文件大小不超过30M");this.isAddingEditing=!1,this.startLoading();const e=t.file,a=new FormData;a.append("file",e),a.append("type","contract_statements_attachment"),this.uploadAttachmentUploading=!0,(0,o.cT)(a).then((t=>{this.closeLoading(),t.data.success?(this.uploadedAttachmentList.push(t.data.data.source),this.contract_attachment_form.attachment_url=this.uploadedAttachmentList.join(","),this.$refs.contract_attachment_form.validateField("attachment_url")):this.$message({type:"warning",message:t.data.message,showClose:!0,duration:2e3}),this.uploadAttachmentUploading=!1})).catch((t=>{this.closeLoading(),this.$message({type:"warning",message:"上传失败，稍后重试",showClose:!0,duration:2e3}),this.uploadAttachmentUploading=!1,console.log(t.message)}))},handleAttachmentClick(t){this.uploadedAttachmentList.splice(t,1)},handleDialogClose(){this.dialogVisible=!1,this.formResetFun(),this.custmerOption=[],this.isAddingEditing=!1,Object.assign(this.$data,this.$options.data())},formResetFun(){this.$refs.contract_attachment_form.resetFields(),this.uploadedAttachmentList=[],this.contract_attachment_form.attachment_url="",this.departmentName=""}}},_=d,h=a(1001),u=(0,h.Z)(_,n,s,!1,null,"1ffcc1a1",null),p=u.exports}}]);