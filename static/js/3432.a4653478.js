"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[3432],{33432:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var n=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("tg-card",e._b({staticClass:"tg-built-in-role-page flex-auto",attrs:{padding:[18,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[e.Permission.canViewList?t("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[t("empty-common",{attrs:{"detial-text":"暂未添加系统角色"}})]},proxy:!0}],null,!1,4140078002)},"el-table",e.tableProps,!1),[t("el-table-column",{attrs:{prop:"role_name",label:"系统角色","min-width":"164"}}),t("el-table-column",{attrs:{prop:"instructions",label:"说明","min-width":"322"},scopedSlots:e._u([{key:"default",fn:function(a){var n=a.row;return[t("div",{staticClass:"line-clamp-2"},[e._v(e._s(n.instructions))])]}}],null,!1,3082906481)}),t("el-table-column",{attrs:{label:"关联管理岗位","min-width":"190",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{class:a.row.related_manager_job?"":"no-content"},[e._v(e._s(a.row.related_manager_job?a.row.related_manager_job.job_name:"--"))])]}}],null,!1,4016228791)}),t("el-table-column",{attrs:{label:"关联执行岗位","min-width":"314",align:"left"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"top",width:"364",disabled:a.row.related_normal_jobs.length<=1,trigger:"hover","open-delay":300}},[t("div",{staticClass:"related-job-label-grid"},e._l(a.row.related_normal_jobs,(function(a){return t("span",{key:a.job_id,staticClass:"related-job-label"},[e._v(e._s(a.job_name))])})),0),t("span",{class:a.row.related_normal_jobs.length>0?"line-clamp-2":"no-content line-clamp-2",attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.relatedNormalJobStr(a.$index)))])])]}}],null,!1,1981349748)}),e.Permission.canEdit?t("el-table-column",{attrs:{label:"操作","min-width":"92",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("a",{staticClass:"edit-a",on:{click:function(t){return e.handleEditAction(a.$index)}}},[e._v("编辑")])]}}],null,!1,212430434)}):e._e()],1):e._e(),e.shouldEditing?t("roleEditDialog",{attrs:{editingRole:e.editingRole},on:{closeAction:function(a){e.shouldEditing=!e.shouldEditing},succeed:e.handleEditingSucceedAction}}):e._e()],1)},o=[],l=t(97434),r=t(50572),i=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("tg-block",{staticClass:"dialog-build-in-edit"},[t("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter",attrs:{visible:!0,width:"478px",top:"278px","close-on-click-modal":!1},on:{close:e.handleCloseAction},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("编辑系统角色")]},proxy:!0},{key:"footer",fn:function(){return[t("tg-button",{on:{click:e.handleCloseAction}},[e._v("取消")]),t("tg-button",{attrs:{type:"primary"},on:{click:e.handleSaveAction}},[e._v("保存")])]},proxy:!0}])},[t("el-form",{ref:"formRef",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"系统角色：",size:"medium"}},[t("span",{staticClass:"system-role-span"},[e._v(e._s(e.editingRole.role_name))])]),t("el-form-item",{attrs:{label:"管理岗位：",prop:"manager_job_id",size:"medium"}},[t("el-select",{attrs:{clearable:"",placeholder:"请选择管理岗位"},on:{change:e.managerJobChanged},model:{value:e.form.manager_job_name,callback:function(a){e.$set(e.form,"manager_job_name",a)},expression:"form.manager_job_name"}},e._l(e.dialogData.managerJobs,(function(e){return t("el-option",{key:e.id,attrs:{label:e.job_name,value:e.job_name}})})),1)],1),t("el-form-item",{attrs:{label:"执行岗位：",prop:"normal_job_ids",size:"medium"}},[t("el-select",{attrs:{"popper-class":"system-role-selection-popper",multiple:"",clearable:"",placeholder:"请选择执行岗位"},on:{change:e.normalJobChanged},model:{value:e.form.normal_job_names,callback:function(a){e.$set(e.form,"normal_job_names",a)},expression:"form.normal_job_names"}},[t("el-checkbox-group",{model:{value:e.form.normal_job_names,callback:function(a){e.$set(e.form,"normal_job_names",a)},expression:"form.normal_job_names"}},e._l(e.dialogData.normalJobs,(function(e){return t("el-option",{key:e.id,attrs:{label:e.job_name,value:e.job_name}},[t("el-checkbox",{attrs:{label:e.job_name},nativeOn:{click:function(e){e.preventDefault()}}})],1)})),1)],1)],1)],1)],1),t("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},s=[],c=(0,l.defineComponent)({props:{editingRole:{type:Object}},setup(e,a){return{...d(a,e.editingRole)}}});function d(e,a){const t=(0,l.ref)(!1),n=(0,l.ref)(void 0),o=(0,l.ref)({manager_job_id:void 0,manager_job_name:"",normal_job_ids:[],normal_job_names:[]}),r=(0,l.ref)({managerJobs:[],normalJobs:[]}),i=()=>{e.emit("closeAction")},s=()=>{n.value?.validate((n=>{n&&m({id:a?a.id:void 0,manager_job_id:o.value.manager_job_id,normal_job_ids:o.value.normal_job_ids},e,t)}))},c=(0,l.ref)({manager_job_id:[{required:!0,message:"请选择管理岗位",trigger:"change"}],normal_job_ids:[{required:!0,message:"请选择执行岗位",trigger:"change"}]}),d=e=>{const a=r.value.managerJobs.filter((a=>a.job_name===e));a.length>0?o.value.manager_job_id=a[0].id:o.value.manager_job_id=void 0},_=e=>{if(e.length>0){const a=[];for(const t of e){const e=r.value.normalJobs.filter((e=>t===e.job_name));e.length>0&&a.push(e[0].id)}o.value.normal_job_ids=a}else o.value.normal_job_ids=[]};return u(1,r),u(2,r),(0,l.onMounted)((()=>{a?.related_manager_job&&(o.value.manager_job_id=a?.related_manager_job.job_id,o.value.manager_job_name=a.related_manager_job.job_name),a?.related_normal_jobs&&a.related_normal_jobs.length>0&&(o.value.normal_job_ids=a.related_normal_jobs.map((e=>e.job_id)),o.value.normal_job_names=a.related_normal_jobs.map((e=>e.job_name)))})),{dialogData:r,form:o,formRef:n,rules:c,saveLoading:t,handleSaveAction:s,handleCloseAction:i,managerJobChanged:d,normalJobChanged:_}}async function u(e,a){const t=await(0,r.Eq)({department_id:void 0,job_name:void 0,job_level:1===e?void 0:e});switch(e){case 1:a.value.normalJobs=t.data.data??[];break;case 2:a.value.managerJobs=t.data.data??[];break;default:break}}async function m(e,a,t){t.value=!0;const n=await(0,r.ey)(e);t.value=!1,n.data.success?(a.emit("succeed"),a.root.$message.success(n.data.message??"保存成功")):a.root.$message.error(n.data.message??"保存失败")}var _=c,b=t(1001),g=(0,b.Z)(_,i,s,!1,null,null,null),f=g.exports,p=t(21757),v=t(78902),h=t(58302),j=(0,l.defineComponent)({name:"TgBuiltInRole",components:{roleEditDialog:f},setup(e){const a=(0,l.computed)((()=>{const e=(0,p.kG)(v.HN.system_role_list),a=(0,p.kG)(v.HN.system_role_edit);return{canEdit:a,canViewList:e}}));return{Permission:a,...y()}}});function y(){const e=(0,l.ref)(!1),a=(0,l.ref)(!1),t=(0,l.ref)([]),n=(0,l.ref)(void 0),o=e=>{const a=t.value[e].related_normal_jobs;return 0===a.length?"--":a.map((e=>e.job_name)).join("、")},r=a=>{e.value=!e.value,n.value=t.value[a]},i=()=>{k(t,a),e.value=!e.value};k(t,a);const s=0,c=0,d=36,u=31,m=(0,l.ref)(0),_=e=>{m.value=e.height},b=(0,h.Z)({compensation:(0,l.computed)((()=>s+c+d+u)),fixedBlockHeightRefs:[m],tableMinHeight:100});return{list:t,relatedNormalJobStr:o,shouldEditing:e,loading:a,handleEditAction:r,editingRole:n,handleEditingSucceedAction:i,onTopCardRectUpdate:_,...b}}async function k(e,a){a.value=!0;const{data:t}=await(0,r.Pz)();a.value=!1,e.value=t.data.data}var w=j,x=(0,b.Z)(w,n,o,!1,null,"f779ec7c",null),C=x.exports},50572:function(e,a,t){t.d(a,{Fv:function(){return _},Eq:function(){return f},cc:function(){return u},Pz:function(){return b},a_:function(){return m},ey:function(){return g}});var n=t(76012),o=t(64236);const l="/api/auth/query_role_v2",r="/api/auth/save_role",i="/api/auth/del_role/:id/",s="/api/auth/query_system_role",c="/api/auth/update_system_role",d="/api/auth/get_job_list",u=async e=>(0,n.dX)(l,{params:{...(0,o.jG)(e)}}),m=async e=>(0,n.SO)(r,{...(0,o.jG)(e)}),_=async e=>(0,n.SO)(i.replace(":id",`${e}`)),b=async()=>(0,n.dX)(s),g=async e=>(0,n.SO)(c,{...(0,o.jG)(e)}),f=async e=>(0,n.dX)(d,{params:{...(0,o.jG)(e)}})},58302:function(e,a,t){var n=t(97434),o=t(77944),l=t(52140);const r=e=>{const a=(0,n.computed)((()=>o.Z.getters["global/scrollbarSetting"])),t=(0,n.computed)((()=>void 0!==e.pagename?!0!==a.value.find((a=>a.key===e.pagename))?.value:e.disable??!1)),r=(0,n.computed)((()=>{const a=(e.fixedBlockHeightRefs??[]).map((e=>(0,n.unref)(e))).reduce(((e,a)=>(0,n.unref)(e)+(0,n.unref)(a)),0);return t.value?"max-content":`calc(100vh - ${(0,n.unref)(a)+56+36}px)`})),i=(0,n.computed)((()=>(t.value,"flex-auto"))),s=(0,n.computed)((()=>({height:r.value,overflowInBody:!t.value}))),c=(0,n.ref)(0),d=(0,n.computed)((()=>t.value?{}:{height:Math.max(c.value-(0,n.unref)((0,n.unref)(e.compensation)),e.tableMinHeight??0)})),u=t.value?()=>{}:e=>{c.value!==e&&(c.value=e,(0,l.S)())},m=t.value?()=>{}:a=>{0===c.value?setTimeout((()=>{u(a.height)}),e.delay??1200):u(a.height)};return{cardHeight:r,tableProps:d,onRectUpdate:m,rectHeight:c,cardFlexClass:i,cardProps:s}};a["Z"]=r},52140:function(e,a,t){t.d(a,{S:function(){return n},n:function(){return o}});const n=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},o=()=>{const{width:e,height:a}=document.body.getBoundingClientRect();return{width:e,height:a}}}}]);