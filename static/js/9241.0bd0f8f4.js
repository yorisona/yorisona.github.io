"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[9241],{96815:function(e,t,a){a.r(t),a.d(t,{default:function(){return D}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-customer-list-company-list-page flex-auto"},[a("tg-card",{attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[a("el-form",{attrs:{size:"small","show-message":!1,"label-width":"70px"},nativeOn:{submit:function(t){return t.preventDefault(),e.onFilterFormSubmit.apply(null,arguments)}}},[a("div",{staticClass:"filter-form-div"},[a("div",{staticClass:"filter-form-item"},[a("el-form-item",{attrs:{label:"公司名称："}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入公司名称"},model:{value:e.filterForm.company_name,callback:function(t){e.$set(e.filterForm,"company_name",t)},expression:"filterForm.company_name"}})],1)],1),a("div",{staticClass:"filter-form-item"},[a("el-form-item",{attrs:{label:"审核状态："}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.filterForm.verify_status,callback:function(t){e.$set(e.filterForm,"verify_status",t)},expression:"filterForm.verify_status"}},[a("el-option",{attrs:{value:"",label:"全部"}}),e._l(e.companyVerifyStatusFilter,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1)],1),a("div",{staticClass:"filter-form-item"},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"filter-form-item-btn"},[a("tg-button",{attrs:{type:"primary"},on:{click:e.reload}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)])],1)])])],1),a("tg-card",e._b({staticClass:"mgt-12",class:e.cardFlexClass,attrs:{padding:[12,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("tg-button-line",{staticClass:"flex-none",style:{padding:e.hasRightAddCompany?" 0 0 12px":" 0 0 6px"}},[e.hasRightAddCompany?a("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:e.onCreateBtnClickNew}},[e._v("新增公司")]):e._e()],1),a("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"customer-table",attrs:{stripe:"",data:e.data},on:{"selection-change":e.onSelectionChange,"row-click":e.onRowClick},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无公司数据"}})]},proxy:!0}])},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,n){return a("el-table-column",e._b({key:n},"el-table-column",t,!1))})),1),e.data.length>0?a("el-pagination",{staticClass:"flex-none",staticStyle:{margin:"8px 0"},attrs:{"current-page":e.filterForm.page_num,"page-sizes":[10,20,50,100,200],"page-size":e.filterForm.num,total:e.total,layout:"total, prev, pager, next, sizes, jumper"},on:{"size-change":e.onPageSizeChange,"current-change":e.onPageChange}}):e._e()],1),a("formDrawer",{ref:"formDrawerRef",on:{"form:submit:success":e.reload}})],1)},o=[],l=(a(26699),a(97434)),r=a(3346);const i=()=>{const e=(0,l.reactive)({company_name:"",page_num:1,num:20,verify_status:""}),t=()=>({...e}),a=()=>{e.company_name="",e.verify_status=""};return{filterForm:e,resetForm:a,getParams:t}};var s=a(52140);const c=()=>{const e=(0,l.ref)({width:0,height:0}),t=()=>{e.value=(0,s.n)()};(0,l.onMounted)((()=>{window.addEventListener("resize",t),(0,s.S)()})),(0,l.onBeforeUnmount)((()=>{window.addEventListener("resize",t)}));const a=(0,l.computed)((()=>e.value.width<1920)),n=(0,l.computed)((()=>e.value.width>=1920));return{WindowRect:e,isSmallScreen:a,isBigScreen:n}};var u=a(1763),m=a(6933),p=a.n(m),d=a(61282),h=a(21757),g=a(93573);const f=(e,t)=>{const a=c(),n=(0,h.gI)(),{hasCheckboxRight:o,hasOnlyDeleteRight:i}=t,s=(0,l.ref)([]),m=(0,l.ref)(!1),f=(0,l.ref)(0),v=(e,t)=>{const{company_name:a}=e,{is_folded:n,folded_text:o}=(0,d.zb)(a||"--",12);return t?o:n?(0,l.h)("div",{class:"company-name-line"},[(0,l.h)("el-popover",{props:{placement:"right",content:a,trigger:"hover"}},[(0,l.h)("span",{class:"company-name",slot:"reference"},[o])])]):(0,l.h)("div",{class:"company-name-line"},[(0,l.h)("span",{class:"company-name"},[o])])},y=(e,t)=>t.find((t=>t.value===e))?.label,b=(0,l.computed)((()=>[...o.value?[{type:"selection",align:"center",headerAlign:"center",width:52,selectable:i.value?e=>e.shops.length<=0:()=>!0}]:[],{label:"公司名称",prop:"company_name",minWidth:300,formatter:e=>v(e,!1)},...a.isSmallScreen.value?[]:[{label:"",width:58}],{label:"关联店铺",prop:"shops",minWidth:300,headerAlign:"left",align:"left",formatter:(e,t,a)=>0===a.length?"--":a.length<5?(0,l.h)("span",{class:"line-clamp-2"},[a.join("/")]):(0,l.h)("el-tooltip",{props:{effect:"light",popperClass:"tg-tooltip-theme",placement:"right"}},[(0,l.h)("div",{slot:"content"},a.map((e=>(0,l.h)("div",[e])))),(0,l.h)("span",{class:"shop-names line-clamp-2"},[a.slice(0,5).join("/")])])},{label:"录入人",prop:"add_by",minWidth:120,align:"center",formatter:(e,t,a)=>a??"--"},{label:"录入日期",prop:"gmt_create",minWidth:220,align:"center",formatter:(e,t,a)=>p()(a).format("YYYY.MM.DD HH:mm:ss")},{label:"审核状态",prop:"verify_status",minWidth:120,align:"left",formatter:(e,t,a)=>{let n="point ";return n+=-1===a?" block":1===a?" success":2===a?" not-commit":" process",(0,l.h)("div",{attrs:{class:"co-status"}},[(0,l.h)("p",{attrs:{class:n}}),(0,l.h)("span",{},y(a,g.Fx))])}},{label:"操作",prop:"add_by",minWidth:120,align:"left",formatter:t=>(0,l.h)("div",{class:"operation"},[(0,l.h)("a",["查看"]),(-1===t.verify_status||2===t.verify_status)&&n.company_edit&&(0,l.h)("a",{on:{click:a=>{a.stopPropagation(),e.root.$router.push({name:u.Ou.companyEdit,params:{id:t.id+""}})}}},["编辑"])])}])),_=async e=>{m.value=!0;const{data:t}=await(0,r.kg)(e);m.value=!1,s.value.splice(0,s.value.length),t.success?(s.value.push(...t.data.data),f.value=t.data.total):f.value=0},C=(0,l.ref)([]),w=e=>{C.value=e},x=(0,l.computed)((()=>C.value.length)),k=t=>{e.root.$router.push({name:u.Ou.companyDetail,params:{id:`${t.id}`}})};return{...a,columns:b,data:s,loading:m,total:f,loadData:_,selectionList:C,onSelectionChange:w,selectionCount:x,onRowClick:k,hasCheckboxRight:o}};var v=a(64236),y=a(3897),b=a(10762),_=a(74750),C=a(82741),w=a(7164),x=a(58302),k=a(44928),S=(0,l.defineComponent)({name:"TgCustomerCompany",components:{formDrawer:w.Z},setup(e,t){const a=(0,k.t)(),n=(0,l.computed)((()=>[u.Ou.list,u.Ou.listTab].includes(t.root.$route.name??""))),o=(0,y.R)(t),{filterForm:s,resetForm:c,getParams:m}=i(),{loadData:p,...d}=f(t,o),h=async e=>{await p(e)},w=async(e=!0)=>{e&&(s.page_num=1);const t={...m()};h(t)},S=async()=>{c(),await w()},R=e=>{s.num=e,w()},F=e=>{s.page_num=e,w(!1)},P=()=>{w(!0)};(0,l.onActivated)((()=>{const e={...m()};h(e)})),(0,l.onBeforeMount)((()=>{S()}));const D=async()=>{if(0===d.selectionCount.value)return!1;if(!o.hasOnlyDeleteRight.value&&d.selectionList.value.filter((e=>e.shops.length>0)).length>0)return void t.root.$SimpleTDialog("选择的公司中包含关联店铺的数据，不允许删除");const e=await(0,C.I)(t,"删除后数据无法恢复，是否继续操作？");if(!e)return!1;const{data:a}=await(0,r.Ou)({ids:d.selectionList.value.map((e=>e.id))});a.success?(t.root.$message.success("删除成功"),await w()):t.root.$message.error(a.message??"删除失败")},O=()=>{const e=(0,v.$D)((0,v.jG)({ids:d.selectionList.value.map((e=>e.id)).join(","),company_name:s.company_name,Authorization:(0,_.LP)()})).toString(),t=b.bq+"?"+e;(0,v.qz)("https://data.goumee.com"+t)},z=(0,l.computed)((()=>n.value&&(o.hasRightAddCompany.value||o.hasRightExportCompany.value||o.hasRightDelCompany.value))),B=(0,l.ref)(null),E=()=>{B.value?.open()},M=()=>{a.push({name:u.Ou.companyAdd})},$=32,A=46,T=30,H=12,L=(0,l.ref)(0),N=e=>{L.value=e.height},W=(0,x.Z)({compensation:$+A+T+H,fixedBlockHeightRefs:[L],pagename:"customer_company"}),Z=[{label:"审核中",value:String(g.PM.PENDING)},{label:"已通过",value:String(g.PM.APPROVED)},{label:"未通过",value:String(g.PM.NOT_APPROVED)},{label:"未提交",value:String(g.PM.NOT_COMMIT)}];return{showOperationButton:n,filterForm:s,reload:w,reset:S,onPageSizeChange:R,onPageChange:F,onFilterFormSubmit:P,...d,onDeleteBtnClick:D,onCreateBtnClick:E,onCreateBtnClickNew:M,exportCompany:O,...o,button_show_all:z,formDrawerRef:B,...W,onTopCardRectUpdate:N,companyVerifyStatusFilter:Z}}}),R=S,F=a(1001),P=(0,F.Z)(R,n,o,!1,null,null,null),D=P.exports},58302:function(e,t,a){var n=a(97434),o=a(77944),l=a(52140);const r=e=>{const t=(0,n.computed)((()=>o.Z.getters["global/scrollbarSetting"])),a=(0,n.computed)((()=>void 0!==e.pagename?!0!==t.value.find((t=>t.key===e.pagename))?.value:e.disable??!1)),r=(0,n.computed)((()=>{const t=(e.fixedBlockHeightRefs??[]).map((e=>(0,n.unref)(e))).reduce(((e,t)=>(0,n.unref)(e)+(0,n.unref)(t)),0);return a.value?"max-content":`calc(100vh - ${(0,n.unref)(t)+56+36}px)`})),i=(0,n.computed)((()=>(a.value,"flex-auto"))),s=(0,n.computed)((()=>({height:r.value,overflowInBody:!a.value}))),c=(0,n.ref)(0),u=(0,n.computed)((()=>a.value?{}:{height:Math.max(c.value-(0,n.unref)((0,n.unref)(e.compensation)),e.tableMinHeight??0)})),m=a.value?()=>{}:e=>{c.value!==e&&(c.value=e,(0,l.S)())},p=a.value?()=>{}:t=>{0===c.value?setTimeout((()=>{m(t.height)}),e.delay??1200):m(t.height)};return{cardHeight:r,tableProps:u,onRectUpdate:p,rectHeight:c,cardFlexClass:i,cardProps:s}};t["Z"]=r},44928:function(e,t,a){a.d(t,{t:function(){return o}});var n=a(86834);const o=()=>{const e=new Proxy({},{get(e,t){return Reflect.get(n.Z,t)}});return e}},52140:function(e,t,a){a.d(t,{S:function(){return n},n:function(){return o}});const n=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},o=()=>{const{width:e,height:t}=document.body.getBoundingClientRect();return{width:e,height:t}}}}]);