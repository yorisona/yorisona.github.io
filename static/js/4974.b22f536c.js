(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[4974],{28645:function(e,t,a){"use strict";a.d(t,{Z:function(){return G}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"invoice-upload-dialog"},[a("el-dialog",{staticClass:"tg-dialog-classic upload-dialog-box",attrs:{title:"上传发票",visible:e.visible,width:"552px","destroy-on-close":"","close-on-click-modal":!1},on:{close:e.cancel}},[a("tg-block",{staticClass:"flex-none",staticStyle:{height:"48px"},attrs:{bodyStyle:{padding:"0"}}},[a("tg-tabs",{attrs:{tabs:e.tabs,bottom:""},model:{value:e.checkedTab,callback:function(t){e.checkedTab=t},expression:"checkedTab"}})],1),"computer"===e.checkedTab?a("computer",{ref:"invoicePcUploadPef",attrs:{type:e.baseType}}):a("iphone",{ref:"invoiceIphoneUploadPef",attrs:{baseType:e.baseType,projectType:e.projectType,baseInfo:e.baseInfo}}),"computer"===e.checkedTab?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("tg-button",{staticClass:"mgr-18",attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),a("tg-button",{attrs:{type:"primary",size:"small"},on:{click:e.submit}},[e._v("提 交")])],1):e._e()],1),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"正在保存，请稍候..."}})],1)},n=[],o=a(97434),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"invoice-pc-upload-wrapper"},[a("div",{staticClass:"invoice-total-amount"},[a("span",{staticClass:"amount-label"},[e._v("已上传发票金额：")]),a("span",{staticClass:"amount-value"},[e._v(e._s(e.total_invoice_amount_str))])]),a("el-form",{ref:"uploadRef",staticClass:"upload-invoice-form",attrs:{model:e.uploadForm,"label-width":"100px"}},[a("div",{staticClass:"list-form-box"},e._l(e.uploadForm.list,(function(t,i){return a("div",{key:i,class:e.invoiceListItemActiveIndex===i?"list-form-item list-form-item-active":"list-form-item",staticStyle:{"margin-top":"8px"},on:{paste:function(t){return e.handlePaste(t,i)},click:function(t){t.stopPropagation(),e.invoiceListItemActiveIndex=i}}},[e.uploadForm.list.length>1?a("el-button",{staticClass:"form-item-close",attrs:{icon:"el-icon-close",circle:""},on:{click:function(t){return e.deleteUploadItemBtn(i)}}}):e._e(),a("el-form-item",{attrs:{prop:"list."+i+".show_url",label:"发票截图：",size:"medium","label-width":"84px",rules:{required:!0,message:"请上传发票截图",trigger:["change","blur"]}}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","http-request":e.uploadImage.bind(this,i,!1),"before-upload":e.beforeAvatarUpload,"show-file-list":!1,accept:".jpeg,.jpg,.png,.pdf"}},[t.show_url&&t.show_url.includes(".pdf")?a("tg-icon",{staticStyle:{"font-size":"90px"},attrs:{name:"ico-pdf"}}):t.show_url?a("img",{staticClass:"avatar",attrs:{src:t.show_url}}):a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"avatar-uploader-icon"},[a("i",{staticClass:"el-icon-plus"}),a("p",[e._v("上传发票")])]),a("div",{staticStyle:{position:"absolute",left:"120px",top:"32px",color:"rgb(164, 178, 194)",width:"300px","text-align":"left"}},[e._v(" 支持pdf，图片格式发票上传 ")]),a("div",{staticClass:"el-upload__tip",staticStyle:{"line-height":"16px",color:"#a4b2c2"},attrs:{slot:"tip"},slot:"tip"},[e._v(" 选中灰色区域，粘贴（ctrl+V）添加图片 ")])],1)],1),a("div",{staticClass:"form-flex"},[a("el-form-item",{staticClass:"flex-item",attrs:{label:"购买方：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"请输入购买方"},model:{value:t.buyer_name,callback:function(a){e.$set(t,"buyer_name","string"===typeof a?a.trim():a)},expression:"item.buyer_name"}})],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"销售方：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:1===t.type,placeholder:"请输入销售方"},nativeOn:{paste:function(e){e.stopPropagation()}},model:{value:t.seller_name,callback:function(a){e.$set(t,"seller_name","string"===typeof a?a.trim():a)},expression:"item.seller_name"}})],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"发票号码：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"请输入8位发票号码"},model:{value:t.invoice_number,callback:function(a){e.$set(t,"invoice_number","string"===typeof a?a.trim():a)},expression:"item.invoice_number"}})],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"开票时间：",size:"medium"}},[a("el-date-picker",{staticStyle:{width:"150px"},attrs:{disabled:"",type:"date",placeholder:"请选择时间","value-format":"yyyy-MM-dd"},model:{value:t.invoice_date,callback:function(a){e.$set(t,"invoice_date",a)},expression:"item.invoice_date"}})],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"开票金额：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"请输入"},model:{value:t.total_amount,callback:function(a){e.$set(t,"total_amount","string"===typeof a?a.trim():a)},expression:"item.total_amount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"税率：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"税率",maxlength:"100",clearable:""},model:{value:t.tax_rate,callback:function(a){e.$set(t,"tax_rate","string"===typeof a?a.trim():a)},expression:"item.tax_rate"}},[a("template",{slot:"append"},[e._v("%")])],2)],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"税额：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"请输入"},model:{value:t.tax_amount,callback:function(a){e.$set(t,"tax_amount","string"===typeof a?a.trim():a)},expression:"item.tax_amount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"不含税金额：",size:"medium"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{disabled:"",placeholder:"请输入"},model:{value:t.tax_excluded_amount,callback:function(a){e.$set(t,"tax_excluded_amount","string"===typeof a?a.trim():a)},expression:"item.tax_excluded_amount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("el-form-item",{staticClass:"flex-item",attrs:{label:"发票类型：",size:"medium"}},[a("el-select",{staticStyle:{width:"150px"},attrs:{disabled:""},model:{value:t.invoice_type,callback:function(a){e.$set(t,"invoice_type",a)},expression:"item.invoice_type"}},[a("el-option",{attrs:{label:"销售发票",value:1}}),a("el-option",{attrs:{label:"采购发票",value:2}})],1)],1)],1)],1)})),0)]),a("tg-ghost-button",{staticClass:"add-upload-form-btn",on:{click:e.addUploadItemBtn}},[e._v("点击添加")])],1)},s=[],r=(a(26699),a(64236)),c=a(34137),u=a(57325),p=a(6933),m=a.n(p),d=a(69706),f=a.n(d),v=a(61282),_=(0,o.defineComponent)({props:{type:Number},setup(e,t){const a=(0,o.ref)(!1),i=(0,o.reactive)({list:[{id:"",buyer_name:"",seller_name:"",invoice_date:"",invoice_number:"",tax_rate:"",tax_amount:"",total_amount:"",tax_excluded_amount:"",invoice_type:"",invoice_pic_url:"",show_url:"",type:1}]}),n=(0,o.ref)(void 0);function l(e){i.list.splice(e,1)}function s(){n.value=void 0}function p(){i.list.push({id:"",buyer_name:"",seller_name:"",invoice_date:"",invoice_number:"",tax_rate:"",tax_amount:"",total_amount:"",tax_excluded_amount:"",invoice_type:"",invoice_pic_url:"",show_url:"",type:1})}function d(e){const a=e.size/1024/1024<20;return["image/jpeg","image/jpg","image/png","application/pdf"].includes(e.type)||[".jpg",".jpeg",".png",".pdf"].includes((0,r.mD)(e.name))?!!a||(t.root.$message.error("上传图片大小不能超过 20MB!"),!1):(t.root.$message.warning("文件格式不正确，请使用 png / jpg / jpeg / pdf"),!1)}async function _(n,o,l){const s=i.list.map((e=>({...e}))),p=new FormData;p.append("file",l.file),a.value=!0;const[{data:d}]=await Promise.all([await(0,c.vf)(p),await(0,r._v)(500)]);if(a.value=!1,d.success){const a=d.data,l=2===e.type&&1===a.agent_mark&&2===a.invoice_type?2:1;s[n].show_url=(0,u.W)(a.invoice_pic_url,!1),s[n].invoice_pic_url=a.invoice_pic_url,s[n].id=a.id,s[n].buyer_name=a.buyer_name,s[n].seller_name=a.seller_name,s[n].invoice_number=a.invoice_number,s[n].invoice_date=m()(1e3*a.invoice_date).format("YYYY-MM-DD"),s[n].tax_rate=a.tax_rate,s[n].tax_amount=a.tax_amount,s[n].total_amount=a.total_amount,s[n].tax_excluded_amount=a.tax_excluded_amount,s[n].invoice_type=a.invoice_type,s[n].type=l,i.list=s,o&&t.root.$message.success("粘贴成功！")}else t.root.$message.error(d.message)}function b(e,a){const i=(e.clipboardData||window.clipboardData)?.items;let n=null;if(!i||0===i.length)return void t.root.$message.error("当前浏览器不支持本地");for(let t=0;t<i.length;t++)if(console.log(i[t]),-1!==i[t].type.indexOf("image")||-1!==i[t].type.indexOf("pdf")){n=i[t].getAsFile();break}if(!n)return void t.root.$message.error("粘贴内容非图片或pdf文件");const o=new FileReader;o.onload=()=>{},o.readAsDataURL(n),n&&d(n)&&_(a,!0,{file:n})}const g=(0,o.computed)((()=>{const e=i.list.reduce(((e,t)=>e.add(new(f())(t.total_amount?t.total_amount:0))),new(f())(0)).toString();return(0,v.FU)(e)}));function y(){return i.list}return{loading:a,uploadForm:i,invoiceListItemActiveIndex:n,clearInvoiceListItemActiveIndex:s,deleteUploadItemBtn:l,beforeAvatarUpload:d,handlePaste:b,uploadImage:_,addUploadItemBtn:p,getData:y,total_invoice_amount_str:g}}}),b=_,g=a(1001),y=(0,g.Z)(b,l,s,!1,null,null,null),h=y.exports,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("qrcode-vue",{staticStyle:{width:"300px",margin:"60px auto 20px"},attrs:{value:e.baseUrl,size:300,level:"H"}}),a("p",{staticStyle:{"padding-bottom":"80px","text-align":"center","font-size":"16px",color:"#6a7b92"}},[e._v(" 使用微信扫描二维码在手机端拍照上传发票 ")])],1)},w=[],k=a(11947),C=a(74750),$=(0,o.defineComponent)({components:{QrcodeVue:k["default"]},props:["baseType","projectType","baseInfo"],setup(e,t){const a=(0,C.LP)(),i=(0,o.ref)(""),n=t=>(i.value+=1===t?`upload?id=${e.baseInfo.id}&company=${e.baseInfo.company}&total_amount=${e.baseInfo.total_amount}&jwt=${a}`:`cost?id=${e.baseInfo.id}&company=${e.baseInfo.company}&project_type=${e.projectType}&jwt=${a}`,i.value=encodeURI(i.value),i.value);return i.value="https://m.goumee.com/",n(e.baseType),{baseUrl:i}}}),S=$,I=(0,g.Z)(S,x,w,!1,null,null,null),j=I.exports,T=a(82741),z=a(23812),P=a(76771),U=(0,o.defineComponent)({components:{computer:h,iphone:j},setup(e,t){const a=(0,o.ref)(!1),i=(0,o.ref)(!1),n=(0,o.ref)(1),l=(0,o.ref)(void 0),s=(0,o.ref)("computer"),c=(0,o.reactive)({id:0,company:"",total_amount:0}),u=(0,o.ref)(null),p=(0,z.pK)((0,o.computed)((()=>{const e=[{label:"手机拍照上传",value:"iphone"},{label:"上传发票截图",value:"computer"}];return e})),s.value),m=(e,t=1,a)=>{n.value=t,i.value=!0,c.id=e.id,c.total_amount=e.total_amount,c.company=e.company,l.value=a},d=()=>{i.value=!1},f=async e=>{const a=e.every((e=>e.buyer_name.replace("(","（").replace(")","）")===c.company.replace("(","（").replace(")","）")));if(!a){const e=await(0,T.I)(t,"上传发票与发票申请中信息不一致，是否继续上传?");return e}return!0},v=async e=>{const a=e.find((e=>e.seller_name!==c.company));if(a){const e=await(0,T.I)(t,{title:"",content:()=>(0,o.h)("div",{style:{lineHeight:"20px",fontSize:"16px",color:"#3c5269",fontWeight:500}},[(0,o.h)("div",["上传的发票销售方与结算单供应商不一致"]),(0,o.h)("div",["是否继续上传?"])])});return e}return!0},_=async()=>{const e=u.value?.getData(),o=[],s=[];if(1===n.value){if(e.map((e=>{e.id&&o.push(e.id)})),0===o.length)return t.root.$message.warning("请先上传发票"),!1;const a=await f(e);if(!a)return!1}else if(2===n.value){if(e.map((e=>{e.id&&s.push({id:e.id,seller_name:e.seller_name})})),0===s.length)return t.root.$message.warning("请先上传发票"),!1;const a=await v(e);if(!a)return!1}a.value=!0;const[{data:p}]=await(0,r.Dc)(500,1===n.value?(0,P.fh)({approval_info_id:c.id,invoice_tmp_ids:o}):(0,P.yi)({settlement_id:c.id,invoice_tmp_infos:s},l.value));a.value=!1,p.success?(i.value=!1,t.emit("success"),t.root.$message.success("发票上传成功")):t.root.$message({type:"error",message:p.message??"上传失败，稍后重试",duration:2e3,showClose:!0})};return{saveLoading:a,visible:i,invoicePcUploadPef:u,cancel:d,submit:_,currentTab:s,show:m,baseType:n,baseInfo:c,projectType:l,...p}}}),A=U,D=(0,g.Z)(A,i,n,!1,null,null,null),G=D.exports},76771:function(e,t,a){"use strict";a.d(t,{DG:function(){return c},KS:function(){return f},PQ:function(){return v},W_:function(){return u},fh:function(){return m},lj:function(){return p},nW:function(){return r},yi:function(){return d}});var i=a(76012),n=a(50709),o=a(64236),l=a(14239),s=a(29625);const r=async e=>(0,i.dX)(n._2,{params:{...(0,o.jG)(e)}}),c=async e=>(0,i.dX)(n.HW,{params:{...(0,o.jG)(e)}}),u=async(e,t)=>(0,i.dX)("income"===e?l.g9:l.QT,{params:{...(0,o.jG)(t)}}),p=async e=>(0,i.SO)(n.gh,{invoice_status:2,...(0,o.jG)(e)}),m=async e=>(0,i.SO)(n.EN,{...(0,o.jG)(e)}),d=async(e,t)=>{switch(t){case s.kA.live:return(0,i.SO)(l.PS,{...(0,o.jG)(e)});case s.kA.common_business:return(0,i.SO)(l._J,{...(0,o.jG)(e)});case s.kA.marketing:return(0,i.SO)(l.Iq,{...(0,o.jG)(e)});default:return(0,i.SO)(l.PS,{...(0,o.jG)(e)})}},f=async e=>(0,i.SO)(n.AY,{...(0,o.jG)(e)}),v=async(e,t)=>(0,i.SO)(n.Dl,{invoice_id:e,write_off_list:t})},87843:function(e,t,a){"use strict";var i;a.d(t,{iO:function(){return i},sX:function(){return l},vC:function(){return n}}),function(e){e[e["write_off_none"]=0]="write_off_none",e[e["write_off_part"]=1]="write_off_part",e[e["write_off_all"]=2]="write_off_all"}(i||(i={}));const n=new Map([[i.write_off_none,"未核销"],[i.write_off_part,"部分核销"],[i.write_off_all,"已核销"]]);var o;(function(e){e[e["marketing"]=1]="marketing",e[e["tabao_live"]=2]="tabao_live",e[e["douyin_live"]=3]="douyin_live",e[e["mcn"]=4]="mcn",e[e["area"]=5]="area"})(o||(o={}));const l=[{label:"营销业务",value:"1"},{label:"抖音店播",value:"3"},{label:"淘宝店播",value:"2"},{label:"S2B2C",value:"4"},{label:"区域业务",value:"5"}]},23812:function(e,t,a){"use strict";a.d(t,{GQ:function(){return s},YE:function(){return o},cY:function(){return r},pK:function(){return l}});var i=a(97434),n=a(44928);const o=(e,t)=>({tabs:(0,i.reactive)([...e]),checkedTab:(0,i.ref)(t??(e.length<1?"":e[0].value))}),l=(e,t)=>{const a=(0,i.isRef)(e)?e:(0,i.ref)(e),n=(0,i.isRef)(t)?(0,i.unref)(t):t,o=a.value.length<1?"":a.value[0].value,l=(0,i.ref)(n??o);return{tabs:a,checkedTab:l}},s=(e,t,a)=>{const n=(0,i.reactive)([...t]),o=(0,i.ref)(a??(t.length<1?"":`${t[0].value}`)),l=t=>{e.root.$router.push({path:e.root.$route.path,query:{tab:`${t.value}`}})};return(0,i.onBeforeMount)((()=>{const i=e.root.$route.query.tab;o.value="string"===typeof i?i:a??(t.length<1?"":`${t[0].value}`)})),{tabs:n,checkedTab:o,onTabChange:l}},r=(e,t)=>{const a=(0,i.reactive)([...e]),o=(0,i.ref)(t??(e.length<1?"":`${e[0].value}`)),l=(0,n.t)(),s=e=>{const t=l.currentRoute,a={...t.params,tab:e.value};l.push({name:t.name,params:a})};return o.value=l.currentRoute.params.tab||t||o.value,{tabs:a,checkedTab:o,onTabChange:s}}},69706:function(e,t,a){e.exports=a(70680)(29887)},11947:function(e,t,a){e.exports=a(70680)(69574)}}]);