"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[6681],{91660:function(t,a,e){e.d(a,{Z:function(){return u}});var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return void 0!==t.approval?s("el-dialog",{staticClass:"customer-dialog workbench-dialog refund-detail-dialog tg-dialog-vcenter",attrs:{visible:t.visible,"append-to-body":!0,width:"800px","close-on-click-modal":!1},on:{close:t.close},scopedSlots:t._u([{key:"title",fn:function(){return[s("span",[t._v("退款申请详情")])]},proxy:!0},{key:"footer",fn:function(){return[t.revocationVisiable&&1===t.approval.approval_status?s("tg-button",{on:{click:t.revocation}},[t._v("撤销")]):t._e(),t.btnVisiable&&1===t.approval.approval_status?s("tg-button",{attrs:{type:"primary"},on:{click:t.refuse}},[t._v("拒绝")]):t._e(),t.btnVisiable&&1===t.approval.approval_status?s("tg-button",{attrs:{type:"primary"},on:{click:t.agree}},[t._v("同意")]):t._e(),s("el-dialog",{staticClass:"userinfo-customer-dialog",attrs:{visible:t.approvalDialogVisible,width:"460px","close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{close:function(a){t.approvalDialogVisible=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-header"},[t._v("拒绝理由")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-footer"},[s("el-button",{staticClass:"big-button",attrs:{size:"small",plain:""},on:{click:function(a){t.approvalDialogVisible=!1}}},[t._v("取消")]),s("el-button",{staticClass:"btn-blue big-button",attrs:{size:"small",type:"primary"},on:{click:t.handleApprovalSubmitClick}},[t._v("保存")])],1)]},proxy:!0}],null,!1,1298338994)},[s("div",{staticClass:"approval-content"},[s("p",{staticStyle:{"text-align":"left",color:"#333","margin-bottom":"10px"}},[t._v("填写理由:")]),s("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:3,maxlength:30,placeholder:"请输入不超过30个字符"},model:{value:t.remark,callback:function(a){t.remark=a},expression:"remark"}})],1)])]},proxy:!0}],null,!1,714291252)},[void 0!==t.approval?s("div",{staticStyle:{"padding-left":"5px","padding-right":"5px"}},[s("div",{staticClass:"main-header"},[s("div",{staticClass:"from-header-box"},[s("div",{staticClass:"from-header"},[s("span",[t._v("申请人:")]),s("span",[t._v(t._s(t.approval.username))])]),s("div",{staticClass:"from-header"},[s("span",[t._v("申请部门:")]),s("span",[t._v(t._s(t.approval.create_department))])]),s("div",{staticClass:"from-header"},[s("span",[t._v("发起时间:")]),s("span",[t._v(t._s(t.approval.gmt_create))])]),s("span",{staticClass:"left_icon"},[t.revocationVisiable&&t.commitAgainVisible?s("div",{staticClass:"apply-click",on:{click:t.again}},[s("span",[s("img",{attrs:{src:e(15634)}})]),s("span",{staticClass:"hover-red"},[t._v("再次提交")])]):t._e(),s("div",{staticClass:"apply-click",on:{click:t.exportPdf}},[s("span",[s("img",{attrs:{src:e(97830)}})]),s("span",[t._v("下载PDF")])])])])]),s("tg-block",{staticClass:"title-right"},[s("span",{staticStyle:{"font-size":"16px",color:"#333"}},[t._v("审批编号:")]),s("span",{staticStyle:{color:"#333","font-weight":"600","font-size":"16px"}},[t._v(t._s(t.approval.approval_uid))]),1===t.approval.approval_status?s("span",{staticClass:"mgl-10 color-tag-processing"},[t._v("审批中")]):t._e(),2===t.approval.approval_status?s("span",{staticClass:"mgl-10 color-tag-success"},[t._v("审批成功")]):t._e(),3===t.approval.approval_status?s("span",{staticClass:"mgl-10 color-tag-failure"},[t._v("审批失败")]):t._e(),4===t.approval.approval_status?s("span",{staticClass:"mgl-10 color-tag-invalid"},[t._v("已撤销")]):t._e()]),s("tg-block",{staticClass:"main mgt-10"},[s("div",{staticClass:"main-middle"},[s("div",{staticClass:"uls"},[s("ul",[s("li",[s("span",{staticClass:"color-9"},[t._v("退款类型:")]),1===t.approval.level_two_types?s("span",[t._v("业绩退款")]):t._e()]),s("li",[s("span",{staticClass:"color-9"},[t._v("退款金额:")]),s("span",{staticStyle:{"font-weight":"600",color:"#ff731e"}},[t._v(t._s("￥"+t.approval.refund_amount_str))])]),s("li",[s("span",{staticClass:"color-9"},[t._v("关联业绩:")]),s("span",[t._v(t._s(t.approval.achievement_uid))])])]),s("ul",[s("li",[s("span",{staticClass:"color-9"},[t._v("退款方式:")]),1===t.approval.level_three_types?s("span",[t._v("V任务")]):t._e(),2===t.approval.level_three_types?s("span",[t._v("支付宝")]):t._e(),3===t.approval.level_three_types?s("span",[t._v("对公银行")]):t._e()]),s("li",[1===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("V任务id:")]),s("span",[t._v(t._s(t.approval.refund_way_detail.v_task_id))])]):t._e(),2===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("姓名:")]),t._v(" "+t._s(t.approval.refund_way_detail.name)+" ")]):t._e(),3===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("银行卡号:")]),t._v(" "+t._s(t.approval.refund_way_detail.bank_card_number)+" ")]):t._e()]),s("li",[1===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("旺旺号:")]),s("span",[t._v(t._s(t.approval.refund_way_detail.wangwang_name))])]):t._e(),2===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("账户:")]),t._v(" "+t._s(t.approval.refund_way_detail.account)+" ")]):t._e(),3===t.approval.level_three_types?s("p",[s("span",{staticClass:"color-9"},[t._v("开户行:")]),t._v(" "+t._s(t.approval.refund_way_detail.bank_of_deposit)+" ")]):t._e()])]),s("ul",[3===t.approval.level_three_types?s("li",[s("span",{staticClass:"color-9"},[t._v("公司名称:")]),t._v(" "+t._s(t.approval.refund_way_detail.company_name)+" ")]):t._e(),s("li",[s("span",{staticClass:"color-9"},[t._v("备注:")]),s("span",{staticClass:"break-all"},[t._v(t._s(t.approval.remark?t.approval.remark:"--"))])])])]),s("ul",{staticClass:"reason"},[s("span",{staticClass:"color-9"},[t._v("退款理由:")]),s("span",{staticClass:"break-all"},[t._v(t._s(t.approval.refund_reason?t.approval.refund_reason:"--"))])])])]),s("tg-block",{staticClass:"flow"},[s("el-form",[s("el-form-item",{attrs:{label:"审批流程：","label-width":"80px"}},[s("ApprovalFlow"),t._e()],1)],1)],1)],1):t._e()]):t._e()},i=[],o=(e(26699),e(97434)),l=e(51351),n=e(4249),r=e(64479),p=(0,o.defineComponent)({name:"refundDetail",props:{visible:{type:Boolean},approval:{type:Object},commitAgainVisible:{type:Boolean,default:!0}},components:{ApprovalFlow:n.Z},setup(t,a){const e=(0,o.computed)((()=>void 0===t.approval?0:[2,3].includes(t.approval.approval_status??-1)?t.approval.steps+1:t.approval.steps)),s=(0,o.computed)((()=>a.root.$store.getters["user/getUserInfo"])),i=(0,o.ref)(""),l=(0,o.computed)((()=>s.value?.id===t.approval?.add_by)),n=(0,o.computed)((()=>s.value?.id===t.approval?.now_id)),r=()=>{a.emit("loan:edit")};return{step_status:e,customerVisible:!0,approvalDialogVisible:!1,remark:i,currentUserInfo:s,revocationVisiable:l,btnVisiable:n,again:r}},methods:{close(){this.$emit("close")},exportPdf(){this.approval?.approval_id&&(0,r.m)(this.approval?.approval_id)},revocation(){this.$confirm("你确定撤销吗","提示",{confirmButtonText:"保存",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{const t={approval_id:this.approval?.approval_id,update_code:4};(0,l.qL)(t).then((t=>{t&&t.data&&t.data.success?(this.close(),this.$message.success("保存成功"),this.remark="",this.$emit("reload:refund")):this.$message.error("保存失败")}))})).catch((()=>!1))},agree(){this.$confirm("你确定同意该申请吗","提示",{confirmButtonText:"同意",cancelButtonText:"取消",type:"warning",iconClass:"success-icon"}).then((()=>{const t={approval_id:this.approval?.approval_id,update_code:2};(0,l.qL)(t).then((t=>{t&&t.data&&t.data.success?(this.close(),this.$message.success("保存成功")):this.$message.error("保存失败")}))})).catch((()=>!1))},refuse(){this.approvalDialogVisible=!0},handleApprovalSubmitClick(){const t={approval_id:this.approval?.approval_id,update_code:3,remark:this.remark};(0,l.qL)(t).then((t=>{t&&t.data&&t.data.success?(this.approvalDialogVisible=!1,this.close(),this.$message.success("保存成功"),this.remark=""):this.$message.error("保存失败")})).catch((()=>!1))}}}),c=p,_=e(1001),d=(0,_.Z)(c,s,i,!1,null,null,null),u=d.exports},86701:function(t,a,e){e.d(a,{Z:function(){return g}});var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("el-dialog",{staticClass:"sty-add-dialog tg-dialog-vcenter",attrs:{"append-to-body":!0,visible:t.customerVisible,width:"800px",top:"70px","close-on-click-modal":!1},on:{"update:visible":function(a){t.customerVisible=a},close:t.close},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"title"},[s("span",[t._v("垫款申请详情")])])]},proxy:!0},{key:"footer",fn:function(){return[t.cost_show?s("span",{staticClass:"dialog-footer"},[t.revocationVisiable()&&1===t.detail_data.approval_status?s("el-button",{staticClass:"big-button color-9",attrs:{size:"small"},on:{click:t.revocation}},[t._v("撤销")]):t._e(),t.btnVisiable()&&1===t.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-red",attrs:{type:"primary",size:"small"},on:{click:t.refuse}},[t._v("拒绝")]):t._e(),t.btnVisiable()&&1===t.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-blue",attrs:{type:"primary",size:"small"},on:{click:t.agree}},[t._v("同意")]):t._e(),s("el-dialog",{staticClass:"userinfo-customer-dialog",attrs:{visible:t.approvalDialogVisible,width:"460px","close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{close:function(a){t.approvalDialogVisible=!1}},scopedSlots:t._u([{key:"title",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-header"},[t._v("拒绝理由")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-footer"},[s("el-button",{staticClass:"big-button",attrs:{size:"small",plain:""},on:{click:function(a){t.approvalDialogVisible=!1}}},[t._v("取消")]),s("el-button",{staticClass:"btn-blue big-button",attrs:{size:"small",type:"primary"},on:{click:t.handleApprovalSubmitClick}},[t._v("确定")])],1)]},proxy:!0}],null,!1,3210623043)},[s("div",{staticClass:"approval-content"},[s("p",{staticStyle:{"text-align":"left",color:"#333","margin-bottom":"10px"}},[t._v("填写理由:")]),s("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:1,maxlength:30,placeholder:"请输入不超过30个字符"},model:{value:t.remark,callback:function(a){t.remark=a},expression:"remark"}})],1)]),s("application-dialog",{ref:"ApplicationDialog",on:{"update-info":t.updateInfo,reloadTable:t.reloadList}})],1):t._e()]},proxy:!0}])},[s("div",{staticClass:"main"},[s("div",{staticClass:"main-header"},[s("div",{staticClass:"from-header-box"},[s("div",{staticClass:"from-header"},[s("span",[t._v("申请人:")]),s("span",[t._v(t._s(t.detail_data.username))])]),s("div",{staticClass:"from-header"},[s("span",[t._v("申请部门:")]),s("span",[t._v(t._s(t.detail_data.create_department))])]),s("div",{staticClass:"from-header"},[s("span",[t._v("发起时间:")]),s("span",[t._v(t._s(t.detail_data.gmt_create))])]),s("span",{staticClass:"left_icon"},[t.revocationVisiable()&&t.commitAgainVisible?s("div",{staticClass:"apply-click",on:{click:t.again}},[s("span",[s("img",{attrs:{src:e(15634)}})]),s("span",{staticClass:"hover-red"},[t._v("再次提交")])]):t._e(),s("div",{staticClass:"apply-click",on:{click:t.exportPdf}},[s("span",[s("img",{attrs:{src:e(97830)}})]),s("span",[t._v("下载PDF")])])])]),s("div",{staticClass:"title-right"},[s("span",{staticStyle:{"font-size":"16px",color:"#333","font-weight":"600"}},[t._v("审批编号：")]),s("span",{staticStyle:{color:"#333","font-weight":"600","font-size":"16px"}},[t._v(t._s(t.detail_data.approval_uid))]),s("span",{class:"status-color status-color-"+t.detail_data.approval_status},[1===t.detail_data.approval_status?s("span",{staticClass:"approver-state"},[t._v("审批中")]):t._e(),2===t.detail_data.approval_status?s("span",{staticClass:"approver-state"},[t._v("审批成功")]):t._e(),3===t.detail_data.approval_status?s("span",{staticClass:"approver-state"},[t._v("审批失败")]):t._e(),4===t.detail_data.approval_status?s("span",{staticClass:"approver-state"},[t._v("已撤销")]):t._e()])])]),s("div",{staticClass:"main-middle"},[s("div",{staticClass:"uls"},[s("ul",[s("li",[s("span",{staticClass:"color-6"},[t._v("垫款类型：")]),s("span",{staticClass:"color-3"},[t._v(t._s(1===t.detail_data.level_two_types?"成本安排":"--"))])]),s("li",[s("span",{staticClass:"color-6"},[t._v("垫款金额(元)：")]),s("span",{staticStyle:{"font-weight":"600",color:"#ff731e"}},[t._v(t._s("￥"+t.detail_data.borrowing_amount_str))])]),s("li",[s("span",{staticClass:"color-6"},[t._v("客户(公司)名称：")]),s("span",{staticClass:"color-3"},[t._v(t._s(t.detail_data.company_name))])]),s("li",[s("span",{staticClass:"color-6",staticStyle:{cursor:"pointer"}},[t._v("关联客户合同：")]),s("span",{staticClass:"color-blue",staticStyle:{cursor:"pointer"},on:{click:function(a){return t.handleClick(t.detail_data.contract_id)}}},[t._v(t._s(t.detail_data.contract_uid))])])]),s("ul",[s("li",[s("span",{staticClass:"color-6"},[t._v("回款时间：")]),s("span",{staticClass:"color-3"},[t._v(t._s(t.detail_data.back_date?t.detail_data.back_date:"--"))])]),s("li",[s("span",{staticClass:"color-6"},[t._v("回款销售金额(元)：")]),s("span",{staticStyle:{"font-weight":"600",color:"#ff731e"}},[t._v(t._s(t.detail_data.back_amount_str?"￥"+t.detail_data.back_amount_str:"--"))])]),s("li",[s("span",{staticClass:"color-6"},[t._v("备注：")]),s("span",{staticClass:"break-all color-3"},[t._v(t._s(t.detail_data.remark?t.detail_data.remark:"--"))])])])]),s("div",{staticClass:"reason"},[s("span",{staticClass:"color-6"},[t._v("垫款理由：")]),s("span",{staticClass:"break-all"},[t._v(t._s(t.detail_data.borrowing_reason?t.detail_data.borrowing_reason:"--"))])])]),s("div",{staticClass:"main-footer"},[s("span",{staticClass:"title-text"},[t._v("附件")]),t.detail_data&&0!==t.detail_data.borrowing_apply_annex_list.length?s("div",{staticClass:"uploaded-list"},t._l(t.detail_data.borrowing_apply_annex_list,(function(a,e){return s("span",{key:e,staticStyle:{"margin-right":"10px","line-height":"30px"}},[s("a",{staticClass:"annex-list",staticStyle:{cursor:"pointer"},attrs:{target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.preview(a)}}},[s("i",{staticClass:"iconfont icon-xiangqingyefujian"}),a?s("span",{staticClass:"uploaded-attachment-name"},[t._v(t._s(decodeURIComponent(a.split("/")[a.split("/").length-1]||"--")))]):t._e()])])})),0):s("span",{staticStyle:{color:"#c8cacc","margin-left":"10px"}},[t._v("未上传附件")]),s("p",{staticStyle:{height:"1px",background:"#f0f3f4",margin:"15px"}}),s("span",{staticClass:"title-text"},[t._v("图片")]),t.detail_data&&0!==t.detail_data.borrowing_apply_photo_list.length?s("div",{staticClass:"uploaded-list"},t._l(t.detail_data.borrowing_apply_photo_list,(function(a,e){return s("span",{key:e,staticClass:"img-list",staticStyle:{"margin-right":"10px","line-height":"30px"}},[s("a",{staticStyle:{cursor:"pointer"},attrs:{target:"_blank"},on:{click:function(e){return e.stopPropagation(),t.preview(a)}}},[s("img",{staticStyle:{"max-height":"70px"},attrs:{src:a+"?Authorization="+t.getToken()}})])])})),0):s("span",{staticStyle:{color:"#c8cacc","margin-left":"10px"}},[t._v("未上传图片")])])]),s("div",{staticClass:"flow",staticStyle:{"padding-left":"18px"}},[s("div",{staticClass:"invoice-info-title"},[t._v("审批流程")]),t.steps.length>0?s("tg-steps",{attrs:{direction:"vertical",steps:t.steps,active:t.activeNumber}}):s("span",[t._v("--")])],1)])},i=[],o=(e(26699),e(61871)),l=e(66117),n=e(74750),r=e(57325),p=e(1763),c=e(64479),_=e(32622),d=e(51351),u={components:{ApplicationDialog:o.Z},name:"applicationDetail",setup(t,a){return{...(0,_.o)(a)}},data(){return{getToken:n.LP,cost_show:!0,step_status:0,detail_data:"",customerVisible:!1,approvalDialogVisible:!1,commitAgainVisible:!0,remark:""}},async mounted(){this.currentUserInfo=this.$store.getters["user/getUserInfo"]},methods:{async getFlowStepData(t){const{data:a}=await(0,d.OC)({approval_id:t});a.success?this.$store.dispatch("workbench/setApproval",{...a.data}):this.$message.error(a.message??"获取审批详情失败")},handleClick(t){const a=this.$router.resolve({name:p.Z8.contract.customer.detail,params:{id:t},query:{partner_type:2}});window.open(a.href,"_blank")},updateInfo(t){},preview(t){const a=t,e=[".doc",".ppt",".xls"],s="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(this.fixFileToken(a,!1));a.includes(e[0])||a.includes(e[1])||a.includes(e[2])?window.open(s):window.open(this.fixFileToken(a,!1))},fixFileToken:r.W,reloadList(){this.$emit("reload:application")},show(t,a,e=!0){const s={};this.commitAgainVisible=e,t.approval_id?s.approval_id=t.approval_id:s.approval_uid=t.borrowing_uid,(0,l.Ec)(s).then((t=>{t&&t.data&&t.data.success&&(this.detail_data=t.data.data,this.step_status=this.detail_data.steps),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1),this.customerVisible=!0})),this.getFlowStepData(t.approval_id)},revocationVisiable(){const t=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.add_by;return t},btnVisiable(){const t=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.now_id;return t},close(){this.$emit("close")},again(){const t=this.detail_data;this.$refs.ApplicationDialog.show(t)},exportPdf(){(0,c.m)(this.detail_data.approval_id)},revocation(){this.$confirm("你确定撤销吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{const t={approval_id:this.detail_data.approval_id,update_code:4};(0,l.bM)(t).then((t=>{t&&t.data&&t.data.success?(this.close(),this.$message.success("保存成功"),this.$emit("reload:application")):this.$message.error("保存失败")}))})).catch((()=>!1))},agree(){this.$confirm("你确定同意该申请吗","提示",{confirmButtonText:"同意",cancelButtonText:"取消",type:"warning",iconClass:"success-icon"}).then((()=>{const t={approval_id:this.detail_data.approval_id,update_code:2};(0,l.bM)(t).then((t=>{t&&t.data&&t.data.success?(this.close(),this.$message.success("保存成功")):this.$message.error("保存失败")}))})).catch((()=>!1))},refuse(){this.approvalDialogVisible=!0},handleApprovalSubmitClick(){const t={approval_id:this.detail_data.approval_id,update_code:3,remark:this.remark};(0,l.bM)(t).then((t=>{t&&t.data&&t.data.success?(this.approvalDialogVisible=!1,this.close(),this.$message.success("保存成功"),this.this.remark=""):this.$message.error("保存失败")})).catch((()=>!1))}}},m=u,h=e(1001),v=(0,h.Z)(m,s,i,!1,null,"58823db0",null),g=v.exports},61871:function(t,a,e){e.d(a,{Z:function(){return h}});var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("common-dialog",{ref:"applicationDialog",staticClass:"sty-add-dialog tg-dialog-vcenter-new",attrs:{isAppendToBody:!0,title:"垫款申请单",width:800,top:70,isfooter:!0},on:{"dialog-cancel":t.handledialogCancel,"dialog-submit":t.handledialogSubmit}},[e("div",{staticClass:"warp"},[e("el-form",{ref:"application_list",attrs:{rules:t.application_list_rules,model:t.application_list,"label-width":"130px"}},[e("el-form-item",{attrs:{prop:"level_two_types",label:"垫款类型："}},[e("el-radio",{attrs:{label:1},model:{value:t.application_list.level_two_types,callback:function(a){t.$set(t.application_list,"level_two_types",a)},expression:"application_list.level_two_types"}},[t._v("成本安排")])],1),e("el-form-item",{attrs:{label:"垫款金额：",prop:"borrowing_amount"}},[e("el-input",{ref:"autoFocuseRef",attrs:{maxlength:t.inputMaxL,placeholder:"请输入垫款金额"},on:{input:function(a){return t.application_list.borrowing_amount=t.getPositiveNumber(a)}},nativeOn:{mousewheel:function(t){t.preventDefault()}},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("元")]},proxy:!0}]),model:{value:t.application_list.borrowing_amount,callback:function(a){t.$set(t.application_list,"borrowing_amount",a)},expression:"application_list.borrowing_amount"}})],1),e("el-form-item",{attrs:{label:"垫款理由：",prop:"borrowing_reason"}},[e("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入文本"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.application_list.borrowing_reason,callback:function(a){t.$set(t.application_list,"borrowing_reason","string"===typeof a?a.trim():a)},expression:"application_list.borrowing_reason"}})],1),e("el-form-item",{staticClass:"value-select",attrs:{label:"客户(公司)名称：",prop:"company_name"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请搜索并选择客户名称","remote-method":t.getAllStoreName,size:"medium"},on:{change:t.handleShopNameChange},model:{value:t.application_list.company_name,callback:function(a){t.$set(t.application_list,"company_name",a)},expression:"application_list.company_name"}},t._l(t.isShopName?t.allCompanyName:[],(function(a,s){return e("el-option",{key:s,attrs:{label:a.company_name,value:a.id}},[e("span",[t._v(t._s(a.company_name))]),e("span",{staticStyle:{color:"#999"}},[t._v(t._s(a.shop_name?"("+a.shop_name+")":"(--)"))])])})),1),""!==t.application_list.company_name?e("el-form-item",{staticClass:"v-bgc",attrs:{prop:"contract_uid","label-width":"127px"},scopedSlots:t._u([{key:"label",fn:function(){return[e("span",[t._v(" 关联客户合同: "),e("el-popover",{attrs:{placement:"top",trigger:"hover",effect:"light",content:"垫款申请需要先与客户签订合同"}},[e("template",{slot:"reference"},[e("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer","margin-right":"5px"}})])],2)],1)]},proxy:!0}],null,!1,3246628582)},[e("el-select",{staticClass:"contract_el",staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",remote:"","reserve-keyword":"","remote-method":t.getContract,placeholder:"请搜索并选择客户合同"},on:{change:function(a){return t.selectContractUidChange(a)}},model:{value:t.application_list.contract_uid,callback:function(a){t.$set(t.application_list,"contract_uid",a)},expression:"application_list.contract_uid"}},t._l(t.application_list.contractVal?t.contract_uids:[],(function(t){return e("el-option",{key:t.contract_id,attrs:{label:t.contract_uid,value:t.contract_id}})})),1)],1):t._e()],1),e("el-form-item",{attrs:{label:"回款时间：",prop:"back_date"}},[e("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"请选择回款时间","value-format":"yyyy-MM-dd"},model:{value:t.application_list.back_date,callback:function(a){t.$set(t.application_list,"back_date",a)},expression:"application_list.back_date"}})],1),e("el-form-item",{attrs:{label:"回款销售金额："}},[e("el-input",{attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",maxlength:t.inputMaxL,placeholder:"请输入回款销售金额"},on:{input:function(a){t.inputMaxL=/^\d+\.?\d{0,1}$/.test(t.application_list.back_amount)?null:t.application_list.back_amount.length-1}},nativeOn:{mousewheel:function(t){t.preventDefault()}},scopedSlots:t._u([{key:"append",fn:function(){return[t._v("元")]},proxy:!0}]),model:{value:t.application_list.back_amount,callback:function(a){t.$set(t.application_list,"back_amount",a)},expression:"application_list.back_amount"}})],1),e("el-form-item",{attrs:{label:"附件：",prop:"gather_certificate_pic"}},[e("div",[[e("el-upload",{staticClass:"upload-btn-wrap",attrs:{action:"",disabled:5===t.borrowing_apply_annex.length,"show-file-list":!1,multiple:!1,"http-request":t.uploadAttachmentFile,accept:".docx,.doc,.xlsx,.xls"}},[e("el-button",{staticClass:"upload-btns btn-blue big-button",attrs:{size:"small",type:"primary",disabled:5===t.borrowing_apply_annex.length}},[e("i",{staticClass:"iconfont icon-zhongxinshangchuan"}),t._v(" "+t._s(5===t.borrowing_apply_annex.length?"最多传5个":"上传文件")+" ")]),e("span",{staticClass:"upload-tips"},[t._v("最多上传5个文件（单个文件大小不超过30M） 支持扩展名：.docx .doc .xlsx .xls ")])],1)],e("div",{staticClass:"uploaded-list"},t._l(t.borrowing_apply_annex,(function(a,s){return e("p",{key:s,staticClass:"uploaded-name",staticStyle:{"margin-right":"10px","line-height":"30px"}},[e("i",{staticClass:"iconfont iconfujian mr5"}),a?e("span",[t._v(t._s(decodeURIComponent(a.split("/")[a.split("/").length-1]||"--")))]):t._e(),a?e("i",{staticClass:"iconfont icon-shanchu",on:{click:function(a){return t.clearUploadedFile(s)}}}):t._e()])})),0)],2)]),e("el-form-item",{attrs:{label:"图片：",prop:"gather_certificate_pic"}},[e("div",[[e("el-upload",{staticClass:"upload-btn-wrap",attrs:{action:"",disabled:5===t.borrowing_apply_photo.length,multiple:!1,"http-request":t.uploadAttachmentImg,"show-file-list":!1,accept:".jpg,.jpeg"}},[e("el-button",{staticClass:"upload-btns btn-blue big-button",attrs:{size:"small",type:"primary",disabled:5===t.borrowing_apply_photo.length}},[e("i",{staticClass:"iconfont icon-zhongxinshangchuan"}),t._v(" "+t._s(5===t.borrowing_apply_photo.length?"最多传5个":"上传图片")+" ")]),e("span",{staticClass:"upload-tips"},[e("span",[t._v("最多上传5张图片（单张图片大小不超过2M）")]),e("span",[t._v("支持扩展名：.jpg .jpeg")])])],1)],e("div",{staticClass:"uploaded-list"},t._l(t.borrowing_apply_photo,(function(a,s){return e("span",{key:s,staticClass:"img-list",staticStyle:{"margin-right":"10px","line-height":"30px"}},[e("img",{attrs:{src:a+"?Authorization="+t.getToken()}}),a?e("span",{on:{click:function(a){return t.clearUploadedImg(s)}}},[t._v("x")]):t._e()])})),0)],2)]),e("el-form-item",{attrs:{label:"备注："}},[e("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入文本"},nativeOn:{mousewheel:function(t){t.preventDefault()}},model:{value:t.application_list.remark,callback:function(a){t.$set(t.application_list,"remark","string"===typeof a?a.trim():a)},expression:"application_list.remark"}})],1)],1)],1),e("tg-mask-loading",{attrs:{visible:t.saveLoading,content:"  正在保存，请稍候..."}})],1)},i=[],o=e(66117),l=e(74750),n=e(79433),r=e(61282),p=e(97434),c=e(48606),_={name:"applicationDialog",setup(t,a){const e=(0,p.ref)(void 0);return{autoFocuseRef:e}},data(){return{loading:null,saveLoading:!1,inputMaxL:null,getToken:l.LP,isShopName:"",error_text:"",checkedIndex:"",approver_name:[],select_data:"",borrowing_apply_annex:[],borrowing_apply_photo:[],application_list:{approval_type:3,level_two_types:1,company_name:"",customer_id:"",contract_id:"",contract_uid:"",contractVal:"",borrowing_amount:"",back_amount:"",borrowing_reason:"",borrowing_apply_annex_list:"",borrowing_apply_photo_list:"",back_date:(new Date).toLocaleDateString().replace("/","-").replace("/","-"),remark:"",approval_stream:[]},allCompanyName:[],contract_uids:[],application_list_rules:{level_two_types:[{required:!0,message:"请搜索并选择垫款类型",trigger:"change"}],borrowing_amount:[{required:!0,message:"请输入垫款金额",trigger:"blur"}],borrowing_reason:[{required:!0,message:"请输入垫款理由",trigger:"blur"}],back_date:[{required:!0,message:"请选择回款时间",trigger:"blur"}],company_name:[{required:!0,message:"请搜索并选择客户名称",trigger:"change"}],contract_uid:[{required:!0,message:"请搜索并选择客户合同",trigger:"change"}]}}},activated(){this.getApprovalStreamSelect()},methods:{getPositiveNumber:r.nA,startLoading(){this.loading=c.Loading.service({lock:!0,text:"加载中……",background:"rgba(0, 0, 0, 0.7)"})},closeLoading(){this.loading.close()},getApprovalStreamSelect(){(0,o.SW)({approval_type:3}).then((t=>{t&&t.data&&t.data.success?(this.select_data=t.data.data,this.list=t.data.data):this.error_text=t.data.message}))},show(t){if(this.$refs.application_list?.resetFields(),this.getApprovalStreamSelect(),this.$refs.applicationDialog.dialogOpen(),t){this.application_list.level_two_types=t.level_two_types,this.application_list.borrowing_amount=t.borrowing_amount_str,this.application_list.borrowing_reason=t.borrowing_reason,this.application_list.company_name=t.company_name,this.application_list.customer_id=t.customer_id,this.application_list.contract_uid=t.contract_uid,this.application_list.contract_id=t.contract_id,this.application_list.back_date=t.back_date,this.application_list.back_amount=t.back_amount_str,this.borrowing_apply_annex=t.borrowing_apply_annex_list,this.borrowing_apply_photo=t.borrowing_apply_photo_list,this.application_list.remark=t.remark;const a=[];for(let e=0;e<t.approval_stream.length;e++)this.approver_name.push(t.approval_stream[e].username),a.push({index:t.approval_stream[e].index,user_id:t.approval_stream[e].user_id,role_code:t.approval_stream[e].role_code});this.application_list.approval_stream.splice(this.checkedIndex,1,...a)}else this.$nextTick((()=>{this.$refs.autoFocuseRef.focus()}))},handledialogSubmit(){this.application_list.borrowing_apply_photo_list=this.borrowing_apply_photo,this.application_list.borrowing_apply_annex_list=this.borrowing_apply_annex,this.application_list.borrowing_amount<1e5&&(6===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(4,2),5===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(4,1)),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount<5e5&&6===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(5,1),this.$refs.application_list.validate((t=>{t&&(0===this.application_list.borrowing_amount||0===this.application_list.back_amount&&""!==this.application_list.back_amount?this.$message.error("金额不得小于等于0"):(this.application_list.borrowing_amount<1e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((t=>{t.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable")):this.$message.error(t.data.message),this.saveLoading=!1}))),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount<5e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((t=>{t.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable")):this.$message.error(t.data.message),this.saveLoading=!1}))),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount>=5e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((t=>{t.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable"),this.$emit("close")):this.$message.error(t.data.message),this.saveLoading=!1})))))}))},async getAllStoreName(t){this.isShopName=t;const{data:a}=await(0,n.G7)({shop_name:t});a.success?Array.isArray(a.data)&&(this.allCompanyName=a.data):this.$message.error(a.message)},getContract(t){this.application_list.contractVal=t,(0,o.v4)({partner_type:1,contract_status:2,partner_id:this.application_list.customer_id,flag:1,search:t}).then((({data:t})=>{this.$set(this,"contract_uids",t.data.data||[])}))},getAllContractUidSelect(t){(0,o.v4)({partner_type:1,contract_status:2,flag:1}).then((t=>{t.data.data.data instanceof Array?this.contract_uids=t.data.data.data:this.$message.error(t.data.message)}))},handleShopNameChange(t){this.isShopName="",this.application_list.contract_uid="",this.application_list.contractVal="";const a=this.allCompanyName.find((a=>a.id===t));a&&(this.application_list.company_name=a.company_name,this.application_list.customer_id=a.id,this.getAllContractUidSelect(a.id))},selectContractUidChange(t){this.application_list.contractVal="";const a=this.contract_uids.find((a=>a.contract_id===t));a&&(this.application_list.contract_uid=a.contract_uid,this.application_list.contract_id=a.contract_id)},selectUserId(t,a,e){this.checkedIndex=e;let s=[];for(let l=0;l<a.length;l++)t===a[l].username&&(s={index:e,user_id:a[l].user_id,role_code:a[l].role_code});this.application_list.approval_stream.length<this.approver_name.length?this.application_list.approval_stream.push(s):this.application_list.approval_stream.splice(e,1,s);let i=this.application_list.approval_stream;function o(t){return function(a,e){return a[t]-e[t]}}i=i.sort(o("index"))},uploadAttachmentFile(t){if(t.file.size>31488e3)return void this.$message.error("单个文件大小不超过30M");const a=new FormData;a.append("file",t.file),a.append("attachment_type","borrowing_apply_annex"),this.startLoading(),(0,o.pD)(a).then((t=>{this.closeLoading(),t.data.success?(this.borrowing_apply_annex.push(t.data.data.source),this.$message.success("上传附件成功")):this.$message.error(t.data.message)})).catch((t=>{this.closeLoading(),this.$message({type:"warning",message:"上传附件失败，稍后重试",showClose:!0,duration:2e3}),console.log(t.message)}))},uploadAttachmentImg(t){const a=new FormData;a.append("file",t.file),a.append("attachment_type","borrowing_apply_photo");const e=t.file.size/1024/1024<2;(0,o.pD)(a).then((t=>{t&&t.data&&t.data.success?e?(this.borrowing_apply_photo.push(t.data.data.source),this.$message.success("上传图片成功")):this.$message.error("上传图片大小不能超过 2MB!"):this.$message.error(t.data.message)}))},clearUploadedFile(t){this.borrowing_apply_annex.splice(t,1)},clearUploadedImg(t){this.borrowing_apply_photo.splice(t,1)},handledialogCancel(){this.application_list.remark="",this.application_list.back_amount="",this.application_list.approval_stream=[],this.borrowing_apply_annex=[],this.borrowing_apply_photo=[],this.approver_name=[],this.$refs.application_list.resetFields(),this.$emit("close")}}},d=_,u=e(1001),m=(0,u.Z)(d,s,i,!1,null,"49707702",null),h=m.exports},66117:function(t,a,e){e.d(a,{D_:function(){return r},Ec:function(){return l},Lc:function(){return p},SW:function(){return i},Uj:function(){return d},bM:function(){return n},jw:function(){return o},kF:function(){return u},pD:function(){return _},v4:function(){return c}});var s=e(76012);function i(t){return(0,s.ZP)({url:"/api/approval/get_approval_stream",method:"get",params:t})}function o(t){return(0,s.ZP)({url:"/api/approval/save_transfer_apply",method:"post",data:t})}function l(t){return(0,s.ZP)({url:"/api/approval/query_approval_info",method:"get",params:t})}function n(t){return(0,s.ZP)({url:"/api/approval/update_approval_info",method:"post",data:t})}function r(t){return(0,s.ZP)({url:"/api/approval/save_refund_apply",method:"post",data:t})}function p(t){return(0,s.ZP)({url:"/api/coop/query_achievement_uid",method:"get",params:t})}function c(t){return(0,s.ZP)({url:"/api/cont/query_contract_uid",method:"get",params:t})}function _(t){return(0,s.ZP)({url:"/api/approval/upload_attachment",method:"post",data:t})}function d(t){return(0,s.ZP)({url:"/api/approval/save_invoice_apply",method:"post",data:t})}function u(t){return(0,s.ZP)({url:"/api/approval/save_borrowing_apply",method:"post",data:t})}},97830:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACNElEQVRYR+2XP2gUURCHv0mCGMU/WJgrJNroEpAUFsZLCgsFG7GwUSwsFNw71FsjRmKlQkCb7GWjEg+JhZUgNhaKhYKFXgSxsAmxUQtB0UJBxEJ98rK5u70ju/uS3ayFbnW3NzO/734z7+1bIXD1ldTmNuEysBtYHfzN9HO+hxuujY2IMsmRWtCAo6zfMAWsNUkMi8n3AELFPUbRBKIOkHfUXWB/EnGdOwugL8WEW+B4HEQQ4OtibQ9C1wH8m9dcm5NREEEAo57FOdQCoMOvuDZOGEQWAJEQWQGgwCvbDLY6kRnAXOvG3IIMBtuYOsB2C9rbwidFCeWyLadrEakDWBtg3aroURXF6GhRzugoYwArB2cPzl/4zXuoPIBP36BzGWzdBB3t0RBuQWa1jQH29ML5I9FF7z+FkTs+RPd6WLMyvB2JAL7/gHcffJiNOVixvAF28SY8fBW3W0DVS+DA5y+w70JD5PYwdOf87y+moVTJGMDZCwf08xOYfgtHxzIGuHQYdm77Sw7o4Rw61JiDyXsw+XiJHQgrb2q/zk80hPMBPHkJ527F//NaRCIAvQqGrjfEZuaWpLl8Qgdal+FChFNzILgP/AfIxIHFiETlLHgV/BMAP4GYY0RqPvyqetKhq9UPJP0lNaOELalJRBQSxetn42I1AeRLykEweJCmgKg4VR0XrwkAlOxwuCpQDDqTglywhFIwMeVxAvy353oLalF9juoV2AV0pSz+UcGj5540Hdj+AM6Q8yGdbmEzAAAAAElFTkSuQmCC"},15634:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB00lEQVRYR+3XsU7bUBTG8f8BVAlVpRUDLBXq0kZIVcdCYASp6sobdChO1BJD1YfogoMpCCEQPEHnKkNXAisbvAFj98KpTHC4Nti+dkwkpHiKcs/198u519aNYFwzDX09JPwAFoExc8z2c3WaPc/BQURt5khYNO9q5QqOgRc2E5NqqtOAsOstU7dBdAFVV38BS72EB3OvAcGl7Hg1vmQhTMDfom030V1A58ttz2ElDWECrNYsq0MxQFD+03NwkxD9AKQi+gVAwW86rMU70TfAzdJteDVZM5exdMD7CgwPJe8UFZpNR76FFaUDKi9h/Fn6VhVlfb0u34OqngCfP3aC9n7fBo4+gbevYGQ4HeHV5Dq7MCAI//ShE3LYuouYmoDnT5OXoyeAGR7+zjgi633R9gt24L7wIohCgLTwvIjcAJvwPIhcgDzhIeKgBfvG0xHfE9aAIuE2CGtA0m4+2oiOzK1m7fvo+AAw6MCgA4+/A/me+rvV93XgH5BxjOg1tjv/su3LSORAMtfQMxXelBaRciNRzo82pRI9ETXURYi9YB+Io6y2N8WPAEBl1mVLoG4e1UomqMLOsc9X6Px77p4Jw6AZV98JLACTJYdfKPw58eXUvO9/kF7RIXH89QIAAAAASUVORK5CYII="}}]);