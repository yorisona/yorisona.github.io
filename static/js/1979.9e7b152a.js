"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[1979],{61979:function(e,t,i){i.r(t),i.d(t,{default:function(){return k}});var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("TgBreadcrumbs",{attrs:{routes:e.routes}}),i("tg-card",e._b({staticClass:"tg-built-in-role-page flex-auto",attrs:{padding:[18,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[e.Permission.canViewList?i("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[i("empty-common",{attrs:{"detial-text":"暂未添加消息管理"}})]},proxy:!0}],null,!1,3677512950)},"el-table",e.tableProps,!1),[i("el-table-column",{attrs:{prop:"id",label:"ID","min-width":"164"}}),i("el-table-column",{attrs:{prop:"instructions",label:"说明","min-width":"322",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("div",{staticClass:"line-clamp-2"},[e._v(e._s(s.description))])]}}],null,!1,1071560540)}),i("el-table-column",{attrs:{label:"提醒频次","min-width":"150",align:"left"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" "+e._s("once"===i.remind_frequency?"一次":"weekly"===i.remind_frequency?"每周一次":"")+" ")]}}],null,!1,3788566226)}),i("el-table-column",{attrs:{label:"发送时间","min-width":"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(e._s(i.send_time.substring(0,i.send_time.length-3)))]}}],null,!1,1683971029)}),i("el-table-column",{attrs:{label:"状态","min-width":"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[e._v(" "+e._s("1"===i.status||1===i.status?"启用":"停用")+" ")]}}],null,!1,3807695597)}),i("el-table-column",{attrs:{label:"操作","min-width":"122",align:"left",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[i("a",{staticClass:"edit-a",on:{click:function(t){return e.handleUploadAction(s.id,s.status)}}},[e._v(e._s("0"===s.status||0===s.status?"启用":"停用"))]),i("a",{staticClass:"edit-a",on:{click:function(t){return e.handleEditAction(s.id,s.message_type,s.event_type)}}},[e._v("设置")])]}}],null,!1,1158423901)})],1):e._e(),e.shouldEditing?i("settingDialog",{attrs:{editingId:e.editingId,msgType:e.msgType,evtType:e.evtType},on:{closeAction:function(t){e.shouldEditing=!e.shouldEditing}}}):e._e()],1)],1)},n=[],a=i(97434),r=i(41729),l=i(21757),o=i(78902),c=i(58302),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("tg-block",[i("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter",attrs:{visible:!0,width:"510px",height:"400px","close-on-click-modal":!1},on:{close:e.handleCloseAction},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("设置")]},proxy:!0},{key:"footer",fn:function(){return[i("tg-button",{on:{click:e.handleCloseAction}},[e._v("取消")]),i("tg-button",{attrs:{type:"primary"},on:{click:e.handleSaveAction}},[e._v("保存")])]},proxy:!0}])},[i("div",{staticClass:"news-body"},[i("div",{directives:[{name:"show",rawName:"v-show",value:1===e.msgType,expression:"msgType === 1"}]},[i("div",{staticClass:"header-title"},[i("tg-icon",{attrs:{name:"ico-warn"}}),e._v("项目关联的客户经理、项目经理、财务BP为默认提醒对象，无需添加 ")],1),i("el-form",{ref:"formRef",staticStyle:{"margin-top":"6px"},attrs:{"label-position":"top",model:e.form,"label-width":"80px"}},[i("el-form-item",{staticClass:"select-item",attrs:{label:"店播项目消息接收人员：",size:"medium"}},[i("el-select",{staticStyle:{width:"462px"},attrs:{multiple:"",filterable:"",remote:"","remote-method":e.getAllUserName,"default-first-option":"",placeholder:e.form.iscanLive?"请输入并选择接收人员":"该消息暂不支持此项目类型",disabled:!e.form.iscanLive},on:{change:e.onChangeLive},model:{value:e.form.Live_ids,callback:function(t){e.$set(e.form,"Live_ids",t)},expression:"form.Live_ids"}},e._l(e.form.User_infos,(function(e){return i("el-option",{key:e.user_id,attrs:{label:e.name,value:e.user_id}})})),1)],1),i("el-form-item",{staticClass:"select-item",attrs:{label:"营销项目消息接收人员：",size:"medium"}},[i("el-select",{staticStyle:{width:"462px"},attrs:{multiple:"",filterable:"",remote:"","remote-method":e.getAllUserName,"default-first-option":"",placeholder:e.form.iscanMarketing?"请输入并选择接收人员":"该消息暂不支持此项目类型",disabled:!e.form.iscanMarketing},on:{change:e.onChangeMarketing},model:{value:e.form.Marketing_ids,callback:function(t){e.$set(e.form,"Marketing_ids",t)},expression:"form.Marketing_ids"}},e._l(e.form.User_infos,(function(e){return i("el-option",{key:e.user_id,attrs:{label:e.name,value:e.user_id}})})),1)],1),i("el-form-item",{staticClass:"select-item",attrs:{label:"MCN项目消息接收人员：",size:"medium"}},[i("el-select",{staticStyle:{width:"462px"},attrs:{multiple:"",remote:"",filterable:"","remote-method":e.getAllUserName,"default-first-option":"",placeholder:e.form.iscanMcn?"请输入并选择接收人员":"该消息暂不支持此项目类型",disabled:!e.form.iscanMcn},on:{change:e.onChangeMcn},model:{value:e.form.Mcn_ids,callback:function(t){e.$set(e.form,"Mcn_ids",t)},expression:"form.Mcn_ids"}},e._l(e.form.User_infos,(function(e){return i("el-option",{key:e.user_id,attrs:{label:e.name,value:e.user_id}})})),1)],1)],1)],1),i("div",{directives:[{name:"show",rawName:"v-show",value:2===e.msgType,expression:"msgType === 2"}],staticClass:"check-tab-class"},[i("div",{staticClass:"header-title"},[i("tg-icon",{attrs:{name:"ico-warn"}}),e._v("群内所有成员都可以接收到消息并查看对象，无需添加 ")],1),i("div",{directives:[{name:"show",rawName:"v-show",value:e.messageIds.length,expression:"messageIds.length"}],staticClass:"ids-row"},e._l(e.messageIds,(function(t,s){return i("div",{key:"cctv_"+s,staticClass:"ids-column"},[i("el-input",{attrs:{placeholder:"请输入接收消息群ID"},model:{value:e.messageIds[s],callback:function(t){e.$set(e.messageIds,s,"string"===typeof t?t.trim():t)},expression:"messageIds[idx]"}},[i("i",{staticClass:"el-icon-delete el-input__icon",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},on:{click:function(){return e.messageIds.splice(s,1)}},slot:"suffix"})])],1)})),0),i("div",{staticClass:"add-ids-btn"},[i("tg-button",{attrs:{disabled:e.messageIds.length>=10,type:"primary"},on:{click:function(){return e.messageIds.push("")}}},[e._v("新增群")])],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:3===e.msgType,expression:"msgType === 3"}]},[i("div",{staticClass:"header-title"},[i("tg-icon",{attrs:{name:"ico-warn"}}),e._v("项目结算单确认提醒将会单独发送至项目经理，不需要设置 ")],1),i("el-form",{ref:"formRef",staticStyle:{"margin-top":"6px"},attrs:{"label-position":"top",model:e.form,"label-width":"80px"}},[i("el-form-item",{staticClass:"select-item",attrs:{label:"结算单确认提醒接收人员：",size:"medium"}},[i("el-select",{staticStyle:{width:"462px"},attrs:{multiple:"",filterable:"",remote:"","remote-method":e.getAllUserName,"default-first-option":"",placeholder:e.form.isUnity?"请输入并选择接收人员":"该消息暂不支持此项目类型",disabled:!e.form.isUnity},on:{change:e.onChangeUnity},model:{value:e.form.Unity_ids,callback:function(t){e.$set(e.form,"Unity_ids",t)},expression:"form.Unity_ids"}},e._l(e.form.User_infos,(function(e){return i("el-option",{key:e.user_id,attrs:{label:e.name,value:e.user_id}})})),1)],1)],1)],1)])]),i("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},d=[],f=(0,a.defineComponent)({props:{editingId:{type:Number},msgType:{type:Number},evtType:{type:Number}},setup(e,t){const i=(0,a.ref)(!1),s=(0,a.ref)(void 0),n=(0,a.ref)({Live_ids:[],Marketing_ids:[],Mcn_ids:[],User_infos:[],Live_infos:[],Marketing_infos:[],Mcn_infos:[],Unity_ids:[],Unity_infos:[],iscanMcn:!0,iscanMarketing:!0,iscanLive:!0,isUnity:!0,Liveid:0,Marketingid:0,Mcnid:0,UnityId:0}),l=(0,a.ref)([]),o=()=>{t.emit("closeAction")},c=async e=>{const{data:i}=await(0,r.HO)(e);i.success?(t.root.$message.success("保存成功"),t.emit("closeAction")):t.root.$message.error(i.message||"请重新保存")},u=async e=>{const{data:i}=await(0,r.yD)(e);i.success?(t.root.$message.success("保存成功"),t.emit("closeAction")):t.root.$message.error(i.message||"请重新保存")},d=()=>{if(1===e.msgType){const t={config_id:e.editingId,data:[{receiver_list:n.value.Live_infos,project_type:1,id:n.value.Liveid},{receiver_list:n.value.Marketing_infos,project_type:2,id:n.value.Marketingid},{receiver_list:n.value.Mcn_infos,project_type:3,id:n.value.Mcnid}]};c(t)}else if(3===e.msgType){const t={config_id:e.editingId,data:[{receiver_list:n.value.Unity_infos,project_type:4,id:n.value.UnityId}]};c(t)}else{const e={event_type:1,chat_ids:l.value.filter((e=>e))};u(e)}},f=async e=>{if(e&&e.length>0){const{data:t}=await(0,r.wk)(e);t.success&&(n.value.User_infos=t.data.data)}},m=async()=>{if(1===e.msgType||3===e.msgType){const{data:t}=await(0,r.nV)(e.editingId);if(t.success){const e=t.data.data;e.filter((e=>{if(1===e.project_type){const t=[];e.receiver_list.filter((e=>{t.push(e.user_id);const i=n.value.User_infos.find((t=>{if(t.user_id===e.user_id)return!0}));i||n.value.User_infos.push(e)})),n.value.Live_infos=e.receiver_list,n.value.Live_ids=t,n.value.iscanLive=e.can_edit,n.value.Liveid=e.id}if(2===e.project_type){const t=[];e.receiver_list.filter((e=>{t.push(e.user_id);const i=n.value.User_infos.find((t=>{if(t.user_id===e.user_id)return!0}));i||n.value.User_infos.push(e)})),n.value.Marketing_infos=e.receiver_list,n.value.Marketing_ids=t,n.value.iscanMarketing=e.can_edit,n.value.Marketingid=e.id}if(3===e.project_type){const t=[];e.receiver_list.filter((e=>{t.push(e.user_id);const i=n.value.User_infos.find((t=>{if(t.user_id===e.user_id)return!0}));i||n.value.User_infos.push(e)})),n.value.Mcn_infos=e.receiver_list,n.value.Mcn_ids=t,n.value.iscanMcn=e.can_edit,n.value.Mcnid=e.id}if(4===e.project_type){const t=[];e.receiver_list.filter((e=>{t.push(e.user_id);const i=n.value.User_infos.find((t=>{if(t.user_id===e.user_id)return!0}));i||n.value.User_infos.push(e)})),n.value.Unity_infos=e.receiver_list,n.value.Unity_ids=t,n.value.isUnity=e.can_edit,n.value.UnityId=e.id}}))}}else{const t=await(0,r.Sg)(e.evtType);if(t.data.success){const e=t.data.data,i=e.filter((e=>e.is_checked)).map((e=>e.chat_id));l.value=i}}},v=e=>{if(e.length>50)return t.root.$message.warning("最多选择50位接收人员"),void n.value.Live_ids.splice(-1);const i=[];e.filter((e=>{let t;n.value.Live_infos.filter((i=>{e===i.user_id&&(t=i)})),t||n.value.User_infos.filter((i=>{e===i.user_id&&(t=i)})),i.push(t)})),n.value.Live_ids=e,n.value.Live_infos=i},_=e=>{if(e.length>50)return t.root.$message.warning("最多选择50位接收人员"),void n.value.Unity_ids.splice(-1);const i=[];e.filter((e=>{let t;n.value.Unity_infos.filter((i=>{e===i.user_id&&(t=i)})),t||n.value.User_infos.filter((i=>{e===i.user_id&&(t=i)})),i.push(t)})),n.value.Unity_ids=e,n.value.Unity_infos=i},p=e=>{if(e.length>50)return t.root.$message.warning("最多选择50位接收人员"),void n.value.Marketing_ids.splice(-1);const i=[];e.filter((e=>{let t;n.value.Marketing_infos.filter((i=>{e===i.user_id&&(t=i)})),t||n.value.User_infos.filter((i=>{e===i.user_id&&(t=i)})),i.push(t)})),n.value.Marketing_ids=e,n.value.Marketing_infos=i},g=e=>{if(e.length>50)return t.root.$message.warning("最多选择50位接收人员"),void n.value.Mcn_ids.splice(-1);const i=[];e.filter((e=>{let t;n.value.Mcn_infos.filter((i=>{e===i.user_id&&(t=i)})),t||n.value.User_infos.filter((i=>{e===i.user_id&&(t=i)})),i.push(t)})),n.value.Mcn_ids=e,n.value.Mcn_infos=i};return(0,a.onMounted)((()=>{m()})),{onChangeLive:v,onChangeUnity:_,onChangeMarketing:p,onChangeMcn:g,getSettingUserName:m,getAllUserName:f,form:n,messageIds:l,formRef:s,saveLoading:i,handleSaveAction:d,handleCloseAction:o}}}),m=f,v=i(1001),_=(0,v.Z)(m,u,d,!1,null,"0437e82b",null),p=_.exports,g=(0,a.defineComponent)({name:"TgNewsManage",components:{settingDialog:p},setup(e,t){const i=(0,a.computed)((()=>{const e=(0,l.kG)(o.HN.system_news_view),t=(0,l.kG)(o.HN.system_news_list);return{canEdit:t,canViewList:e}})),s=[{title:"系统设置"},{title:"消息管理"}];return{routes:s,Permission:i,...h(t)}}});function h(e){const t=(0,a.ref)(!1),i=(0,a.ref)(!1),s=(0,a.ref)(1),n=(0,a.ref)(0),l=(0,a.ref)([]),o=(0,a.ref)(void 0),u=(e,i,a)=>{t.value=!t.value,s.value=i,n.value=a,o.value=e},d=async(t,s)=>{const n={config_id:t,status:"1"===s||1===s?0:1},{data:a}=await(0,r.i6)(n);a.success?(e.root.$message.success("状态修改成功"),y(l,i)):e.root.$message.error(a.message||"状态修改失败")},f=()=>{y(l,i),t.value=!t.value};y(l,i);const m=0,v=0,_=36,p=31,g=(0,a.ref)(0),h=e=>{g.value=e.height},b=(0,c.Z)({compensation:(0,a.computed)((()=>m+v+_+p)),fixedBlockHeightRefs:[g],tableMinHeight:100});return{handleUploadAction:d,list:l,shouldEditing:t,loading:i,msgType:s,evtType:n,handleEditAction:u,editingId:o,handleEditingSucceedAction:f,onTopCardRectUpdate:h,...b}}async function y(e,t){t.value=!0;const{data:i}=await(0,r.ZZ)();t.value=!1,i.success&&(e.value=i.data.data)}var b=g,w=(0,v.Z)(b,s,n,!1,null,"23ad7827",null),k=w.exports},41729:function(e,t,i){i.d(t,{Sg:function(){return m},ZZ:function(){return u},nV:function(){return d},wk:function(){return f},i6:function(){return p},HO:function(){return v},yD:function(){return _}});var s=i(76012);const n="/api/auth/message_notification_config/",a="/api/auth/message_notification_receiver_list/",r="/api/feishu/feishu_user_list",l="/api/auth/save_message_notification_receiver/",o="/api/auth/message_notification_config_status/";var c=i(64236);const u=async()=>(0,s.dX)(n),d=async e=>(0,s.dX)(a+"?config_id="+e),f=async e=>(0,s.dX)(r+"?name="+e),m=async e=>(0,s.dX)("/api/feishu/feishu_bot_groups?event_type="+e),v=async e=>(0,s.SO)(l,{...(0,c.jG)(e)}),_=async e=>(0,s.SO)("/api/feishu/update_checked_feishu_bot_groups",{...(0,c.jG)(e)}),p=async e=>(0,s.SO)(o,{...(0,c.jG)(e)})},58302:function(e,t,i){var s=i(97434),n=i(77944),a=i(52140);const r=e=>{const t=(0,s.computed)((()=>n.Z.getters["global/scrollbarSetting"])),i=(0,s.computed)((()=>void 0!==e.pagename?!0!==t.value.find((t=>t.key===e.pagename))?.value:e.disable??!1)),r=(0,s.computed)((()=>{const t=(e.fixedBlockHeightRefs??[]).map((e=>(0,s.unref)(e))).reduce(((e,t)=>(0,s.unref)(e)+(0,s.unref)(t)),0);return i.value?"max-content":`calc(100vh - ${(0,s.unref)(t)+56+36}px)`})),l=(0,s.computed)((()=>(i.value,"flex-auto"))),o=(0,s.computed)((()=>({height:r.value,overflowInBody:!i.value}))),c=(0,s.ref)(0),u=(0,s.computed)((()=>i.value?{}:{height:Math.max(c.value-(0,s.unref)((0,s.unref)(e.compensation)),e.tableMinHeight??0)})),d=i.value?()=>{}:e=>{c.value!==e&&(c.value=e,(0,a.S)())},f=i.value?()=>{}:t=>{0===c.value?setTimeout((()=>{d(t.height)}),e.delay??1200):d(t.height)};return{cardHeight:r,tableProps:u,onRectUpdate:f,rectHeight:c,cardFlexClass:l,cardProps:o}};t["Z"]=r},52140:function(e,t,i){i.d(t,{S:function(){return s},n:function(){return n}});const s=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},n=()=>{const{width:e,height:t}=document.body.getBoundingClientRect();return{width:e,height:t}}}}]);