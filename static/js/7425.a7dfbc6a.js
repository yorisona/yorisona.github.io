"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[7425],{87425:function(t,e,a){a.d(e,{Z:function(){return h}});var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("SettlementStep3Layout",{staticClass:"tg-income-investment-settlement-step3-container",scopedSlots:t._u([{key:"top",fn:function(){return[a("top-card",{attrs:{amount:t.settlementDetail.total_settle_amount.toString(),taxed:t.settlementDetail.is_include_tax,name:t.settlementDetail.company_name,name_desc:"客户：",tax_rate:t.settlementDetail.tax_rate.toString(),type:"value2",tax_rate_disabled:!0}})]},proxy:!0},{key:"left",fn:function(){return[a("card-layout",{attrs:{padding:[0]},scopedSlots:t._u([{key:"title",fn:function(){return[t.isAmountInfoList?a("span",[t._v("结算详情")]):a("span",[t._v("坑位费")])]},proxy:!0}])},[t.isAmountInfoList?a("div",{staticClass:"investment-settlement-step3-detail"},[[t.json_data?a("div",{staticStyle:{padding:"0 0 18px"}},[a("div",{staticClass:"settlement-goods-info",staticStyle:{background:"transparent","padding-left":"16px"}},[a("div",[t._v(t._s(t.typeMap.get(t.amountInfoList[0].type))+"：")]),a("div",[a("div",{staticClass:"goods-info-code line-clamp-1"},[t._v(" "+t._s(t.formatAmountWithoutPrefix(t.amountInfoList[0]?t.amountInfoList[0].amount:0)+" 元")+" ")])])])]):t._e()]],2):a("div",{staticClass:"investment-settlement-step3-detail"},[[t.json_data?a("div",{staticStyle:{padding:"0 0 18px"}},[a("div",{staticClass:"settlement-goods-info"},[a("div",{staticClass:"goods-info-label"},[a("tg-icon",{staticClass:"godos-info-icon",attrs:{name:"ico-icon_tongyong_tishi_mianxing-01"}}),a("div",[t._v("商品：")])],1),a("div",[a("div",{staticClass:"goods-info-code line-clamp-1"},[t._v(" "+t._s(t.json_data.product_code?t.json_data.product_code:"--")+" ")]),a("div",{staticClass:"line-clamp-2 goods-info-name"},[t._v(" "+t._s(t.json_data.product_name?t.json_data.product_name:"--")+" ")])])]),t.merchants_project?a("div",{staticClass:"investment-project-income"},[a("div",{staticClass:"income-label"},[t._v("招商项目结算收入")]),a("div",{staticClass:"income-value"},[t._v(" "+t._s(t.formatAmountWithoutPrefix(t.merchants_project?t.merchants_project.income_amount:0)+" 元")+" ")])]):t._e(),t.execute_project?a("div",{staticClass:"execute-project-income"},[a("div",{staticClass:"income-label"},[t._v(" "+t._s((t.execute_project?t.execute_project.project_name:"--")+"项目结算收入")+" ")]),a("div",{staticClass:"income-value"},[t._v(" "+t._s(t.formatAmountWithoutPrefix(t.execute_project?t.execute_project.income_amount:0)+" 元")+" ")])]):t._e()]):t._e()]],2)])]},proxy:!0},{key:"right",fn:function(){return[a("CardLayout",{scopedSlots:t._u([{key:"title",fn:function(){return[t._v("手工调账")]},proxy:!0}])},[a("div",{staticClass:"adjust-info-content"},[a("div",{staticClass:"adjust-info-total"},[a("div",{staticClass:"adjust-info-total-lbl"},[t._v(" 调账 "+t._s(t.settlementDetail.adjust_info.length)+" 笔 ")]),a("div",{staticClass:"adjust-info-total-amount"},[a("strong",[t._v(t._s(t.adjustTotalAmount())+"  元")])])]),a("div",{staticClass:"adjust-info-line"}),a("div",{staticClass:"adjust-info-list"},[t._l(t.settlementDetail.adjust_info,(function(e,n){return[a("div",{key:n,staticClass:"adjust-info-item"},[a("span",{staticClass:"number"},[t._v(t._s(n+1)+". ")]),a("div",[a("div",{staticClass:"income-project"},[t._v(t._s(t.adjustProjectDesc(e)))]),a("div",{staticClass:"project-income-info"},[a("span",[t._v("调整金额：")]),a("span",[t._v(t._s(t.formatAmountWithoutPrefix(e.adjust_amount))+" 元")]),a("span",[t._v("；调整原因：")]),a("span",[t._v(t._s(e.adjust_reason))])])])])]}))],2)])])]},proxy:!0},{key:"files",fn:function(){return[a("div",{staticStyle:{"border-bottom":"1px solid rgba(164, 178, 194, 0.3)","margin-top":"18px"}}),a("div",{staticClass:"upload-form"},[t.readonly?t._e():a("div",{staticClass:"upload-box"},[a("p",{staticClass:"upload-title"},[a("span",{staticClass:"star"},[t._v("*")]),t._v("结算单")]),a("tg-upload",{attrs:{action:"/api/resources/upload_file",data:{type:"settlement"},beforeUpload:t.beforeUpload,success:t.successHandle,disabled:t.isFileUploaderDisabled,"show-file-list":!1}},[a("tg-button",{attrs:{size:"medium",icon:"ico-btn-upload",disabled:t.isFileUploaderDisabled}},[t._v("上传文件")])],1),a("span",{staticClass:"file-tips"},[t._v(" 支持 .docx .pdf .jpg .png .xlsx, 最多上传5个文件(单个文件大小不超过30M) ")])],1),a("div",{staticClass:"file-list-box"},[t.readonly?a("Appendix",{attrs:{list:t.settlement_files}}):a("upload-file-list",{model:{value:t.settlement_files,callback:function(e){t.settlement_files=e},expression:"settlement_files"}})],1)])]},proxy:!0},t.readonly?null:{key:"button",fn:function(){return[a("tg-button",{on:{click:t.prev}},[t._v("上一步")]),a("tg-button",{attrs:{type:"primary"},on:{click:t.next}},[t._v("生成结算单")])]},proxy:!0},{key:"mask",fn:function(){return[a("tg-mask-loading",{attrs:{visible:t.loading,content:t.loadingText}})]},proxy:!0}],null,!0)})},s=[],i=(a(26699),a(97434)),o=a(28966),l=a(94559),r=a(99048),u=a(79703),c=a(28348),d=a(85937),_=a.n(d),m=a(61282),p=a(82741),f=a(71963),v=a(11676),y=(0,i.defineComponent)({props:{readonly:{type:Boolean,default:!1}},components:{TopCard:l.Z,Appendix:u.Z,CardLayout:r.Z,SettlementStep3Layout:o.Z},setup(t,e){const a=(0,i.inject)("settlement")??(0,i.ref)(void 0),n=()=>({id:a.value?.id??-1,total_settle_amount:a.value?.total_settle_amount??0,adjust_info:a.value?.adjust_info?[...a.value?.adjust_info]:[],company_name:a.value?.company_name?a.value?.company_name:"--",is_include_tax:a.value?.is_include_tax,tax_rate:a.value?.tax_rate??0,json_data:a.value?.json_data}),s=(0,i.ref)(n()),o=(0,i.ref)(!1),l=(0,i.ref)(void 0),r=(0,i.computed)((()=>u.value.length>=5)),u=(0,i.ref)(a.value?.settlement_files?[...a.value?.settlement_files]:[]),d=(0,i.ref)([...u.value]),y=(0,i.computed)((()=>h.value?.company_info_list?.find((t=>t.type===c.Cy.merchant_project)))),g=(0,i.computed)((()=>h.value?.company_info_list?.find((t=>t.type===c.Cy.execute_project)))),j=(0,i.computed)((()=>h.value?.amount_info_list??[])),x=(0,i.computed)((()=>j.value&&[11,12,13].includes(j.value[0]?.type))),h=(0,i.computed)((()=>s.value.json_data)),C={prev:()=>{C.isModified()?C.saveSettlementDataRequest(!1):e.emit("prev")},next:async()=>{if(!u.value.length)return void e.root.$message.warning("请上传结算单扫描件");const t=await(0,p.I)(e,{title:"确定生成结算单吗?",content:()=>(0,i.h)("div",[(0,i.h)("div","将对本次结算生成对应的结算单"),(0,i.h)("div","是否需要生成？")]),confirmText:"确定",cancelText:"取消"});t&&C.submitSettlementDataRequest()},startLoading:t=>{"save"===t?l.value="正在保存，请稍候...":"upload"===t?l.value="正在上传，请稍候...":"submit"===t&&(l.value="正在生成结算单，请稍候..."),o.value=!0},stopLoading:()=>{o.value=!1,l.value=void 0},isModified:()=>{const t=JSON.stringify(d.value),e=JSON.stringify(u.value);return t!==e},adjustTotalAmount:()=>{let t=new(_())(0);return s.value.adjust_info.forEach((e=>{t=new(_())(e.adjust_amount).add(t)})),(0,m.dN)(t.toString(),"None")},adjustProjectDesc:t=>t.type===c.Cy.merchant_project?"招商项目收入结算":t.type===c.Cy.execute_project?"执行项目结算收入":void 0,confirmBeforeClose:async()=>C.isModified(),saveBeforeClose:()=>C.saveSettlementDataRequest(!0),saveSettlementDataRequest:async t=>{const a={id:s.value.id,step:c.br.step_three,settlement_files:u.value};C.startLoading("save");const n=await(0,f.We)(a);return C.stopLoading(),n.data.success?(t?e.root.$message.success(n.data.message??"保存成功"):e.emit("prev",n.data.data),!0):(e.root.$message.error(n.data.message??"保存失败"),!1)},submitSettlementDataRequest:async()=>{if(!u.value.length)return void e.root.$message.warning("请上传结算单扫描件");C.startLoading("submit");const t=await(0,f.nE)(s.value.id,u.value);C.stopLoading(),t.data.success?(e.root.$message.success(t.data.message??"生成结算单成功"),e.emit("submit:success")):e.root.$message.error(t.data.message??"生成结算单失败")},beforeUpload:t=>(0,v.K)({pdf:!0,image:!0,excel:!0,doc:!0,fileSize:30})(t),successHandle:t=>{u.value.push(t.data.source)},formatAmountWithoutPrefix:m.FU},b=new Map([[11,"佣金"],[12,"佣金(服务费)"],[13,"技术服务费"]]);return{settlementDetail:s,merchants_project:y,isAmountInfoList:x,execute_project:g,typeMap:b,loading:o,loadingText:l,settlement_files:u,isFileUploaderDisabled:r,json_data:h,amountInfoList:j,...C}}}),g=y,j=a(1001),x=(0,j.Z)(g,n,s,!1,null,null,null),h=x.exports},71963:function(t,e,a){a.d(e,{Qp:function(){return I},t:function(){return O},nE:function(){return w},Nz:function(){return W},b$:function(){return M},YH:function(){return Z},FZ:function(){return $},GZ:function(){return G},uc:function(){return R},Eo:function(){return P},B0:function(){return T},R3:function(){return U},W_:function(){return L},jJ:function(){return D},bs:function(){return A},xR:function(){return q},ob:function(){return b},eD:function(){return S},We:function(){return k},II:function(){return X},ln:function(){return E}});var n=a(76012);const s="/api/shop_live/save_live_goods_v2",i="/api/settlement/save_merchant_settlement_base_info",o="/api/settlement/save_settlement_data/merchant",l="/api/settlement/gen_sub_merchant_income_settlement",r="/api/shop_live/query_merchant_shop_live",u="/api/settlement/query_merchant_settlements",c="/api/settlement/del_merchant_settlement",d="/api/settlement/pass_merchant_settlement",_="/api/settlement/pass_unity_settlement",m="/api/settlement/refuse_merchant_settlement",p="/api/settlement/approve_merchant_settlement_financial/:id",f="/api/settlement/refuse_merchant_settlement_financial/:id",v="/api/financial/query_pay_list_v2",y="/api/settlement/list_unity_settlements",g="/api/settlement/create_unity_settlements",j="/api/settlement/confirm_unity_settlements",x="/api/settlement/delete_unity_settlement",h="/api/settlement/refresh_unity_settlement";var C=a(64236);const b=async t=>(0,n.SO)(s,{...(0,C.jG)(t)}),S=async t=>(0,n.SO)(i,{...(0,C.jG)(t)}),k=async t=>(0,n.SO)(o,{...(0,C.jG)(t)}),w=async(t,e)=>(0,n.SO)(l,{...(0,C.jG)({settlement_id:t,settlement_files:e})}),D=async t=>(0,n.dX)(r,{params:{merchant_goods_id:t}}),L=async(t,e=3)=>(0,n.dX)(u,{params:{...(0,C.jG)(t??""),settlement_kind:e}}),O=async t=>(0,n.SO)(c,{...(0,C.jG)({id:t})}),$=async t=>(0,n.SO)(`${d}/${t}`),G=async t=>(0,n.SO)(`${_}/${t}`),A=(t,e)=>(0,n.SO)(`${m}/${t}`,{refuse_reason:e}),I=async t=>(0,n.dX)(p.replace(":id",`${t}`)),q=async({id:t,refuse_reason:e})=>(0,n.SO)(f.replace(":id",`${t}`),{refuse_reason:e}),W=async t=>(0,n.dX)(v,{params:t}),Z=async t=>(0,n.dX)(y,{params:t}),M=async t=>(0,n.dX)("/api/shop_live/query_withdraw",{params:t}),P=t=>(0,n.SO)(g,{...(0,C.jG)(t)}),R=async t=>(0,n.SO)(j,{...(0,C.jG)({id:t})}),T=async t=>(0,n.SO)(x,{...(0,C.jG)({id:t})}),U=async t=>(0,n.SO)(h,{...(0,C.jG)({id:t})}),X=async t=>(0,n.SO)("/api/shop_live/delete_withdraw",{...(0,C.jG)({id:t})}),E=async t=>(0,n.SO)("/api/shop_live/withdraw_write_off",{...(0,C.jG)({id:t})})}}]);