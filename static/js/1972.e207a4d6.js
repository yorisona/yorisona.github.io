"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[1972],{61972:function(e,t,a){a.r(t),a.d(t,{default:function(){return ve}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-roster-page flex-auto"},[a("tg-card",{staticClass:"stick-bottom",attrs:{padding:0}},[a("tg-tabs",{attrs:{bottom:"",tabs:e.tabs},on:{change:e.onTabChange},model:{value:e.checkedTab,callback:function(t){e.checkedTab=t},expression:"checkedTab"}})],1),a(e.checkedTab,{tag:"component"})],1)},l=[],o=a(1763),s=a(23812),i=a(97434),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-roster-kol flex-auto"},[a("tg-card",{staticClass:"stick-top tg-roster-kol-filter",attrs:{padding:18}},[a("el-form",{staticClass:"flex-form",attrs:{inline:!0,size:"small","show-message":!1,"label-width":"70px"}},[a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"主播名称："}},[a("el-select",{staticStyle:{width:"250px"},attrs:{filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入并选择主播名称","remote-method":e.kolQuery,loading:e.kolLoading},on:{change:e.kolIDChange},model:{value:e.key,callback:function(t){e.key=t},expression:"key"}},e._l(e.kolList,(function(e){return a("el-option",{key:e.kol_id,attrs:{label:e.kol_name_and_real_name,value:e.kol_id}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"24px !important"},attrs:{label:"查询日期："}},[a("el-date-picker",{staticStyle:{width:"250px"},attrs:{clearable:"",editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd"},on:{blur:e.onDateBlur},model:{value:e.queryForm.date,callback:function(t){e.$set(e.queryForm,"date",t)},expression:"queryForm.date"}})],1),a("el-form-item",[a("tg-button",{attrs:{type:"primary"},on:{click:e.queryKolScheduleData}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)],1)],1),a("tg-card",{staticClass:"tg-roster-kol-schedule flex-auto mgt-12",attrs:{padding:18}},[a("div",{staticClass:"roster-table-container flex-auto"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.queryLoading,expression:"queryLoading"}],attrs:{height:"100%",stripe:"",data:e.timelineSchedules,"row-style":{cursor:"pointer"}},on:{"row-click":e.goDetail},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无查询信息"}})]},proxy:!0}])},e._l(e.columns,(function(t,r){return a("el-table-column",e._b({key:r},"el-table-column",t,!1))})),1)],1)])],1)},d=[],c=a(3293),u=a(8581);const m=()=>{const e=new Date,t=(0,u.WU)(e,"YYYY-mm-dd"),a=(0,u.WU)(e.getTime()+5184e5,"YYYY-mm-dd"),r=(0,i.ref)({date:[t,a],kol_id:void 0,studio_id:void 0,business_type:void 0}),l=()=>{r.value.date=[t,a],r.value.kol_id=void 0,r.value.studio_id=void 0,r.value.business_type=void 0},o=()=>{r.value.date=r.value.date??[];const{date:[e,t],kol_id:a,studio_id:l,business_type:o}=r.value;return{kol_id:a,studio_id:l,start_date:e,end_date:t,business_type:o}},s=(0,i.ref)({minDate:void 0,maxDate:void 0}),n=(0,i.ref)({disabledDate(e){return!(!s.value.minDate||s.value.minDate&&s.value.maxDate)&&(e.getTime()!==s.value.minDate.getTime()-5184e5&&e.getTime()!==s.value.minDate.getTime()+5184e5)},onPick({minDate:e,maxDate:t}){e&&(s.value.minDate=e,s.value.maxDate=t)}}),d=()=>{s.value.minDate=void 0,s.value.maxDate=void 0};return{pickerOptions:n,queryForm:r,resetForm:l,getPayload:o,onDateBlur:d}};var p=a(64236),v=a(6933),_=a.n(v),f=a(67910),g=a(29625),y=a(40290),h=(0,i.defineComponent)({setup(e,t){const a=(0,i.ref)(""),{queryForm:r,resetForm:l,getPayload:o,...s}=m(),n=(0,i.ref)((0,u._3)().getTime()),d=(0,i.ref)((0,u._3)().getTime()),v=(0,i.ref)([]),h=(0,i.ref)(!1),b=(0,i.ref)(!1),k=(0,i.ref)([]),D=async()=>{const e={...o()};if(!e.kol_id||!e.start_date||!e.end_date)return void(e.kol_id?t.root.$message.warning("请选择查询日期"):t.root.$message.warning("请输入搜索主播名称"));const r=(0,p.RT)({...(0,p.jG)(e),kol_name:a.value},(([e,t])=>[e,`${t}`]));"{}"!==JSON.stringify(r)&&JSON.stringify(r)!==JSON.stringify(t.root.$route.query)&&t.root.$router.replace({query:r}),b.value=!0;const[{data:l}]=await Promise.all([await(0,c.k9)(e),await(0,p._v)(300)]);b.value=!1,x(),S(),l.success?v.value=l.data:t.root.$message.error(l.message??"排班查询失败，请稍候再试")};(0,i.onBeforeMount)((async()=>{const{kol_id:e,start_date:l,end_date:o,kol_name:s}=t.root.$route.query;if(void 0!==l&&void 0!==o&&(r.value.date=[l,o],void 0!==e)){const t=parseInt(e,10);r.value.kol_id=t,w(t),a.value=s,await $(a.value),a.value=k.value.find((e=>e.kol_id===t))?.kol_name??"",D()}}));const $=async e=>{const{data:t}=await(0,c.Sx)({kol_name:e});if(t.success){const e=t.data.map((e=>{const t=e.real_name?e.real_name:"--",a=e.kol_name+"("+t+")";return{kol_company_id:e.kol_company_id,kol_company_name:e.kol_company_name,kol_id:e.kol_id,kol_name:e.kol_name,real_name:e.real_name,kol_name_and_real_name:a}}));k.value=e}},w=e=>{r.value.kol_id=e,a.value=k.value.find((t=>t.kol_id===e))?.kol_name??"",e||(k.value=[])},j=async()=>{l(),a.value="",k.value=[],v.value=[],x(),S()},x=()=>{r.value.date&&r.value.date.length>1?n.value=_()(r.value.date[0]).valueOf():n.value=(0,u._3)().getTime()},S=()=>{r.value.date&&r.value.date.length>1?d.value=_()(r.value.date[1]).valueOf():d.value=(0,u._3)().getTime()+5184e5};(0,i.onBeforeMount)((()=>{x(),S()}));const C=(0,i.computed)((()=>{const e=[...v.value];return v.value.forEach((t=>{if(t.start_time&&t.end_time){const[a,l]=t.start_time.split(" "),[o,s]=t.end_time.split(" "),i="00:00",[n,d]=r.value.date;if(a!==o&&s!==i){if(t.end_time=`${o} ${i}`,_()(n).toDate()>_()(a).toDate()&&e.splice(e.indexOf(t),1),_()(d).toDate()<_()(o).toDate())return;const r={...t};r.start_time=`${o} ${i}`,r.end_time=`${o} ${s}`,e.push(r)}}})),e.map((e=>({id:e.shop_live_id,start_time:_()(e.start_time).valueOf(),end_time:_()(e.end_time).valueOf(),name:e.studio_name,duration:e.duration,content:e.project_name??"--"})))})),T=e=>{(0,y.k)(t).jumpLiveDisplayDetail({project_id:`${e.project_id}`,live_id:`${e.shop_live_id}`,newWindow:!0})},q=()=>{D()},O=e=>`${e.project_uid}`,F=e=>`${e.project_name}`,M=(0,i.computed)((()=>[{label:"项目编码",minWidth:(0,f.zY)(v,"项目编码",O).value,formatter:e=>O(e)},{label:"项目名称",minWidth:200,formatter:e=>F(e)},{label:"业务类型",minWidth:183,formatter:e=>g.Zb.get(e.business_type)},{label:"直播间标题",minWidth:200,formatter:e=>e.live_title},{label:"排班时间",minWidth:206,align:"center",formatter:e=>e.start_time&&e.end_time?`${e.start_time} ~ ${e.end_time}`.replace(/-/g,"."):"--"}]));return{key:a,kolLoading:h,queryLoading:b,kolList:k,queryForm:r,...s,queryKolScheduleData:q,reset:j,startDate:n,endDate:d,kolQuery:$,kolIDChange:w,timelineSchedules:v,kolTimelineSchedules:C,goDetail:T,columns:M}}}),b=h,k=a(1001),D=(0,k.Z)(b,n,d,!1,null,null,null),$=D.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex-auto tg-roster-operator"},[a("tg-card",{staticClass:"stick-top tg-roster-operator-filter",attrs:{padding:18}},[a("el-form",{staticClass:"flex-form filter-form",attrs:{inline:!0,size:"small","show-message":!1,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"业务类型："}},[a("el-select",{model:{value:e.queryForm.business_type,callback:function(t){e.$set(e.queryForm,"business_type",t)},expression:"queryForm.business_type"}},e._l(e.BusinessTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",attrs:{label:"查询日期："}},[a("el-date-picker",{staticStyle:{width:"250px"},attrs:{clearable:!1,editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{blur:e.onDateBlur},model:{value:e.queryForm.date,callback:function(t){e.$set(e.queryForm,"date",t)},expression:"queryForm.date"}})],1),a("el-form-item",[a("tg-button",{attrs:{type:"primary"},on:{click:e.queryOperatorScheduleData}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)],1)],1),a("tg-card",{staticClass:"flex-auto mgt-12 tg-roster-operator-schedule",attrs:{padding:18}},[a("TgRosterDay",{attrs:{startDate:e.startDate,endDate:e.endDate,schedules:e.operatorScheduleList},on:{clickItem:e.clickItem}})],1)],1)},j=[];const x=()=>({});var S,C=(0,i.defineComponent)({setup(e,t){const a=(0,i.ref)(Date.now()),r=(0,i.ref)(Date.now()),{queryForm:l,resetForm:o,getPayload:s,...n}=m(),d=(0,i.ref)([]),v=async()=>{const e={...s()};if(!e.start_date||!e.end_date)return void t.root.$message.warning("请选择查询日期");const l=(0,p.RT)({...(0,p.jG)(e)},(([e,t])=>[e,`${t}`]));"{}"!==JSON.stringify(l)&&JSON.stringify(l)!==JSON.stringify(t.root.$route.query)&&t.root.$router.replace({path:"/live/roster-query/operator",query:l});const[{data:o}]=await Promise.all([await(0,c.mN)(e),await(0,p._v)(300)]);o.success?(a.value=h(),r.value=b(),d.value=o.data):t.root.$message.error(o.message??"排班查询失败，请稍候再试")},f=async()=>{o(),d.value=[],a.value=h(),r.value=b(),await v()},h=()=>l.value.date&&l.value.date.length>1?_()(l.value.date[0]).valueOf():(0,u._3)().getTime(),b=()=>l.value.date&&l.value.date.length>1?_()(l.value.date[1]).valueOf():(0,u._3)().getTime()+5184e5,k=()=>{v()},D=(0,i.computed)((()=>{if(l.value.date)return d.value.forEach((e=>{const t=[...e.operator_schedule_list];t.forEach((t=>{if(t.start_time&&t.end_time){const[a,r]=t.start_time.split(" "),[o,s]=t.end_time.split(" "),i="00:00",[n,d]=l.value.date;if(a!==o&&s!==i){if(t.end_time=`${a} ${i}`,_()(n).toDate()>_()(a).toDate()&&e.operator_schedule_list.splice(e.operator_schedule_list.indexOf(t),1),_()(d).toDate()<_()(o).toDate())return;const r={...t};r.start_time=`${o} ${i}`,r.end_time=`${o} ${s}`,e.operator_schedule_list.push(r)}}}))})),d.value.map((e=>({user_id:e.user_id,username:e.username,operator_schedule_list:e.operator_schedule_list})))}));(0,i.onBeforeMount)((()=>{const{start_date:e,end_date:a}=t.root.$route.query;void 0!==e&&void 0!==a?(l.value.date=[e,a],v()):f()}));const $=e=>{(0,y.k)(t).jumpLiveDisplayDetail({project_id:`${e.project_id}`,live_id:`${e.shop_live_id}`,newWindow:!0})};return{queryForm:l,queryOperatorScheduleData:k,reset:f,...n,...x(),operatorScheduleList:D,startDate:a,endDate:r,clickItem:$,BusinessTypeOptions:g.Yh.filter((e=>e.value!==g.WD.marketing))}}}),T=C,q=(0,k.Z)(T,w,j,!1,null,"2726500e",null),O=q.exports,F=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"flex-auto tg-roster-studio"},[a("tg-card",{staticClass:"stick-top tg-roster-studio-filter",attrs:{padding:18}},[a("el-form",{staticClass:"flex-form filter-form",attrs:{inline:!0,size:"small","show-message":!1,"label-width":"70px"}},[a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"直播间："}},[a("el-select",{staticStyle:{width:"250px"},attrs:{filterable:"",remote:"",clearable:"",placeholder:"请输入搜索直播间名称",loading:e.loading,"remote-method":e.studioQuery},on:{change:e.studioChange},model:{value:e.queryForm.studio_id,callback:function(t){e.$set(e.queryForm,"studio_id",t)},expression:"queryForm.studio_id"}},e._l(e.studioList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.studio_name,value:e.id}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"24px !important"},attrs:{label:"查询日期："}},[a("el-date-picker",{staticStyle:{width:"250px"},attrs:{clearable:"",editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{blur:e.onDateBlur},model:{value:e.queryForm.date,callback:function(t){e.$set(e.queryForm,"date",t)},expression:"queryForm.date"}})],1),a("el-form-item",[a("tg-button",{attrs:{type:"primary"},on:{click:e.queryStudioScheduleData}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)],1)],1),a("tg-card",{staticClass:"flex-auto mgt-12 tg-roster-studio-schedule",attrs:{padding:18}},[a("TgRosterTimeline",{attrs:{startDate:e.startDate,endDate:e.endDate,timelineSchedules:e.studioTimelineSchedules},on:{clickSingleSchedule:e.clickSingleSchedule}})],1)],1)},M=[],Y=(0,i.defineComponent)({setup(e,t){const a=(0,i.ref)(!1),r=(0,i.ref)((0,u._3)().getTime()),l=(0,i.ref)((0,u._3)().getTime()),s=(0,i.ref)([]),n=(0,i.ref)([]),{queryForm:d,resetForm:v,getPayload:f,...g}=m(),y=(0,i.ref)([]),h=async()=>{const e={...f()};if(!e.studio_id||!e.start_date||!e.end_date)return void(e.studio_id?t.root.$message.warning("请选择查询日期"):t.root.$message.warning("请输入搜索直播间名称"));const a=(0,p.RT)({...(0,p.jG)(e)},(([e,t])=>[e,`${t}`]));"{}"!==JSON.stringify(a)&&(JSON.stringify(a),JSON.stringify(t.root.$route.query));const[{data:r}]=await Promise.all([await(0,c.yR)(e),await(0,p._v)(300)]);$(),w(),r.success?(n.value=r.data,s.value=j()):t.root.$message.error(r.message??"排班查询失败，请稍候再试")},b=async e=>{if(""!==e){a.value=!0;const{data:t}=await(0,c.lj)(e);a.value=!1,t.success&&(y.value=t.data)}else y.value=[]},k=e=>{e||(y.value=[])},D=async()=>{v(),n.value=[],$(),w()},$=()=>{d.value.date&&d.value.date.length>1?r.value=_()(d.value.date[0]).valueOf():r.value=(0,u._3)().getTime()},w=()=>{d.value.date&&d.value.date.length>1?l.value=_()(d.value.date[1]).valueOf():l.value=(0,u._3)().getTime()+5184e5};(0,i.onBeforeMount)((()=>{$(),w()}));const j=()=>{const e=[...n.value];return n.value.forEach((t=>{if(t.start_time&&t.end_time){const[a,r]=t.start_time.split(" "),[l,o]=t.end_time.split(" "),s="00:00",[i,n]=d.value.date;if(a!==l&&o!==s){if(t.end_time=`${l} ${s}`,_()(i).toDate()>_()(a).toDate()&&e.splice(e.indexOf(t),1),_()(n).toDate()<_()(l).toDate())return;const r={...t};r.start_time=`${l} ${s}`,r.end_time=`${l} ${o}`,e.push(r)}}})),e.map((e=>({id:e.id,project_id:e.project_id,start_time:_()(e.start_time).valueOf(),end_time:_()(e.end_time).valueOf(),name:"",duration:e.real_duration,content:e.project_name??"--"})))},S=()=>{h()},C=e=>{const{href:a}=t.root.$router.resolve({name:o.FB.display.detail,params:{id:`${e.project_id}`,liveId:`${e.id}`,tab:"live"}});window.open(a,"_blank")};return{loading:a,startDate:r,endDate:l,studioList:y,studioTimelineSchedules:s,queryForm:d,queryStudioScheduleData:S,reset:D,studioQuery:b,studioChange:k,...g,...x(),clickSingleSchedule:C}}}),P=Y,R=(0,k.Z)(P,F,M,!1,null,null,null),N=R.exports,B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-roster-project-page flex-auto"},[a("tg-card",{staticClass:"flex-none stick-top",attrs:{padding:[18]}},[a("el-form",{ref:"formRef",staticClass:"filter-form flex-form",attrs:{inline:"","show-message":!1,model:e.form,"label-width":"76px",size:"small"}},[a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"项目查询："}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"246px"},attrs:{placeholder:"请输入关键词"},model:{value:e.form.search_value,callback:function(t){e.$set(e.form,"search_value",t)},expression:"form.search_value"}},[a("el-select",{staticStyle:{width:"102px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:e.form.search_type,callback:function(t){e.$set(e.form,"search_type",t)},expression:"form.search_type"}},e._l(e.ProjectScheduleQuerySearchTypeOptions,(function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)],1)],1),a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"项目经理：",prop:"project_manager_id"}},[a("el-select",{staticStyle:{width:"246px"},attrs:{loading:e.pmLoading},model:{value:e.form.project_manager_id,callback:function(t){e.$set(e.form,"project_manager_id",t)},expression:"form.project_manager_id"}},[a("el-option",{attrs:{value:"",label:"全部"}}),e._l(e.pmOptions,(function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}))],2)],1),a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"业务类型：",prop:"business_type"}},[a("el-select",{staticStyle:{width:"246px"},model:{value:e.form.business_type,callback:function(t){e.$set(e.form,"business_type",t)},expression:"form.business_type"}},[a("el-option",{attrs:{value:"",label:"全部"}}),e._l(e.BusinessTypeOptions,(function(t){return a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}},[e._v(e._s(t.label))])}))],2)],1),a("el-form-item",{staticStyle:{"margin-right":"24px !important"},attrs:{label:"查询日期：",prop:"date"}},[a("el-date-picker",{staticStyle:{width:"246px"},attrs:{clearable:"",editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{blur:e.onDateBlur},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1),a("el-form-item",[a("tg-button",{attrs:{type:"primary"},on:{click:e.reload}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.reset}},[e._v("重置")])],1)],1)],1),a("tg-card",{staticClass:"roster-project-card flex-auto mgt-12",attrs:{padding:18}},[a("div",{staticClass:"mgb-12"},[a("div",{staticClass:"role-label-group"},e._l(e.roles,(function(t){return a("div",{key:t.name,staticClass:"role-label"},[a("div",{staticClass:"role-color",class:t.class}),a("div",{staticClass:"role-name"},[e._v(e._s(t.name))])])})),0)]),a("div",{staticClass:"roster-project-table-container"},[a("ProjectScheduleTable",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{start:e.startDate,end:e.endDate,schedules:e.data}})],1)])],1)},L=[];(function(e){e[e["ProjectName"]=1]="ProjectName",e[e["ProjectUid"]=2]="ProjectUid"})(S||(S={}));const E=[{value:S.ProjectName,label:"项目名称"},{value:S.ProjectUid,label:"项目编号"}];var W=a(76012);const I=async e=>(0,W.dX)("/api/shop_live/query_schedule_detail_by_project",{params:{...(0,p.jG)(e)}});var J=a(14782),Q=a(36568),U=a.n(Q),G=a(41651);const Z=e=>"周"+",一,二,三,四,五,六,日".split(",")[e],z=e=>_()(e).format("HH:mm"),A={functional:!0,render:(e,t)=>{const a=t.props?.listSign??!1,r=t.props?.last??!1,l=["card-item",a?"card-item-list-sign":""],o=t.props?.ispopover??!1,s=[];return o&&t?.props?.title&&s.push(e("span",{class:"type"},[t.props?.type+"："??""])),t?.props?.title&&s.push(e("span",[t.props?.content??""])),e("div",{class:l,style:{paddingBottom:r?"0":o?"12px":"0"}},[a?e("div",{class:["card-item-sign",r?"card-last-item":""]}):"",e("div",{class:["card-item-title",o?"":"line-clamp-1"]},[t?.props?.title??"暂未排班"]),e("div",{class:["card-item-content",o?"":"line-clamp-1"]},[s])])}},K={functional:!0,render:(e,t)=>{const{start_time:a,end_time:r,star:l,operator:o}=t.props.data,s=z(r),i="00:00"===s?`次日${s}`:s;return e("div",{class:"project-schedule-card"},[e("el-popover",{attrs:{trigger:"hover",popperClass:"project-schedule-card-popover",placement:"right-start",offset:-4,width:298}},[e("div",U()([{class:"project-schedule-card-inner"},{on:{click:()=>{t.listeners?.click()}}},{slot:"reference"}]),[e("div",{class:"project-schedule-card-title"},[z(a),"~",i]),e("div",{class:"project-schedule-card-star project-schedule-card-item-list"},[l.length>0?l.map(((t,a)=>e(A,U()([{},{props:{title:`${z(t.start_time)}~${z(t.end_time)}`,content:t.names.join("/"),listSign:!0,last:a===l.length-1&&l.length>1||l.length<2}}])))):e(A,U()([{},{props:{listSign:!0,last:!0}}]))]),e("div",{class:"project-schedule-card-operator project-schedule-card-item-list"},[o.length>0?o.map((t=>e(A,U()([{},{props:{title:`${z(t.start_time)}~${z(t.end_time)}`,content:t.names.join("/")}}])))):e(A)])]),e("div",{class:"project-schedule-card-popover-inner"},[e("div",{class:"project-schedule-card-title"},[e("div",[z(a),"~",i]),e("div",{class:"live-name"},["直播间：",t.props.data.name?t.props.data.name:"--"])]),e("div",{class:"project-schedule-card-star project-schedule-card-item-list"},[l.length>0?l.map(((t,a)=>e(A,U()([{},{props:{title:`${z(t.start_time)}~${z(t.end_time)}`,type:"主播",content:t.names.join("/"),listSign:!0,last:a===l.length-1&&l.length>1||l.length<2,ispopover:!0}}])))):e(A,U()([{},{props:{listSign:!0,last:!0,ispopover:!0}}]))]),e("div",{class:"project-schedule-card-operator project-schedule-card-item-list"},[o.length>0?o.map((t=>e(A,U()([{},{props:{title:`${z(t.start_time)}~${z(t.end_time)}`,type:"运助",content:t.names.join("/"),ispopover:!0}}])))):e(A)])])])])}},X={functional:!0,render:(e,t)=>{const{schedule:a,row:r,column:l}=t.props,o={gridColumnStart:l,gridColumnEnd:l+1,gridRowStart:r,gridRowEnd:r+1};if(a){const s=`${a.date}-${r}-${l}`;return e("div",{class:"card-cell",style:o,key:s},[a.live_room.map((a=>e(K,{props:{data:a},on:{click:()=>{t.listeners?.click(a.project_id,a.studio_id)}}})))])}return e("div",{class:"card-cell empty",style:o},[e("span",["暂未排班"])])}},H=(0,i.defineComponent)({name:"ProjectScheduleTable",props:{start:{type:Number,required:!0},end:{type:Number,required:!0},schedules:{type:Array,required:!0}},setup(e,t){const a=(0,i.computed)((()=>e.schedules.length)),{jumpLiveDisplayDetail:r}=(0,y.k)(t);return{rows:a,jumpLiveDisplayDetail:r}},render(){const e=arguments[0],t=[e("div",{class:"header-cell"},[e("label",["项目"]),e("div",{class:"border-mask"})])],a=new Array(7).fill("").map(((t,a)=>{const r={gridColumnStart:a+2,gridColumnEnd:a+3,gridRowStart:1,gridRowEnd:2},l=_()(this.start+a*G.MU);return e("div",{class:"header-cell",style:r},[e("label",[l.format("YYYY.MM.DD")]),e("span",[Z(parseInt(l.format("E"),10))]),e("div",{class:"border-mask"})])})),r=this.schedules.map(((t,a)=>{const r={gridColumnStart:1,gridColumnEnd:2,gridRowStart:a+2,gridRowEnd:a+3},l=e("div",{class:"body-cell project-cell",style:r},[e("div",{class:"project-info"},[e("div",{class:"line-clamp-3 project-name"},[t.project_name??"--"]),e("div",{class:"line-clamp-2 project-uid"},[t.project_uid??"--"])])]),o=new Array(7).fill("").map(((t,r)=>{const l={gridColumnStart:r+2,gridColumnEnd:r+3,gridRowStart:a+2,gridRowEnd:a+3};return e("div",{class:"body-cell",style:l},[r+1])}));return[...o,l]})).flat();if(t.push(...a),t.push(...r),0===this.rows){const a=new Array(8).fill("").map(((t,a)=>e("div",{class:"body-cell",style:{padding:0}},[e("div",{style:{backgroundColor:"white",width:"100%",height:"100%"}})])));return e("div",{class:"project-schedule-table"},[t,a])}const l=this.schedules.map(((t,a)=>(t.schedule_list.map(((t,r)=>{const l={gridColumnStart:r+2,gridColumnEnd:r+3,gridRowStart:a+2,gridRowEnd:a+3};return e("div",{class:"card-cell",style:l},[t.date])})),new Array(7).fill("").map(((r,l)=>{const o=this.start+l*G.MU,s=_()(o),i=s.format("YYYY-MM-DD"),n=t.schedule_list.find((e=>e.date===i));return e(X,U()([{},{props:{schedule:n,column:l+2,row:a+2}},{on:{click:(e,t)=>{this.jumpLiveDisplayDetail({project_id:`${e}`,live_id:`${t}`,newWindow:!0})}}}]))}))))).flat();return e("div",{class:"project-schedule-table"},[t,l])}});var V=H;const ee=5184e5,te=()=>{const e=(0,i.ref)({minDate:void 0,maxDate:void 0}),t=(0,i.ref)({disabledDate(t){return!(!e.value.minDate||e.value.minDate&&e.value.maxDate)&&(t.getTime()!==e.value.minDate.getTime()-ee&&t.getTime()!==e.value.minDate.getTime()+ee)},onPick({minDate:t,maxDate:a}){t&&(e.value.minDate=t,e.value.maxDate=a)}}),a=()=>{e.value.minDate=void 0,e.value.maxDate=void 0};return{pickerOptions:t,onDateBlur:a}},ae=new Date,re=ae.getTime()+5184e5,le=(0,u.WU)(ae,"YYYY-mm-dd"),oe=(0,u.WU)(re,"YYYY-mm-dd"),se=()=>{const e=(0,i.ref)(!1),t=(0,i.ref)([]),a=async()=>{if(t.value.length>0)return;e.value=!0;const[{data:a}]=await Promise.all([await(0,J.g)(),await(0,p._v)(500)]);e.value=!1,t.value=a.data},r=(0,i.computed)((()=>t.value.map((e=>({value:e.id,label:e.username})))));return(0,i.onBeforeMount)((()=>{a()})),{pmList:t,pmLoading:e,pmOptions:r}};var ie=(0,i.defineComponent)({name:"TgLiveRosterQueryTabProject",props:{},components:{ProjectScheduleTable:V},setup(e,t){const a=(0,i.ref)(null),r=(0,i.ref)({date:[le,oe],business_type:"",project_manager_id:"",search_type:S.ProjectName,search_value:""}),l=(0,i.ref)([]);(0,i.watch)((()=>r.value.date),(e=>{null===e&&(r.value.date=[le,oe])}));const o=(0,i.ref)([{name:"主播",class:"role-kol"},{name:"运营助理",class:"role-op"}]),s=()=>{r.value.date=[le,oe],r.value.business_type="",r.value.project_manager_id="",r.value.search_type=S.ProjectName,r.value.search_value=""},n=()=>{const{search_value:e,business_type:t,project_manager_id:a,date:[l,o],search_type:s}=r.value;return(""!==e||""!==t||""!==a)&&{search_type:""===e?void 0:s,search_value:""===e?void 0:e,business_type:""===t?void 0:t,project_manager_id:""===a?void 0:a,start_date:l,end_date:o}},d=(0,i.ref)(!1),c=async e=>{d.value=!0;const[{data:t}]=await Promise.all([await I(e),await(0,p._v)(500)]);d.value=!1,l.value=t.data},u=async()=>{const e=n();if(!1===e)return void t.root.$message.warning("请设置查询条件");const{project_manager_id:a,...l}=e,o=(0,p.jG)({project_manager_id:a?`${a}`:void 0,...l}),s=t.root.$route.query;if(JSON.stringify(o)!==JSON.stringify(s)){const{href:a}=t.root.$router.resolve({query:(0,p.jG)(e)});t.root.$router.replace({path:a})}await c(e),v.value=new Date(r.value.date[0]).getTime(),_.value=new Date(r.value.date[1]).getTime()},m=async()=>{s(),t.root.$router.replace({path:t.root.$route.path})};(0,i.onMounted)((()=>{const e=t.root.$route.query;if("{}"===JSON.stringify(e))return;const{start_date:a,end_date:l,business_type:o,project_manager_id:s,search_type:i,search_value:n}=e;r.value.date=[a,l],o&&(r.value.business_type=parseInt(o,10)),s&&(r.value.project_manager_id=parseInt(s,10)),i&&(r.value.search_type=parseInt(i,10)),n&&(r.value.search_value=n),u()}));const v=(0,i.ref)(ae.getTime()),_=(0,i.ref)(re);return{formRef:a,form:r,reset:m,data:l,loading:d,reload:u,...te(),...se(),BusinessTypeOptions:g.Yh.filter((e=>e.value!==g.WD.marketing)),ProjectScheduleQuerySearchTypeOptions:E,startDate:v,endDate:_,roles:o}}}),ne=ie,de=(0,k.Z)(ne,B,L,!1,null,null,null),ce=de.exports,ue=(0,i.defineComponent)({name:"TgLiveRoster",components:{kol:$,operator:O,studio:N,project:ce},props:{tab:{type:String,default:"kol"}},setup(e,t){const{tabs:a,checkedTab:r}=(0,s.pK)([{label:"主播",value:"kol"},{label:"运营助理",value:"operator"},{label:"直播间",value:"studio"},{label:"项目排班",value:"project"}],e.tab),l=e=>{r.value=e.value;const l=a.value[0].value===e.value?{name:o.FB.roster}:{name:o.FB.rosterTab,params:{tab:e.value}};t.root.$router.replace({}),t.root.$router.push(l)};return{tabs:a,checkedTab:r,onTabChange:l}}}),me=ue,pe=(0,k.Z)(me,r,l,!1,null,null,null),ve=pe.exports},6549:function(e,t,a){a.d(t,{C:function(){return l},j:function(){return r}});const r="/api/auth/query_user_v2",l="/api/auth/get_user_by_role"},14782:function(e,t,a){a.d(t,{g:function(){return o},s:function(){return s}});var r=a(76012),l=a(6549);const o=async()=>(0,r.dX)(l.C,{params:{roles:1003}}),s=async()=>(0,r.dX)(l.C,{params:{roles:1008}})},23812:function(e,t,a){a.d(t,{GQ:function(){return i},YE:function(){return o},cY:function(){return n},pK:function(){return s}});var r=a(97434),l=a(44928);const o=(e,t)=>({tabs:(0,r.reactive)([...e]),checkedTab:(0,r.ref)(t??(e.length<1?"":e[0].value))}),s=(e,t)=>{const a=(0,r.isRef)(e)?e:(0,r.ref)(e),l=(0,r.isRef)(t)?(0,r.unref)(t):t,o=a.value.length<1?"":a.value[0].value,s=(0,r.ref)(l??o);return{tabs:a,checkedTab:s}},i=(e,t,a)=>{const l=(0,r.reactive)([...t]),o=(0,r.ref)(a??(t.length<1?"":`${t[0].value}`)),s=t=>{e.root.$router.push({path:e.root.$route.path,query:{tab:`${t.value}`}})};return(0,r.onBeforeMount)((()=>{const r=e.root.$route.query.tab;o.value="string"===typeof r?r:a??(t.length<1?"":`${t[0].value}`)})),{tabs:l,checkedTab:o,onTabChange:s}},n=(e,t)=>{const a=(0,r.reactive)([...e]),o=(0,r.ref)(t??(e.length<1?"":`${e[0].value}`)),s=(0,l.t)(),i=e=>{const t=s.currentRoute,a={...t.params,tab:e.value};s.push({name:t.name,params:a})};return o.value=s.currentRoute.params.tab||t||o.value,{tabs:a,checkedTab:o,onTabChange:i}}},44928:function(e,t,a){a.d(t,{t:function(){return l}});var r=a(86834);const l=()=>{const e=new Proxy({},{get(e,t){return Reflect.get(r.Z,t)}});return e}},40290:function(e,t,a){a.d(t,{k:function(){return l}});var r=a(1763);const l=e=>{const t={jumpProjectDetail:e=>{const a={name:r.FB.project.detail,params:{id:`${e.project_id}`,tab:e.tab??"projectInfo",liveType:e.liveType??"calendar"}},l=e.newWindow??!1;t.jump(a,l)},jumpLiveDisplayDetail:e=>{const a={name:r.FB.display.detail,params:{id:`${e.project_id}`,liveId:`${e.live_id}`,tab:"live",liveType:e.liveType??"calendar"}},l=e.newWindow??!1;t.jump(a,l)},jump:(t,a=!1)=>{if(a){const{href:a}=e.root.$router.resolve(t);window.open(a,"_blank")}else e.root.$router.push(t)}};return{...t}}},67910:function(e,t,a){a.d(t,{P6:function(){return n},zY:function(){return i}});var r=a(97434),l=a(61282),o=a(85937),s=a.n(o);const i=(e,t,a,o=20)=>(0,r.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,l.QN)(a(e,!0)))),(0,l.QN)(t)))+o+6)),n=(e,t=!0)=>{let a;return a=""===e||void 0===e?"--":(0,l.SJ)(new(s())(e??0)),t?(0,r.h)("span",[`￥${a}`]):(0,r.h)("span",[`${a}`])}}}]);