"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[5281],{35734:function(e,t,n){n.r(t),n.d(t,{default:function(){return x}});var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tg-common-business-project-page"},[n("tg-card",{attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[n("el-form",{attrs:{size:"small","show-message":!1,"label-width":"70px"}},[n("div",{staticClass:"filter-form-div"},[n("div",{staticClass:"filter-form-item",staticStyle:{"min-width":"314px"}},[n("el-form-item",{attrs:{label:"项目搜索："}},[n("el-input",{staticClass:"input-with-select",staticStyle:{width:"244px"},attrs:{clearable:"",placeholder:"请输入"+e.search_value_type},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reload.apply(null,arguments)}},model:{value:e.QueryForm.search_value,callback:function(t){e.$set(e.QueryForm,"search_value",t)},expression:"QueryForm.search_value"}},[n("el-select",{staticClass:"search-type-block",staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.QueryForm.search_type,callback:function(t){e.$set(e.QueryForm,"search_type",t)},expression:"QueryForm.search_type"}},[n("el-option",{attrs:{label:"项目名称",value:6}}),n("el-option",{attrs:{label:"项目编码",value:1}}),n("el-option",{attrs:{label:"项目经理",value:5}}),n("el-option",{attrs:{label:"创建人",value:9}}),n("el-option",{attrs:{label:"团队成员",value:8}})],1)],1)],1)],1),n("div",{staticClass:"filter-form-item"},[n("el-form-item",{attrs:{label:"业务平台："}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:e.QueryForm.platform_type,callback:function(t){e.$set(e.QueryForm,"platform_type",t)},expression:"QueryForm.platform_type"}},[n("el-option",{attrs:{label:"全部",value:""}}),n("el-option",{attrs:{label:"抖音平台",value:1}}),n("el-option",{attrs:{label:"淘宝平台",value:2}})],1)],1)],1),n("div",{staticClass:"filter-form-item"},[n("el-form-item",{attrs:{label:"项目类型："}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:e.QueryForm.mcn_project_type,callback:function(t){e.$set(e.QueryForm,"mcn_project_type",t)},expression:"QueryForm.mcn_project_type"}},[n("el-option",{attrs:{label:"全部",value:""}}),e._l(e.projectTypeOptions,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1)],1),n("div",{staticClass:"filter-form-item"},[n("el-form-item",{attrs:{label:"项目阶段："}},[n("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:""},model:{value:e.QueryForm.project_status,callback:function(t){e.$set(e.QueryForm,"project_status",t)},expression:"QueryForm.project_status"}},[n("el-option",{attrs:{label:"全部",value:""}}),n("el-option",{attrs:{label:"执行中",value:e.ProjectStatusEnum.execution}}),n("el-option",{attrs:{label:"执行结束",value:e.ProjectStatusEnum.executionEnd}}),n("el-option",{attrs:{label:"已完结",value:e.ProjectStatusEnum.finish}})],1)],1)],1),n("div",{staticClass:"filter-form-item"},[n("el-form-item",{attrs:{"label-width":"0"}},[n("div",{staticClass:"filter-form-item-btn"},[n("tg-button",{attrs:{type:"primary"},on:{click:e.onQuerySearchClick}},[e._v("查询")]),n("tg-button",{staticClass:"mgl-12",on:{click:e.onQueryResetClick}},[e._v("重置")])],1)])],1)])])],1),n("tg-card",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mgt-12",class:e.cardFlexClass,attrs:{padding:[0,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[e.Permission.canEdit?n("tg-button-line",{staticClass:"mgt-12"},[n("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:function(t){return e.toggleProjectModalVisible(!0)}}},[e._v("新增项目")])],1):e._e(),e.Permission.canViewList?n("el-table",e._b({class:e.Permission.canEdit?"mgt-12":"mgt-18",attrs:{stripe:"",data:e.list},on:{"row-click":e.onRowClick},scopedSlots:e._u([{key:"empty",fn:function(){return[n("empty-common",{attrs:{"detial-text":"暂无项目"}})]},proxy:!0}],null,!1,3081171088)},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,r){return n("el-table-column",e._b({key:r},"el-table-column",t,!1))})),1):e._e(),e.Permission.canViewList&&e.total>0?n("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.QueryForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.QueryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.QueryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.QueryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}}):e._e()],1),n("CommonBusinessProjectDialog",{attrs:{title:e.ProjectFormTitle,visible:e.ProjectFormVisible},on:{"dialog:close":e.onProjectFormModalClose}})],1)},a=[],o=n(97434),u=n(78902),c=n(1763),i=n(4665),l=n(21757),s=n(64236),p=n(83626),m=n(6933),_=n.n(m),d=n(67910),f=n(61282),h=n(29625);const v=e=>{const t=(0,o.ref)(!1),n=(0,o.ref)([]),r=(0,o.ref)(0),a=async a=>{t.value=!0;const[o,{data:u}]=await Promise.all([await(0,s._v)(500),await(0,p.fX)(a)]);t.value=!1,u.success?(n.value=u.data.data,r.value=u.data.total):e.root.$message({type:"warning",message:u.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},u=e=>e.project_uid??"--",c=(e,t)=>{const n=e.project_name||"--",{is_folded:r,folded_text:a}=(0,f.zb)(n,12);return t||!r?a:(0,o.h)("el-popover",{props:{placement:"right",trigger:"hover",content:n}},[(0,o.h)("span",{slot:"reference"},[a]),(0,o.h)("DefText",{props:{content:e.project_name}})])},l=(0,d.zY)(n,"项目名称",c),m=(0,o.computed)((()=>[{label:"项目编码",property:"project_uid",fixed:"left",minWidth:(0,d.zY)(n,"项目编码",u).value,formatter:u},{label:"项目名称",property:"project_name",fixed:"left",minWidth:l.value,formatter:e=>c(e,!1)},{label:"所属部门",minWidth:118,align:"center",formatter:e=>(0,o.h)("div",{},[e.feishu_department_name?e.feishu_department_name:"--"])},{label:"业务平台",minWidth:98,align:"center",property:"platform_type",formatter:e=>{let t="--";return 1===e.platform_type?t="抖音平台":2===e.platform_type&&(t="淘宝平台"),(0,o.h)("div",{},[t])}},{label:"项目类型",minWidth:98,align:"center",formatter:e=>{const t=i.MU.get(e.mcn_project_type)??"--";return(0,o.h)("div",{},[t])}},{label:"项目经理",minWidth:88,align:"center",formatter:e=>(0,o.h)("div",{},[e.project_manager?e.project_manager:"--"])},{label:"项目阶段",minWidth:88,align:"center",formatter:e=>(0,o.h)("div",{},[e.project_status===h.C_.execution?"执行中":e.project_status===h.C_.executionEnd?"执行结束":"已完结"])},{label:"创建人",width:98,align:"center",property:"add_by_username",formatter:e=>(0,o.h)("div",{},[e.add_by_username])},{label:"创建日期",width:110,align:"center",property:"add_by_username",formatter:e=>(0,o.h)("div",{},[_()(e.gmt_create).format("YYYY.MM.DD")])}]));return{loadData:a,list:n,loading:t,total:r,columns:m}};var g=n(90553),y=n(58302),b=n(30845),j=(0,o.defineComponent)({name:"TgCommonBusinessProject",components:{CommonBusinessProjectDialog:g.Z},setup(e,t){const n=(0,o.ref)({search_type:6,search_value:"",mcn_project_type:"",platform_type:"",project_status:"",page_num:1,num:20,data_type:2}),r=(0,o.computed)((()=>{const e=new Map([[6,"项目名称"],[1,"项目编码"],[5,"项目经理"],[9,"创建人"],[8,"团队成员"]]);return""===n.value.search_type?"":e.get(n.value.search_type)??""})),a=(0,o.computed)((()=>{const e=(0,l.kG)(u.HN.common_business_project_view),t=(0,l.kG)(u.HN.common_business_project_save);return{canEdit:t,canViewList:e}})),s=v(t),p=e=>{t.root.$router.push({name:c.u3.project.detail,params:{id:`${e.id}`}})},m=()=>{n.value.search_type=6,n.value.search_value="",n.value.mcn_project_type="",n.value.platform_type="",n.value.page_num=1,n.value.project_status="",n.value.num=20},_=()=>{m(),P()},d=async e=>{q(!1),e&&await P()},f=e=>{n.value.page_num=e,P(!1)},g=e=>{n.value.num=e,P()},j=()=>{P()},P=async(e=!0)=>{e&&(n.value.page_num=1);const{search_type:t,search_value:r,...a}=n.value,o=(0,b.f)(t),u={...a};r?(u.search_type=o,u.search_value=r):(u.search_type=void 0,u.search_value=""),await s.loadData(u)};(0,o.onBeforeMount)((()=>{P()}));const w=32,C=34,x=36,k=31,$=(0,o.ref)(0),F=e=>{$.value=e.height},Z=(0,y.Z)({compensation:(0,o.computed)((()=>w+C+x+k)),fixedBlockHeightRefs:[$],tableMinHeight:100,pagename:"common_bussiness_project"}),S=(0,o.ref)(!1),Q=(0,o.ref)("新增项目"),q=(e=!1)=>{S.value=e},M=(0,o.computed)((()=>{let e=[];const t=[i.kA.taobao_cps,i.kA.v_task,i.kA.label,i.kA.clothing,i.kA.head,i.kA.makeups];return e=t.map((e=>({label:i.MU.get(e),value:e}))),e}));return{ProjectStatusEnum:h.C_,onProjectFormModalClose:d,onQuerySearchClick:j,onQueryResetClick:_,handleCurrentChange:f,handlePageSizeChange:g,ProjectFormVisible:S,ProjectFormTitle:Q,toggleProjectModalVisible:q,...s,QueryForm:n,onRowClick:p,search_value_type:r,Permission:a,onTopCardRectUpdate:F,...Z,projectTypeOptions:M}}}),P=j,w=n(1001),C=(0,w.Z)(P,r,a,!1,null,null,null),x=C.exports},86863:function(e,t,n){n.d(t,{B9:function(){return w},C7:function(){return g},E2:function(){return p},Fn:function(){return s},Jv:function(){return j},LK:function(){return _},Ou:function(){return v},TG:function(){return u},Uw:function(){return a},XZ:function(){return m},_6:function(){return b},aw:function(){return Z},cQ:function(){return P},dh:function(){return F},em:function(){return o},g9:function(){return x},iI:function(){return l},it:function(){return y},jy:function(){return f},kT:function(){return C},pc:function(){return c},qJ:function(){return d},qq:function(){return h},ve:function(){return k},vf:function(){return $},w_:function(){return i}});var r=n(76012);n(42963);function a(e){return(0,r.ZP)({url:"/api/cust/del_customer",method:"get",params:e})}function o(e){return(0,r.ZP)({url:"/api/auth/query_user_names",method:"get",params:e})}function u(){return(0,r.ZP)({url:"/api/auth/query_user_names",method:"get"})}function c(e){return(0,r.ZP)({url:"/api/auth/get_user_by_role",method:"get",params:e})}function i(e){return(0,r.ZP)({url:"/api/cont/upload_attachment",method:"post",data:e})}function l(){return(0,r.ZP)({url:"/api/auth/get_department",method:"get"})}function s(){return(0,r.ZP)({url:"/api/cont/get_approver",method:"get"})}function p(e,t=1){const n=1===t?"/api/cont/query_contract":2===t?"/api/cont/query_law_contract":4===t?"/api/cont/query_cooperation_contract":5===t?"/api/cont/query_common_contract":"/api/cont/query_shop_live_contract";return(0,r.ZP)({url:n,method:"get",params:e})}function m(){return(0,r.ZP)({url:"/api/cont/get_contract_uid",method:"get"})}function _(e={}){return(0,r.ZP)({url:"/api/shop_live/get_shop_live_contract_uid",method:"get",params:e})}function d(e){return(0,r.ZP)({url:"/api/cont/del_contract",method:"post",data:e})}function f(e){return(0,r.ZP)({url:"/api/cont/approve_contract",method:"post",data:e})}function h(e){return(0,r.ZP)({url:"/api/cont/del_contract",method:"post",data:e})}function v(e){return(0,r.ZP)({url:`/api/cont/delete_contract_annex/${e}/`,method:"post"})}function g(e){return(0,r.ZP)({url:`/api/cont/delete_contract_statements/${e}/`,method:"post"})}function y(e){return(0,r.ZP)({url:"/api/cont/invalid_contract",method:"post",data:e})}function b(e){return(0,r.ZP)({url:"/api/cont/recycle_contract",method:"post",data:e})}function j(e){return(0,r.ZP)({url:"/api/auth/get_user_by_role",method:"get",params:e})}function P(e){return(0,r.ZP)({url:"/api/cont/get_partner_by_name",method:"get",params:e})}function w(e){return(0,r.ZP)({url:"/api/cont/save_contract_annex",method:"post",data:e})}function C(e){return(0,r.ZP)({url:"/api/cont/del_contract_annex",method:"post",data:e})}function x(e){return(0,r.ZP)({url:"/api/cont/query_contract_annex",method:"get",params:e})}function k(e){return(0,r.ZP)({url:"/api/cont/query_contract_statements",method:"get",params:e})}function $(e){return(0,r.ZP)({url:`/api/cont/get_contract_approval_flow/${e}/`,method:"get"})}function F(e){return(0,r.ZP)({url:`/api/cont/get_contract_annex_approval_flow/${e}/`,method:"get"})}function Z(e){return(0,r.ZP)({url:`/api/cont/get_contract_statements_approval_flow/${e}/`,method:"get"})}},83626:function(e,t,n){n.d(t,{TR:function(){return q},Cv:function(){return S},eF:function(){return F},R5:function(){return X},Fb:function(){return E},Ll:function(){return M},$q:function(){return P},fX:function(){return j},cm:function(){return Z},LE:function(){return $},ME:function(){return x},Iq:function(){return R},gY:function(){return T},ij:function(){return w},yT:function(){return k},x$:function(){return z},AT:function(){return Q},Il:function(){return O},Lt:function(){return H},i1:function(){return C},nY:function(){return Y},YP:function(){return G}});const r="/api/shop_live/query_common_project",a="/api/shop_live/get_common_project/:id/",o="/api/shop_live/save_common_project",u="/api/payable/query_common_payables",c="/api/common_business/save_cost",i="/api/common_business/query_cost",l="/api/common_business/del_cost",s="/api/shop_live/query_mcn_shop_live",p="/api/shop_live/merchant_goods/",m="/api/shop_live/merchant_goods_v2",_="/api/shop_live/update_shop_live_common_project_team_members",d="/api/shop_live/get_live_goods",f="/api/shop_live/get_shop_live_common_project_profit_stat_data",h="/api/common_business/query_s2b2c_douyin_daily_report",v="/api/common_business/query_s2b2c_douyin_live_report",g="/api/shop_live/save_project_douyin_goal_info";var y=n(64236),b=n(76012);const j=async e=>(0,b.dX)(r,{params:{...(0,y.jG)(e)}}),P=async e=>(0,b.dX)(a.replace(":id",e)),w=async e=>(0,b.dX)("/api/receivable/query_common_receivables",{params:{...(0,y.jG)(e)}}),C=async e=>(0,b.SO)(o,{...(0,y.jG)(e)}),x=(e,t,n,r)=>(0,b.dX)("/api/common_business/query_daily_report",{params:{begin_time:e,end_time:t,project_id:n,business_type:r}}),k=e=>(0,b.SO)("/api/common_business/save_daily_report",(0,y.jG)(e)),$=async e=>(0,b.dX)(u,{params:e}),F=e=>(0,b.SO)(c,(0,y.jG)(e)),Z=async e=>(0,b.dX)(i,{params:{project_id:e}}),S=e=>(0,b.SO)(l,{cost_id:e}),Q=async e=>(0,b.dX)(s,{params:{...(0,y.jG)(e??"")}}),q=e=>(0,b.SO)(p,(0,y.jG)(e)),M=(e,t)=>(0,b.qb)(`/api/shop_live/merchant_goods/${t}/`,(0,y.jG)(e)),E=e=>(0,b.HG)(`/api/shop_live/merchant_goods/${e}/`),G=async(e,t)=>(0,b.qb)(`${_}/${e}/`,{...t}),R=async e=>(0,b.dX)(d,{params:{...(0,y.jG)(e??"")}}),X=e=>(0,b.HG)(`/api/shop_live/delete_live_goods/${e}/`),T=async e=>(0,b.dX)(m,{params:{...(0,y.jG)(e??"")}}),z=async e=>(0,b.dX)(`${f}/${e}/`),O=async e=>(0,b.dX)(h,{params:{...(0,y.jG)(e)}}),H=async e=>(0,b.dX)(v,{params:{...(0,y.jG)(e)}}),Y=e=>(0,b.SO)(g,(0,y.jG)(e))},58302:function(e,t,n){var r=n(97434),a=n(77944),o=n(52140);const u=e=>{const t=(0,r.computed)((()=>a.Z.getters["global/scrollbarSetting"])),n=(0,r.computed)((()=>void 0!==e.pagename?!0!==t.value.find((t=>t.key===e.pagename))?.value:e.disable??!1)),u=(0,r.computed)((()=>{const t=(e.fixedBlockHeightRefs??[]).map((e=>(0,r.unref)(e))).reduce(((e,t)=>(0,r.unref)(e)+(0,r.unref)(t)),0);return n.value?"max-content":`calc(100vh - ${(0,r.unref)(t)+56+36}px)`})),c=(0,r.computed)((()=>(n.value,"flex-auto"))),i=(0,r.computed)((()=>({height:u.value,overflowInBody:!n.value}))),l=(0,r.ref)(0),s=(0,r.computed)((()=>n.value?{}:{height:Math.max(l.value-(0,r.unref)((0,r.unref)(e.compensation)),e.tableMinHeight??0)})),p=n.value?()=>{}:e=>{l.value!==e&&(l.value=e,(0,o.S)())},m=n.value?()=>{}:t=>{0===l.value?setTimeout((()=>{p(t.height)}),e.delay??1200):p(t.height)};return{cardHeight:u,tableProps:s,onRectUpdate:m,rectHeight:l,cardFlexClass:c,cardProps:i}};t["Z"]=u},52140:function(e,t,n){n.d(t,{S:function(){return r},n:function(){return a}});const r=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},a=()=>{const{width:e,height:t}=document.body.getBoundingClientRect();return{width:e,height:t}}},30845:function(e,t,n){n.d(t,{f:function(){return r}});const r=e=>""===e?void 0:e},67910:function(e,t,n){n.d(t,{P6:function(){return i},zY:function(){return c}});var r=n(97434),a=n(61282),o=n(85937),u=n.n(o);const c=(e,t,n,o=20)=>(0,r.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,a.QN)(n(e,!0)))),(0,a.QN)(t)))+o+6)),i=(e,t=!0)=>{let n;return n=""===e||void 0===e?"--":(0,a.SJ)(new(u())(e??0)),t?(0,r.h)("span",[`￥${n}`]):(0,r.h)("span",[`${n}`])}},57046:function(e,t,n){n.d(t,{I8:function(){return a},X1:function(){return o},mr:function(){return r}});n(26699);function r(e,t="yyyy-MM-dd"){var n=new Date(e),r={"M+":n.getMonth()+1,"d+":n.getDate(),"h+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?r[a]:("00"+r[a]).substr((""+r[a]).length)));return t}function a(e){const t=e.constructor===Array?[]:{};for(let n in e)e.hasOwnProperty(n)&&(e[n]&&"object"===typeof e[n]?(t[n]=e[n].constructor===Array?[]:{},t[n]=a(e[n])):t[n]=e[n]);return t}function o(e,t,n){const r=e.target.value,a=/^[1-9]\d*$/;e.target.value=a.test(r)?r:"",t[n]=a.test(r)?r:""}}}]);