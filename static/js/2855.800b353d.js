"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[2855,5028],{45028:function(e,t,a){a.d(t,{Z:function(){return b}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-display-dialog-add-page tg-dialog-vcenter"},[a("el-drawer",{staticClass:"tg-dialog-classic",attrs:{title:e.title,visible:e.visible,wrapperClosable:!1,"close-on-press-escape":!1},on:{close:e.handleCloseAction}},[a("div",{staticClass:"ta-live-display-content"},[a("el-form",{ref:"formRef",attrs:{"label-position":"top",model:e.numOfSessionsForm,rules:e.formRules,size:"small","label-width":"106px"}},[a("head-lines",{staticStyle:{"margin-bottom":"17px","margin-left":"-10px"},attrs:{title:"场次信息"}}),a("el-form-item",{staticClass:"one-item",attrs:{label:"直播标题",prop:"live_title"}},[a("el-input",{attrs:{placeholder:"请输入直播标题",maxlength:"20",clearable:""},model:{value:e.numOfSessionsForm.live_title,callback:function(t){e.$set(e.numOfSessionsForm,"live_title","string"===typeof t?t.trim():t)},expression:"numOfSessionsForm.live_title"}})],1),a("div",{staticClass:"four-item"},[a("el-form-item",{staticClass:"date-picker-item",attrs:{label:"直播时间",prop:"live_start_time"}},[a("el-date-picker",{staticStyle:{width:"472px"},attrs:{clearable:!1,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","popper-class":"live-time-layer"},on:{change:e.onLiveTimeChange},model:{value:e.numOfSessionsForm.startTimeAndEndTime,callback:function(t){e.$set(e.numOfSessionsForm,"startTimeAndEndTime",t)},expression:"numOfSessionsForm.startTimeAndEndTime"}})],1)],1),a("el-form-item",{staticClass:"one-item",attrs:{label:"直播间",prop:"studio_id",rules:e.studioRequired?{required:!0,message:"请选择直播间",trigger:["blur","change"]}:void 0}},[a("el-select",{attrs:{remote:"","reserve-keyword":"",clearable:!e.studioRequired,disabled:""===e.project_id,filterable:"",placeholder:"请选择直播间","remote-method":e.queryStudio},on:{change:e.studioChanged},model:{value:e.numOfSessionsForm.studio_name,callback:function(t){e.$set(e.numOfSessionsForm,"studio_name",t)},expression:"numOfSessionsForm.studio_name"}},e._l(e.studioList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.studio_name,value:e.studio_name}})})),1)],1),a("section",{staticClass:"schedule-list three-item",staticStyle:{"margin-top":"29px"}},[a("head-lines",{staticStyle:{"margin-left":"-10px"},attrs:{title:"主播排班信息"}}),a("div",{staticStyle:{"margin-top":"15px"}},[a("tg-button",{attrs:{type:"primary",size:"mini",disabled:!!e.numOfSessionsForm.kol_schedule_infos.length||!e.numOfSessionsForm.live_title||!e.numOfSessionsForm.live_start_time||!e.numOfSessionsForm.studio_id&&e.studioRequired||e.isNotOneDay||e.isAutoObtain},on:{click:e.onAddkolSchedule}},[e._v(" 添加排班 ")]),a("tg-button",{staticClass:"mgl-12",attrs:{type:"default",size:"mini",disabled:!e.numOfSessionsForm.kol_schedule_infos.length||e.isAutoObtain},on:{click:e.onDeleteKolSchedule}},[e._v(" 清除排班 ")])],1),e.numOfSessionsForm.kol_schedule_infos.length?a("div",{staticStyle:{display:"flex",width:"100%"}},[a("div",{staticStyle:{"margin-right":"9px",position:"relative","margin-top":"18px",width:"2px"}},[a("div",{staticStyle:{margin:"8px 0",height:"calc(100% - 22px)",background:"rgba(164, 178, 194, 0.3)"}}),a("div",{staticStyle:{position:"absolute",top:"0",left:"-2px",width:"6px",height:"6px","-moz-border-radius":"3px","-webkit-border-radius":"3px","border-radius":"3px",background:"rgba(164, 178, 194, 0.3)"}}),a("div",{staticStyle:{position:"absolute",bottom:"7px",left:"-2px",width:"6px",height:"6px","-moz-border-radius":"3px","-webkit-border-radius":"3px","border-radius":"3px",background:"rgba(164, 178, 194, 0.3)"}})]),a("div",{staticStyle:{width:"100%"}},[e._l(e.numOfSessionsForm.kol_schedule_infos,(function(t,s){return a("div",{key:s,staticStyle:{position:"relative"}},[s>0&&!e.isAutoObtain?a("i",{staticClass:"delete-btn-time el-icon-error",on:{click:function(t){return e.deleteKolTime(s)}}}):e._e(),a("div",{staticStyle:{padding:"18px 18px 0 18px",background:"#f8fafc",color:"#666","margin-top":"18px","border-radius":"4px",width:"100%"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"直播时间"}},[a("div",[a("el-date-picker",{staticStyle:{width:"176px"},attrs:{type:"datetime",disabled:0===s||e.isAutoObtain,clearable:!1,format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","picker-options":t.pickerOptions,placeholder:"选择日期时间"},on:{change:function(t){return e.kolWorkTime(s)}},model:{value:t.start_time,callback:function(a){e.$set(t,"start_time",a)},expression:"item.start_time"}}),a("span",[e._v(" ~ "+e._s(t.end_time||"待设置"))])],1)]),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"排班人员",rules:{required:!0,message:"请选择排版人员"}}},[a("div",[a("el-select",{attrs:{clearable:"",multiple:"","reserve-keyword":"",disabled:e.isAutoObtain,filterable:"",value:t.kol_ids,placeholder:"请输入并选择排班人员"},on:{change:function(t){return e.onSelectKolUserChanged(t,s)}}},e._l(e.anchorKolList,(function(e){return a("el-option",{key:e.kol_id,attrs:{label:e.kol_name+"("+e.real_name+")",value:e.kol_id}})})),1)],1)])],1)])})),a("div",{staticClass:"add-timeline",attrs:{disabled:e.isAutoObtain},on:{click:function(){return e.addKolTimeLine(!0)}}},[a("i",{staticClass:"el-icon-circle-plus"}),e._v("添加时间点 ")])],2)]):e._e()],1),a("section",{staticClass:"schedule-list three-item",staticStyle:{"margin-top":"29px"}},[a("head-lines",{staticStyle:{"margin-left":"-10px"},attrs:{title:"运营排班信息"}}),a("div",{staticStyle:{"margin-top":"15px"}},[a("tg-button",{attrs:{type:"primary",size:"mini",disabled:!!e.numOfSessionsForm.operator_schedule_infos.length||!e.numOfSessionsForm.live_title||!e.numOfSessionsForm.live_start_time||!e.numOfSessionsForm.studio_id&&e.studioRequired||e.isNotOneDay},on:{click:e.onAddOperatorSchedule}},[e._v(" 添加排班 ")]),a("tg-button",{staticClass:"mgl-12",attrs:{type:"default",size:"mini",disabled:!e.numOfSessionsForm.operator_schedule_infos.length},on:{click:e.onDeleteOperatorSchedule}},[e._v(" 清除排班 ")])],1),e.numOfSessionsForm.operator_schedule_infos.length?a("div",{staticStyle:{display:"flex",width:"100%"}},[a("div",{staticStyle:{"margin-right":"9px",position:"relative","margin-top":"18px",width:"2px"}},[a("div",{staticStyle:{margin:"8px 0",height:"calc(100% - 22px)",background:"rgba(164, 178, 194, 0.3)"}}),a("div",{staticStyle:{position:"absolute",top:"0",left:"-2px",width:"6px",height:"6px","-moz-border-radius":"3px","-webkit-border-radius":"3px","border-radius":"3px",background:"rgba(164, 178, 194, 0.3)"}}),a("div",{staticStyle:{position:"absolute",bottom:"7px",left:"-2px",width:"6px",height:"6px","-moz-border-radius":"3px","-webkit-border-radius":"3px","border-radius":"3px",background:"rgba(164, 178, 194, 0.3)"}})]),a("div",{staticStyle:{width:"100%"}},[e._l(e.numOfSessionsForm.operator_schedule_infos,(function(t,s){return a("div",{key:s,staticStyle:{position:"relative"}},[s>0?a("i",{staticClass:"delete-btn-time el-icon-error",on:{click:function(t){return e.deleteOperateTime(s)}}}):e._e(),a("div",{staticStyle:{padding:"18px 18px 0 18px",background:"#f8fafc",color:"#666","margin-top":"18px","border-radius":"4px",width:"100%"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"直播时间"}},[a("div",[a("el-date-picker",{staticStyle:{width:"176px"},attrs:{type:"datetime",disabled:0===s,clearable:!1,format:"yyyy.MM.dd HH:mm","value-format":"yyyy-MM-dd HH:mm","picker-options":t.pickerOptions,placeholder:"选择日期时间"},on:{change:function(t){return e.kolOperateTime(s)}},model:{value:t.start_time,callback:function(a){e.$set(t,"start_time",a)},expression:"item.start_time"}}),a("span",[e._v(" ~ "+e._s(t.end_time||"待设置"))])],1)]),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"排班人员",rules:{required:!0,message:"请选择排版人员"}}},[a("div",[a("el-select",{attrs:{clearable:"",multiple:"","reserve-keyword":"",filterable:"",value:t.operator_ids,placeholder:"请输入并选择排班人员"},on:{change:function(t){return e.onSelectOperateUserChanged(t,s)}}},e._l(e.oprateList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.id}})})),1)],1)])],1)])})),a("div",{staticClass:"add-timeline",on:{click:e.addOperateTimeLine}},[a("i",{staticClass:"el-icon-circle-plus"}),e._v("添加时间点 ")])],2)]):e._e()],1)],1),a("div",{staticClass:"live-display-add-footer"},[a("tg-button",{attrs:{size:"small"},on:{click:e.handleCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleSaveHandler}},[e._v("保存")])],1)],1)]),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},i=[],o=a(97434),r=a(3293),l=a(64236),n=a(47583),c=a(50935),d=a(6933),p=a.n(d),u=a(82741),_=a(53451),m=a.n(_);const{debounce:v}=m();var f=(0,o.defineComponent)({props:{visible:{type:Boolean,default:!1},title:{type:String,default:"新增场次"},start_date_disabled:{type:Boolean,default:!1},defaultDisplay:{type:Object},project_id:{type:Number,default:-1},business_type:{type:Number},studioInfo:{type:Object}},setup(e,t){const a=(0,o.ref)(!1),s=(0,o.ref)(void 0),i=(0,o.ref)({id:void 0,project_id:e.project_id,live_title:"",live_start_time:"",live_end_time:"",studio_id:Number(e.studioInfo?.studio_id),studio_name:e.studioInfo?.studio_name,kol_schedule_infos:[],operator_schedule_infos:[],startTimeAndEndTime:[]});(0,o.watch)([()=>e.visible,()=>e.defaultDisplay],(async()=>{if(e.visible&&(i.value.studio_id=e.studioInfo?Number(e.studioInfo?.studio_id):Number(e.defaultDisplay?.studio_id),i.value.studio_name=e.studioInfo?e.studioInfo?.studio_name:e.defaultDisplay?.studio_name,e.defaultDisplay)){d.value=e.defaultDisplay?.business_type;const{id:t=0,project_id:a=0,live_title:s="",live_start_time:o="",live_end_time:n=""}=e.defaultDisplay,[{data:c}]=await(0,l.Dc)(300,(0,r.D2)(t));if(c.success){const e={},t={};c.data.operator_schedule_list.forEach((e=>{const a=p()(e.start_time).valueOf();t[a]?t[a].operator_ids.push(e.user_id):(t[a]={},t[a].start_time=e.start_time,t[a].end_time=e.end_time,t[a].operator_ids=[e.user_id],t[a].pickerOptions={disabledDate(t){return p()(t).format("YYYY-MM-DD")<p()(e.start_time).format("YYYY-MM-DD")||p()(t).format("YYYY-MM-DD")>p()(e.end_time).format("YYYY-MM-DD")}})})),c.data.kol_schedule_list.forEach((t=>{const a=p()(t.start_time).valueOf();e[a]?e[a].kol_ids.push(t.kol_id):(e[a]={},e[a].start_time=t.start_time,e[a].end_time=t.end_time,e[a].kol_ids=[t.kol_id],e[a].pickerOptions={disabledDate(e){return p()(e).format("YYYY-MM-DD")<p()(t.start_time).format("YYYY-MM-DD")||p()(e).format("YYYY-MM-DD")>p()(t.end_time).format("YYYY-MM-DD")}})})),i.value.operator_schedule_infos=Object.values(t),i.value.kol_schedule_infos=Object.values(e)}i.value.project_id=a,i.value.id=t,i.value.live_title=s,i.value.live_start_time=o,i.value.live_end_time=n,i.value.startTimeAndEndTime=[o,n]}}));const d=(0,o.ref)(void 0),_=(0,o.ref)([]),m=(0,o.ref)({project_id:{required:!0,message:"请输入项目编号",trigger:["change","blur"]},live_start_time:{required:!0,message:"请选择直播日期",trigger:"blur"},live_title:{required:!0,message:"请输入直播标题",trigger:"blur"}});async function f(e,t){const{data:a}=await(0,r.lj)(e,t);a.success&&(_.value=a.data)}const h=()=>{b(),t.emit("closeAction")},g=(0,o.reactive)({check_kol_schedule_infos:[],anchorKolList:[],oprateList:[]}),y=e=>{const t=_.value.filter((t=>e===t.studio_name));t.length?i.value.studio_id=t[0].id:i.value.studio_id=void 0},b=()=>{i.value={id:void 0,project_id:e.project_id,live_title:"",live_start_time:"",live_end_time:"",studio_id:Number(e.studioInfo?.studio_id),studio_name:e.studioInfo?.studio_name,kol_schedule_infos:[],operator_schedule_infos:[],startTimeAndEndTime:[]},s.value?.clearValidate()},{loadScheduleData:w,ScheduleData:x,...k}=(0,c.g)(),C=e=>{""!==e?f(e,d.value):_.value=[]},S=(0,o.ref)([]),j=async()=>{const{data:e}=await(0,r.Sx)({});e.success?(S.value=e.data,g.anchorKolList=e.data.filter((e=>e.kol_id<0))):g.anchorKolList=[];const t=await(0,n.uZ)({roles:"1001",business_type:d.value});t.data.success?g.oprateList=t.data.data:g.oprateList=[]},D=()=>{const e=[{duration:0,start_time:"",end_time:"",name:"",id:0}],t=(0,l.Tw)(e.map((e=>[e.start_time,e.end_time])).flat()).map((e=>new Date(e).getTime())).sort();t.shift(),t.forEach(((e,a)=>{a<t.length-1&&P()}))},$=()=>{const e=[{duration:0,start_time:"",end_time:"",name:"",id:-1}],t=(0,l.Tw)(e.map((e=>[e.start_time,e.end_time])).flat()).map((e=>new Date(e).getTime())).sort();t.shift(),t.forEach(((e,a)=>{a<t.length-1&&M()}))},A=async()=>{await j(),D(),$()};A();const P=(e=!1)=>{if(H.value&&e)return;const a=i.value.kol_schedule_infos.length,s=i.value.kol_schedule_infos[a-1],o=i.value.kol_schedule_infos.length-1,r=i.value.kol_schedule_infos[o].end_time,l=i.value.kol_schedule_infos[o].start_time;s.start_time?0!==i.value.kol_schedule_infos[o].kol_ids.length?i.value.kol_schedule_infos?.push({end_time:"",start_time:p()(l).format("YYYY-MM-DD")+" 00:00",kol_ids:[],pickerOptions:{disabledDate(e){return p()(e).format("YYYY-MM-DD")<p()(l).format("YYYY-MM-DD")||p()(e).format("YYYY-MM-DD")>p()(r).format("YYYY-MM-DD")}}}):t.root.$message.error({showClose:!0,duration:6e3,message:"未选择排班人员"}):t.root.$message.error({showClose:!0,duration:6e3,message:"请先选择时间"})},F=e=>{const t=i.value.kol_schedule_infos[e],a=i.value.kol_schedule_infos[e-1];1!==e||t.start_time?(a.end_time=t.start_time,e===i.value.kol_schedule_infos.length-1&&(t.end_time=i.value.live_end_time)):a.end_time=i.value.live_end_time},R=e=>{const t=i.value.operator_schedule_infos[e],a=i.value.operator_schedule_infos[e-1];1!==e||t.start_time?(a.end_time=t.start_time,e===i.value.operator_schedule_infos.length-1&&(t.end_time=i.value.live_end_time)):a.end_time=i.value.live_end_time},M=()=>{const e=i.value.operator_schedule_infos.length,a=i.value.operator_schedule_infos[e-1],s=i.value.operator_schedule_infos.length-1,o=i.value.operator_schedule_infos[s].end_time,r=i.value.operator_schedule_infos[s].start_time;a.start_time?0!==i.value.operator_schedule_infos[s].operator_ids.length?i.value.operator_schedule_infos?.push({end_time:"",start_time:p()(r).format("YYYY-MM-DD")+" 00:00",operator_ids:[],pickerOptions:{disabledDate(e){return p()(e).format("YYYY-MM-DD")<p()(r).format("YYYY-MM-DD")||p()(e).format("YYYY-MM-DD")>p()(o).format("YYYY-MM-DD")}}}):t.root.$message.error({showClose:!0,duration:6e3,message:"未选择排班人员"}):t.root.$message.error({showClose:!0,duration:6e3,message:"请先选择时间"})},E=e=>{i.value.kol_schedule_infos.splice(e,1);const t=i.value.kol_schedule_infos.length;i.value.kol_schedule_infos.forEach(((e,a)=>{e.end_time=a===t-1?i.value.live_end_time:i.value.kol_schedule_infos[a+1].start_time}))},I=e=>{i.value.operator_schedule_infos.splice(e,1);const t=i.value.operator_schedule_infos.length;i.value.operator_schedule_infos.forEach(((e,a)=>{e.end_time=a===t-1?i.value.live_end_time:i.value.operator_schedule_infos[a+1].start_time}))},T=(e,t)=>{const a=i.value.kol_schedule_infos;a[t].kol_ids=e},O=(e,t)=>{i.value.operator_schedule_infos[t].operator_ids=e},V=()=>{i.value.live_start_time?i.value.kol_schedule_infos?.push({end_time:i.value.live_end_time,start_time:i.value.live_start_time,kol_ids:[],pickerOptions:{}}):t.root.$message.error({showClose:!0,duration:6e3,message:"请先选择直播开始时间和结束时间"})},Z=()=>{i.value.kol_schedule_infos=[]},L=()=>{i.value.live_start_time?i.value.operator_schedule_infos?.push({end_time:i.value.live_end_time,start_time:i.value.live_start_time,operator_ids:[],pickerOptions:{}}):t.root.$message.error({showClose:!0,duration:6e3,message:"请先选择直播开始时间和结束时间"})},Y=()=>{i.value.operator_schedule_infos=[]},N=v((async(e,a)=>{const s=await(0,u.I)(t,"此次排班改动较大，是否进行重新排班？");return s?(Z(),Y(),Promise.resolve(s)):(i.value.live_start_time=e,i.value.live_end_time=a,i.value.startTimeAndEndTime=[e,a],Promise.resolve(!1))})),B=async(e,t,a,s)=>{if(t===s[1]?.start_time)s?.shift();else{if(t<s[0].start_time){const o={end_time:s[0].start_time,start_time:e[0],pickerOptions:{disabledDate(e){return e.getTime()<p()(t,"YYYY-MM-DD").valueOf()||e.getTime()>p()(a,"YYYY-MM-DD").valueOf()}}};return s[0].kol_ids?o.kol_ids=[...s[0].kol_ids]:o.operator_ids=[...s[0].operator_ids],s?.unshift(o),i.value.live_start_time=e[0],Promise.resolve(!1)}if(e[0]>s[0].start_time&&e[0]<s[1]?.start_time)return s[0].start_time=e[0],Promise.resolve(!1);if(s[s.length-1]?.end_time<e[1]){const i={end_time:e[1],start_time:s[s.length-1]?.end_time,pickerOptions:{disabledDate(e){return e.getTime()<p()(t,"YYYY-MM-DD").valueOf()||e.getTime()>p()(a,"YYYY-MM-DD").valueOf()}}};return s[0].kol_ids?i.kol_ids=[...s[s.length-1].kol_ids]:i.operator_ids=[...s[s.length-1].operator_ids],s?.push(i),Promise.resolve(!1)}if(s[s.length-1]?.start_time===e[1])return s.pop(),Promise.resolve(!1);if(e[1]<s[s.length-1]?.end_time&&e[1]>s[s.length-1]?.start_time)1===s.length?(s[0].start_time=e[0],s[0].end_time=e[1]):s[s.length-1].end_time=e[1];else if(1===s.length)return s[0].start_time=e[0],s[0].end_time=e[1],Promise.resolve(!1)}},z=async e=>{const t=i.value.kol_schedule_infos.length,a=i.value.operator_schedule_infos.length,s=i.value.live_start_time,o=i.value.live_end_time;if(null===e)return i.value.live_start_time="",i.value.live_end_time="",Z(),void Y();if(i.value.live_start_time=e[0],i.value.live_end_time=e[1],0===t&&0===a)return;const r=i.value.live_start_time,l=i.value.live_end_time;return 1===i.value.kol_schedule_infos.length&&e[0]>i.value.kol_schedule_infos[0].end_time||(W.value||e[0]>i.value.kol_schedule_infos[1]?.start_time||e[1]<i.value.kol_schedule_infos[t-1]?.start_time)&&e[1]!==i.value.kol_schedule_infos[t-1]?.start_time?N(s,o):(0!==t&&await B(e,r,l,i.value.kol_schedule_infos),void(0!==a&&await B(e,r,l,i.value.operator_schedule_infos)))},q={disabledDate(t){return!e.defaultDisplay?.id&&t.getTime()<Date.now()-864e5}},W=(0,o.computed)((()=>{const e=i.value.live_start_time,t=i.value.live_end_time;return p()(t).date()-p()(e).date()>=2})),U=async()=>{const e=await new Promise((e=>s.value?.validate((t=>e(t)))));if(!e||!i.value.studio_id&&J.value)return;const o=i.value.live_start_time,n=i.value.live_end_time;if(W.value)return void t.root.$message.error({showClose:!0,duration:6e3,message:"保存失败，日期最多跨一天"});const{live_end_time:c,live_start_time:d,live_title:u,project_id:_,studio_id:m,id:v,kol_schedule_infos:f,operator_schedule_infos:h}=i.value;if(0!==f.length){const e=f.find((e=>p()(e.start_time).valueOf()<p()(o).valueOf()||e.start_time===e.end_time||e.start_time>n)),a=f.find((e=>0===e.kol_ids.length));if(e)return void t.root.$message.error({showClose:!0,duration:6e3,message:"主播排班日期错误"});if(a)return void t.root.$message.error({showClose:!0,duration:6e3,message:"未选择排班人员"})}if(0!==h.length){const e=h.find((e=>p()(e.start_time).valueOf()<p()(o).valueOf()||e.start_time===e.end_time||e.start_time>n));if(e)return void t.root.$message.error({showClose:!0,duration:6e3,message:"运营排班日期错误"});const a=h.find((e=>0===e.operator_ids.length));if(a)return void t.root.$message.error({showClose:!0,duration:6e3,message:"未选择排班人员"})}const g={id:v?.toString(),project_id:_.toString(),live_title:u,live_start_time:d,live_end_time:c,studio_id:m?.toString(),kol_schedule_infos:f.map((({start_time:e,end_time:t,kol_ids:a})=>({start_time:e,end_time:t,kol_ids:a}))),operator_schedule_infos:h.map((({start_time:e,end_time:t,operator_ids:a})=>({start_time:e,end_time:t,operator_ids:a})))};a.value=!0;const[{data:y}]=await(0,l.Dc)(300,(0,r.MB)(g));a.value=!1,y.success?(t.emit("succeed"),t.root.$message.success(y.message)):t.root.$message.error(y.message??"保存失败")},H=(0,o.computed)((()=>!e.defaultDisplay?.allow_update_kol_schedule&&!!e.defaultDisplay?.compass_shop_live_room_id)),J=(0,o.computed)((()=>e.defaultDisplay?3!==e.defaultDisplay.business_type:3!==e.business_type));return{onSelectKolUserChanged:T,onSelectOperateUserChanged:O,deleteKolTime:E,deleteOperateTime:I,addKolTimeLine:P,addOperateTimeLine:M,...(0,o.toRefs)(g),formRef:s,isNotOneDay:W,formRules:m,studioList:_,resetForm:b,handleCloseAction:h,studioChanged:y,saveLoading:a,queryStudio:C,onAddkolSchedule:V,onDeleteKolSchedule:Z,onAddOperatorSchedule:L,onDeleteOperatorSchedule:Y,onLiveTimeChange:z,numOfSessionsForm:i,handleSaveHandler:U,pickerOptions:q,kolWorkTime:F,kolOperateTime:R,isAutoObtain:H,studioRequired:J}}}),h=f,g=a(1001),y=(0,g.Z)(h,s,i,!1,null,null,null),b=y.exports},62326:function(e,t,a){a.r(t),a.d(t,{default:function(){return Vs}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-detail-page"},[a("TgBreadcrumbs",{attrs:{routes:e.routes}}),a("tg-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flex-auto",attrs:{padding:[0],overflowInBody:""}},[e.inProject||e.permission.view_all_project?a("tg-tabs",{attrs:{tabs:e.tabs},on:{change:e.onTabChange},model:{value:e.checkedTab,callback:function(t){e.checkedTab=t},expression:"checkedTab"}}):e._e(),e.inProject||e.permission.view_all_project?a(e.checkedTab,{tag:"component",staticStyle:{"border-top":"1px solid #ebebeb"},attrs:{is_from_project:!0},on:{editProjectReload:e.editProjectReload}}):e._e(),e.inProject||e.permission.view_all_project?e._e():a("div",{staticClass:"abnormal-empty"},[a("div",{staticClass:"abnormal-empty-content"},[a("empty-common",{attrs:{"detial-text":void 0===e.inProject?"获取项目详情失败，请稍后重试":"暂无查看当前项目的权限"}})],1)])],1)],1)},i=[],o=a(23812),r=a(1763),l=a(85457),n=a(64236);const c=(e,t)=>{const a=t=>{const a=(0,l.P)({...e,...t}),{tab:s,liveType:i,...o}=a;return{name:r.FB.project.detail,params:"tracking"===s?(0,n.jG)({tab:s,...o}):(0,n.jG)({tab:s,liveType:i,...o})}},s=e=>{t.root.$router.push(a(e)).catch((e=>{}))},i=e=>{t.root.$router.replace(a(e)).catch((e=>{}))};return{jump:s,replace:i}};var d=a(97434),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-info"},[a("div",{staticClass:"project-info-scroll"},[a("div",{staticClass:"project-info-left"},[a("div",{staticClass:"project-name-info filter-form-item-btn"},[a("span",{staticClass:"project-name"},[e._v(e._s(e.project.project_name))]),e.Permission.canPorjectEdit?a("tg-button",{staticClass:"project-edit",on:{click:e.onProjectEdit}},[e._v(" 编辑项目 ")]):e._e()],1),a("div",{staticClass:"project-uid"},[e._v(e._s(e.project.project_uid))]),e.project.project_status!==e.ProjectStatusEnum.finish?a("div",{staticClass:"project-status"},[a("div",[a("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row","-ms-flex-align":"start"}},[a("div",{staticStyle:{color:"#6a7b92"}},[e._v("状态：")]),a("div",{staticStyle:{width:"200px"}},[e.project.project_status===e.ProjectStatusEnum.tryLive?a("div",{staticClass:"status",staticStyle:{"font-size":"14px",color:"#ffac15"}},[e._v(" 试播中"),e.Permission.canEditProjectStatus?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.openTestLiveDialog}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1):e._e(),e.project.project_status===e.ProjectStatusEnum.execution?a("div",{staticClass:"status",staticStyle:{"font-size":"14px",color:"#ffac15"}},[e._v(" 项目执行中"),e.Permission.canEditProjectStatus?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.openFinishDialog}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1):e._e(),e.project.project_status===e.ProjectStatusEnum.executionEnd?a("div",{staticClass:"status",staticStyle:{"font-size":"14px",color:"#ffac15"}},[e._v(" 执行结束"),e.Permission.canEditProjectStatus?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.openFinishDialog}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1):e._e(),2===e.project.cooperation_type&&e.project.project_status===e.ProjectStatusEnum.regionExecution?a("div",{staticClass:"status",staticStyle:{"font-size":"14px",color:"#ffac15"}},[e._v(" 区域执行中"),e.Permission.canEditProjectStatus?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.openFinishDialog}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1):e._e()])])])]):a("div",{staticClass:"project-status"},[a("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row","-ms-flex-align":"start"}},[a("div",{staticStyle:{color:"#6a7b92"}},[e._v("状态：")]),a("div",{staticStyle:{width:"200px"}},[a("div",{staticClass:"project-status-desc"},[a("div",{staticClass:"status",staticStyle:{"font-size":"14px",color:"#00a935"},style:{color:1===e.injectProject.end_type?"#00A935":"#ED3434"}},[e._v(" "+e._s(e.project_status_str)+" ")]),e.Permission.canEndEditProjectStatus?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.onProjectRollBackEdit}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1),e.injectProject.end_time?a("div",{staticStyle:{"margin-top":"2px",color:"#999999","font-size":"12px"}},[e._v(" "+e._s(e.project_end_time)+" ")]):e._e()])]),2===e.injectProject.end_type?a("div",{staticStyle:{width:"100%",display:"flex","flex-direction":"row","-ms-flex-align":"start","margin-top":"8px"}},[a("div",{staticStyle:{color:"#6a7b92"}},[e._v("处理方案：")]),a("div",{staticStyle:{width:"180px","white-space":"normal","word-wrap":"break-word",overflow:"hidden"}},[e._v(" "+e._s(e.project_reason_status_str)+" ")])]):e._e()]),2!==e.project.cooperation_type||e.project.project_status!==e.ProjectStatusEnum.regionExecution&&e.project.project_status!==e.ProjectStatusEnum.finish&&e.project.project_status!==e.ProjectStatusEnum.executionEnd?e._e():a("div",{staticStyle:{"margin-top":"8px"}},[a("span",{staticStyle:{color:"#6a7b92"}},[e._v("合作公司：")]),e.project.supplier_company_name?a("span",{staticClass:"status",staticStyle:{"margin-right":"2px"}},[(e.Permission.canEditProjectStatus&&e.project.project_status===e.ProjectStatusEnum.regionExecution?e.project.supplier_company_name.length>10:e.project.supplier_company_name.length>11)?a("el-popover",{attrs:{placement:"right-start",trigger:"hover"}},[a("div",[e._v(" "+e._s(e.project.supplier_company_name)+" ")]),a("div",{staticClass:"live",staticStyle:{display:"inline-block"},style:{width:e.Permission.canEditProjectStatus?"":"162px"},attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(e.getnewcoopcompany(e.project.supplier_company_name))+" ")])]):a("div",{staticClass:"live",staticStyle:{display:"inline-block"},style:{width:e.Permission.canEditProjectStatus?"":"162px"}},[e._v(" "+e._s(e.project.supplier_company_name)+" ")]),e.Permission.canEditProjectStatus&&e.project.project_status===e.ProjectStatusEnum.regionExecution?a("tg-button",{staticClass:"edit-button",attrs:{type:"link"},on:{click:e.openAreaDialog}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1):e.Permission.canEditProjectStatus&&e.project.project_status===e.ProjectStatusEnum.regionExecution?a("tg-button",{attrs:{type:"link"},on:{click:e.openAreaDialog}},[e._v("点击添加")]):a("span",[e._v("--")])],1),a("div",{staticClass:"project-business-type"},[a("span",{staticClass:"label"},[e._v("业务类型：")]),a("span",[e._v(e._s(e.business_type_str))]),a("span",{staticClass:"cooperation-type",style:{color:2===e.project.cooperation_type?"#FF7A36":"#FFAC15",borderColor:2===e.project.cooperation_type?"#FF7A36":"#FFAC15"}},[e._v(e._s(e.cooperation_type_str))])]),a("div",{staticClass:"feishu-department"},[a("span",{staticClass:"label"},[e._v("所属部门：")]),a("span",[e._v(e._s(e.project.feishu_department_name?e.project.feishu_department_name:"--"))])]),a("div",{staticClass:"customer-company"},[a("span",{staticClass:"label"},[e._v("客户公司：")]),a("tg-button",{staticClass:"arrow-btn",attrs:{type:"link"},on:{click:function(t){return e.onCustomerCompany(e.project.company_id)}}},[a("el-popover",{attrs:{placement:"top-start",trigger:"hover","open-delay":300,content:e.project.customer_company_name}},[a("span",{staticClass:"line-clamp-2",staticStyle:{width:"160px"},attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.project.customer_company_name))])]),a("tg-icon",{attrs:{name:"ico-arrow-right"}})],1)],1),a("div",{staticClass:"customer-shop"},[a("span",{staticClass:"label"},[e._v("客户店铺：")]),a("el-popover",{attrs:{placement:"top-start",trigger:"hover","open-delay":300,content:e.project.shop_name}},[a("span",{staticClass:"line-clamp-2",staticStyle:{width:"160px"},attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(e.project.shop_name))])])],1),a("div",{staticClass:"shop-brand"},[a("span",{staticClass:"label"},[e._v("店铺品牌：")]),a("span",[e._v(e._s(e.project.brand_name?e.project.brand_name:"--"))])]),a("div",{staticClass:"studio"},[a("span",{staticClass:"label"},[e._v("直播间：")]),a("span",[e._v(e._s(e.project.studio_name?e.project.studio_name:"--"))])]),1!==e.project.cooperation_type||3!==e.project.business_type&&7!==e.project.business_type?e._e():a("div",{staticClass:"studio"},[a("span",{staticClass:"label"},[e._v("商家授权：")]),1===e.project.is_shop_auth||!0===e.project.is_shop_auth?a("span",[e._v("已授权")]):a("span",{staticStyle:{color:"#2877ff",cursor:"pointer"},on:{click:e.linkAccess}},[e._v("立即授权")])]),a("div",{staticClass:"project-circle",staticStyle:{"margin-top":"24px"}},[a("span",{staticClass:"label"},[e._v("项目周期：")]),a("span",[e._v(e._s(e.project_cycle))])]),a("div",{staticClass:"settlement-circle"},[a("span",{staticClass:"label"},[e._v("结算周期：")]),a("span",[e._v(e._s(e.settlement_cycle_type))])]),a("div",{staticClass:"price-per-hour"},[a("span",{staticClass:"label"},[e._v("小时报价：")]),a("span",[e._v(e._s(e.isCustomerManager&&e.project.price_per_hour?e.project.price_per_hour+"/小时":"--"))])]),1!==e.project.cooperation_type||3!==e.project.business_type&&7!==e.project.business_type?e._e():a("div",{staticClass:"price-per-hour"},[a("span",{staticClass:"label"},[e._v("服务费：")]),a("span",[e._v(e._s(e.isCustomerManager&&e.project.service_amount?e.project.service_amount+"元":"--"))])]),a("div",{staticClass:"commission-rate"},[a("span",{staticClass:"label"},[e._v("佣金比例：")]),a("span",[e._v(e._s(e.isCustomerManager&&e.project.commission_rate?e.project.commission_rate+"%":"--"))])]),e.teamMemberEditEnabled?a("div",{staticClass:"project-team"},[a("span",{staticClass:"label",staticStyle:{"font-weight":"600","font-size":"14px",color:"#3c5269"}},[e._v("项目团队")]),a("tg-button",{staticClass:"edit-people-button",attrs:{type:"link"},on:{click:e.onProjectTeamEdit}},[a("tg-icon",{attrs:{name:"ico-edit"}})],1)],1):e._e(),a("div",{staticClass:"project-manager",class:e.teamMemberEditEnabled?"":"mgt-24"},[a("span",{staticClass:"label"},[e._v("项目经理：")]),a("span",[e._v(e._s(e.project.project_manager?e.project.project_manager:"--"))])]),a("div",{staticClass:"customer-manager"},[a("span",{staticClass:"label"},[e._v("客户经理：")]),a("span",[e._v(e._s(e.project.customer_manager?e.project.customer_manager:"--"))])]),a("div",{staticClass:"other-members"},[a("span",{staticClass:"label"},[e._v("其他成员：")]),a("span",[e._v(e._s(e.otherMembersStr))])])]),a("div",{staticClass:"project-info-right",class:2!==e.project.cooperation_type?"three-rows":"two-rows"},[a("div",{staticClass:"project-info-income-contract"},[a("div",{staticClass:"income"},[a("div",{staticClass:"title"},[e._v("项目盈收")]),a("div",{staticClass:"income-row"},[a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.income_settlement_amount)))]),a("div",[e._v("收入结算金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.real_income_amount)))]),a("div",[e._v("实收金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.unreceived_amount)))]),a("div",[e._v("未收金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.paid_invoice_amount)))]),a("div",[e._v("已开发票")])])]),a("div",{staticClass:"income-row"},[a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.cost_settlement_amount)))]),a("div",[e._v("成本结算金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.real_paid_amount)))]),a("div",[e._v("实付金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.unpaid_amount)))]),a("div",[e._v("未付金额")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.formatAmountWithoutPrefix(e.profitData.received_invoice_amount)))]),a("div",[e._v("已收发票")])])])]),a("div",{staticClass:"contract"},[a("div",{staticClass:"title"},[e._v("合同")]),a("div",{staticClass:"contract-row"},[a("div",{staticClass:"income-contract-item"},[a("div",{class:0===(e.project.contract_stat?e.project.contract_stat.customer:0)?"contract-no-customer":""},[e._v(" "+e._s(e.project.contract_stat?e.project.contract_stat.customer:0)+" ")]),a("div",[e._v("客户合同")])]),a("div",{staticClass:"income-contract-item"},[a("div",[e._v(e._s(e.project.contract_stat?e.project.contract_stat.supplier:0))]),a("div",[e._v("供应商合同")])])]),0===(e.project.contract_stat?e.project.contract_stat.customer:0)?a("div",{staticClass:"contract-tip"},[a("tg-icon",{attrs:{name:"ico-icon_jinggao"}}),a("div",[e._v("当前还没签署合同，请尽快签署合同并录入系统")])],1):e._e()])]),2!==e.project.cooperation_type?a("div",{staticClass:"project-info-live-schedule"},[a("div",{staticClass:"live"},[e._m(0),a("el-table",{attrs:{data:e.liveDatas,stripe:"",height:330},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":e.withoutLiveDisplayPermission?"权限不足，需要查看权限":"暂无场次"}})]},proxy:!0}],null,!1,857714895)},e._l(e.liveColumns,(function(t,s){return a("el-table-column",e._b({key:s},"el-table-column",t,!1))})),1)],1),a("div",{staticClass:"today-schedule"},[e._m(1),a("div",{staticClass:"today-schedule-content",class:e.noTodayKolScheduleData&&e.noTodayOperatorScheduleData?"center":""},[e.noTodayKolScheduleData?e._e():a("div",{staticClass:"today-schedule-kol"},e._l(e.todayScheduleData.kol_schedule_list?e.todayScheduleData.kol_schedule_list:[],(function(t,s){return a("div",{key:s,staticClass:"kol-row"},[a("div",{staticClass:"time"},[e._v(e._s(t.time_str))]),a("div",{staticClass:"kols"},e._l(t.names,(function(t,s){return a("div",{key:s},[e._v(e._s(t))])})),0)])})),0),e.noTodayOperatorScheduleData?e._e():a("div",{staticClass:"today-schedule-assistant"},e._l(e.todayScheduleData.operator_schedule_list?e.todayScheduleData.operator_schedule_list:[],(function(t,s){return a("div",{key:s,staticClass:"assistant-row"},[a("div",{staticClass:"time"},[e._v(e._s(t.time_str))]),a("div",{staticClass:"assistants"},e._l(t.names,(function(t,s){return a("div",{key:s},[e._v(e._s(t))])})),0)])})),0),!e.noTodayOperatorScheduleData||!e.noTodayKolScheduleData||e.todayScheduleData&&e.todayScheduleData.is_rest_day?e._e():a("div",{staticClass:"abnormal-empty"},[a("div",{staticClass:"abnormal-empty-content"},[a("empty-common",{attrs:{"detial-text":"暂无排班 "}})],1)]),e.todayScheduleData&&e.todayScheduleData.is_rest_day?a("div",{staticClass:"rest"},[e._v(" 休 ")]):e._e()])])]):e._e(),a("div",{staticClass:"project-info-daily-data"},[a("div",{staticClass:"title"},[e._v("项目日报（近7天）")]),e.withoutDailyDataPermission?a("div",{staticClass:"project-info-daily-data-empty"},[a("div",{staticClass:"abnormal-empty"},[a("div",{staticClass:"abnormal-empty-content"},[a("empty-common",{attrs:{"detial-text":"暂无查看日报数据权限 "}})],1)])]):a("div",[a("calendar-page",{attrs:{query:e.queryDailyData,business_type:e.project?e.project.business_type:"",cooperation_type:e.project?e.project.cooperation_type:void 0,type:"base",near_seven_data:!0,itemHeight:"32px",showRest:!0,showQueryError:!1},on:{withoutPermission:e.withoutPermission}})],1)])])]),a("AddLiveProject",{attrs:{visible:e.editProjectVisible,project:e.project,isEditForm:!0},on:{"dialog:close":e.onEditProjectClose}}),a("projectTrial",{ref:"projectTrial",attrs:{visible:e.ProjectStepTrialFormVisible,step:e.project_status},on:{"ProjectTrailStep:close":e.onProjectTrailStepDialogModalClose,getDetail:e.getDetail}}),a("projectArea",{ref:"projectArea",attrs:{visible:e.ProjectStepAreaFormVisible},on:{"ProjectAreaStep:close":e.onProjectAreaStepDialogModalClose,getDetail:e.getDetail}}),a("projectFinal",{ref:"projectFinal",attrs:{visible:e.ProjectStepFinalFormVisible,status:e.project.project_status},on:{"ProjectFinalStep:close":e.onProjectFinalStepDialogModalClose,getDetail:e.getDetail}}),a("team-member",{attrs:{projectId:""+e.project.id,member:e.memberForEdit,creator:e.project.add_by_username,visible:e.teamMemberVisible},on:{"update:visible":function(t){e.teamMemberVisible=t},save:e.onTeamMemberSave}}),a("roll-back-project",{attrs:{visible:e.rollBackProjectVisible,projectInfo:e.rollBackProjectInfo},on:{"update:visible":function(t){e.rollBackProjectVisible=t},save:e.onProjectRollBackSave}})],1)},u=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"live-header"},[a("div",{staticClass:"title"},[e._v("直播场次（本周）")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"schedule-header mgr-12"},[a("div",{staticClass:"title"},[e._v("今日排班")]),a("div",{staticClass:"schedule-tip"},[a("div",{staticClass:"header-kol"},[a("span"),a("span",[e._v("主播")])]),a("div",{staticClass:"header-assistant"},[a("span"),a("span",[e._v("运助")])])])])}],_=a(29625),m=a(60600),v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-team-member"},[a("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter-new",attrs:{visible:e.visible,width:"478px",title:"团队成员","close-on-click-modal":!1},on:{close:e.onClose},scopedSlots:e._u([{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onClose}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"team-member-content"},[a("el-form",{attrs:{model:e.form,"label-width":"60px",size:"small","label-position":"top"}},[a("div",{staticClass:"manager-row"},[a("el-form-item",{attrs:{label:"客户经理："}},[a("el-select",{attrs:{filterable:"",placeholder:"请输入并选择客户经理"},model:{value:e.form.customer_manager_id,callback:function(t){e.$set(e.form,"customer_manager_id",t)},expression:"form.customer_manager_id"}},e._l(e.customerManagers,(function(e,t){return a("el-option",{key:t,attrs:{label:e.username,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"项目经理："}},[a("el-select",{attrs:{filterable:"",placeholder:"请输入并选择项目经理"},model:{value:e.form.project_manager_id,callback:function(t){e.$set(e.form,"project_manager_id",t)},expression:"form.project_manager_id"}},e._l(e.projectManagers,(function(e,t){return a("el-option",{key:t,attrs:{label:e.username,value:e.id}})})),1)],1)],1),a("el-form-item",{staticClass:"mgt-18",attrs:{label:"其他成员："}},[a("el-select",{attrs:{clearable:"",multiple:"",remote:"",filterable:"",value:e.selectNames,"remote-method":e.getAllOtherMembersRequest,loading:e.otherMemberLoading,placeholder:"请输入并选择其他成员"},on:{change:e.onOtherMembersChanged}},e._l(e.otherMembers,(function(e){return a("el-option",{key:e.id,attrs:{label:e.username,value:e.username}})})),1)],1),a("div",{staticClass:"creator mgt-24"},[a("span",[e._v("创建人：")]),a("span",[e._v(e._s(e.computedCreator))])])],1)],1)]),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},f=[],h=a(3293),g=a(14782),y=a(57046);const b=()=>({project_manager_id:void 0,customer_manager_id:void 0,team_members:[]});var w=(0,d.defineComponent)({props:{visible:{type:Boolean,default:!1},projectId:{type:String},member:{type:Object},creator:{type:String}},setup(e,t){const a=(0,d.ref)(!1),s=(0,d.ref)(!1),i=(0,d.computed)((()=>e.creator?e.creator:"--")),o=(0,d.ref)(b()),r=(0,d.ref)([]),l=(0,d.ref)([]),n=(0,d.ref)([]),c=(0,d.ref)([]),p=(0,d.computed)((()=>o.value.team_members.map((e=>{const t=c.value.find((t=>t.id===e));return t?.name??""})))),u={onClose:()=>{t.emit("close"),t.emit("update:visible",!1)},onSave:async()=>{const a={project_manager_id:o.value.project_manager_id,customer_manager_id:o.value.customer_manager_id,team_members:o.value.team_members??[]};s.value=!0;const i=await(0,h.Nr)(e.projectId??"",a);s.value=!1,i.data.success?t.emit("save"):t.root.$message.error(i.data.message??"保存失败，请稍候重试")},getAllProjectManagerRequest:async()=>{const e=await(0,g.g)();e.data.success&&(l.value=e.data.data)},getAllCustomManagerRequest:async()=>{const e=await(0,g.s)();e.data.success&&(r.value=e.data.data)},getAllOtherMembersRequest:async e=>{if(""===e||void 0===e)return void(n.value=[]);a.value=!0;const t=await(0,h.em)(e);a.value=!1,t.data.success?n.value=t.data.data.user_data:n.value=[]},onOtherMembersChanged:e=>{const t=[];n.value.forEach((e=>{const t=c.value.find((t=>e.id===t.id));t||c.value.push({id:e.id,name:e.username})})),e.forEach((e=>{const a=c.value.find((t=>t.name===e));a&&t.push(a.id)})),o.value.team_members=t}};return(0,d.watch)([()=>e.visible,()=>e.member],(([e,t])=>{if(t&&e){const e=t;o.value={project_manager_id:e.project_manager_id,customer_manager_id:e.customer_manager_id,team_members:e.team_members.map((e=>e.id))},c.value=(0,y.I8)(e.team_members)}else n.value=[]})),u.getAllCustomManagerRequest(),u.getAllProjectManagerRequest(),{selectNames:p,computedCreator:i,otherMemberLoading:a,form:o,saveLoading:s,customerManagers:r,projectManagers:l,otherMembers:n,...u}}}),x=w,k=a(1001),C=(0,k.Z)(x,v,f,!1,null,null,null),S=C.exports,j=a(68762),D=a(78066),$=a(44928),A=a(60097),P=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-trail-dialog tg-dialog-vcenter"},[a("el-dialog",{staticClass:"customer-dialog project-form-modal",attrs:{width:"428px",visible:e.visible,"destroy-on-close":!0,"close-on-click-modal":!1},on:{close:e.closeDialog},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("项目试播")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button-line",{attrs:{"justify-content":"center"}},[a("tg-button",{on:{click:e.closeDialog}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])],1)]},proxy:!0}])},[a("div",{staticClass:"dialog-content"},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"106px"}},[a("el-form-item",{staticStyle:{height:"36px"},attrs:{size:"medium",label:"试播结束时间：",prop:"try_live_end_date"}},[a("el-date-picker",{staticStyle:{width:"275px",height:"36px"},attrs:{type:"date",placeholder:"选择日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd"},model:{value:e.form.try_live_end_date,callback:function(t){e.$set(e.form,"try_live_end_date",t)},expression:"form.try_live_end_date"}})],1)],1)],1)])],1)},F=[],R=a(47583),M=(0,d.defineComponent)({props:{visible:{type:Boolean,default:!1}},setup(e,t){const a=(0,d.reactive)({form:{id:parseInt(t.root.$route.params.id,10),try_live_end_date:`${(new Date).getFullYear()}-${(new Date).getMonth()+1}-${(new Date).getDate()}`},rules:{try_live_end_date:[{required:!0,message:"请选择试播结束时间",trigger:"change"}]}}),s=e=>{t.refs[e].validate((async e=>{if(!e)return!1;{const e=await(0,R.a$)(a.form);e.data.success?(t.root.$message({type:"success",message:"保存成功"}),t.emit("ProjectTrailStep:close"),c({},t).jump({id:parseInt(t.root.$route.params.id,10),liveType:t.root.$route.params.liveType,tab:t.root.$route.params.tab}),t.emit("getDetail")):t.root.$message({type:"error",message:e.data.message})}}))},i=()=>{a.form.id=parseInt(t.root.$route.params.id,10),a.form.try_live_end_date=`${(new Date).getFullYear()}-${(new Date).getMonth()+1}-${(new Date).getDate()}`},o=()=>{i(),t.emit("ProjectTrailStep:close")};return{...(0,d.toRefs)(a),closeDialog:o,resetForm:i,submitForm:s}}}),E=M,I=(0,k.Z)(E,P,F,!1,null,null,null),T=I.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-area-dialog tg-dialog-vcenter"},[a("el-dialog",{staticClass:"customer-dialog project-form-modal",attrs:{width:"428px",visible:e.visible,"destroy-on-close":!0,"close-on-click-modal":!1},on:{close:e.closeDialog},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("区域执行")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button-line",{attrs:{"justify-content":"center"}},[a("tg-button",{on:{click:e.closeDialog}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])],1)]},proxy:!0}])},[a("div",{staticClass:"dialog-content"},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"106px"}},[a("el-form-item",{attrs:{size:"medium",label:"区域合作公司：",prop:"supplier_company_id"}},[a("el-select",{staticStyle:{width:"280px"},attrs:{filterable:"",placeholder:"请输入搜索区域合作公司"},model:{value:e.form.supplier_company_id,callback:function(t){e.$set(e.form,"supplier_company_id",t)},expression:"form.supplier_company_id"}},e._l(e.list_companyInfo,(function(e){return a("el-option",{key:e.company_id,attrs:{label:e.company_name,value:e.company_id}})})),1)],1)],1)],1)])],1)},V=[],Z=(0,d.defineComponent)({props:{visible:{type:Boolean,default:!1}},setup(e,t){const a=(0,d.inject)("project")??(0,d.ref)(void 0),s=(0,d.reactive)({form:{id:parseInt(t.root.$route.params.id,10),supplier_company_id:void 0},list_companyInfo:[],rules:{supplier_company_id:[{required:!0,message:"请输入搜索区域合作公司",trigger:"change"}]}});(0,d.onMounted)((()=>{i()}));const i=async()=>{const e=await(0,R.Yd)(s.form);e.data.success?s.list_companyInfo=e.data.data:t.root.$message({type:"error",message:e.data.message})},o=e=>{t.refs[e].validate((async e=>{if(!e)return!1;{const e=await(0,R.Fy)(s.form);e.data.success?(t.root.$message({type:"success",message:"保存成功"}),t.emit("ProjectAreaStep:close"),t.emit("getDetail")):t.root.$message({type:"error",message:e.data.message})}}))},r=()=>{s.form.id=parseInt(t.root.$route.params.id,10),a.value?.supplier_company_id?s.form.supplier_company_id=a.value.supplier_company_id:s.form.supplier_company_id=void 0},l=()=>{r(),t.emit("ProjectAreaStep:close")};return a.value?.supplier_company_id&&(s.form.supplier_company_id=a.value.supplier_company_id),{...(0,d.toRefs)(s),getCompanyNameAndId:i,closeDialog:l,resetForm:r,submitForm:o}}}),L=Z,Y=(0,k.Z)(L,O,V,!1,null,"03fac4bc",null),N=Y.exports,B=a(72713),z=a(6933),q=a.n(z),W=a(61282),U=a(21757),H=a(78902),J=a(77944),G=(0,d.defineComponent)({components:{AddLiveProject:m.Z,TeamMember:S,CalendarPage:j.Z,projectFinal:A.Z,projectTrial:T,projectArea:N,RollBackProject:B.Z},setup(e,t){const a=q()(),s=(0,d.computed)((()=>J.Z.getters["user/getUserInfo"])),i=(0,d.computed)((()=>{const e=(0,U.kG)(H.HN.live_project_save),t=(0,U.kG)(H.HN.live_project_status_edit),a=(0,U.kG)(H.HN.live_project_status_finish_edit);return{canPorjectEdit:e,canEditProjectStatus:t,canEndEditProjectStatus:a}})),o=(0,$.t)(),r=o.currentRoute.params.id,l=(0,d.inject)("project")??(0,d.ref)(void 0),n=(0,d.computed)((()=>(l.value&&l.value.cooperation_type===_.x3.selfSupport&&(Y.queryTodayLiveScheduleDetail(),Y.queryProjectShopLive()),l.value??{}))),c=(0,d.computed)((()=>{if(l.value?.start_date&&l.value?.end_date){const e=l.value?.start_date.replace(/-/g,"."),t=l.value?.end_date.replace(/-/g,".");return`${e} - ${t}`}return"--"})),p=(0,d.computed)((()=>_.UN.get(l.value?.cooperation_type??0))),u=(0,d.computed)((()=>{const e=_.Zb.get(l.value?.business_type??0),t=1===l.value?.region?"(上海)":"";return e+t})),m=(0,d.computed)((()=>_.i8.get(l.value?.settlement_cycle_type??0))),v=(0,d.computed)((()=>{const e=l.value?.end_time??0;return q()(1e3*e).format("yyyy.MM.DD")})),f=(0,d.ref)(!1),g=(0,d.ref)(!1),y=(0,d.ref)([]),b=(0,d.ref)({income_settlement_amount:"",cost_settlement_amount:"",real_income_amount:"",real_paid_amount:"",unreceived_amount:"",unpaid_amount:"",paid_invoice_amount:"",received_invoice_amount:""}),w=(0,d.ref)(void 0),x=(0,d.ref)(!1),k=(0,d.ref)(!1),C=(0,d.ref)(!1),S=(0,d.ref)(!1),j=(0,d.ref)(!1),A=(0,d.ref)(!1),P=(0,d.computed)((()=>l.value?.project_status??-1)),F=(0,d.computed)((()=>{if(l.value?.project_status===_.C_.regionExecution&&l.value?.supplier_company_name)return l.value.supplier_company_name;const e=1===l.value?.end_type?"正常结束":2===l.value?.end_type?"意外终止":"";return e})),R=(0,d.computed)((()=>{const e=2===l.value?.end_detail.end_handle_type?`${l.value?.end_detail.end_handle_detail}`:"退款";return 2===l.value?.end_type?e:""})),M=(0,d.computed)((()=>{const e=l.value?.team_members.map((e=>e.name))??[];return e.length?e.join(" "):"--"})),E=(0,d.computed)((()=>({project_manager_id:l.value?.project_manager_id,customer_manager_id:l.value?.customer_manager_id,team_members:l.value?.team_members}))),I=(0,d.computed)((()=>!(!s.value?.id||!l.value)&&s.value.id===l.value.customer_manager_id)),T=(0,d.computed)((()=>!(!s.value?.id||!l.value)&&(s.value.id===l.value.customer_manager_id||s.value.id===l.value.project_manager_id||s.value.id===l.value.add_by))),O=(0,d.computed)((()=>!(w.value?.kol_schedule_list??[]).length)),V=(0,d.computed)((()=>!(w.value?.operator_schedule_list??[]).length)),Z=(0,d.computed)((()=>({projectId:l.value?.id,cooperationType:l.value?.cooperation_type,projectType:_.kA.live}))),L=(0,d.computed)((()=>[{label:"直播标题",minWidth:160,formatter:e=>(0,d.h)("div",{class:Y.is_today(e.live_start_time)?"today line-clamp-1":"line-clamp-1"},[e.live_title?e.live_title:"--"])},{label:"直播时间",minWidth:186,align:"left",formatter:e=>{if(e.live_start_time&&e.live_end_time){const t=q()(e.live_start_time),a=q()(e.live_end_time),s=t.isSame(a,"d");let i=`${t.format("MM.DD HH:mm")} ~ ${a.format("HH:mm")}`;if(!s){const e=t.date(),s=a.date(),o=t.clone().date(e+1),r=o.isSame(a,"d");i=r?`${i}(次日)`:`${i}(${s}日)`}return i}return"--"}},{label:"人员排班",minWidth:84,align:"right",formatter:e=>{const t=e.is_kol_scheduled&&e.is_operator_scheduled,a=Y.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status"},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已排班":"未排班"])])}},{label:"数据录入",minWidth:84,align:"center",formatter:e=>{const t=e.is_entry_live_data,a=Y.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status",style:{justifyContent:"center"}},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已录入":"待录入"])])}},{label:"是否归档",minWidth:84,align:"right",formatter:e=>{const t=4===e.live_status,a=Y.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status"},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已归档":"未归档"])])}}])),Y={onProjectEdit:()=>{x.value=!0},onCustomerCompany:e=>{const t="/customer/company/"+e.toString();window.open(t)},onShopName:e=>{const t="/customer/shop/"+e.toString();window.open(t)},onProjectTeamEdit:()=>{k.value=!0},onEditProjectClose:async e=>{x.value=!1,e&&Y.getDetail()},queryDailyData:(e,t)=>(0,D.sB)(void 0,void 0,r),onProjectTrailStepDialogModalClose:()=>{C.value=!1},onProjectFinalStepDialogModalClose:()=>{j.value=!1},onProjectAreaStepDialogModalClose:()=>{S.value=!1},openTestLiveDialog:()=>{C.value=!0},openAreaDialog:()=>{S.value=!0,S.value=!0},openFinishDialog:()=>{j.value=!0},onProjectRollBackEdit:()=>{A.value=!0},getDetail:()=>{t.emit("editProjectReload")},onTeamMemberSave:()=>{k.value=!1,Y.getDetail()},queryProjectShopLive:async()=>{let e=a;l.value?.project_status===_.C_.finish&&(e=q()(l.value.end_date));const t="yyyy-MM-DD",s=e.clone().startOf("week"),i=e.clone().endOf("week"),o={project_id:r,live_start_date:s.format(t),live_end_date:i.format(t),is_rest_day:0,num:1e3,page_num:1},n=await(0,h.lD)(o);n.data.success?(g.value=!1,y.value=n.data.data.data):200===n.data.error_code?g.value=!0:g.value=!1},queryShopLiveProfitStatData:async()=>{const e=await(0,h.L$)(r);e.data.success&&(b.value=e.data.data)},is_before:e=>{const t=q()(e);return t.isBefore(a,"d")},is_today:e=>{const t=q()(e);return t.isSame(a,"d")},formatAmountWithoutPrefix:e=>{const t=e||"0";return(0,W.FU)(t)},withoutPermission:()=>{f.value=!0},queryTodayLiveScheduleDetail:async()=>{const e=await(0,h.GI)(r);e.data.success&&(w.value=e.data.data)},onProjectRollBackSave:()=>{A.value=!1,Y.getDetail()}},N=e=>{const{folded_text:t}=(0,W.zb)(e,10);return t};Y.queryShopLiveProfitStatData();const B=()=>{G(),window.open(l.value?.shop_auth_url?l.value?.shop_auth_url:"")};let z=!1;const G=()=>{const e=setInterval((()=>{(0,D.mP)(r).then((({data:t})=>{t.success&&t.data&&(z=t.data.is_shop_auth||!1,1!==z&&!0!==z||(clearInterval(e),Y.getDetail()))}))}),3e3)};return{ProjectStatusEnum:_.C_,getnewcoopcompany:N,injectProject:l,linkAccess:B,noTodayKolScheduleData:O,noTodayOperatorScheduleData:V,todayScheduleData:w,isCustomerManager:I,teamMemberEditEnabled:T,userinfo:s,Permission:i,memberForEdit:E,editProjectVisible:x,teamMemberVisible:k,liveColumns:L,liveDatas:y,project:n,project_cycle:c,cooperation_type_str:p,business_type_str:u,settlement_cycle_type:m,project_status_str:F,project_reason_status_str:R,project_status:P,otherMembersStr:M,ProjectStepTrialFormVisible:C,ProjectStepAreaFormVisible:S,ProjectStepFinalFormVisible:j,rollBackProjectVisible:A,profitData:b,rollBackProjectInfo:Z,withoutDailyDataPermission:f,withoutLiveDisplayPermission:g,project_end_time:v,...Y}}}),Q=G,K=(0,k.Z)(Q,p,u,!1,null,null,null),X=K.exports,ee=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-live"},[a("live-calendar")],1)},te=[],ae=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-project-live-schedule"},[a("div",{staticClass:"live-operator-row"},[a("div",{staticClass:"live-operator-row-left"},["calendar"===e.liveDisplayType?a("div",{staticClass:"date-switch"},[a("div",{staticClass:"btn-circle",on:{click:e.onPrevMonth}},[a("tg-icon",{attrs:{name:"ico-arrow-left"}})],1),a("span",{staticClass:"live-date"},[e._v(e._s(e.currentTitle))]),a("div",{staticClass:"btn-circle",on:{click:e.onNextMonth}},[a("tg-icon",{attrs:{name:"ico-arrow-right"}})],1)]):a("div",{staticClass:"date-select"},[a("span",{staticClass:"label"},[e._v("查询日期：")]),a("el-date-picker",{attrs:{type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd",size:"small",editable:!1},model:{value:e.selectDates,callback:function(t){e.selectDates=t},expression:"selectDates"}})],1),a("div",{staticClass:"live-operator"},[e.Permission.live_display_save?a("tg-button",{attrs:{type:"primary"},on:{click:e.CopyLiveScheduleHandler}},[e._v("复制排期")]):e._e(),e.Permission.live_display_save?a("tg-button",{staticClass:"mgl-12",attrs:{icon:"ico-btn-add",type:"primary"},on:{click:e.AddLiveDisplayHandler}},[e._v("新增场次")]):e._e(),a("tg-button",{staticClass:"mgl-12",attrs:{type:"primary"},on:{click:e.onDownloadScheduleClick}},[e._v("下载主播排期")])],1)]),a("div",{staticClass:"live-operator-row-right"},[a("el-popover",{attrs:{placement:"bottom-end",trigger:"hover","open-delay":300}},[a("tg-button",{staticClass:"abnormal-tip-btn",attrs:{slot:"reference",type:"link"},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-question"}})],1),a("div",{staticClass:"abnormal-tip"},[a("div",{staticClass:"abnormal-tip-title"},[e._v("以下情况直播场次将以橙色标注")]),a("div",{staticClass:"mgt-12 abnormal-tip-row"},[e._v("1、场次未完成主播和运助排班")]),a("div",{staticClass:"mgt-12 abnormal-tip-row"},[e._v("2、已过直播结束时间仍未录入直播数据")])])],1),a("span",{staticClass:"mgl-6",staticStyle:{color:"#6a7b92"}},[e._v("异常提醒说明")]),a("TgBtnCapsule",{staticClass:"btn-capsule mgl-18",attrs:{value:"calendar"===e.liveDisplayType?"left":"right"},on:{click:e.onCapsuleClick},scopedSlots:e._u([{key:"left",fn:function(){return[e._v("日历")]},proxy:!0},{key:"right",fn:function(){return[e._v("列表")]},proxy:!0}])})],1)]),"calendar"===e.liveDisplayType?a("calendar",{ref:"CalendarRef",attrs:{displayDate:e.displayDate}}):a("live-list",{ref:"LiveListRef",attrs:{start_date:e.start_date,end_date:e.end_date}}),a("CopyScheduleForm",{attrs:{visible:e.CopyScheduleFormVisible},on:{"update:visible":function(t){e.CopyScheduleFormVisible=t},succeed:e.handleCopyScheduleSucceedAction}}),a("liveDisplayAddDialog",{attrs:{visible:e.liveDisplayAddDialogVisible,project_id:e.project_id,business_type:e.business_type,studioInfo:e.studioInfo},on:{succeed:e.handleSaveSucceedAction,closeAction:e.handleCloseAction}}),a("downloadSchedule",{ref:"downloadScheduleRef"})],1)},se=[],ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"tg-live-schedule-calendar",staticStyle:{overflow:"overlay"}},[a("div",{staticClass:"calender"},[e._l(e.weeks,(function(t){return a("div",{key:t,staticClass:"grid-item grid-item-header"},[e._v(" "+e._s(t)+" ")])})),e._l(e.calendarData,(function(t,s){return a("div",{key:s+"cur",staticClass:"grid-item grid-item-content",class:e.isToday(t)?"today":""},[a("div",{staticClass:"grid-item-content-header"},[a("div",{staticClass:"day-no"},[e._v(" "+e._s(t.day)+" ")]),a("div",{staticClass:"rest",class:1===t.status?"is-rest":"",attrs:{disabled:e.is_rest_disabled(t)},on:{click:function(a){return e.onRestHandle(t)}}},[e._v(" 休 ")])]),a("div",{staticClass:"grid-item-content-detail"},[2===t.status?a("div",{staticStyle:{display:"flex","flex-direction":"column"}},e._l(e.two_live(t),(function(t,s){return a("el-popover",{key:s+"live",style:s<1?"":"margin-top: 8px;",attrs:{placement:"right-start","open-delay":300,trigger:"hover",disabled:!e.is_live_abnormal(t)}},[a("div",e._l(e.abnormal_live_tips(t),(function(t,s){return a("div",{key:s+"tip",class:s>0?"mgt-12":""},[e._v(" "+e._s(t)+" ")])})),0),a("div",{staticClass:"live",class:4===t.live_status?"archiving":e.is_live_abnormal(t)?"abnormal":"",attrs:{slot:"reference"},on:{click:function(a){return e.jumpDetail(t)}},slot:"reference"},[s<2?a("div",[e._v(e._s(t.time_str))]):e._e()])])})),1):e._e(),0===t.status?a("div",{staticStyle:{"text-align":"center","margin-top":"40px",color:"#a4b2c2"}},[e._v(" 暂无排期 ")]):e._e(),1===t.status?a("div",{staticStyle:{"text-align":"center","margin-top":"11px",color:"rgba(60, 82, 105, 0.2)","font-size":"56px","font-weight":"400"}},[e._v(" 休 ")]):e._e()]),2===t.status&&t.shop_live_list.length>2?a("div",{staticClass:"grid-item-content-footer"},[a("el-popover",{attrs:{"popper-class":"more-live",trigger:"hover",placement:"right-start","open-delay":300}},[a("tg-icon",{attrs:{slot:"reference",name:"ico-Icon_24px_gengduo"},slot:"reference"}),a("div",{staticClass:"live-list"},e._l(t.shop_live_list,(function(t,s){return a("div",{key:s+"live",staticClass:"live",class:4===t.live_status?"archiving":e.is_live_abnormal(t)?"abnormal":"",on:{click:function(a){return e.jumpDetail(t)}}},[e._v(" "+e._s(t.time_str)+" ")])})),0)],1)],1):e._e()])}))],2)])},oe=[],re=a(53451),le=a.n(re),ne=a(40290);const{debounce:ce}=le(),de="yyyy-MM-DD";var pe,ue,_e=(0,d.defineComponent)({name:"Calendar",props:{displayDate:{type:Date}},setup(e,t){const a=(0,d.ref)(!1),s=(0,d.computed)((()=>_.value.map((e=>{const t=i.value.find((t=>m.is_same_day(e,t.date))),a=t?.date?q()(t?.date):q()(e),s=t?m.status_of_day(t):0;return{date:e,day:a.date(),new_date:a,status:s,shop_live_list:t?.shop_live_list??[]}}))));console.log(s);const i=(0,d.ref)([]),o=(0,$.t)(),r=o.currentRoute.params.id,l=(0,d.computed)((()=>e.displayDate?q()(e.displayDate):q()())),c=(0,d.computed)((()=>l.value.clone().endOf("month").date())),p=(0,d.computed)((()=>{const e=l.value.clone().startOf("month").day();return(0===e?7:e)-1})),u=(0,d.computed)((()=>{const e=l.value.clone().endOf("month").day();return e?7-e:0})),_=(0,d.computed)((()=>{const e=[],t=l.value.clone();for(let a=0;a<m.prefixDays.value.length;a++){const s=m.prefixDays.value[a],i=t.clone().month(t.month()-1).date(s);e.push(i.format(de))}for(let a=1;a<=c.value;a++){const s=t.clone().date(a);e.push(s.format(de))}for(let a=0;a<m.surfixDays.value.length;a++){const s=m.surfixDays.value[a],i=t.clone().month(t.month()+1).date(s);e.push(i.format(de))}return e})),m={onRest:async e=>{if(m.is_rest_disabled(e))return;if(1===e.status){const a=await(0,h.m6)(e.shop_live_list[0].id);return void(a.data.success?(m.queryProjectScheduleCalendar(),t.root.$message.success(a.data.message??"取消休息日成功")):t.root.$message.error(a.data.message??"休息日取消失败，请稍后重试"))}const a=await(0,h.It)(r,e.date);a.data.success?(m.queryProjectScheduleCalendar(),t.root.$message.success(a.data.message??"设置休息日成功")):t.root.$message.error(a.data.message??"休息日设置失败，请稍后重试")},isToday:e=>{const t=q()();return t.format(de)===e.date},surfixDays:(0,d.computed)((()=>{const e=[];for(let t=1;t<=u.value;t++)e.push(t);return e})),prefixDays:(0,d.computed)((()=>{const e=[],t=l.value.clone().month(l.value.month()-1).endOf("month").date();for(let a=0;a<p.value;a++)e.push(t+a-p.value+1);return e})),queryProjectScheduleCalendar:async()=>{const e={project_id:r,start_date:_.value[0],end_date:_.value[_.value.length-1]};a.value=!0;const[s,o]=await Promise.all([await(0,h.nf)(e),await(0,n._v)(500)]);a.value=!1;const l=s.data.data??[];s.data.success?i.value=l:(i.value=[],t.root.$message.error(s.data.message??"获取直播场次信息失败，请稍后重试"))},status_of_day:e=>{const t=e.shop_live_list.find((e=>e.is_rest_day));return t?1:e.shop_live_list.length?2:0},is_same_day:(e,t)=>!!(t&&t.length&&q()(t).isSame(q()(e),"day")),is_rest_disabled:e=>2===e.status,two_live:e=>e.shop_live_list.filter(((e,t)=>t<2)),is_live_abnormal:e=>{let t=!1;return e.is_kol_scheduled&&e.is_entry_live_data&&e.is_operator_scheduled||(t=!0),t},abnormal_live_tips:e=>{const t=[];return e.is_kol_scheduled&&e.is_operator_scheduled||t.push(`${t.length+1}、直播场次待排班`),e.is_entry_live_data||t.push(`${t.length+1}、未录入直播数据`),t},jumpDetail:e=>{(0,ne.k)(t).jumpLiveDisplayDetail({project_id:`${r}`,live_id:`${e.id}`,newWindow:!0})},reloadData:()=>{m.queryProjectScheduleCalendar()}},v=(0,d.ref)(["周一","周二","周三","周四","周五","周六","周日"]);(0,d.watch)([()=>e.displayDate],(([e])=>{m.queryProjectScheduleCalendar()})),m.queryProjectScheduleCalendar();const f=ce(m.onRest,200);return{onRestHandle:f,loading:a,calendarData:s,weeks:v,...m}}}),me=_e,ve=(0,k.Z)(me,ie,oe,!1,null,null,null),fe=ve.exports,he=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-livelist-page"},[a("tg-card",{staticStyle:{display:"flex","flex-direction":"column","flex-grow":"1"},attrs:{padding:0}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{height:"100%",stripe:"",data:e.ShopLiveDataList},on:{"row-click":e.onRowClick},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无记录"}})]},proxy:!0}])},e._l(e.ShopLiveColumns,(function(t,s){return a("el-table-column",e._b({key:s},"el-table-column",t,!1))})),1),a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.QueryForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.QueryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.QueryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.QueryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}})],1)],1)},ge=[],ye=(0,d.defineComponent)({props:{start_date:{type:String},end_date:{type:String}},setup(e,t){const a=q()(),s=(0,$.t)(),i=s.currentRoute.params.id,o=(0,d.ref)(!1),r=(0,d.ref)(0),l=(0,d.ref)({page_num:1,num:20,project_id:i,live_start_date:e.start_date??"",live_end_date:e.end_date??""}),c=(0,d.ref)([]);(0,d.watch)((()=>[e.start_date,e.end_date]),(t=>{t&&(l.value.live_start_date=e.start_date??"",l.value.live_end_date=e.end_date??"",f())}));const p=()=>{f()},u=async e=>{o.value=!0;const[{data:a}]=await(0,n.Dc)(500,(0,h.G3)(e));o.value=!1,a.success?(c.value=a.data.data,r.value=a.data.total):(c.value=[],r.value=0,t.root.$message.warning(a.message??"查询失败，稍后重试"))},_=e=>{(0,ne.k)(t).jumpLiveDisplayDetail({project_id:`${i}`,live_id:`${e.id}`,liveType:"list"})},m=e=>{l.value.page_num=e,f(!1)},v=e=>{l.value.num=e,f()},f=async(e=!0)=>{e&&(l.value.page_num=1),await u(l.value)};(0,d.onMounted)((()=>{f()}));const g={is_before:e=>{const t=q()(e);return t.isBefore(a,"d")}},y=(0,d.computed)((()=>[{label:"直播标题",minWidth:130,formatter:e=>(0,d.h)("div",{class:"line-clamp-1"},[e.live_title?e.live_title:"--"])},{label:"直播时间",minWidth:186,align:"left",formatter:e=>{if(e.live_start_time&&e.live_end_time){const t=q()(e.live_start_time),a=q()(e.live_end_time),s=t.isSame(a,"d");let i=`${t.format("MM.DD HH:mm")} ~ ${a.format("HH:mm")}`;if(!s){const e=t.date(),s=a.date(),o=t.clone().date(e+1),r=o.isSame(a,"d");i=r?`${i}(次日)`:`${i}(${s}日)`}return i}return"--"}},{label:"人员排班",minWidth:74,align:"right",formatter:e=>{const t=e.is_kol_scheduled&&e.is_operator_scheduled,a=g.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status"},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已排班":"未排班"])])}},{label:"数据录入",minWidth:74,align:"center",formatter:e=>{const t=e.is_entry_live_data,a=g.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status",style:{justifyContent:"center"}},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已录入":"待录入"])])}},{label:"是否归档",minWidth:74,align:"right",formatter:e=>{const t=4===e.live_status,a=g.is_before(e.live_start_time)&&!t?"warning":"";return(0,d.h)("div",{class:"live-status"},[(0,d.h)("span",{class:a}),(0,d.h)("span",[t?"已归档":"未归档"])])}}]));return{reloadData:p,QueryForm:l,onRowClick:_,handleCurrentChange:m,handlePageSizeChange:v,ShopLiveDataList:c,ShopLiveColumns:y,loading:o,total:r}}}),be=ye,we=(0,k.Z)(be,he,ge,!1,null,null,null),xe=we.exports,ke=a(40884),Ce=a(13413),Se=a(45028),je=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic live-project-download-schedule-dialog tg-dialog-vcenter-new",attrs:{visible:e.dialogVisible,width:"390px",title:"下载排期","lock-scroll":"","close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:e.close},scopedSlots:e._u([{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.close}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确定")])]},proxy:!0}])},[a("el-form",{ref:"formRef",attrs:{model:e.dataForm,"label-width":"70px",size:"small"}},[a("el-form-item",{attrs:{label:"选择时间：",rules:{required:!0,message:"请选择排期时间",trigger:"change"},prop:"date"}},[a("el-date-picker",{staticStyle:{width:"264px"},attrs:{type:"daterange",editable:!1,clearable:!1,"range-separator":"～","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd","picker-options":e.pickerOptions},on:{blur:e.onDateBlur},model:{value:e.dataForm.date,callback:function(t){e.$set(e.dataForm,"date",t)},expression:"dataForm.date"}})],1)],1)],1)},De=[],$e=a(74750),Ae=(0,d.defineComponent)({setup(e,t){const a=(0,d.ref)(!1),s=(0,d.ref)(void 0),i=(0,d.ref)({date:[]}),o=(0,d.ref)(void 0),r=(0,$.t)(),l=r.currentRoute.params?.id,n={close:()=>{a.value=!1},save:()=>{s.value?.validate((e=>{e&&(t.emit("save"),a.value=!1,window.open(`/api/settlement/download_kol_schedule_v2?project_id=${l}&start_date=${i.value.date[0]}&end_date=${i.value.date[1]}&Authorization=${(0,$e.LP)()}`,"_blank"))}))},show:()=>{s.value?.clearValidate(),a.value=!0},onDateBlur:()=>{o.value=void 0}},c={onPick:({minDate:e})=>{o.value=e},disabledDate(e){if(o.value){const t=q()(o.value),a=q()(o.value),s=q()(e);return t.add(30,"days"),a.add(-30,"days"),s.isBefore(a)||s.isAfter(t)}return!1}};return(0,d.watch)((()=>a.value),(e=>{e||setTimeout((()=>{i.value.date=[]}),300)})),{pickerOptions:c,formRef:s,dataForm:i,dialogVisible:a,...n}}}),Pe=Ae,Fe=(0,k.Z)(Pe,je,De,!1,null,null,null),Re=Fe.exports,Me=(0,d.defineComponent)({components:{calendar:fe,TgBtnCapsule:ke.Z,LiveList:xe,CopyScheduleForm:Ce.Z,liveDisplayAddDialog:Se.Z,downloadSchedule:Re},setup(e,t){const a=(0,U.gI)(),s=(0,d.ref)(void 0),i=(0,d.ref)(void 0),o=(0,d.inject)("project",void 0),l=(0,d.computed)((()=>({studio_id:o?.value?.studio_id,studio_name:o?.value?.studio_name}))),n=(0,d.ref)(!1),c=(0,$.t)(),p=parseInt(c.currentRoute.params.id,10),u=(0,d.ref)(0),_=(0,d.computed)((()=>{const e=new Date;return e.setMonth(e.getMonth()+u.value,1),e})),m=(0,d.ref)(void 0),v=(0,d.computed)((()=>(m.value??[])[0])),f=(0,d.computed)((()=>(m.value??[])[1])),h=(0,d.ref)("calendar"),g=(0,d.computed)((()=>`${_.value.getFullYear()}年${y.formatMonth(_.value.getMonth()+1)}月`)),y={onCapsuleClick:e=>{h.value="left"===e?"calendar":"list",t.root.$router.replace({name:r.FB.project.detail,params:{id:`${p}`,tab:c.currentRoute.params.tab,liveType:h.value}})},onPrevMonth:()=>{y.getNewDate(-1)},onNextMonth:()=>{y.getNewDate(1)},getNewDate:e=>{u.value+=e},formatMonth:e=>e<10?`0${e}`:e},b=()=>{n.value=!0},w=()=>{s.value?.reloadData(),i.value?.reloadData()},x=(0,d.ref)(!1),k=()=>{x.value=!0},C=()=>{x.value=!1,s.value?.reloadData(),i.value?.reloadData()},S=()=>{x.value=!1};(0,d.onBeforeMount)((()=>{const e=t.root.$route.params.liveType??"calendar";"calendar"===e?h.value="calendar":"list"===e&&(h.value="list")}));const j=(0,d.ref)(void 0),D=()=>{j.value?.show()};return{Permission:a,handleCopyScheduleSucceedAction:w,liveDisplayAddDialogVisible:x,handleSaveSucceedAction:C,CopyScheduleFormVisible:n,CopyLiveScheduleHandler:b,AddLiveDisplayHandler:k,handleCloseAction:S,studioInfo:l,project_id:p,liveDisplayType:h,currentTitle:g,...y,displayDate:_,selectDates:m,start_date:v,end_date:f,CalendarRef:s,LiveListRef:i,downloadScheduleRef:j,onDownloadScheduleClick:D,business_type:o?.value?.business_type}}}),Ee=Me,Ie=(0,k.Z)(Ee,ae,se,!1,null,null,null),Te=Ie.exports,Oe=(0,d.defineComponent)({components:{LiveCalendar:Te},setup(){return{}}}),Ve=Oe,Ze=(0,k.Z)(Ve,ee,te,!1,null,null,null),Le=Ze.exports,Ye=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("sub-tabs",[e.permission.live_project_gathering_view&&e.permission.live_project_settlement_view?[a("settlementIncome",{attrs:{name:"结算",cooperationType:e.cooperation_type}}),a("comp1",{attrs:{name:"应收"}}),a("comp2",{attrs:{name:"实收"}})]:e.permission.live_project_gathering_view?[a("comp1",{attrs:{name:"应收"}}),a("comp2",{attrs:{name:"实收"}})]:e.permission.live_project_settlement_view?[a("settlementIncome",{attrs:{name:"结算"}})]:e._e()],2)},Ne=[],Be=a(58008),ze=a(85688),qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("tg-card",{staticClass:"project-collection",staticStyle:{height:"calc(100vh - 236px)"},attrs:{overflowInBody:""},on:{"rect:update":e.onRectUpdate}},[a("div",{staticClass:"header"},[a("span",{staticClass:"label"},[e._v("应收金额：")]),a("span",{staticClass:"text"},[e._v(e._s(e.header_money.receivable))]),a("span",{staticClass:"label"},[e._v("已核销金额：")]),a("span",{staticClass:"text"},[e._v(e._s(e.header_money.write_off))]),a("span",{staticClass:"label"},[e._v("未核销金额：")]),a("span",{staticClass:"text"},[e._v(e._s(e.header_money.not_write_off))]),e.isDev?a("tg-button",{on:{click:function(t){return e.reload()}}},[e._v("刷新(开发环境限定)")]):e._e()],1),a("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",border:"",data:e.data}},"el-table",e.tableProps,!1),[e._l(e.columns,(function(t,s){return a("el-table-column",e._b({key:s},"el-table-column",t,!1))})),a("div",{staticStyle:{position:"static"},attrs:{slot:"empty"},slot:"empty"},[a("empty-common",{attrs:{"detial-text":"暂无数据"}})],1)],2),a("achievement",{ref:"achievementRef",on:{ok:function(t){return e.reload()}}}),a("invoicelist",{ref:"invoicelistRef"}),a("InvoiceDetail",{ref:"invoiceDialogRef"}),a("first-step",{ref:"firstStepRef",on:{submit:function(t){return e.reload()}}})],1)},We=[],Ue=(a(26699),a(98560)),He=a(91538),Je=a(82741),Ge=a(45781),Qe=a(49187),Ke=a(43847),Xe=a(93889),et=a(39716),tt=a(31279),at=a(2698),st=a(17352),it=a(85937),ot=a.n(it),rt=a(67910),lt=a(58302),nt=(0,d.defineComponent)({components:{achievement:Ue.Z,invoicelist:He.Z,InvoiceDetail:et.Z,FirstStep:tt.Z},setup(e,t){const a=(0,d.ref)(null),s=(0,d.ref)(null),i=(0,d.ref)(null),o=(0,d.inject)("project")??(0,d.ref)(void 0),r=(0,d.ref)(void 0),l=(0,U.gI)(),c=(0,d.ref)(!1),p=(0,d.ref)(!1),u=(0,d.ref)([]),_=(0,d.ref)(0),m=(0,d.ref)(0),v=(0,d.ref)(0);let f;const h=async e=>{f=e,p.value=!0;const[{data:t}]=await(0,n.Dc)(500,(0,st.pF)(e)),a=t.data;p.value=!1,c.value=!0,t.success?(u.value=t.data.data,_.value=a.not_write_off,m.value=a.receivable,v.value=a.write_off):(u.value=[],console.warn("未获取到数据"))},g=()=>{h(f)},y=e=>(0,D.oP)(e+"").then((e=>{e.data.success?(t.root.$message.success(e.data.message),g()):t.root.$message.error(e.data.message)}));(0,d.watch)((()=>o.value),(()=>{null!==o.value&&h({receivable_type:o.value?.business_type,project_id:o.value?.id})})),(0,d.onMounted)((()=>{void 0!==o.value&&null!==o.value&&h({receivable_type:o.value.business_type,project_id:o.value?.id})}));const b=async e=>{const a=await(0,Je.I)(t,"确认删除该业绩？");a&&y(e).then((()=>{g()}))},w=(0,Ke.Pc)(),x=(e,t)=>[Xe.RJ.Sales,Xe.RJ.Framework].includes(e)?"/legal/contract/customer/"+t.toString():[Xe.RJ.ServiceContract].includes(e)?"/legal/contract/customerTemplate/"+t.toString():[Xe.RJ.Purchase,Xe.RJ.SupplierFramework].includes(e)?"/legal/contract/supplier/"+t.toString()+"?contract_type="+e.toString():[Xe.RJ.SupplierContract].includes(e)?"/legal/contract/supplierTemplate/"+t.toString()+"?contract_type="+e.toString():[Xe.RJ.AnchorContract].includes(e)?"/legal/contract/anchorTemplate/"+t.toString()+"?contract_type="+e.toString():"",k=(0,d.computed)((()=>({receivable:Ge.Z.formatPrice(m.value,Qe.WL.Yuan,!0),write_off:Ge.Z.formatPrice(v.value,Qe.WL.Yuan,!0),not_write_off:Ge.Z.formatPrice(_.value,Qe.WL.Yuan,!0)}))),C=e=>(0,d.h)("div",{class:"number-div"},[(0,d.h)("span",{class:"number-span "+(null!==e.reversed_id||null!==e.refunded_id?"reverse-red":"")},e.receivable_uid)]),S=(e,t)=>{const a=`${(0,W.SJ)(new(ot())(e.receivable_amount))}`;return t?a:(0,d.h)("div",{class:null!==e.reversed_id||null!==e.refunded_id?"reverse-red":""},[a])},j=(0,rt.zY)(u,"应收金额 (元)",S),$=e=>(0,d.h)("div",{class:"number-div"},[(0,d.h)("span",{class:"number-span text "+(null!==e.reversed_id||null!==e.refunded_id?"reverse-red":"")},e.settlement_uid)]),A=e=>1===e.write_off_status?"状态：部分核销":"状态：未核销",P=(0,rt.zY)(u,"核销状态",A),F=(0,d.computed)((()=>[{label:"应收编号",fixed:"left",minWidth:160,formatter:e=>C(e)},{label:"应收金额 (元)",align:"right",fixed:"left",minWidth:j.value,formatter:e=>S(e,!1)},{label:"创建日期",minWidth:110,align:"center",formatter:e=>q()(e.create_date).format("YYYY.MM.DD")},{label:"结算单",minWidth:160,formatter:e=>$(e)},{label:"核销状态",minWidth:P.value,formatter:e=>{const t=(e.write_off_infos||[]).map((e=>[e.receipt_uid,e.write_off_amount,e.write_off_user,e.write_off_time]));(e.refund_write_off_infos||[]).forEach((e=>{t.push([e.cost_id,-1*(e.write_off_amount??0),e.write_off_user,e.write_off_time])}));const a=["单据编号","核销金额 (元)","核销人/日期"];return(0,d.h)(at.Z,{attrs:{write_off_header:a,write_off_infos:t,write_off_status:e.write_off_status,is_reverse:null!==e.reversed_id}})}},{label:"操作",fixed:"right",align:"center",formatter:e=>{if(e.reverse_id||e.reversed_id||e.refunded_id)return"";const t=[],a=l.live_write_off_save;return 1!==e.write_off_status&&0!==e.write_off_status||!a||t.push((0,d.h)("a",{on:{click:()=>{r.value?.show({type:"isReceivable",id:e.id,amount:e.not_write_off_amount,leaf:"live",busType:e.receivable_type,receivable_uid:e.receivable_uid||e.achievement_uid})}}},["核销"])),(0,d.h)("div",{class:"operation"},t)}}])),R=32,M=0,E=36,I=31,T=(0,lt.Z)({compensation:(0,d.computed)((()=>R+M+E+I)),fixedBlockHeightRefs:[],tableMinHeight:100});return{invoiceDialogRef:i,getContractJumpLink:x,deleteCollection:b,achievementRef:a,invoicelistRef:s,permission:l,userinfo:w,firstStepRef:r,header_money:k,columns:F,reload:g,data:u,loading:p,isDev:!1,...T}}}),ct=nt,dt=(0,k.Z)(ct,qe,We,!1,null,"0c5f7f80",null),pt=dt.exports,ut=a(36568),_t=a.n(ut),mt=a(48606),vt={useShopLiveAchievment(){const e=(0,d.ref)(!1),t=(0,d.ref)(!1),a=(0,d.ref)([]),s=(0,d.ref)(0),i=(0,d.ref)(0),o=(0,d.ref)(0),r=(0,d.ref)(0),l=(0,d.ref)(0);let n;const c=async c=>{if(void 0===c)return;n=c,t.value=!0;const d=await(0,D.MB)(c);t.value=!1;const p=d.data.data,u=p.stat_info;a.value=p.data,e.value=!0,s.value=u.confirmed_gather_amount,i.value=u.total_gather_amount,o.value=u.wait_gather_amount,l.value=u.write_off_amount,r.value=u.not_write_off_amount},p=()=>{c(n)},u=e=>(0,D.oP)(e+"").then((e=>{e.data.success?(mt.Message.success(e.data.message),p()):mt.Message.error(e.data.message)}));return(0,d.reactive)({init:e,loading:t,data:a,confirmed_gather_amount:s,total_gather_amount:i,wait_gather_amount:o,write_off_amount:l,not_write_off_amount:r,query:c,reload:p,deleteShopLiveAchievement:u})}},ft=a(89935),ht=a(64519),gt=a(10114),yt=a(28348),bt=a(42386),wt=a(58861),xt=a(6283),kt=a(79546),Ct=(0,d.defineComponent)({components:{achievement:Ue.Z,invoicelist:He.Z,InvoiceDetail:et.Z,FirstStep:tt.Z,reverseOrderDialog:gt.Z,refundDialog:xt.Z,RefundWriteOff:kt.Z},setup(e,t){const a=(0,d.ref)(void 0),s=(0,d.ref)(null),i=(0,d.ref)(null),o=(0,d.ref)(void 0),r=(0,d.ref)(!1),l=(0,U.gI)(),c=(0,$.t)(),p=vt.useShopLiveAchievment(),u=(0,d.ref)(void 0),_=(0,d.ref)(void 0),m=(0,d.ref)(void 0),v=(0,d.ref)(!1),f=(0,d.ref)(!1),h=(0,d.ref)([]),g=(0,d.ref)(0),y=(0,d.ref)(0),b=(0,d.ref)(0),w=(0,d.ref)(0),x=(0,d.ref)(0);let k;const C=(0,d.ref)(!1),S=(0,d.ref)({achievement_id:"",achievement_uid:"",project_name:"",gather_amount:0,project_id:"",business_type:""}),j=e=>{S.value.achievement_id=e.achievement_id,S.value.achievement_uid=e.achievement_uid,S.value.project_name=e.project_name,S.value.gather_amount=e.gather_amount,S.value.project_id=e.project_id,S.value.business_type=e.business_type,C.value=!0},A=()=>{S.value.achievement_id="",S.value.achievement_uid="",S.value.project_name="",S.value.gather_amount=0,S.value.project_id="",S.value.business_type="",C.value=!1},P=async e=>{if(void 0===e)return;k=e,f.value=!0;const[t]=await(0,n.Dc)(500,(0,D.MB)(e));f.value=!1;const a=t.data.data,s=a.stat_info;h.value=a.data,v.value=!0,g.value=s.confirmed_gather_amount,y.value=s.total_gather_amount,b.value=s.wait_gather_amount,x.value=s.write_off_amount,w.value=s.not_write_off_amount},F=()=>{P(k)},R=e=>(0,D.oP)(e+"").then((e=>{e.data.success?(t.root.$message.success(e.data.message),F()):t.root.$message.error(e.data.message)}));P(c.currentRoute.params.id);const M=async(e,a)=>{const s=await(0,Je.I)(t,a);s&&R(e).then((()=>{F()}))},E=(0,Ke.Pc)(),I=(e,t)=>[Xe.RJ.Sales,Xe.RJ.Framework].includes(e)?"/legal/contract/customer/"+t.toString():[Xe.RJ.ServiceContract].includes(e)?"/legal/contract/customerTemplate/"+t.toString():[Xe.RJ.Purchase,Xe.RJ.SupplierFramework].includes(e)?"/legal/contract/supplier/"+t.toString()+"?contract_type="+e.toString():[Xe.RJ.SupplierContract].includes(e)?"/legal/contract/supplierTemplate/"+t.toString()+"?contract_type="+e.toString():[Xe.RJ.AnchorContract].includes(e)?"/legal/contract/anchorTemplate/"+t.toString()+"?contract_type="+e.toString():"",T=(0,d.ref)(!1),O=(0,d.ref)(""),V=(0,d.ref)(""),Z=()=>{O.value="",T.value=!1},L=e=>{V.value="冲销原因",O.value=e,T.value=!0},Y=e=>{V.value="退回原因",O.value=e,T.value=!0},N=(0,d.ref)(null),B=async(e,a)=>{const s={id:e,reverse_type:yt.Jd.receive,reverse_reason:a},{data:i}=await(0,bt.Tu)(s);return i.success?(t.root.$message.success("提交成功"),F()):t.root.$message.error(i.message),i.success},z=e=>null!==e.reversed_id&&0!==e.reversed_id,{visible:q,toggleVisible:H}=(0,wt.Z)(),J=async(e,a)=>{H();const[{data:s}]=await(0,n.Dc)(500,(0,bt.Xz)({id:e,reverse_type:yt.Jd.receive,reverse_reason:a}));return H(),s.success?(t.root.$message.success(s.message??"重新提交成功"),F()):t.root.$message.error(s.message??"重新提交失败"),s.success},G=!1,Q=(e,t)=>t?(0,W.QN)(e.achievement_uid)>(0,W.QN)(e.achievement_name)?e.achievement_uid:e.achievement_name:(0,d.h)("div",[(0,d.h)("div",{class:null!==e.reversed_id?"reverse-red":""},[e.achievement_uid]),(0,d.h)("div",{class:"text"},[e.achievement_name])]),K=(0,rt.zY)(h,"收款编号/名称",Q),X=e=>{const t=null!==e.reversed_id,a=t?"冲销":ft.qw.find((t=>t.value===e.gather_type))?.label;return(0,d.h)("span",t?{class:"reverse-red"}:void 0,[a])},ee=(e,t)=>{const a=`${(0,W.SJ)(new(ot())(e.gather_amount))}`;return t||null===e.reversed_id?a:(0,d.h)("span",{class:"reverse-red"},[a])},te=(0,rt.zY)(h,"收款金额 (元)",ee),ae=(0,d.computed)((()=>[{label:"收款编号/名称",fixed:"left",minWidth:K.value,formatter:e=>Q(e,!1)},{label:"收款类型",minWidth:80,prop:"gather_type",align:"center",formatter:X},{label:"收款金额 (元)",prop:"gather_amount",align:"right",minWidth:te.value,formatter:e=>ee(e,!1)},{label:"收款账户",width:120,align:"center",formatter:e=>{const t=ft.Fj.find((t=>t.value===e.gather_way))?.label;return(0,d.h)("div",{class:"column-cell",style:{width:"100%",textAlign:"center",paddingLeft:"10px"}},[(0,d.h)("div",{class:"column-cell-line",style:{width:"100px",textAlign:"left"}},[(0,d.h)("span",{class:"label"},["方式："]),(0,d.h)("span",{class:"text"},[t])]),(0,d.h)("div",{class:"column-cell-line",style:{width:"100px",textAlign:"left"}},[(0,d.h)("span",{class:"label"},["详情："]),(0,d.h)("el-popover",{props:{trigger:"hover",placement:"left"}},[(0,d.h)("div",{class:"pop-container pop-finance"},[(0,d.h)("div",{class:"pop-header"},["收款账户"]),(0,d.h)("div",{class:"pop-row"},[(0,d.h)("span",{class:"label"},["收款方式："]),(0,d.h)("span",{class:"text"},[t])]),...1===e.gather_way?[(0,d.h)("div",{class:"pop-row"},[(0,d.h)("span",{class:"label"},["旺旺号"]),(0,d.h)("span",{class:"text"},[e.gather_way_detail.order_wangwang_id])]),(0,d.h)("div",{class:"pop-row"},[(0,d.h)("span",{class:"label"},["V任务ID："]),(0,d.h)("span",{class:"text"},[e.gather_way_detail.task_id])]),(0,d.h)("div",{class:"pop-row"},[(0,d.h)("span",{class:"label"},["接单时间："]),(0,d.h)("span",{class:"text"},[e.gather_way_detail.order_date])])]:[],...2===e.gather_way||3===e.gather_way?[(0,d.h)("div",{class:"pop-row"},[(0,d.h)("span",{class:"label"},["打款公司："]),(0,d.h)("span",{class:"text"},[e.gather_way_detail.pay_company_name])])]:[]]),(0,d.h)("a",{slot:"reference"},["查看"])])])])}}])),se=32,ie=0,oe=36,re=31,{tableProps:le,onRectUpdate:ne,...ce}=(0,lt.Z)({compensation:(0,d.computed)((()=>se+ie+oe+re)),fixedBlockHeightRefs:[],tableMinHeight:100});return{isDev:G,reverseAgainLoading:q,refundWriteOffVisible:r,reverseAgain:J,reason:O,onReasonDialogClose:Z,onReverseBackReasonViewBtnClick:Y,reasonDialogTitle:V,reasonDialogVisible:T,isReversedRow:z,onReverseReasonViewBtnClick:L,reverseOrderDialogRef:N,onWriteOffConfirmResolve:B,invoiceDialogRef:i,getContractJumpLink:I,deleteCollection:M,achievment:p,achievementRef:a,invoicelistRef:s,permission:l,userinfo:E,firstStepRef:o,columns:ae,loading:f,data:h,reload:F,...ce,tableProps:le,onRectUpdate:ne,onRefundViewBtnClick:j,refundRow:S,refundDialogVisible:C,onRefundDialogClose:A,total_gather_amount:y,wait_gather_amount:b,not_write_off_amount:w,write_off_amount:x,confirmed_gather_amount:g,refundWriteOffId:u,refundWriteOffAchievementId:_,refundWriteOffAmount:m}},render(){const e=arguments[0],t=this.isReversedRow,a={class:"project-collection",props:{overflowInBody:!0},on:{["rect:update"]:e=>{this.onRectUpdate(e)}},style:{height:"calc(100vh - 236px)"}};return e("tg-card",_t()([{},a]),[e("div",{class:"header"},[this.isDev?e("tg-button",_t()([{},{on:{click:()=>{this.reload()}}}]),["刷新(仅开发环境)"]):"",e("span",{class:"label"},["登记收款："]),e("span",{class:"text"},[Ge.Z.formatPrice(this.total_gather_amount,Qe.WL.Yuan,!0)]),e("span",{class:"label"},["确认收款："]),e("span",{class:"text"},[Ge.Z.formatPrice(this.confirmed_gather_amount,Qe.WL.Yuan,!0)]),e("span",{class:"label"},["等待确认："]),e("span",{class:"text"},[Ge.Z.formatPrice(this.wait_gather_amount,Qe.WL.Yuan,!0)]),e("span",{class:"label"},["已核销金额："]),e("span",{class:"text"},[Ge.Z.formatPrice(this.write_off_amount,Qe.WL.Yuan,!0)]),e("span",{class:"label"},["未核销金额："]),e("span",{class:"text"},[Ge.Z.formatPrice(this.not_write_off_amount,Qe.WL.Yuan,!0)])]),e("el-table",_t()([{attrs:{stripe:!0,border:!0,loading:this.loading,height:this.tableProps.height}},{directives:[{name:"loading",value:this.loading}]},{attrs:{data:this.data},scopedSlots:{empty:()=>e("div",{style:"position: static;"},[e("empty-common",{attrs:{"detial-text":"暂无数据"}})])}}]),[this.columns.map(((t,a)=>e("el-table-column",_t()([{},{props:{...t}},{key:a}])))),e("el-table-column",{attrs:{label:"收款凭证","min-width":80,align:"center"},scopedSlots:{default:({row:t})=>t.gather_certificate_pic?e("button",{class:"tg-button",style:"margin-right:0px",on:{click:()=>{ht.Z.showDetail(t.gather_certificate_pic+"?Authorization="+(0,$e.LP)())}}},["查看"]):"--"}}),e("el-table-column",{attrs:{label:"是否开票","min-width":110,align:"center"},scopedSlots:{default:({row:t})=>e("div",{class:"column-cell",style:"padding-left:18px;text-align:center;width:100%;dispaly:inline-block"},[e("div",{class:"column-cell-line",style:"width:80px;text-align:left;dispaly:inline-block"},[e("span",{class:"label"},["开票："]),e("span",{class:"text"},[1===t.is_invoice?"是":"否"])]),e("div",{class:"column-cell-line",style:"width:80px;text-align:left;dispaly:inline-block"},[e("span",{class:"label"},["详情："]),1===t.is_invoice&&t.invoice_info.length>0&&e("button",{slot:"reference",class:"tg-button",on:{click:()=>{this.invoicelistRef?.show({title:"发票详情",list:t.invoice_info.map((e=>(e.info=[{label:"发票号码",value:Ge.Z.formatEmpty(e.invoice_num)},{label:"开票时间",value:Ge.Z.formatTime(e.invoice_date)},{label:"开票金额",value:Ge.Z.formatPrice(e.amount,Qe.WL.Yuan)},{label:"开票公司",value:Ge.Z.formatEmpty(e.institution)}],e))),type:0})}}},["查看"]),(1!==t.is_invoice||0===t.invoice_info.length)&&"--"])])}}),e("el-table-column",{attrs:{label:"关联单据","min-width":238},scopedSlots:{default:({row:t})=>{const a=!!t.contract_id;return e("div",{class:"column-cell column-cell-start"},[e("div",{class:"column-cell-line"},[e("span",{class:"label"},["关联合同："]),a?e("span",{class:"text",style:"color: #2877FF; cursor: pointer",on:{click:()=>{const e=this.getContractJumpLink(t.contract_type,t.contract_id);e&&window.open(e)}}},[Ge.Z.formatEmpty(t.contract_uid)]):e("span",{class:"text"},["--"])]),e("div",{class:"column-cell-line"},[e("span",{class:"label"},["开票审批："]),e("span",_t()([{class:"hover-link"},{on:{click:()=>{t.invoice_apply_id&&this.invoiceDialogRef?.open(t.invoice_apply_id)}}}]),[t.approval_uid??"--"])])])}}}),e("el-table-column",{attrs:{label:"财务确认信息","min-width":150},scopedSlots:{default({row:t}){const a=1===t.is_gather,s=1!==t.gather_way;return 1!==t.is_gather?e("span",{style:{color:"#FF7A36"}},["待确认"]):e("div",{class:"column-cell"},[e("div",{class:"column-cell-line"},[e("span",{class:"label"},["状态："]),e("span",{class:"text"},[1===t.is_gather?"已确认":"未确认"])]),e("div",{class:"column-cell-line"},[e("span",{class:"label"},["打款时间："]),e("span",{class:"text"},[Ge.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.order_date:"")])]),s&&e("div",{class:"column-cell-line"},[e("span",{class:"label"},["详情："]),e("el-popover",{attrs:{trigger:"click",placement:"left"}},[e("div",{class:"pop-container pop-finance"},[e("div",{class:"pop-header"},["财务确认信息"]),e("div",{class:"pop-row"},[e("span",{class:"label"},["收款时间："]),e("span",{class:"text"},[Ge.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.order_date:"")])]),e("div",{class:"pop-row"},[e("span",{class:"label"},["名称："]),e("span",{class:"text"},[Ge.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.pay_company_name:"")])]),e("div",{class:"pop-row"},[e("span",{class:"label"},["账号："]),e("span",{class:"text"},[Ge.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.account:"")])]),3===t.gather_way&&e("div",{class:"pop-row"},[e("span",{class:"label"},["开户行："]),e("span",{class:"text"},[Ge.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.bank_of_deposit:"")])])]),a?e("button",{slot:"reference",class:"tg-button"},["查看"]):e("span",{slot:"reference"},["--"])])])])}}}),e("el-table-column",{attrs:{label:"核销状态","min-width":120},scopedSlots:{default({row:t}){let a=[];a=5===t.gather_type?(t.refund_write_off_info_items||[]).map((e=>[e.settlement_uid,e.payable_uid,-1*e.write_off_amount,e.write_off_user,e.write_off_time])):(t.write_off_infos||[]).map((e=>[e.settlement_uid,e.receivable_uid,e.write_off_amount,e.write_off_user,e.write_off_time]));const s=["结算单编号",5===t.gather_type?"应付编号":"应收编号","核销金额 (元)","核销人/日期"];return e(at.Z,{attrs:{write_off_header:s,write_off_infos:a,write_off_status:5===t.gather_type?t.refund_write_off_status:t.write_off_status,is_reverse:null!==t.reversed_id}})}}}),e("el-table-column",{attrs:{label:"冲销状态",align:"center","min-width":80},scopedSlots:{default:({row:t})=>1===t.reverse_status?e("div",{style:"color: #ff7a36"},["待确认"]):2===t.reverse_status?e("div",{style:"color: #02ba3c"},["已确认"]):3===t.reverse_status?e("div",{style:"color: #e91313"},["退回"]):"--"}}),e("el-table-column",{attrs:{label:"录入人/日期","min-width":100,align:"center"},scopedSlots:{default:({row:t})=>e("div",{class:"table_achievement",style:"width:100%;text-align:center;padding-left:10px"},[e("div",{style:"width:80px;text-align:left;"},[t.add_by??"--"]),e("div",{style:"width:80px;text-align:left",class:"text"},[q()(t.gmt_create).format("YYYY.MM.DD")])])}}),e("el-table-column",{attrs:{fixed:"right",label:"操作",minWidth:160},scopedSlots:{default:({row:a})=>{const s=a.not_refund_amount>0&&1===a.is_gather&&!a.reverse_id&&(1===a.gather_type||2===a.gather_type||3===a.gather_type),i=e("button",{on:{click:()=>{this.onRefundViewBtnClick(a)}},class:"tg-button"},["退款"]),o=1===a.is_gather&&5===a.gather_type&&!a.reverse_id&&!a.reversed_id&&this.permission.live_write_off_save&&2!==a.refund_write_off_status,r=e("tg-button",{attrs:{type:"link"},on:{click:()=>{this.refundWriteOffAmount=new(ot())(a.gather_amount?a.gather_amount:0).sub(new(ot())(a.refund_write_off_amount?a.refund_write_off_amount:0)).toNumber(),this.refundWriteOffId=a.refund_cost_id,this.refundWriteOffAchievementId=a.achievement_id,this.refundWriteOffVisible=!0}}},["核销"]);if(t(a)){const t=[e("div",{class:"operation-column"},[e("button",{class:"tg-button",on:{click:()=>{this.onReverseReasonViewBtnClick(a.reverse_reason)}}},["查看"]),s&&i])],l=[e("div",{class:"operation-column"},[e("button",{class:"tg-button",on:{click:()=>this.deleteCollection(a.achievement_id,"是否删除该冲销单")}},["删除"]),e("button",{class:"tg-button",on:{click:()=>{this.reverseOrderDialogRef?.open((e=>this.reverseAgain(a.achievement_id,e)),a.reverse_reason)}}},["重新提交"]),e("button",{class:"tg-button",on:{click:()=>{this.onReverseBackReasonViewBtnClick(a.reverse_back_reason)}}},["退回原因"]),s&&i])];return 3===a.reverse_status?(o&&l.push(r),l):(o&&t.push(r),t)}{const t=a.add_by_id===this.userinfo.id,l=0===a.is_gather,n=this.permission.live_project_status_edit,c=this.permission.live_write_off_save;let d,p;return 0!==a.write_off_status&&1!==a.write_off_status||!c||5===a.gather_type||1===a.is_gather&&null===a.reverse_id&&(d=e("button",{class:"tg-button",on:{click:()=>{this.firstStepRef?.show({type:"isActualIncome",id:a.achievement_id,amount:a.not_write_off_amount,leaf:"live",busType:a.business_type,receivable_uid:a.receivable_uid||a.achievement_uid})}}},["核销"])),1!==a.is_gather||null!==a.reverse_id||5===a.gather_type||a.has_refund||(p=e("button",{class:"tg-button",on:{click:()=>{this.reverseOrderDialogRef?.open((e=>this.onWriteOffConfirmResolve(a.achievement_id,e)))}},style:"color: #e91313"},["冲销"])),e("div",{class:"operation-column"},[p,d,t&&l&&n&&e("button",{class:"tg-button",on:{click:()=>{const e={achievement_name:a.achievement_name,gather_type:a.gather_type,gather_amount:a.gather_amount,gather_way:a.gather_way,contract_id:a.contract_id,is_invoice:a.is_invoice,invoice_apply_id:a.invoice_apply_id,achievement_id:a.achievement_id,id:a.settlement_id,revenue_flow_id:a.revenue_flow_id},t=a.gather_way_detail;if(t&&(e.order_date=t.order_date,e.order_wangwang_id=t.order_wangwang_id,e.task_id=t.task_id,e.pay_company_name=t.pay_company_name),a.gather_certificate_pic){const t=new RegExp("\\/([^\\/]+)$"),s=t.exec(a.gather_certificate_pic);let i;s&&(i=s[1]),e.gather_certificate_pic={name:i,value:a.gather_certificate_pic}}a.contract_id&&(e.search_contract_list_value=[{label:a.contract_uid,value:a.contract_id}]),a.invoice_apply_id&&(e.search_invoice_apply_value=[{label:a.approval_uid,value:a.invoice_apply_id}]);const s="CommonBusinessProjectDetail"===this.$route.name,i="SSLiveProjectDetail"===this.$route.name,o="MarketingProjectDetail"===this.$route.name;this.achievementRef?.show(e,{isMcn:s,isBrand:i,isMarketing:o},a.business_type===_.WD.douyin||a.business_type===_.WD.douyinsh)}}},["编辑"]),t&&l&&n&&e("button",{on:{click:()=>this.deleteCollection(a.achievement_id,"确认删除该业绩？")},class:"tg-button"},["删除"]),s&&i,o&&r])}}}})]),e(Ue.Z,{ref:"achievementRef",on:{ok:()=>{this.reload()}}}),e(He.Z,{ref:"invoicelistRef"}),e(et.Z,_t()([{},{ref:"invoiceDialogRef"}])),e("first-step",{ref:"firstStepRef",on:{submit:()=>{this.reload()}}}),e(gt.Z,{ref:"reverseOrderDialogRef"}),e("refund-write-off",{attrs:{type:"pay",notWriteOffAmount:this.refundWriteOffAmount,refund_cost_id:this.refundWriteOffId,achievement_id:this.refundWriteOffAchievementId,visible:this.refundWriteOffVisible},on:{cancel:()=>this.refundWriteOffVisible=!1,save:()=>{this.refundWriteOffVisible=!1,this.reload()}}}),e("tg-mask-loading",{attrs:{visible:this.writeOffLoading,content:"正在提交冲销，请稍候..."}}),e("tg-mask-loading",{attrs:{visible:this.reverseAgainLoading,content:"正在提交冲销，请稍候..."}}),e("el-dialog",{class:"tg-dialog-classic tg-dialog-vcenter-new",attrs:{visible:this.reasonDialogVisible,width:"440px"},on:{close:()=>{this.onReasonDialogClose()}}},[e("div",{slot:"title"},[this.reasonDialogTitle]),e("div",{class:"reason-dialog-content"},[this.reason])]),this.refundDialogVisible?e(xt.Z,_t()([{attrs:{visible:this.refundDialogVisible,row:this.refundRow}},{on:{"dialog:close":()=>{this.refundDialogVisible=!1,this.reload()}}}])):""])}}),St=Ct,jt=(0,k.Z)(St,pe,ue,!1,null,"387c0a10",null),Dt=jt.exports,$t=(0,d.defineComponent)({components:{SubTabs:Be.Z,settlementIncome:ze.Z,comp1:pt,comp2:Dt},setup(){const e=JSON.stringify((0,d.inject)("project",{cooperation_type:0})),t=JSON.parse(e);let a=(0,d.ref)(0);t.value&&(a=t.value.cooperation_type||0);const s=(0,U.gI)();return{cooperation_type:a,permission:s}}}),At=$t,Pt=(0,k.Z)(At,Ye,Ne,!1,null,null,null),Ft=Pt.exports,Rt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("sub-tabs",[e.permission.live_project_settlement_view&&e.showCostSettlement&&e.permission.live_project_pay_view?[a("settlementCost",{attrs:{name:"结算",isareacost:!1}}),a("comp1",{attrs:{name:"应付"}}),a("comp2",{attrs:{name:"实付"}})]:e.permission.live_project_pay_view&&e.permission.live_project_settlement_view?[a("settlementCost",{attrs:{name:"结算",isareacost:!0,cooperationType:e.cooperation_type}}),a("comp1",{attrs:{name:"应付"}}),a("comp2",{attrs:{name:"实付"}})]:e.permission.live_project_settlement_view&&e.showCostSettlement?[a("settlementCost",{attrs:{name:"结算"}})]:e._e()],2)},Mt=[],Et=a(36165),It=(a(21703),a(74511));const Tt=(e=15)=>{const t=new Date,a=new Date(t.getFullYear(),t.getMonth(),e);return q()(a).format("YYYY-MM-DD")},Ot={id:void 0,pay_amount:void 0,pay_reason:"",transfer_date:Tt()};var Vt,Zt,Lt=(0,d.defineComponent)({setup(e,t){const a=(0,d.ref)(!1),s=(0,d.ref)(void 0),i=(0,d.inject)("project"),o=(0,d.reactive)({...Ot}),r=(0,d.ref)(!1),l=(e={})=>{Object.entries({...Ot,...e}).forEach((([e,t])=>{o[e]=t})),r.value=!0,(0,d.nextTick)((()=>{s.value?.focus()}))},n=(0,d.ref)(null),c=(e=!1)=>{t.emit("close",e),r.value=!1},p=()=>{t.emit("added"),r.value=!1,a.value=!1},u=()=>{n.value?.validate((e=>{if(!e)return!1;const t=i?i.value.id:-1;if(-1===t)return mt.Message.error("项目ID错误"),!1;const s={project_id:t,new_cost_type:1,...o};a.value=!0,(0,D.I8)(s).then((e=>{if(!e.data.success)return mt.Message.error(e.data.message);mt.Message.success(e.data.message),setTimeout(p,1e3)})).catch((e=>{mt.Message.error(e.message),a.value=!1}))}))};return{saveLoading:a,project:i,form:o,formRef:n,emitClose:c,submit:u,visible:r,show:l,payAmountRef:s}},render(e){return e("div",[e("el-dialog",{class:"customer-dialog tg-dialog-vcenter",attrs:{width:"478px",visible:this.visible,title:"登记成本","close-on-click-modal":!1},on:{close:this.emitClose}},[e("div",{class:"cost-dialog-achievement-container"},[e("el-form",_t()([{attrs:{labelWidth:"78px",size:"small",labelPosition:"top"},ref:"formRef"},{attrs:{model:this.form}},{on:{input:()=>{}}}]),[e("el-form-item",{attrs:{label:"成本类型"}},[e("el-input",{attrs:{value:"人员工资",disabled:!0}})]),e("el-form-item",{attrs:{label:"打款金额",prop:"pay_amount",rules:[{required:!0,message:"请输入打款金额",trigger:"blur"},{validator:(e,t,a)=>{if(isNaN(t))return a(new Error("无效金额"));const s=/\.(\d+)/g,i=s.exec(t);return i?i[1].length>2?a(new Error("只能输入2位小数")):void a():a()},trigger:"blur"},{validator:(e,t,a)=>{Number(t)<=0&&a(new Error("费用金额必须大于0")),a()},trigger:"change"},{validator:It.Z.number_range(0),trigger:"blur"}]}},[e("el-input",{attrs:{placeholder:"请输入打款金额",value:this.form.pay_amount,inputType:"price",maxLength:14},ref:"payAmountRef",on:{input:e=>this.form.pay_amount=e}})]),e("el-form-item",{attrs:{label:"用款日期",prop:"transfer_date",rules:[{required:!0,message:"请输入用款日期",trigger:"change"}]}},[e("el-date-picker",{style:"width: 100%",attrs:{placeholder:"请输入用款日期",value:this.form.transfer_date,"value-format":"yyyy-MM-dd"},on:{input:e=>this.form.transfer_date=e}})]),e("el-form-item",{attrs:{label:"付款事由",prop:"pay_reason",inputType:"date",rules:{required:!0,message:"请输入付款事由",trigger:"blur"}}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入付款事由",rows:4,maxlength:100,"show-word-limit":!0,value:this.form.pay_reason},on:{input:e=>this.form.pay_reason=e}})])])]),e("template",{slot:"footer"},[e("tg-button",{on:{click:this.emitClose}},["取消"]),e("tg-button",{attrs:{type:"primary"},on:{click:this.submit}},["提交"])])]),e("tg-mask-loading",{attrs:{visible:this.saveLoading,content:"正在保存，请稍候..."}})])}}),Yt=Lt,Nt=(0,k.Z)(Yt,Vt,Zt,!1,null,null,null),Bt=Nt.exports,zt=a(18728),qt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticStyle:{"border-radius":"10px"},attrs:{"append-to-body":!0,visible:e.customerVisible,width:"800px",top:"70px","close-on-click-modal":!1},on:{"update:visible":function(t){e.customerVisible=t},close:e.close},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",[s("span",{staticStyle:{"font-size":"18px","font-weight":"600",color:"#333"}},[e._v("退款申请详情")])])]},proxy:!0},{key:"footer",fn:function(){return[e.cost_show?s("span",{staticClass:"dialog-footer"},[s("div"),e.revocationVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button color-9",attrs:{size:"small"},on:{click:e.revocation}},[e._v("撤销")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-red",attrs:{type:"primary",size:"small"},on:{click:e.refuse}},[e._v("拒绝")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-blue",attrs:{type:"primary",size:"small"},on:{click:e.agree}},[e._v("同意")]):e._e(),s("el-dialog",{staticClass:"userinfo-customer-dialog",attrs:{visible:e.approvalDialogVisible,width:"460px","close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{close:function(t){e.approvalDialogVisible=!1}},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-header"},[e._v("拒绝理由")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-footer"},[s("el-button",{staticClass:"big-button",attrs:{size:"small",plain:""},on:{click:function(t){e.approvalDialogVisible=!1}}},[e._v("取消")]),s("el-button",{staticClass:"btn-blue big-button",attrs:{size:"small",type:"primary"},on:{click:e.handleApprovalSubmitClick}},[e._v("确定")])],1)]},proxy:!0}],null,!1,3210623043)},[s("div",{staticClass:"approval-content"},[s("p",{staticStyle:{"text-align":"left",color:"#333","margin-bottom":"10px"}},[e._v("填写理由:")]),s("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:3,maxlength:30,placeholder:"请输入不超过30个字符"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)]),s("refund-dialog",{ref:"RefundDialog",on:{"update-info":e.updateInfo}})],1):e._e()]},proxy:!0}])},[s("div",{staticClass:"main"},[s("div",{staticClass:"main-header"},[s("div",{staticClass:"from-header-box"},[s("div",{staticClass:"from-header"},[s("span",[e._v("申请人:")]),s("span",[e._v(e._s(e.detail_data.username))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("申请部门:")]),s("span",[e._v(e._s(e.detail_data.create_department))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("发起时间:")]),s("span",[e._v(e._s(e.detail_data.gmt_create))])]),s("span",{staticClass:"left_icon"},[e.revocationVisiable()&&e.commitAgainShow?s("div",{staticClass:"apply-click",on:{click:e.again}},[s("span",[s("img",{attrs:{src:a(15634)}})]),s("span",{staticClass:"hover-red"},[e._v("再次提交")])]):e._e(),s("div",{staticClass:"apply-click",on:{click:e.exportPdf}},[s("span",[s("img",{attrs:{src:a(97830)}})]),s("span",[e._v("下载PDF")])])])]),s("div",{staticClass:"title-right"},[s("span",{staticStyle:{"font-size":"16px",color:"#333"}},[e._v("审批编号:")]),s("span",{staticStyle:{color:"#333","font-weight":"600","font-size":"16px"}},[e._v(e._s(e.detail_data.approval_uid))]),s("span",{class:"status-color status-color-"+e.detail_data.approval_status},[1===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批中")]):e._e(),2===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批通过")]):e._e(),3===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批失败")]):e._e(),4===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("已撤销")]):e._e()])])]),s("div",{staticClass:"main-middle"},[s("div",{staticClass:"uls"},[s("ul",[s("li",[s("span",{staticClass:"color-9"},[e._v("退款类型:")]),1===e.detail_data.level_two_types?s("span",[e._v("业绩退款")]):e._e()]),s("li",[s("span",{staticClass:"color-9"},[e._v("退款金额:")]),s("span",{staticClass:"color-red",staticStyle:{"font-weight":"600"}},[e._v(e._s("￥"+e.detail_data.refund_amount_str))])]),s("li",[s("span",{staticClass:"color-9"},[e._v("关联业绩:")]),s("span",{staticClass:"color-blue"},[e._v(e._s(e.detail_data.achievement_uid))])])]),s("ul",[s("li",[s("span",{staticClass:"color-9"},[e._v("退款方式:")]),1===e.detail_data.level_three_types?s("span",[e._v("V任务")]):e._e(),2===e.detail_data.level_three_types?s("span",[e._v("支付宝")]):e._e(),3===e.detail_data.level_three_types?s("span",[e._v("对公银行")]):e._e()]),s("li",[1===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("V任务id:")]),s("span",[e._v(e._s(e.detail_data.refund_way_detail.v_task_id))])]):e._e(),2===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("姓名:")]),e._v(" "+e._s(e.detail_data.refund_way_detail.name)+" ")]):e._e(),3===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("银行卡号:")]),e._v(" "+e._s(e.detail_data.refund_way_detail.bank_card_number)+" ")]):e._e()]),s("li",[1===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("旺旺号:")]),s("span",[e._v(e._s(e.detail_data.refund_way_detail.wangwang_name))])]):e._e(),2===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("账户:")]),e._v(" "+e._s(e.detail_data.refund_way_detail.account)+" ")]):e._e(),3===e.detail_data.level_three_types?s("p",[s("span",{staticClass:"color-9"},[e._v("开户行:")]),e._v(" "+e._s(e.detail_data.refund_way_detail.bank_of_deposit)+" ")]):e._e()])]),s("ul",[3===e.detail_data.level_three_types?s("li",[s("span",{staticClass:"color-9"},[e._v("公司名称:")]),e._v(" "+e._s(e.detail_data.refund_way_detail.company_name)+" ")]):e._e(),s("li",[s("span",{staticClass:"color-9"},[e._v("备注:")]),s("span",{staticClass:"break-all"},[e._v(e._s(e.detail_data.remark?e.detail_data.remark:"--"))])])])]),s("ul",{staticClass:"reason"},[s("span",{staticClass:"color-9"},[e._v("退款理由:")]),s("span",{staticClass:"break-all"},[e._v(e._s(e.detail_data.refund_reason?e.detail_data.refund_reason:"--"))])])])]),s("div",{staticClass:"flow",staticStyle:{"padding-left":"18px"}},[s("div",{staticClass:"invoice-info-title"},[e._v("审批流程")]),e.steps.length>0?s("tg-steps",{attrs:{direction:"vertical",steps:e.steps,active:e.activeNumber}}):s("span",[e._v("--")])],1)])},Wt=[],Ut=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("common-dialog",{ref:"refundDialog",attrs:{isAppendToBody:!0,title:"退款申请单",width:800,top:70,isfooter:!0},on:{"dialog-cancel":e.handledialogCancel,"dialog-submit":e.handledialogSubmit}},[a("div",{staticClass:"warp"},[a("el-form",{ref:"refund_list",attrs:{rules:e.refund_list_rules,model:e.refund_list}},[a("el-form-item",{attrs:{"label-width":"90px",prop:"radio"},scopedSlots:e._u([{key:"label",fn:function(){return[a("span",[a("span",{staticStyle:{color:"#f56c6c","margin-right":"3px"}},[e._v("*")]),e._v("退款类型: ")])]},proxy:!0}])},[a("el-radio",{attrs:{label:"1"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("业绩退款")])],1),a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{attrs:{label:"关联业绩：",prop:"achievement_uid","label-width":"90px"}},[a("el-select",{staticStyle:{"padding-right":"6px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"搜索并选择收款编号"},on:{change:function(t){return e.selectAchievementUid(t,e.refund_list)}},model:{value:e.refund_list.achievement_uid,callback:function(t){e.$set(e.refund_list,"achievement_uid",t)},expression:"refund_list.achievement_uid"}},e._l(e.achievement_uids,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),a("div",{staticClass:"gatherAmountStr-bgc"},[a("span",[e._v("该笔业绩收款金额:")]),a("span",{staticClass:"gatherAmountStr",staticStyle:{width:"400px"}},[e._v(e._s(e.refund_list.gather_amount?"￥"+e.refund_list.gather_amount:"--"))])])],1),a("el-form-item",{attrs:{label:"退款金额：","label-width":"90px",prop:"refund_amount"}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",maxlength:e.inputMaxL,placeholder:"请输入退款金额"},on:{input:function(t){e.inputMaxL=/^\d+\.?\d{0,1}$/.test(e.refund_list.refund_amount)?null:e.refund_list.refund_amount.length-1}},nativeOn:{mousewheel:function(e){e.preventDefault()}},scopedSlots:e._u([{key:"append",fn:function(){return[e._v("元")]},proxy:!0}]),model:{value:e.refund_list.refund_amount,callback:function(t){e.$set(e.refund_list,"refund_amount",t)},expression:"refund_list.refund_amount"}})],1),a("el-form-item",{attrs:{label:"退款方式：",prop:"level_three_types","label-width":"90px"}},[a("el-radio",{attrs:{label:1},on:{change:function(t){return e.vTaskChange(t)}},model:{value:e.refund_list.level_three_types,callback:function(t){e.$set(e.refund_list,"level_three_types",t)},expression:"refund_list.level_three_types"}},[e._v("V任务")]),a("el-radio",{attrs:{label:2},on:{change:function(t){return e.accountChange(t)}},model:{value:e.refund_list.level_three_types,callback:function(t){e.$set(e.refund_list,"level_three_types",t)},expression:"refund_list.level_three_types"}},[e._v("支付宝")]),a("el-radio",{attrs:{label:3},on:{change:function(t){return e.payMentChange(t)}},model:{value:e.refund_list.level_three_types,callback:function(t){e.$set(e.refund_list,"level_three_types",t)},expression:"refund_list.level_three_types"}},[e._v("对公银行")])],1),1===e.refund_list.level_three_types?a("div",[a("el-form-item",{attrs:{"label-width":"90px"}},[a("div",{key:"1",staticClass:"v-bgc"},[a("el-form-item",{attrs:{label:"V任务id：","label-width":"90px",prop:"v_task_id"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入v任务id"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.refund_list.v_task_id,callback:function(t){e.$set(e.refund_list,"v_task_id","string"===typeof t?t.trim():t)},expression:"refund_list.v_task_id"}})],1),a("el-form-item",{attrs:{label:"旺旺名：","label-width":"90px",prop:"wangwang_name"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入公司名称"},model:{value:e.refund_list.wangwang_name,callback:function(t){e.$set(e.refund_list,"wangwang_name","string"===typeof t?t.trim():t)},expression:"refund_list.wangwang_name"}})],1)],1)])],1):e._e(),2===e.refund_list.level_three_types?a("div",[a("el-form-item",{attrs:{"label-width":"90px"}},[a("div",{key:"2",staticClass:"v-bgc"},[a("el-form-item",{attrs:{label:"姓名：","label-width":"90px",prop:"name"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入姓名"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.refund_list.name,callback:function(t){e.$set(e.refund_list,"name","string"===typeof t?t.trim():t)},expression:"refund_list.name"}})],1),a("el-form-item",{attrs:{label:"账号：","label-width":"90px",prop:"account"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入账号"},model:{value:e.refund_list.account,callback:function(t){e.$set(e.refund_list,"account","string"===typeof t?t.trim():t)},expression:"refund_list.account"}})],1)],1)])],1):e._e(),3===e.refund_list.level_three_types?a("div",[a("el-form-item",{attrs:{"label-width":"90px"}},[a("div",{key:"3",staticClass:"v-bgc"},[a("el-form-item",{attrs:{label:"银行卡号：","label-width":"90px",prop:"bank_card_number"}},[a("el-input",{attrs:{maxlength:"40",oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:"请输入银行卡号"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.refund_list.bank_card_number,callback:function(t){e.$set(e.refund_list,"bank_card_number","string"===typeof t?t.trim():t)},expression:"refund_list.bank_card_number"}})],1),a("el-form-item",{attrs:{label:"公司名称：","label-width":"90px",prop:"company_name"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入公司名称"},model:{value:e.refund_list.company_name,callback:function(t){e.$set(e.refund_list,"company_name","string"===typeof t?t.trim():t)},expression:"refund_list.company_name"}})],1),a("el-form-item",{staticClass:"bank-deposit",attrs:{maxlength:"40",label:"开户行：","label-width":"90px",prop:"bank_of_deposit"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入开户行"},model:{value:e.refund_list.bank_of_deposit,callback:function(t){e.$set(e.refund_list,"bank_of_deposit","string"===typeof t?t.trim():t)},expression:"refund_list.bank_of_deposit"}})],1)],1)])],1):e._e(),a("el-form-item",{attrs:{label:"退款理由：","label-width":"90px",prop:"refund_reason"}},[a("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入退款理由"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.refund_list.refund_reason,callback:function(t){e.$set(e.refund_list,"refund_reason","string"===typeof t?t.trim():t)},expression:"refund_list.refund_reason"}})],1),a("el-form-item",{attrs:{label:"备注：","label-width":"90px"}},[a("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入备注"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.refund_list.remark,callback:function(t){e.$set(e.refund_list,"remark","string"===typeof t?t.trim():t)},expression:"refund_list.remark"}})],1)],1)],1),a("div",{staticClass:"flow"},[a("el-form",[a("el-form-item",{attrs:{label:"审批流程：","label-width":"90px"}},[e.error_text?a("p",{staticStyle:{color:"#f43846"}},[e._v(e._s(e.error_text))]):e._e(),a("div",[a("el-steps",{staticClass:"steps-line",attrs:{direction:"vertical"}},e._l(e.select_data,(function(t,s){return a("div",{key:s,class:[{"line-show-1":e.refund_list.refund_amount<1e5},{"line-show-2":e.refund_list.refund_amount>=1e5&&e.refund_list.refund_amount<5e5},{"line-show-3":e.refund_list.refund_amount>=5e5}]},[!e.select_data[s].limit_amount||e.refund_list.refund_amount>=e.select_data[s].limit_amount?a("el-step",{staticStyle:{height:"82px"},scopedSlots:e._u([{key:"title",fn:function(){return[804!==t.role_code&&802!==t.role_code?a("span",[e._v(e._s(t.role_name))]):e._e(),804===t.role_code?a("span",[e._v(e._s(t.role_name+"（用款金额大于10万元）"))]):e._e(),802===t.role_code?a("span",[e._v(e._s(t.role_name+"（用款金额大于50万元）"))]):e._e()]},proxy:!0},{key:"description",fn:function(){return[a("div",[a("span",{staticStyle:{color:"#f56c6c","margin-right":"3px"}},[e._v("*")]),a("span",{staticClass:"flow-select"},[e._v("审批人:")]),a("el-select",{attrs:{clearable:!1,filterable:"",placeholder:"请选择"},on:{change:function(t){return e.selectUserId(t,e.select_data[s].approval_user,s)}},model:{value:e.approver_name[s],callback:function(t){e.$set(e.approver_name,s,t)},expression:"approver_name[index]"}},e._l(e.select_data[s].approval_user?e.select_data[s].approval_user:"",(function(e){return a("el-option",{key:e.user_id,attrs:{value:e.username}})})),1)],1)]},proxy:!0}],null,!0)}):e._e()],1)})),0)],1)])],1)],1)])},Ht=[],Jt=a(66117),Gt={name:"refundDialog",data(){return{inputMaxL:null,error_text:"",index:"",approver_name:[],select_data:"",radio:"1",refund_list:{approval_type:2,level_two_types:1,level_three_types:1,achievement_id:"",achievement_uid:"",refund_amount:"",name:"",account:"",v_task_id:"",wangwang_name:"",bank_card_number:"",bank_of_deposit:"",company_name:"",refund_reason:"",remark:"",approval_stream:[],gather_amount:""},achievement_uids:[],list:[],list_uid:[],refund_list_rules:{achievement_uid:[{required:!0,message:"请选择关联业绩",trigger:"change"}],refund_amount:[{required:!0,message:"请输入退款金额",trigger:"blur"}],level_three_types:[{required:!0,message:"请选择退款方式",trigger:"change"}],v_task_id:[{required:!0,message:"请输入v任务id",trigger:"blur"}],wangwang_name:[{required:!0,message:"请输入旺旺名",trigger:"blur"}],name:[{required:!0,message:"请输入姓名",trigger:"blur"}],account:[{required:!0,message:"请输入账号",trigger:"blur"}],bank_card_number:[{required:!0,message:"请输入银行卡号",trigger:"blur"}],bank_of_deposit:[{required:!0,message:"请输入开户行",trigger:"blur"}],refund_reason:[{required:!0,message:"请输入退款理由",trigger:"blur"}],company_name:[{required:!0,message:"请输入公司名称",trigger:"blur"}]}}},activated(){this.getApprovalStreamSelect()},methods:{getApprovalStreamSelect(){(0,Jt.SW)({approval_type:2}).then((e=>{e&&e.data&&e.data.success?(this.select_data=e.data.data,this.list=e.data.data):this.error_text=e.data.message}))},show(e){if(this.getApprovalStreamSelect(),this.$refs.refundDialog.dialogOpen(),e){this.refund_list.gather_amount=e.gather_amount,this.refund_list.achievement_id=e.achievement_id,this.refund_list.achievement_uid=e.achievement_uid,this.refund_list.refund_amount=e.refund_amount_str,this.refund_list.level_three_types=e.level_three_types,this.refund_list.v_task_id=1===e.level_three_types?e.refund_way_detail.v_task_id:"",this.refund_list.wangwang_name=1===e.level_three_types?e.refund_way_detail.wangwang_name:"",this.refund_list.name=2===e.level_three_types?e.refund_way_detail.name:"",this.refund_list.account=2===e.level_three_types?e.refund_way_detail.account:"",this.refund_list.bank_card_number=3===e.level_three_types?e.refund_way_detail.bank_card_number:"",this.refund_list.bank_of_deposit=3===e.level_three_types?e.refund_way_detail.bank_of_deposit:"",this.refund_list.company_name=3===e.level_three_types?e.refund_way_detail.company_name:"",this.refund_list.refund_reason=e.refund_reason,this.refund_list.remark=e.remark;const t=[];for(let a=0;a<e.approval_stream.length;a++)this.approver_name.push(e.approval_stream[a].username),t.push({index:e.approval_stream[a].index,user_id:e.approval_stream[a].user_id,role_code:e.approval_stream[a].role_code});this.refund_list.approval_stream.splice(this.index,1,...t)}this.getAchievementUIds()},selectAchievementUid(e,t){for(let a=0;a<this.list_uid.length;a++)this.list_uid[a].achievement_uid===e&&(this.refund_list.gather_amount=this.list_uid[a].gather_amount,this.refund_list.achievement_id=this.list_uid[a].achievement_id)},vTaskChange(e){1===e&&(this.refund_list.bank_card_number="",this.refund_list.company_name="",this.refund_list.bank_of_deposit="",this.refund_list.name="",this.refund_list.account="")},accountChange(e){2===e&&(this.refund_list.bank_card_number="",this.refund_list.company_name="",this.refund_list.bank_of_deposit="",this.refund_list.v_task_id="",this.refund_list.wangwang_name="")},payMentChange(e){3===e&&(this.refund_list.name="",this.refund_list.account="",this.refund_list.v_task_id="",this.refund_list.wangwang_name="")},getAchievementUIds(){(0,Jt.Lc)({partner_type:2}).then((e=>{this.achievement_uids=e.data.data.data.map((e=>e.achievement_uid)),this.list_uid=e.data.data.data}))},handledialogSubmit(){this.refund_list.refund_amount<1e5&&(6===this.refund_list.approval_stream.length&&this.refund_list.approval_stream.splice(4,2),5===this.refund_list.approval_stream.length&&this.refund_list.approval_stream.splice(4,1)),this.refund_list.refund_amount>=1e5&&this.refund_list.refund_amount<5e5&&6===this.refund_list.approval_stream.length&&this.refund_list.approval_stream.splice(5,1),this.$refs.refund_list.validate((e=>{e&&(0===this.refund_list.refund_amount?this.$message.error("金额不得小于等于0"):(this.refund_list.refund_amount<1e5&&(4!==this.refund_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,Jt.D_)(this.refund_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.refundDialog.dialogClose()):this.$message.error(e.data.message)}))),this.refund_list.refund_amount>=1e5&&this.refund_list.refund_amount<5e5&&(5!==this.refund_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,Jt.D_)(this.refund_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.refundDialog.dialogClose()):this.$message.error(e.data.message)}))),this.refund_list.refund_amount>=1e5&&this.refund_list.refund_amount>=5e5&&(6!==this.refund_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,Jt.D_)(this.refund_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.refundDialog.dialogClose()):this.$message.error(e.data.message)})))))})),this.$emit("update-info","update")},selectUserId(e,t,a){this.index=a;let s=[];for(let r=0;r<t.length;r++)e===t[r].username&&(s={index:a,user_id:t[r].user_id,role_code:t[r].role_code});this.refund_list.approval_stream.length<this.approver_name.length?this.refund_list.approval_stream.push(s):this.refund_list.approval_stream.splice(a,1,s);let i=this.refund_list.approval_stream;function o(e){return function(t,a){return t[e]-a[e]}}i=i.sort(o("index"))},handledialogCancel(){this.$refs.refund_list.resetFields(),this.refund_list.remark="",this.refund_list.approval_stream=[],this.refund_list.gather_amount="--",this.approver_name=[]}}},Qt=Gt,Kt=(0,k.Z)(Qt,Ut,Ht,!1,null,"4acde0ee",null),Xt=Kt.exports,ea=a(64479),ta=a(32622),aa=a(51351),sa={components:{RefundDialog:Xt},name:"refundDetail",setup(e,t){return{...(0,ta.o)(t)}},data(){return{cost_show:!0,step_status:0,detail_data:"",customerVisible:!0,commitAgainShow:!0,approvalDialogVisible:!1,remark:""}},async mounted(){this.currentUserInfo=this.$store.getters["user/getUserInfo"]},methods:{async getFlowStepData(e){const{data:t}=await(0,aa.OC)({approval_id:e});t.success?this.$store.dispatch("workbench/setApproval",{...t.data}):this.$message.error(t.message??"获取审批详情失败")},updateInfo(e){e&&this.$parent.handleSearch()},show(e,t=0){this.commitAgainShow=0===t,e&&void 0===e.pay_way_detail&&0===t?(0,Jt.Ec)({approval_id:e.approval_id}).then((e=>{e&&e.data&&e.data.success&&(this.detail_data=e.data.data,this.step_status=this.detail_data.steps),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1)})):(0,Jt.Ec)({approval_id:1===t?e.approval_id:e.pay_way_detail[0].approval_id}).then((e=>{e&&e.data&&e.data.success&&(this.detail_data=e.data.data,this.step_status=this.detail_data.steps),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1)})),this.getFlowStepData(e.approval_id)},revocationVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.add_by;return e},btnVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.now_id;return e},close(){this.$emit("close")},again(){const e=this.detail_data;this.$refs.RefundDialog.show(e)},exportPdf(){(0,ea.m)(this.detail_data.approval_id)},revocation(){this.$confirm("你确定撤销吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:4};(0,Jt.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功"),this.$parent.handleSearch()):this.$message.error("保存失败")}))})).catch((()=>!1))},agree(){this.$confirm("你确定同意该申请吗","提示",{confirmButtonText:"同意",cancelButtonText:"取消",type:"warning",iconClass:"success-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:2};(0,Jt.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功"),this.$parent.handleSearch()):this.$message.error("保存失败")}))})).catch((()=>!1))},refuse(){this.approvalDialogVisible=!0},handleApprovalSubmitClick(){const e={approval_id:this.detail_data.approval_id,update_code:3,remark:this.remark};(0,Jt.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.approvalDialogVisible=!1,this.close(),this.$message.success("保存成功"),this.this.remark="",this.$parent.handleSearch()):this.$message.error("保存失败")})).catch((()=>!1))}}},ia=sa,oa=(0,k.Z)(ia,qt,Wt,!1,null,"4c679323",null),ra=oa.exports,la=a(86701),na=a(33018),ca=a(24643),da=a(35049);const pa=e=>`￥${(0,W.SJ)(new(ot())(e))}`,ua=e=>`${(0,W.SJ)(new(ot())(e))}`;var _a,ma,va=(0,d.defineComponent)({components:{achievement:Bt,invoicelist:He.Z,applyDetail:zt.Z,refundDetail:ra,applicationDetail:la.Z,invoicesDetail:na.Z,FirstStep:tt.Z,PaymentDialog:da.Z},setup(e,t){const a=(0,d.ref)(null),s=(0,d.ref)(null),i=(0,d.ref)(null),o=(0,d.ref)(null),r=(0,d.ref)(null),l=(0,d.ref)(null),c=(0,d.ref)(!1),p=(0,d.ref)(!1),u=(0,d.ref)(!1),_=(0,d.ref)(!1),m=(0,d.ref)(void 0),v=(0,d.ref)(!1),f=(0,U.gI)(),h=(0,d.ref)(!1),g=(0,d.ref)([]);let y;const b=(0,d.ref)(0),w=(0,d.ref)(0),x=(0,d.ref)(0),k=(0,d.ref)(0),C=async(e={})=>{y=e,h.value=!0;const[a]=await(0,n.Dc)(500,(0,D.sV)(e));if(h.value=!1,a.data.success){const e=a.data.data;g.value=e.data,b.value=e.payable,w.value=e.write_off,x.value=e.not_write_off}else t.root.$message.error(a.data.message)},S=()=>{C(y)},j=e=>{(0,D.Ed)(e+"").then((e=>{e.data.success?(t.root.$message.success(e.data.message),S()):t.root.$message.error(e.data.message)}))},A=(0,$.t)(),P=A.currentRoute.params.id,F=async e=>{const a=await(0,Je.I)(t,"确认删除该成本？");a&&j(e)},R=(0,d.inject)("project"),M=(0,d.ref)({project_name:R?.value?.project_name,project_id:R?.value?.id,brand_name:R?.value?.brand_name,brand_id:R?.value?.brand_id,business_type:2!==R?.value?.cooperation_type?R?.value?.business_type:6});(0,d.watch)((()=>R?.value),(()=>{void 0!==R?.value?.business_type&&(C({project_id:P,payable_type:R?.value.business_type}),M.value={project_name:R?.value?.project_name,project_id:R?.value?.id,brand_name:R?.value?.brand_name,brand_id:R?.value?.brand_id,business_type:2!==R?.value?.cooperation_type?R?.value?.business_type:6})})),void 0!==R?.value?.business_type&&C({project_id:P,payable_type:R?.value.business_type});const E=(0,Ke.Pc)(),I=(e,t)=>(0,d.h)("div",{class:"number-div"},[(0,d.h)("span",{class:"number-span "+(!t&&null!==e.reversed_id||null!==e.refunded_id?"reverse-red":"")},e.payable_uid)]),T=(e,t)=>{const a=ua(e.payable_amount);return!t&&null!==e.reversed_id||null!==e.refunded_id?(0,d.h)("span",{class:"reverse-red"},[a]):a},O=(0,rt.zY)(g,"应付金额 (元)",T),V=e=>e.create_date?e.create_date.replace(/-/g,"."):Ge.Z.formatEmpty(e.create_date),Z=(e,t)=>(0,d.h)("div",{class:"number-div"},[(0,d.h)("span",{class:"number-span text "+(!t&&null!==e.reversed_id||null!==e.refunded_id?"reverse-red":"")},e.settlement_uid)]),L=e=>1===e.write_off_status?"状态：部分核销":"状态：未核销",Y=(0,rt.zY)(g,"核销状态",L),N=(0,d.computed)((()=>[{label:"应付编号",fixed:"left",minWidth:160,formatter:e=>I(e,!1)},{label:"应付金额 (元)",align:"right",fixed:"left",minWidth:O.value,formatter:e=>T(e,!1)},{label:"创建日期",minWidth:110,align:"center",formatter:V},{label:"结算单",minWidth:160,formatter:e=>Z(e,!1)},{label:"核销状态",minWidth:Y.value,formatter:e=>{const t=(e.write_off_infos||[]).map((e=>[e.cost_id,e.write_off_amount,e.write_off_user,e.write_off_time]));(e.refund_write_off_info_items||[]).forEach((e=>{t.push([e.achievement_uid,-1*(e.write_off_amount??0),e.write_off_user,e.write_off_time])}));const a=["单据编号","核销金额 (元)","核销人/日期"];return(0,d.h)(at.Z,{attrs:{write_off_header:a,write_off_infos:t,write_off_status:e.write_off_status,is_reverse:null!==e.reversed_id}})}},{label:"操作",fixed:"right",align:"center",formatter:e=>{if(e.reverse_id||e.reversed_id||e.refunded_id)return"";const t=(1===e.write_off_status||0===e.write_off_status)&&f.live_write_off_save;return(0,d.h)("div",{class:"operation-column"},[t?(0,d.h)("a",{on:{click:()=>{m.value?.show({type:"isPayable",id:e.id,amount:e.not_write_off_amount,leaf:"live",busType:e.payable_type,receivable_uid:e.payable_uid})}}},["核销"]):""])}}])),B=(0,d.computed)((()=>pa(b.value))),z=(0,d.computed)((()=>pa(w.value))),q=(0,d.computed)((()=>pa(x.value))),W=32,H=0,J=36,G=31,{onRectUpdate:Q,...K}=(0,lt.Z)({compensation:(0,d.computed)((()=>W+H+J+G)),fixedBlockHeightRefs:[],tableMinHeight:100}),X=()=>{v.value=!0};return{numberMoneyFormat:ca.rH,permission:f,achievementRef:a,invoicelistRef:s,applyDetailDialog:i,applyDetailDialogVisible:c,deleteCollection:F,userinfo:E,refundDetailDialog:o,applicationDetailDialog:r,invoicesDetailDialog:l,refundVisible:p,applicationVisible:u,invoicesVisible:_,paymentDialogVisible:v,showPaymentDialog:X,paymentData:M,firstStepRef:m,loading:h,data:g,reload:S,total:k,payable:B,write_off:z,not_write_off:q,query:C,Delete:j,columns:N,isDev:!1,...K,onRectUpdate:Q}},render(e){return e("tg-card",_t()([{class:"project-collection"},{on:{["rect:update"]:e=>{this.onRectUpdate(e)}}},{attrs:{overflowInBody:!0},style:"height: calc(100vh - 236px)"}]),[e("div",{class:"header"},[e("span",{class:"label"},["应付金额："]),e("span",{class:"text"},[this.payable]),e("span",{class:"label"},["已核销金额："]),e("span",{class:"text"},[this.write_off]),e("span",{class:"label"},["未核销金额："]),e("span",{class:"text"},[this.not_write_off]),this.isDev?e("tg-button",_t()([{},{on:{click:()=>{this.reload()}}}]),["刷新(开发环境)"]):""]),e("el-table",_t()([{attrs:{stripe:!0,border:!0,data:this.data,height:this.tableProps.height}},{directives:[{name:"loading",value:this.loading}]},{scopedSlots:{empty:()=>e("div",{style:"position: static;"},[e("empty-common",{attrs:{"detial-text":"暂无数据"}})])}}]),[this.columns.map(((t,a)=>e("el-table-column",_t()([{},{props:{...t}},{key:a}]))))]),e(Bt,{ref:"achievementRef",on:{added:()=>this.reload()}}),e("first-step",{ref:"firstStepRef",on:{submit:()=>this.reload()}}),e(He.Z,{ref:"invoicelistRef"}),this.applyDetailDialogVisible&&e(zt.Z,{ref:"applyDetailDialog",on:{close:()=>{this.applyDetailDialogVisible=!1}}}),this.refundVisible&&e("refund-detail",{ref:"refundDetailDialog",on:{close:()=>{this.refundVisible=!1}}}),this.applicationVisible&&e("application-detail",{ref:"applicationDetailDialog",on:{close:()=>{this.applicationVisible=!1}}}),this.invoicesVisible&&e("invoices-detail",{ref:"invoicesDetailDialog",on:{close:()=>{this.invoicesVisible=!1}}}),this.paymentDialogVisible&&e("payment-dialog",_t()([{attrs:{visible:this.paymentDialogVisible,data:this.paymentData}},{on:{"dialog:close":()=>{this.paymentDialogVisible=!1}}}]))])}}),fa=va,ha=(0,k.Z)(fa,_a,ma,!1,null,"0e7bfcec",null),ga=ha.exports,ya=a(7629),ba=a(41532),wa=a(5968),xa=a(70727),ka=a(92656);const Ca=e=>`￥${(0,W.SJ)(new(ot())(e))}`,Sa=e=>`${(0,W.SJ)(new(ot())(e))}`,ja=!1;var Da,$a,Aa,Pa,Fa=(0,d.defineComponent)({components:{achievement:Bt,invoicelist:He.Z,invoicesDetail:na.Z,FirstStep:tt.Z,reverseOrderDialog:gt.Z,PaymentDetailDialog:ya.Z,RefundDetailDialog:ba.Z,AdvanceDetailDialog:wa.Z,PayRefund:xa.Z,RefundWriteOff:kt.Z,LoanfinanceDetailModal:ka.Z},setup(e,t){const a=(0,d.ref)(null),s=(0,d.ref)(null),i=(0,d.ref)(null),o=(0,d.ref)(!1),r=(0,d.ref)(!1),l=(0,d.ref)(!1),c=(0,d.ref)(!1),p=(0,d.ref)(void 0),u=(0,d.ref)(void 0),_=(0,d.ref)(void 0),m=(0,d.ref)({id:void 0,amout:void 0}),v=(0,d.ref)(!1),f=(0,d.ref)(!1),h=(0,d.ref)(void 0),g=(0,U.gI)(),y=(0,d.ref)(!1),b=(0,d.ref)(void 0),w=(0,d.ref)([]),x=(0,d.ref)(!1);let k;const C=(0,d.ref)(0),S=(0,d.ref)(0),j=(0,d.ref)(0),A=(0,d.ref)(0),P=(0,d.ref)(0),F=(0,d.ref)(0),R=(0,d.computed)((()=>t.root.$store.state.workbench)),M=(0,d.computed)((()=>R.value.approval)),E=async(e={})=>{k=e,x.value=!0;const[a]=await(0,n.Dc)(500,(0,D.Eo)(e));if(x.value=!1,a.data.success){const e=a.data.data;w.value=e.data,C.value=e.stat_info.paid_amount,S.value=e.stat_info.total_pay_amount,j.value=e.stat_info.wait_pay_amount,P.value=e.stat_info.not_write_off_amount,A.value=e.stat_info.write_off_amount}else t.root.$message.error(a.data.message)},I=()=>{E(k)},T=e=>{(0,D.Ed)(e+"").then((e=>{e.data.success?(t.root.$message.success(e.data.message),I()):t.root.$message.error(e.data.message)}))},O=(0,$.t)(),V=O.currentRoute.params.id,Z=async(e,a)=>{const s=await(0,Je.I)(t,a);s&&T(e)};E({project_id:V});const L=(0,Ke.Pc)(),Y=(0,d.ref)(null),{visible:N,toggleVisible:B}=(0,wt.Z)(),z=async(e,a)=>{B();const s={id:e,reverse_reason:a,reverse_type:yt.Jd.payment},i=await(0,bt.Tu)(s);return B(),i.data.success?(t.root.$message.success(i.data.message??"冲销成功"),I()):t.root.$message.error(i.data.message??"冲销失败"),i.data.success},q=(0,d.ref)(!1),H=(0,d.ref)(""),J=(0,d.ref)(""),G=()=>{H.value="",q.value=!1},Q=e=>{J.value="冲销原因",H.value=e,q.value=!0},K=e=>{J.value="退回原因",H.value=e,q.value=!0},{visible:X,toggleVisible:ee}=(0,wt.Z)(),te=async(e,a)=>{ee();const[{data:s}]=await(0,n.Dc)(500,(0,bt.Xz)({id:e,reverse_type:yt.Jd.payment,reverse_reason:a}));return ee(),s.success?(t.root.$message.success(s.message??"重新提交成功"),I()):t.root.$message.error(s.message??"重新提交失败"),s.success},ae=e=>null!==e.reversed_id&&0!==e.reversed_id,se=(0,d.computed)((()=>({total_pay_amount:Ca(S.value),paid_amount:Ca(C.value),wait_pay_amount:Ca(j.value),write_off_amount:Ca(A.value),not_write_off_amount:Ca(P.value)}))),ie=(e,t)=>t||null===e.reversed_id?e.uid:(0,d.h)("span",{class:"reverse-red"},[e.uid]),oe=(0,rt.zY)(w,"付款编号",ie),re=e=>1===e.pay_type?"成本":2===e.pay_type?"退款":"--",le=(e,t)=>{const a=Sa(e.pay_amount);return t||null===e.reversed_id?a:(0,d.h)("span",{class:"reverse-red"},[a])},ne=(0,rt.zY)(w,"付款金额 (元)",le),ce=e=>{switch(e){case 0:return"待打款";case 1:return"已打款";case-1:return"待发起打款";default:return"--"}},de=(e,t)=>{const{is_folded:a,folded_text:s}=(0,W.zb)(e.pay_reason??"--",12);return t||!a?s:(0,d.h)("el-popover",{props:{placement:"right",trigger:"hover"}},[(0,d.h)("span",{slot:"reference"},[s]),(0,d.h)("div",{style:{width:"300px"}},[e.pay_reason])])},pe=(0,rt.zY)(w,"付款事由",de),ue=e=>{s.value?.show({title:"发票详情",secondTitle:"发票",list:e.invoice_info.map((e=>(e.info=[{label:"发票号码",value:Ge.Z.formatEmpty(e.invoice_num)},{label:"开票时间",value:Ge.Z.formatEmpty(e.invoice_date)},{label:"开票金额",value:Ca(e.amount)},{label:"开票公司",value:Ge.Z.formatEmpty(e.institution)}],e))),type:0})},_e=(e,t)=>0===e.invoice_info.length?"未开票":t?"查看":(0,d.h)("a",{on:{click:t=>{ue(e),t.stopPropagation()}}},["查看"]),me=(e,t)=>{const a=e.cost_company_name||"--",{is_folded:s,folded_text:i}=(0,W.zb)(a,12);return t||!s?i:(0,d.h)("el-popover",{props:{placement:"right",trigger:"hover",content:a}},[(0,d.h)("span",{slot:"reference"},[i])])},ve=(0,rt.zY)(w,"是否开票",_e,20),fe=(0,d.computed)((()=>[{label:"付款编号",fixed:"left",align:"center",minWidth:oe.value,formatter:e=>ie(e,!1)},{label:"付款金额 (元)",align:"right",minWidth:ne.value,formatter:e=>le(e,!1)},{label:"付款类型",align:"center",minWidth:80,formatter:re},{label:"付款方式",minWidth:80,align:"center",formatter:e=>{const t=e.pay_way_detail;if(!t||null===e.pay_way)return"--";const a=e.pay_way,s={2:"V任务",3:"对公银行",4:"支付宝"}[a]||"未知类型";return s}},{label:"付款事由",minWidth:pe.value,formatter:e=>de(e,!1)},{label:"供应商",minWidth:(0,rt.zY)(w,"供应商",me).value,formatter:e=>me(e,!1)},{label:"是否开票",align:"center",minWidth:ve.value,formatter:e=>_e(e,!1)},{label:"付款时间",minWidth:100,align:"center",formatter:e=>e.pay_date?e.pay_date.replace(/-/g,"."):"--"},{label:"付款凭证",minWidth:80,align:"center",formatter:e=>1===e.is_pay?(0,d.h)("tg-button",{props:{type:"link"},on:{click:t=>{const a=e.pay_certificate_pic.split(",");1===a.length?ht.Z.showDetail(e.pay_certificate_pic+"?Authorization="+(0,$e.LP)()):s.value?.show({title:"打款凭证",list:a.map((e=>e+"?Authorization="+(0,$e.LP)())),type:1}),t.stopPropagation()}}},"查看"):"--"},{label:"核销状态",minWidth:120,formatter:e=>{let t=[];t=2===e.pay_type?(e.refund_write_off_infos||[]).map((e=>[e.settlement_uid,e.receivable_uid,-1*e.write_off_amount,e.write_off_user,e.write_off_time])):(e.write_off_infos||[]).map((e=>[e.settlement_uid,e.payable_uid,e.write_off_amount,e.write_off_user,e.write_off_time]));const a=["结算单编号",2===e.pay_type?"应收编号":"应付编号","核销金额 (元)","核销人/日期"];return(0,d.h)(at.Z,{attrs:{write_off_header:a,write_off_infos:t,write_off_status:e.write_off_status,is_reverse:null!==e.reversed_id}})}},{label:"单据状态",minWidth:80,align:"center",formatter:e=>(0,d.h)("div",{style:{color:0===e.is_pay?"#ff7a36":1===e.is_pay?void 0:"#ffac15"}},[ce(e.is_pay)])}])),he=32,ge=0,ye=36,be=31,{onRectUpdate:we,...xe}=(0,lt.Z)({compensation:(0,d.computed)((()=>he+ge+ye+be)),fixedBlockHeightRefs:[],tableMinHeight:100});return{payRefundVisible:v,refundWriteOffVisible:f,isDev:!1,isReversedRow:ae,reasonDialogTitle:J,reason:H,reasonDialogVisible:q,reverseAgainLoading:X,reverseAgain:te,onReasonDialogClose:G,onReverseReasonViewBtnClick:Q,onReverseBackReasonViewBtnClick:K,writeOffLoading:N,reverseOrderDialogRef:Y,onWriteOffConfirmResolve:z,permission:g,achievementRef:a,invoicelistRef:s,applyDetailDialogVisible:o,deleteCollection:Z,userinfo:L,invoicesDetailDialog:i,refundVisible:r,applicationVisible:l,invoicesVisible:c,firstStepRef:p,paid_amount:C,total_pay_amount:S,wait_pay_amount:j,write_off_amount:A,not_write_off_amount:P,data:w,query:E,reload:I,total:F,Delete:T,loading:x,all_amount:se,columns:fe,...xe,onRectUpdate:we,approval:M,payRefundInfo:m,refundWriteoffId:u,notRefundWriteOffAmount:h,refundWriteoffCostId:_,loanDetailVisible:y,detailroval:b}},render(){const e=arguments[0];return e("tg-card",_t()([{class:"project-collection"},{on:{["rect:update"]:e=>{this.onRectUpdate(e)}}},{attrs:{overflowInBody:!0},style:"height: calc(100vh - 236px)"}]),[ja?e("div",[" ",e("tg-button",_t()([{},{on:{click:()=>this.reload()}}]),["刷新(开发环境)"])," "]):"",e("tg-button-line",{class:"header mgt-12 mgb-12"},[this.permission?.live_project_cost&&e("tg-button",{attrs:{type:"primary",icon:"ico-btn-add"},on:{click:()=>this.achievementRef?.show()}},["登记成本"]),e("span",{class:"label",style:"margin-left:18px"},["登记付款："]),e("span",{class:"text"},[this.all_amount.total_pay_amount]),e("span",{class:"label"},["已付款："]),e("span",{class:"text"},[this.all_amount.paid_amount]),e("span",{class:"label"},["待付款："]),e("span",{class:"text"},[this.all_amount.wait_pay_amount]),e("span",{class:"label"},["已核销金额："]),e("span",{class:"text"},[this.all_amount.write_off_amount]),e("span",{class:"label"},["未核销金额 ："]),e("span",{class:"text"},[this.all_amount.not_write_off_amount])]),e("el-table",_t()([{attrs:{stripe:!0,border:!0,data:this.data,height:this.tableProps.height,"row-style":{cursor:"pointer"}}},{on:{"row-click":e=>{this.detailroval=e,this.loanDetailVisible=!0}}},{},{directives:[{name:"loading",value:this.loading}]},{scopedSlots:{empty:()=>e("div",{style:"position: static;"},[e("empty-common",{attrs:{"detial-text":"暂无数据"}})])}}]),[this.columns.map(((t,a)=>e("el-table-column",_t()([{},{props:{...t}},{key:a}])))),e("el-table-column",{attrs:{label:"操作",fixed:"right","min-width":160},scopedSlots:{default:({row:t})=>{const a=e("tg-button",{style:"margin-right: 12px;",attrs:{type:"link"},on:{click:e=>{this.payRefundInfo.id=t.raw_cost_id,this.payRefundInfo.amout=new(ot())(t.pay_amount??0).sub(new(ot())(t.refunded_amount??0)).toNumber(),this.payRefundVisible=!0,e.stopPropagation()}}},["退款"]),s=e("tg-button",{style:"margin-right: 12px;",attrs:{type:"link"},on:{click:e=>{this.refundWriteOffVisible=!0,this.refundWriteoffId=t.achievement_uid,this.refundWriteoffCostId=t.cost_id,this.notRefundWriteOffAmount=t.not_write_off_amount,e.stopPropagation()}}},["核销"]);if(this.isReversedRow(t)){const s=[e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{this.onReverseReasonViewBtnClick(t.reverse_reason),e.stopPropagation()}}},["查看"])],i=[e("div",[e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{this.deleteCollection(t.id,"是否删除该冲销单"),e.stopPropagation()}}},["删除"]),e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{this.reverseOrderDialogRef?.open((e=>this.reverseAgain(t.raw_cost_id,e)),t.reverse_reason),e.stopPropagation()}}},["重新提交"]),e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{this.onReverseBackReasonViewBtnClick(t.reverse_back_reason),e.stopPropagation()}}},["退回原因"])])];return 3===t.reverse_status?i:(1===t.reverse_status||2===t.reverse_status||2!==t.pay_type&&t.is_pay&&s.push(a),s)}const i=t.add_by_id===this.userinfo.id,o=0===t.is_pay,r=1===t.new_cost_type,l=this.permission.live_project_status_edit,n=this.permission.live_project_settlement_delete;let c,d;return!this.permission.live_write_off_save||1!==t.write_off_status&&0!==t.write_off_status||1!==t.pay_type||0===t.is_pay||null!==t.reverse_id||(c=e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{this.firstStepRef?.show({type:"isActual",id:t.cost_id,amount:t.not_write_off_amount,leaf:"live",busType:t.business_type,receivable_uid:t.cost_id,cost_split_id:t.id}),e.stopPropagation()}}},["核销"])),1!==t.is_pay||null!==t.reversed_id||null!==t.reverse_id||2===t.pay_type||t.has_refund||(d=e("a",{on:{click:e=>{this.reverseOrderDialogRef?.open((e=>this.onWriteOffConfirmResolve(t.raw_cost_id,e))),e.stopPropagation()}},style:"color: #e91313;margin-right: 12px;"},["冲销"])),e("div",[d,c,i&&l&&o&&r&&!t.approval_id&&e("fragments",[e("button",{style:"margin-right: 12px;",class:"tg-button",on:{click:e=>{const a={};a.pay_amount=t.pay_amount,a.pay_reason=t.pay_reason,a.id=t.id,this.achievementRef?.show(a),e.stopPropagation()}}},["编辑"])]),o&&n&&e("button",{style:"margin-right: 12px;",on:{click:e=>{this.deleteCollection(t.id,"确认删除"+(1===t.pay_type?"成本":"退款")),e.stopPropagation()}},class:"tg-button"},["删除"]),t.is_pay&&2!==t.pay_type&&!t.reverse_id?a:"",t.is_pay&&2===t.pay_type&&!t.reverse_id&&!t.reversed_id&&2!==t.write_off_status&&this.permission.live_write_off_save?s:""])}}})]),e(Bt,{ref:"achievementRef",on:{added:()=>this.reload()}}),e("first-step",{ref:"firstStepRef",on:{submit:()=>this.reload()}}),e(He.Z,{ref:"invoicelistRef"}),this.applyDetailDialogVisible&&e("payment-detail-dialog",_t()([{attrs:{info:this.approval,visible:this.applyDetailDialogVisible}},{on:{"dialog:close":()=>{this.applyDetailDialogVisible=!1}}}])),this.refundVisible&&e("refund-detail-dialog",_t()([{attrs:{info:this.approval,visible:this.refundVisible}},{on:{"dialog:close":()=>{this.refundVisible=!1}}}])),this.applicationVisible&&e("advance-detail-dialog",_t()([{attrs:{info:this.approval,visible:this.applicationVisible}},{on:{"dialog:close":()=>{this.applicationVisible=!1}}}])),this.invoicesVisible&&e("invoices-detail",{ref:"invoicesDetailDialog",on:{close:()=>{this.invoicesVisible=!1}}}),e(gt.Z,{ref:"reverseOrderDialogRef"}),e("pay-refund",{attrs:{visible:this.payRefundVisible,costId:this.payRefundInfo.id,rawAmount:this.payRefundInfo.amout},on:{cancel:()=>{this.payRefundVisible=!1},save:()=>{this.payRefundVisible=!1,this.reload()}}}),e("refund-write-off",{attrs:{type:"receive",projectType:1,notWriteOffAmount:this.notRefundWriteOffAmount,visible:this.refundWriteOffVisible,invoiceId:this.refundWriteoffId,costSplitId:this.refundWriteoffCostId},on:{cancel:()=>{this.refundWriteOffVisible=!1},save:()=>{this.refundWriteOffVisible=!1,this.reload()}}}),e("tg-mask-loading",{attrs:{visible:this.writeOffLoading,content:"正在提交冲销，请稍候..."}}),e("tg-mask-loading",{attrs:{visible:this.reverseAgainLoading,content:"正在提交冲销，请稍候..."}}),e("el-dialog",{class:"tg-dialog-classic tg-dialog-vcenter-new",attrs:{visible:this.reasonDialogVisible,width:"440px"},on:{close:()=>{this.onReasonDialogClose()}}},[e("div",{slot:"title"},[this.reasonDialogTitle]),e("div",{class:"reason-dialog-content"},[this.reason])]),this.loanDetailVisible&&e("loanfinance-detail-modal",_t()([{attrs:{visible:this.loanDetailVisible,detailroval:this.detailroval}},{on:{"dialog:closerow":()=>{this.loanDetailVisible=!1}}}]))])}}),Ra=Fa,Ma=(0,k.Z)(Ra,Da,$a,!1,null,"7ae60af7",null),Ea=Ma.exports,Ia=(0,d.defineComponent)({components:{SubTabs:Be.Z,settlementCost:Et.Z,comp1:ga,comp2:Ea},setup(){const e=(0,U.gI)(),t=(0,d.inject)("project")??(0,d.ref)(void 0),a=(0,d.computed)((()=>t.value?.cooperation_type===_.x3.selfSupport)),s=JSON.stringify((0,d.inject)("project",{cooperation_type:1})),i=JSON.parse(s);let o=(0,d.ref)(1);return i.value&&(o=i.value.cooperation_type||1),{permission:e,cooperation_type:o,showCostSettlement:a}}}),Ta=Ia,Oa=(0,k.Z)(Ta,Rt,Mt,!1,null,null,null),Va=Oa.exports,Za=a(91354),La=(0,d.defineComponent)({props:{},components:{CalendarPage:j.Z},setup(e,t){const a=(0,$.t)(),s=a.currentRoute.params.id,i=(e,t)=>(0,D.sB)(e,t,s),o=(0,d.inject)("project"),r=(0,d.computed)((()=>o?.value?.business_type)),l=(0,d.computed)((()=>o?.value?.end_date)),n=(0,d.computed)((()=>o?.value?.cooperation_type)),c=(e,a=!1)=>(0,D.hQ)({...e,project_id:s,is_enforcement:a?1:0}).then((async a=>{if(!a.data.success)throw new Error(a.data.message);if(1001===a.data.error_code){const a=await(0,Je.I)(t,{title:"提示",content:()=>(0,d.h)("div",{style:"margin-left: -10px; margin-right: -10px;"},["当前日目标总和超过月目标，请确认目标分配是否正确？"]),cancelText:"取消",confirmText:"确定"});a&&c(e,!0)}return a}));return{query:i,save:c,business_type:r,cooperation_type:n,end_date:l}},render(){const e=arguments[0];return e("calendar-page",_t()([{},{props:{query:this.query,save:this.save,business_type:this.business_type,cooperation_type:this.cooperation_type,type:"base",end_date:this.end_date}}]))}}),Ya=La,Na=(0,k.Z)(Ya,Aa,Pa,!1,null,null,null),Ba=Na.exports,za=a(11867),qa=a(42993),Wa=a(96732),Ua=a(88721),Ha=a(41572);const Ja=Ua.Z;var Ga,Qa,Ka,Xa,es,ts,as,ss,is,os,rs=(0,d.defineComponent)({props:{type:{type:String},business_type:{type:Number},cooperation_type:{type:Number},targettype:{type:String,dafault:""},isEdittarget:{type:Boolean,dafault:!1},dailydata:{type:Object,dafault:{}},index:{type:Number,dafault:0},month:{type:Number}},components:{CalendarCustom:qa.ZP,MarketDialog:Wa.Z},setup(e,t){const a=(0,U.gI)(),s=(0,d.ref)(e.dailydata??{}),i=(0,qa.vu)(qa.i4.Year,{integerMonth:!0}),o=(0,$.t)(),r=o.currentRoute.params.id,l=(0,d.ref)(),n=(0,d.ref)({}),c=(0,d.computed)((()=>void 0!==e.month?e.month:q()().month()));(0,d.watch)((()=>[e.isEdittarget]),(()=>{p()}));const p=()=>{!0===e.isEdittarget?n.value=[{field:"goal_value",label:"目标 (元)",limit:[Ua.Z.IntergerAndDecimals]}]:n.value=[{field:"goal_value",label:"目标 (元)",limit:[Ua.Z.IntergerAndDecimals]},{field:"gmv",label:"GMV (元)",limit:[Ua.Z.IntergerAndDecimals]},{field:"complete_rate",label:"完成比例",limit:[Ua.Z.IntergerAndDecimals]}]};p(),"target"===e.targettype&&i.changeCalendarType(2);const u=e=>s.value.months?s.value.months.find((t=>t?.name+""===e+"月")):"",_=(e,t=!0)=>{let a=null;return s.value.months.map((t=>{a=a||0,t[e]&&(a+=Number(t[e]))})),a?t?m(String(a)):a:""},m=e=>{const t=(/(?:0|[1-9]\d{0,18})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0];return Ja.Thousands(t)},v=e=>{const t=String(e||""),a=(/(?:0|[1-9]\d{0,18})(?:\.\d{0,1})?/u.exec(t.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0];return a+"%"},f=(0,d.ref)(e.index||0),h=e=>{t.emit("columnClick",e)};return{indexnew:f,AmountOneInput:v,AmountInput:m,getAllValue:_,findmonth:u,project_id:r,permission:a,config:i,newdailydata:s,fields:n,active:l,selectedMonth:c,onColumnClick:h}},render(){const e=arguments[0];return e("div",{class:"dailydata page-calendar",style:!1!==this.isEdittarget||this.newdailydata.anchor_name?"margin-top:26px":"margin-top:16px"},[e("div",{class:"operation"},[e("div",{class:"titlediv"},[e("span"),this.newdailydata.anchor_name?"主播："+this.newdailydata.anchor_name:"店铺目标"])," ",this.isEdittarget&&0===this.indexnew&&e("span",["（",e("span",{style:{color:"#FF7A36"}},["注：双击月目标单元格更改月目标数据，日目标编辑可以通过回车键快速切换日期"]),"）"])]),e("div",{class:"calendar-body"},[e("calendar-custom",{attrs:{selectedMonth:0===this.index?this.selectedMonth:void 0,selectedAbled:0===this.index,config:this.config,fields:this.fields},on:{columnClick:this.onColumnClick},scopedSlots:{rednerTotal:t=>{let a="";if("complete_rate"===t.field){const e=Number(this.getAllValue("gmv",!1)||0),t=Number(this.getAllValue("goal_value",!1)||0);e&&t&&0!==Number(t)&&(a=this.AmountOneInput(100*e/t))}else a=this.getAllValue(t.field);return e("div",[a])},render:(t,{field:a,maxLength:s,limit:i,format:o=(e=>e)})=>{let r=this.findmonth(t),l="calendar-day";if(void 0===r&&(r={name:t+"月",goal_value:null},this.newdailydata.months.push(r)),!r["complete_rate"]&&r["gmv"]&&r["goal_value"]){const e=Number(r["gmv"]),t=Number(r["goal_value"]);0!==t&&(r["complete_rate"]=this.AmountOneInput(String(100*e/t)))}return`${a}_${r.name}`===this.active&&(l=`${l} active`),e("div",{on:{click:()=>{this.isEdittarget&&(this.active=`${a}_${r.name}`)},dblclick:e=>{!1!==this.isEdittarget&&(this.active=`${a}_${r.name}`,(0,d.set)(r,`edit_${a}`,!0),this.$nextTick((()=>{e.target.querySelector("input")?.focus()})))}},class:l},[e("span",{class:"show-txt",directives:[{name:"show",value:!r[`edit_${a}`]}]},[o(Ja.Thousands(r[a]))]),e("el-input",{attrs:{maxLength:s,value:r[a]},on:{blur:()=>{this.active="";let e=r[a];if(e){const t=String(e).split("");t.length>0&&"."===t[t.length-1]&&t.pop(),e=t.join(""),(0,d.set)(r,a,e)}(0,d.set)(r,`edit_${a}`,!1),this.$emit("updata",this.newdailydata,this.indexnew)},input:e=>{let t=e;if(i&&i.forEach((e=>{t=e(t)})),Number(t)>1e9){let e=String(t);e=e.slice(0,e.length-1),t=e}(0,d.set)(r,a,t)}},directives:[{name:"show",value:r[`edit_${a}`]}]})])}}})])])}}),ls=rs,ns=(0,k.Z)(ls,Ga,Qa,!1,null,"e3980c7c",null),cs=ns.exports,ds="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAYAAAByDd+UAAAAAXNSR0IArs4c6QAABWVJREFUSEullm1sk1UUx//n9ukG6zYQnLII2o2BoUM0xg+ExDAihk5QRMOkBQZOAhnGDCLygSiEhSzBIC/xhYzEBJCtYzOiaKTEJYxokJAATmDGbayVgJMMeZ3buj7PPeY+fZ6ubC1DuemHpr33/M7L/557CPez6hc6kNNFmNWkJ91+rEhDVw6jpMEYzhzdc8OmTQKFLZRoqOhYkRaGW1Pn3AjrTYlOKMcueBibN8tUdlMDFUwdZKaCI0umSIcsksBsMCYSkKsMMtAJwkUBNApDNLUXH/gNRAz7bBJqcqDytKTBcB9Z5GaiDcRYBCArxsDgM/Zvd5hQR8xV4eK6MCwbg5lDgZZ3ecElJczGbgBjFIgBgwBhGbDPKZjyQhLgsJy5TuQoD3kP1CeL9G6g5VV+0LdGMnZYEal6qH02LFV51D7lgNpHgrC2wxvYOTjSAaAFKwj6SnRGLWIeKyPDgeIOEAhEJCVLdcbQCP52b6A+ERoDstoJnvSDPz+q80kAOf8HJiERkVGkC6ckkIJ2OTWa3vZibYfNiAEHRFIN0EoGdAJM6d/PEiBE2UCa0JCXkYtQTyd0NnQCaQDvCRfXrbIZZH/Ja/RNYx3HwRidQo1J2So1BkuzyFVTV8A/4QWUnf4Qhzt/5tFOFxmQN0nDzNDswK+KFQfmH/WXS8mf2dEpQ4IIkqWphGRLRWaAYbCBrVNXmrAb/d3wndqC5lvtyNBG6JKlJgSt7phTuzsGtFZ+0H9IMr+qaqfy389RRIwosrQMcBKkcki5oksdWzxlWO724ma0GyvPbMfxa78gU8tQzpqiE0Rfd3hrFyiUCTTbVX/uGUg8RSCOsk656WPgdo3DyestEOSAisYGK5j69OkRVHrexIq8ubij96D87E4cvXoKo5yZZprjpRE4507rfFa1QRPoPrZ8BEUil5iRo4B9sp8qPcuxwj0X29sasLU1AJc2MnbLLCt9RgQfTFmK1fnz0WP04e2zu/DdXyctWLyHm12ICF2cnv54eNbePhM4/sTCkdpt5xUwPySIuMeI0MuPTsfHz1Qg3eHEttaD2Npah2ynywR2673Y8KQfFQWvo9eIoKL5Exz68yeMcrrsyOxKxdoe0Q09O/rY5RkNvSbQU78wrSfbeR7Mk1QARETd0V4snvACtk0rh4MEqn6vwY62L0EErJ/kw7rJJYhKHWuaP0XDlSbTGSuNifqKARltYx/JKjz93J5oXDTuoO8bMF6xL7wggdvRf1DmLkZV4VtwkAPvX/gcacKJjVNKTdh756tRc6nRhCk1J1mxTkU4HPYG5sdEY1/64OI1YLkj8VqoaFT6VrnnobKwDFFpwEHqugisP1eNvZeCyNJcYFZyGnp54g2ExNqwt8bsqwMXP/jG08ziOIBRtrpU+Krid/RevJO/wBSJimRjy15Uh75FtuaCamcplv1s3SKSM0Peg80D9zAepW8fGKWq8VrNO9ZkweiXOuaNm65aFoJXTyFdpFmKTdUWLBuE/WFvYNlAa4vp3LSb31g6WerRE2CMHdy87fSqKmRqI8003mPZtftbaM4ZHbP3t97dvNVJK8q8oH8pM++30mq/b7EHkYRZqRQCsfn2+6nEXhry1n4x9Hmyt1rQJ4KL3yWW2x7kAWYS6/7w1nyU+gG2ofaIccS3hAm7wENGjCEzzV0jBuE6MSpCxYEDw48YgyIt+H7ZREP0b5SM1wjIvNcQxUC3IHzlkGmV7S/tu3j/Q9SgSFWxC476PAbgZdDzkOyBoIfNbZKvQVALgX90AMH2OYEWU9T/eUxMhA4ahFUbvD3enHeQfRlGS0lDf1ytDzQIJ2peGVIr1Sg/3P8Jtv4FuUqgQ221G+oAAAAASUVORK5CYII=",ps=(0,d.defineComponent)({props:{date:{type:q()},isEdit:{type:Boolean,default:!0}},setup(e,t){const a=(0,$.t)(),s=a.currentRoute.params.id,i=(0,d.computed)((()=>e.date??q()())),o=(0,d.computed)((()=>i.value.year())),r=(0,d.computed)((()=>i.value.month()+1)),l=(0,d.ref)([]),n=(0,d.ref)([]),c=(0,d.computed)((()=>e.isEdit?[{field:void 0,label:"日期"},{field:"goal_value",label:"目标 (元)"}]:[{field:void 0,label:"日期"},{field:"goal_value",label:"目标 (元)"},{field:"gmv",label:"GMV (元)"},{field:"percent",label:"完成比例"}])),p=(0,d.ref)(!1),u=(0,d.ref)(12),_=(0,d.ref)(3),m=(0,d.ref)(void 0),v={onDblclick(t){e.isEdit&&(m.value=t,(0,d.nextTick)((()=>{f.value?.focus()})))},onKeyup({keyCode:e}){13===e&&(m.value=(m.value??0)+1,(0,d.nextTick)((()=>{f.value?.focus()})))},onWindowClick(e){"INPUT"!==e.target?.tagName?.toUpperCase()&&(m.value=void 0)},async queryProjectDailyGoalSettings(){const e=await(0,h.vE)({project_id:s,year:o.value,month:r.value});if(e.data.success){let a=(e.data.data[0]?.days??[]).map((e=>(e.gmv=e.gmv?e.gmv/100:e.gmv,e.goal_value=e.goal_value?e.goal_value/100:e.goal_value,e)));if(0===a.length){const e=i.value.endOf("month").date();a=Array.from({length:e},((e,t)=>t)).map((e=>({gmv:null,goal_value:null,is_rest_day:!1,name:`${e+1}`,percent:null})))}l.value=a,n.value=(0,y.I8)(a),p.value=!1,t.emit("update",p.value)}},async save(e=!1){if(!p.value)return void t.emit("save");const a=await(0,h.VG)({project_id:s,year:o.value,month:r.value,is_enforcement:e?1:0,goals:[{anchor_id:0,days:l.value.map((e=>({goal_value:e.goal_value,goal_day:e.name})))}]});if(a.data.success){if(1001===a.data.error_code){const e=await(0,Je.I)(t,{title:"提示",content:()=>(0,d.h)("div",{style:"margin-left: -10px; margin-right: -10px;"},["当前日目标总和超过月目标，请确认目标分配是否正确？"]),cancelText:"取消",confirmText:"确定"});return void(e&&v.save(!0))}t.emit("save"),t.root.$message.success(a.data.message??"保持成功")}else t.emit("error"),t.root.$message.error(a.data.message??"保持失败")},reload(){v.queryProjectDailyGoalSettings()},percentColorStyle(e){return e?e<40?"color: ##ED3434;":e<100?"color: #FFAC15;":"color: #20BF55;":"color: #ED3434;"},goalGmvInput(e,a){const s=(/(?:0|[1-9]\d{0,8})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0];a.goal_value=s?+s:null;const i=JSON.stringify(n.value),o=JSON.stringify(l.value);p.value=i!==o,t.emit("update",p.value)}},f=(0,d.ref)(void 0);return(0,d.watch)((()=>e.date),(()=>{m.value=void 0,v.queryProjectDailyGoalSettings()})),(0,d.onMounted)((()=>{v.queryProjectDailyGoalSettings(),window.addEventListener("click",v.onWindowClick)})),(0,d.onUnmounted)((()=>{window.removeEventListener("click",v.onWindowClick)})),{isEdited:p,daysData:l,bodyColumns:u,headerRepeatConnt:_,headerItems:c,currentDate:i,editIndex:m,targetInputRef:f,formatAmount:W.dN,...v}},render(){const e=arguments[0],t=Array.from({length:this.headerRepeatConnt}).map(((e,t)=>t)),a=Array.from({length:this.bodyColumns}).map(((e,t)=>t)),s=this.currentDate.month()+1,i=this.currentDate.endOf("month").date();return e("div",{class:"target-daily-detail-container"},[e("div",{class:"table-header-left"},[t.map(((a,s)=>{const i=this.headerItems.map(((a,i)=>{const o=s===t.length-1&&i===this.headerItems.length-1?"border-bottom: none;":"";return e("div",{class:0===i?"cell top":"cell",style:`font-weight: 500; text-align: center; ${o}`},[a.label])}));return e("div",[i])}))]),e("div",{class:"table-body"},[t.map(((o,r)=>{const l=a.map(((l,n)=>{const c=this.headerItems.map(((c,d)=>{const p=o*this.bodyColumns+ +l+1,u=this.daysData[p-1],_=d>0?u?.[this.headerItems[d].field??""]:void 0,m=u?.is_rest_day??!1,v=r===t.length-1&&d===this.headerItems.length-1?"border-bottom: none;":"",f=n===a.length-1?"border-right: none;":"";return p>i?e("div",{class:0===d?"cell top":"cell",style:`${v} ${f}`}):0===d?e("div",{class:0===d?"cell top":"cell",style:`${f}`},[`${s}月${p}日`]):this.isEdit?e("div",{class:"cell",style:this.editIndex===p?"padding: 0; border: 1px solid #2877ff;":`${v} ${f}`,on:{dblclick:()=>this.onDblclick(p)}},[this.editIndex===p?e("el-input",{class:"target-input",attrs:{size:"small",value:u.goal_value},ref:"targetInputRef",nativeOn:{keyup:this.onKeyup},on:{input:e=>this.goalGmvInput(e,u)}}):void 0!==_&&null!==_?this.formatAmount(_,"None"):_]):e("div",{class:m&&3===d?"cell rest":m&&3!==d?"cell rest-none":"cell"},[m?"休":null===_||void 0===_?_:3===d?e("div",{class:"complete-percent",style:this.percentColorStyle(_)},[_&&_>=100?e("img",{attrs:{src:ds}}):"",`${this.formatAmount(_,"None")}%`]):this.formatAmount(_,"None")])}));return e("div",[c])}));return e("div",{class:"repeat-row"},[l])}))])])}}),us=ps,_s=(0,k.Z)(us,Ka,Xa,!1,null,"a1d28680",null),ms=_s.exports,vs=(0,d.defineComponent)({props:{year:{type:Number,dafault:2022}},components:{CalendarPage:cs,dailyDetail:ms},setup(e,t){const a=(0,d.ref)([]),s=(0,$.t)(),i=s.currentRoute.params.id,o=(0,d.ref)(!0),r=()=>{o.value=!0,(0,D.dF)(u.value,i).then((({data:e})=>{if(o.value=!1,e.success&&e.data&&e.data.length>0){const t=[];e.data.map((e=>{0===e.anchor_id||"0"===e.anchor_id?t.unshift(e):t.push(e)})),a.value=t}else a.value=[{months:[],anchor_id:0,anchor_name:""}]}))},l=(0,d.inject)("project"),n=(0,d.computed)((()=>l?.value?.business_type)),c=(0,d.computed)((()=>l?.value?.cooperation_type)),p=(0,d.ref)(!1),u=(0,d.ref)(e.year);r(),(0,d.watch)((()=>e.year),(e=>{u.value=e,a.value=[],r()}));const _=(0,d.ref)(q()()),m=(0,d.computed)((()=>_.value.month())),v=t=>{_.value=q()(`${e.year}-${t+1}`)};return{loading:o,query:r,business_type:n,cooperation_type:c,isEdittarget:p,newyear:u,dailydataList:a,onColumnClick:v,dailyDetailDate:_,dailyDetailMonth:m}},render(){const e=arguments[0];return e("div",{directives:[{name:"loading",value:this.loading}],style:"height:90%;"},[this.dailydataList.map(((t,a)=>e("div",{class:"calender-div",key:t?.anchor_id+"list"+this.newyear},[" ",e("calendar-page",_t()([{},{props:{dailydata:t,business_type:this.business_type,cooperation_type:this.cooperation_type,type:"base",targettype:"target",isEdittarget:this.isEdittarget,isSaveClick:this.isSaveClick,index:a,month:this.dailyDetailMonth}},{on:{columnClick:this.onColumnClick}}])),0===a&&e(ms,{attrs:{date:this.dailyDetailDate,isEdit:!1}})])))])}}),fs=vs,hs=(0,k.Z)(fs,es,ts,!1,null,"ee924868",null),gs=hs.exports,ys=a(11676),bs=a(76012),ws=(0,d.defineComponent)({props:{year:{type:Number,dafault:2022}},components:{dailyDetail:ms,CalendarPage:cs},setup(e,t){const a=(0,d.ref)([]),s=(0,d.ref)([]),i=[],o=(0,d.ref)(void 0),r=(0,d.ref)(void 0),l=(0,d.ref)(!1);let c=[{months:[],anchor_id:0,anchor_name:""}];const p=(0,d.computed)((()=>{const e=(0,U.kG)(H.HN.live_project_target_shop_edit),t=(0,U.kG)(H.HN.live_project_target_anchor_edit);return{canPorjectTargetShopEdit:e,canPorjectTargetAnchorEdit:t}}));let u=null;const _=(0,$.t)(),m=_.currentRoute.params.id,v=(0,d.ref)(!0),f=(0,d.ref)((new Date).getFullYear()),h=()=>{v.value=!0,(0,D.dF)(f.value,m).then((({data:e})=>{if(v.value=!1,e.success&&e.data&&e.data.length>0){const t=[];e.data.map((e=>{!p.value.canPorjectTargetShopEdit||0!==e.anchor_id&&"0"!==e.anchor_id?p.value.canPorjectTargetAnchorEdit&&0!==e.anchor_id&&"0"!==e.anchor_id&&(s.value.push(e.anchor_id),t.push(e)):t.unshift(e),p.value.canPorjectTargetAnchorEdit&&0!==e.anchor_id&&"0"!==e.anchor_id&&i.push({label:e.anchor_name,value:e.anchor_id})})),a.value=t,c=JSON.parse(JSON.stringify(e.data))}else a.value=[{months:[],anchor_id:0,anchor_name:""}]}))},g=(0,d.inject)("project"),y=(0,d.computed)((()=>g?.value?.business_type)),b=(0,d.computed)((()=>g?.value?.cooperation_type)),w=(0,d.ref)(!1),x=(0,d.ref)(!1),k=(0,d.ref)(!1),C=(0,d.ref)(!1),S=()=>{if(u){const e=[],a=[];for(let t=0;t<u.length;t++){const i=u[t],o=i.anchor_id,r=s.value.find((e=>e===o));if(r||0===o||"0"===o){const t=[];i.months.map((e=>{const a=String(e.name).replace("月","");e.goal_value||0===e.goal_value?t.push({goal_value:Number(e.goal_value),goal_month:Number(a)}):t.push({goal_value:null,goal_month:Number(a)})})),0===o||"0"===o?e.push({anchor_id:o,months:t}):a.push({anchor_id:o,months:t})}}if(e.length>0){const s={year:f.value,project_id:Number(m),goals:e||[]};C.value=!0,(0,D.FT)(s).then((({data:e})=>{e.success?((!1===p.value.canPorjectTargetAnchorEdit||a.length<1)&&(t.root.$message.success(e.message),x.value=!0),w.value=!0,r.value?.save()):(w.value=!1,t.root.$message.error(e.message??"保存店铺目标配置失败"))}))}else w.value=!0;if(a.length>0){const s={year:f.value,project_id:Number(m),goals:a||[]};C.value=!0,(0,D.HB)(s).then((({data:a})=>{a.success?(t.root.$message.success(a.message),(!1===p.value.canPorjectTargetShopEdit||e.length<1)&&(w.value=!0),x.value=!0):(x.value=!1,t.root.$message.error(a.message??"保存主播目标配置失败"))}))}}else w.value=!0,x.value=!0,r.value?.save()},j=()=>{S()},A=()=>{u||l.value?t.root.$confirm("你确定退出编辑吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{t.emit("added"),u=null})).catch((()=>!1)):t.emit("added")},P=(e,t)=>{u=u||JSON.parse(JSON.stringify(a.value)),t<u.length&&(u[t]=JSON.parse(JSON.stringify(e)))};h(),(0,d.watch)((()=>[w.value,x.value,k.value]),(()=>{w.value&&x.value&&(C.value=!1,u=null,k.value&&t.emit("added"))})),(0,d.watch)((()=>[s.value]),(()=>{const e=[];if(p.value.canPorjectTargetShopEdit){const t=a.value.find((e=>0===e.anchor_id));e.push(t)}s.value.map((t=>{const s=a.value.find((e=>e.anchor_id===t));if(s)e.push(s);else{const a=c.find((e=>e.anchor_id===t));e.push(a)}})),a.value=e}));const F=(0,d.ref)(!1),R=(0,d.ref)(void 0),M=(0,d.ref)(q()()),E=(0,d.computed)((()=>M.value.month())),I=async a=>{if(a!==E.value)if(l.value){const s=await(0,Je.I)(t,{title:"提示",content:()=>(0,d.h)("div",{style:"margin-left: -10px; margin-right: -10px;"},["当前日目标信息已变更，是否需要保存？"]),cancelText:"取消",confirmText:"保存"});s?(R.value=a,r.value?.save()):(l.value=!1,M.value=q()(`${e.year}-${a+1}`))}else M.value=q()(`${e.year}-${a+1}`)},T=()=>{void 0!==R.value?(l.value=!1,M.value=q()(`${e.year}-${R.value+1}`),R.value=void 0):k.value=!0},O=()=>{k.value=!1},V=()=>{const e="https://tiange-oss.oss-cn-hangzhou.aliyuncs.com/upload_template/project_daily_goal_template.xlsx";fetch(e).then((async e=>{const a=e.clone();try{const e=await a.json();t.root.$message.error(e.message)}catch{if(200===e.status){const t=await e.blob();(0,n.uA)(t,"project_daily_goal_template.xlsx")}else t.root.$message.error("下载失败")}}))},Z=async e=>(0,bs.SO)("/api/shop_live/import_project_daily_goal_settings",e),L=async e=>{const t=e.file,a=new FormData,s=t.name;a.append("file",t,s),a.append("project_id",`${e.project_id}`),a.append("year",`${e.year}`),a.append("month",`${e.month}`),a.append("is_enforcement",`${e.is_enforcement}`),v.value=!0;const i=await Z(a);v.value=!1;const r=i.data;N(r),o.value=void 0},Y=e=>{o.value=e,ys.Z.ValidationFileUpload({excel:!0,fileSize:30,doc:!1,pdf:!1})},N=async a=>{if(a.success)if(1001!==a.error_code)mt.Message.success(a.message),r.value?.reload();else{const a=await(0,Je.I)(t,{title:"提示",content:()=>(0,d.h)("div",{style:"margin-left: -10px; margin-right: -10px;"},["当前日目标总和超过月目标，请确认目标分配是否正确？"]),cancelText:"取消",confirmText:"确定"});a&&L({project_id:m,year:e.year??2022,month:M.value.month()+1,is_enforcement:1,file:o.value})}else mt.Message.error(a.message)},B=e=>{l.value=e};return{saveloading:C,loading:v,saveShop:w,saveAnchor:x,Permission:p,visible:F,saleChances:i,selectAnchors:s,newdata:u,project_id:m,getNewdata:P,onCancelClick:A,onSaveClick:j,query:h,business_type:y,cooperation_type:b,newyear:f,dailydataList:a,onColumnClick:I,dailyDetailDate:M,dailyDetailRef:r,onDailyDetailSave:T,onError:O,onDownloadTemplate:V,onUploadHandler:N,onBeforeUploadHandler:Y,onUpdate:B,dailyDetailMonth:E}},render(){const e=arguments[0],t=this.Permission.canPorjectTargetAnchorEdit&&this.saleChances.length>0;return e("div",{directives:[{name:"loading",value:this.loading}],style:"position:relative;height:100%;"},[e("div",{class:"targetlistdiv"},[e("tg-button",{attrs:{type:"link",download:!0,href:"https://tiange-oss.oss-cn-hangzhou.aliyuncs.com/upload_template/project_daily_goal_template.xlsx"},style:"position: absolute; right: 158px; top: 30px;"},["下载模版"]),e("tg-upload",{attrs:{"show-file-list":!1,action:"/api/shop_live/import_project_daily_goal_settings",data:{project_id:this.project_id,year:this.year,month:this.dailyDetailDate.month()+1,is_enforcement:0},beforeUpload:this.onBeforeUploadHandler,success:this.onUploadHandler},style:"position: absolute; right: 18px; top: 24px;"},[e("tg-button",["导入每日目标"])]),this.dailydataList.map(((a,s)=>e("div",{key:a?.anchor_id+"edit",style:0===s?"margin-top:30px":"margin-top:24px"},[" ",t&&(1===s&&this.Permission.canPorjectTargetShopEdit||0===s&&!1===this.Permission.canPorjectTargetShopEdit)&&e("div",{class:"anchordiv"},[e("div",{class:"filter-form-item-btn project-edit",style:"margin-right:10px；line-height: 20px;"},[e("tg-icon",{attrs:{name:"ico-shezhi"},on:{click:()=>{this.visible=!0}}})])]),e("calendar-page",_t()([{style:!1===this.Permission.canPorjectTargetAnchorEdit&&0===s?"margin-top:24px":"margin-top:0px"},{props:{dailydata:a,business_type:this.business_type,cooperation_type:this.cooperation_type,type:"base",targettype:"target",isEdittarget:!0,index:s,month:this.dailyDetailMonth}},{on:{updata:(e,t)=>this.getNewdata(e,t),columnClick:this.onColumnClick}}])),0===s&&e(ms,{ref:"dailyDetailRef",attrs:{date:this.dailyDetailDate,isEdit:!0},on:{save:this.onDailyDetailSave,error:this.onError,update:this.onUpdate}})])))]),e("div",{style:"height:58px;box-sizing: border-box;box-sizing: border-box;position: absolute;bottom: 0px;width:100%;border: 1px solid rgba(164, 178, 194, 0.3);"},[e("div",{class:"filter-form-item-btn",style:"margin: 12px auto;"},[e("tg-button",{on:{click:()=>this.onCancelClick()}},["返回"]),e("tg-button",{directives:[{name:"loading",value:this.saveloading}],attrs:{type:"primary"},style:"margin-left: 20px;",on:{click:()=>this.onSaveClick()}},["保存"])])]),e("el-dialog",{attrs:{className:"el-dialog__wrapper customer-dialog",width:"460px",visible:this.visible,title:"设置主播目标展示"},on:{close:()=>{this.visible=!1}}},[e("div",{style:"margin:0px 8px 8px 8px"},[e("span",{style:"color:#6a7b92"},["请选择需要展示目标的主播 "]),e("el-checkbox-group",{class:"contract-checkbox-group",model:{value:this.selectAnchors,callback:e=>{this.selectAnchors=e}}},[this.saleChances.map((t=>e("el-checkbox",{on:{change:()=>{this.selectAnchors.length<1&&(this.selectAnchors.push(t.value),this.$message.warning("至少选择一个主播"))}},class:"chance-checkbox",attrs:{value:t.value,label:t.value},key:t.value,style:"height: 30px; line-height: 30px;color:#3c5269;font-weight:400"},[t.label])))]),0===this.saleChances.length&&e("div",["暂无主播可设置"])])])])}}),xs=ws,ks=(0,k.Z)(xs,as,ss,!1,null,"615aefaa",null),Cs=ks.exports,Ss=(0,d.defineComponent)({props:{},components:{ListView:gs,EditView:Cs},setup(e,t){const a=null,s=(0,d.inject)("project"),i=(0,d.computed)((()=>s?.value?.business_type)),o=(0,d.computed)((()=>s?.value?.cooperation_type)),r=(0,d.ref)(!1),l=(0,d.ref)((new Date).getFullYear()),n=(0,d.ref)([1]),c=(0,d.ref)([{value:1,label:"123"},{value:2,label:"12223"}]),p=()=>{r.value=!1},u=(0,d.computed)((()=>{const e=(0,U.kG)(H.HN.live_project_target_shop_edit),t=(0,U.kG)(H.HN.live_project_target_anchor_edit),a=e||t;return{canEdit:a}}));return{Permission:u,getNewdata:p,saleChances:c,selectAnchors:n,newdata:a,yearsoptions:[l.value+1,l.value,l.value-1,l.value-2],business_type:i,cooperation_type:o,isEdittarget:r,year:l}},render(){const e=arguments[0];return e("div",{style:"overflow: auto;displey:flex;flex-direction: column; border-top: 1px solid rgb(235, 235, 235);flex-grow: 1;"},[!1===this.isEdittarget&&e("div",{class:"operation"},[e("div",{class:"left"},[e("div",{class:"calendar-date-range"},[e("el-select",{attrs:{size:"small",placeholder:"请选择"},style:"width:108px",model:{value:this.year,callback:e=>{this.year=e}}},[this.yearsoptions.map((t=>e("el-option",{attrs:{label:t+" 年",value:t}})))])]),e("div",{class:"tips"},[e("i",{class:"el-icon-warning-outline",style:"color: #ffac15; height: 22px; line-height: 22px; font-size: 16px;margin-right:4px;"}),"统计说明：主播GMV根据主播排班信息进行统计。"])]),this.Permission.canEdit&&e("div",{class:"right"},[e("tg-button",{on:{click:()=>{this.isEdittarget=!0,this.isSaveClick=!1,this.isCancelClick=!1}},style:"text-align:center;line-height:32px;width:96px;border-radius: 4px;display: inline-block;padding:0px"},["目标管理"])])]),!1===this.isEdittarget&&e(gs,{attrs:{year:this.year}}),this.isEdittarget&&e(Cs,_t()([{style:"display:flex;flex-direction: column;flex-grow: 1;height: 100%;"},{props:{year:this.year}},{on:{added:()=>this.getNewdata()}}]))])}}),js=Ss,Ds=(0,k.Z)(js,is,os,!1,null,"16061c80",null),$s=Ds.exports,As=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-detail-tab-calendar"},[a("el-form",{staticStyle:{padding:"33px"},attrs:{model:e.DataForm,size:"small","label-width":"98px",rules:e.FormRules},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"mgt-18",staticStyle:{width:"348px","line-height":"32px",height:"32px"},attrs:{label:"小时报价"}},[a("el-input",{staticStyle:{width:"248px"},attrs:{maxlength:"12",placeholder:"请输入"},on:{input:e.PriceHourAmountInput},model:{value:e.DataForm.price_per_hour,callback:function(t){e.$set(e.DataForm,"price_per_hour",t)},expression:"DataForm.price_per_hour"}},[a("span",{attrs:{slot:"append"},slot:"append"},[e._v("元/时")])])],1),a("el-form-item",{staticClass:"mgt-18",staticStyle:{width:"348px","line-height":"32px",height:"32px"},attrs:{label:"服务费"}},[a("el-input",{staticStyle:{width:"248px"},attrs:{maxlength:"12",placeholder:"请输入"},on:{input:e.SaleAmountInput},model:{value:e.DataForm.service_amount,callback:function(t){e.$set(e.DataForm,"service_amount",t)},expression:"DataForm.service_amount"}},[a("span",{attrs:{slot:"append"},slot:"append"},[e._v("元")])])],1),a("el-form-item",{staticStyle:{width:"348px","line-height":"32px",height:"32px"},attrs:{label:"佣金比例",prop:"commission_rate"}},[a("el-input",{staticStyle:{width:"248px"},attrs:{placeholder:"请输入",maxlength:"6"},on:{input:e.CommissionRateInput},model:{value:e.DataForm.commission_rate,callback:function(t){e.$set(e.DataForm,"commission_rate","string"===typeof t?t.trim():t)},expression:"DataForm.commission_rate"}},[a("span",{attrs:{slot:"append"},slot:"append"},[e._v("%")])])],1),a("el-form-item",{staticStyle:{display:"inline-block",width:"348px","line-height":"32px",height:"32px"},attrs:{label:"是否开启",prop:"status"}},[a("el-radio-group",{staticStyle:{"line-height":"38px",height:"38px"},model:{value:e.DataForm.is_enable,callback:function(t){e.$set(e.DataForm,"is_enable",t)},expression:"DataForm.is_enable"}},[a("el-radio",{attrs:{label:1}},[e._v("开启")]),a("el-radio",{attrs:{label:0}},[e._v("关闭")])],1)],1),a("div",{staticClass:"filter-form-item-btn",staticStyle:{"margin-left":"20px"}},[a("tg-button",{staticStyle:{width:"92px",height:"32px",padding:"0px","line-height":"30px","text-align":"center",display:"inline-block"},attrs:{type:"primary"},on:{click:e.onSaveClick}},[e._v(" 保存 ")])],1)],1),e._m(0)],1)},Ps=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{"margin-top":"0px",color:"#6a7b92",padding:"15px 53px","line-height":"24px","font-family":"PingFangSC-Regular","font-weight":"400","font-size":"14px"}},[a("div",{staticStyle:{"margin-bottom":"10px"}},[e._v("结算设置说明")]),a("div",{staticStyle:{color:"#a4b2c2"}},[e._v("结算时间：每月2号自动进行上个月的收入结算。")]),a("div",{staticStyle:{color:"#a4b2c2"}},[e._v("服务费：每月固定收取的固定直播服务费用。")]),a("div",{staticStyle:{color:"#a4b2c2"}},[e._v(" 佣金比例：计算佣金的基础比例，其它计算规则请在收入结算时手工调账。 ")]),a("div",{staticStyle:{color:"#a4b2c2"}},[e._v("是否开启：开启或关闭自动结算功能。")])])}],Fs=(0,d.defineComponent)({name:"TgTabCalendarWeek",components:{},setup(e,t){const a=(0,d.ref)({commission_rate:"",service_amount:"",settlement_day:"",is_enable:0,price_per_hour:""}),s=(0,$.t)(),i=s.currentRoute.params.id,o=()=>{(0,D.fz)(i).then((({data:e})=>{e.success&&e.data&&(a.value={commission_rate:e.data.commission_rate||0===e.data.commission_rate?e.data.commission_rate:"",service_amount:e.data.service_amount||0===e.data.service_amount?e.data.service_amount:"",price_per_hour:e.data.price_per_hour||0===e.data.price_per_hour?e.data.price_per_hour:"",settlement_day:e.data.settlement_day||"",is_enable:e.data.is_enable||1===e.data.is_enable?1:0})}))};o();const r=()=>{a.value.commission_rate?1!==a.value.is_enable||0!==_&&!1!==_?l():m(!0):t.root.$message.warning("请填写佣金比例！")},l=()=>{(0,D.LY)({project_id:i,...a.value}).then((({data:e})=>{e.success?(t.emit("editProjectReload"),t.root.$message.success(e.message)):t.root.$message.error(e.message??"保存结算设置失败")}))},n=e=>{const t=(/(?:0|[1-9]\d{0,7})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0];a.value.service_amount=t},c=e=>{const t=(/(?:0|[1-9]\d{0,7})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0];a.value.price_per_hour=t},p=e=>(/100(?:\.0{0,2})?|(?:[1-9]?\d)(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(Ha.Pj,""))??[""])[0],u=e=>{const t=p(e);a.value.commission_rate=String(t)};let _=!1;const m=(e=!1)=>{(0,D.mP)(i).then((({data:a})=>{a.success&&a.data?(_=a.data.is_shop_auth||!1,e&&(1===_||!0===_?l():t.root.$message.error("商家暂未授权，请先去项目信息中商家授权"))):e&&t.root.$message.error(a.message??"保存失败，请重新保存！")}))};m(!1);const v=(0,d.ref)({commission_rate:[{required:!0,message:"请输入佣金比例",trigger:["blur","change"]}]});return{FormRules:v,CommissionRateInput:u,SaleAmountInput:n,PriceHourAmountInput:c,onSaveClick:r,getSettingDeatil:o,DataForm:a,costOptions:[1,2,3,4,5,6,7,8,9,10]}}}),Rs=Fs,Ms=(0,k.Z)(Rs,As,Ps,!1,null,"0a0b7679",null),Es=Ms.exports,Is=(0,d.defineComponent)({components:{projectInfo:X,live:Le,income:Ft,cost:Va,contract:Za.Z,dailyData:za["default"],targetView:$s,setting:Es,TbdailyData:Ba},props:{id:{type:Number,required:!0},tab:{type:String},calendar:{type:String,default:""}},setup(e,t){const a=(0,$.t)(),s=a.currentRoute.params.id,i=(0,U.gI)(),l=(0,d.ref)(!1),n=(0,d.ref)(void 0),p=(0,d.ref)(void 0),u=[{name:r.FB.project.list,title:"项目管理"},{path:"",title:"项目详情"}];(0,d.provide)("project",p),(0,d.provide)("live_project",p);const m=c(e,t),v=(0,o.pK)((0,d.computed)((()=>{const e=[{label:"项目信息",value:"projectInfo"}];return p.value?.cooperation_type===_.x3.selfSupport&&i.live_display_view&&e.push({label:"直播场次",value:"live"}),(i.live_project_settlement_view||i.live_project_gathering_view)&&e.push({label:"收入",value:"income"}),(i.live_project_settlement_view&&p.value?.cooperation_type===_.x3.selfSupport||i.live_project_pay_view)&&e.push({label:"成本",value:"cost"}),i.live_project_contract_view&&e.push({label:"合同",value:"contract"}),i.view_or_save_shop_daily_report&&(1===p.value?.cooperation_type&&3===p.value?.business_type?e.push({label:"数据",value:"dailyData"}):e.push({label:"日报",value:"TbdailyData"})),1===p.value?.cooperation_type&&3===p.value?.business_type&&(i.live_project_target_view&&e.push({label:"目标",value:"targetView"}),e.push({label:"设置",value:"setting"})),e})),e.tab??"projectInfo"),f={getDetail:async()=>{const{data:t}=await(0,D.l7)(e.id.toString());p.value=t.data,localStorage.setItem("project3inone",JSON.stringify(p))},onTabChange:e=>{let a=t.root.$route.params.liveType??"calendar";v.checkedTab.value=e.value,"live"!==e.value&&(a="calendar"),m.jump({tab:e.value,liveType:a})},queryInProjectTeam:async()=>{l.value=!0;const e=await(0,h.gs)(s);l.value=!1,e.data.success&&(n.value=!!e.data.data.in_project,n.value&&f.getDetail())}},g=()=>{f.getDetail()};return(0,d.onBeforeMount)((()=>{f.queryInProjectTeam()})),(0,d.onBeforeMount)((()=>{const a=t.root.$route.params.tab??v.checkedTab.value,s=t.root.$route.params.liveType??"calendar";m.replace({id:e.id,tab:a,liveType:s})})),{loading:l,inProject:n,routes:u,permission:i,editProjectReload:g,...v,...f}}}),Ts=Is,Os=(0,k.Z)(Ts,s,i,!1,null,null,null),Vs=Os.exports},13413:function(e,t,a){a.d(t,{Z:function(){return g}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-copy-schedule-dialog"},[a("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter-new",attrs:{visible:e.visible,width:"440px",title:"复制排期排班","close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:e.onClose},scopedSlots:e._u([{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onClose}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.onSave}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"copy-schedule-dialog-content"},[a("el-form",{attrs:{model:e.DataForm,"label-width":"60px",size:"small","label-position":"top"}},[a("div",{staticClass:"form-row"},[a("el-form-item",{attrs:{label:"请选择需要复制的时间段"}},[a("el-date-picker",{staticStyle:{width:"392px"},attrs:{"picker-options":e.pickerOptions,clearable:"",editable:!1,type:"daterange","range-separator":"~","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd"},model:{value:e.DataForm.date_range,callback:function(t){e.$set(e.DataForm,"date_range",t)},expression:"DataForm.date_range"}})],1),a("el-form-item",{attrs:{label:"请选择复制到哪个时间段"}},[a("div",{staticStyle:{display:"flex"}},[a("el-date-picker",{staticStyle:{width:"184px"},attrs:{clearable:"",editable:!1,type:"date","range-separator":"~",placeholder:"开始日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd"},on:{change:e.ChangeCopyToStartDate},model:{value:e.DataForm.start_date,callback:function(t){e.$set(e.DataForm,"start_date",t)},expression:"DataForm.start_date"}}),a("div",{staticStyle:{"text-align":"center",width:"24px",color:"#3c5269","font-size":"14px"}},[e._v(" ～ ")]),a("el-date-picker",{staticStyle:{width:"184px"},attrs:{clearable:"",disabled:"",editable:!1,type:"date","range-separator":"~",placeholder:"结束日期",format:"yyyy.MM.dd","value-format":"yyyy-MM-dd"},model:{value:e.DataForm.end_date,callback:function(t){e.$set(e.DataForm,"end_date",t)},expression:"DataForm.end_date"}})],1)])],1)])],1)])],1)},i=[],o=a(3293),r=a(66870),l=a(82741),n=a(44928),c=a(64236),d=a(97434),p=a(6933),u=a.n(p);const _=async e=>{const[{data:t}]=await(0,c.Dc)(200,(0,o.aT)(e));return t};var m=(0,d.defineComponent)({props:{visible:{type:Boolean,default:!1}},setup(e,t){const a=(0,n.t)(),s=a.currentRoute.params.id,i=(0,d.ref)({date_range:[],start_date:"",end_date:""}),c=()=>{i.value={date_range:[],start_date:"",end_date:""}},p={onClose:()=>{c(),t.emit("close"),t.emit("update:visible",!1)},onSave:async()=>{const e=(0,d.ref)(1),a=i.value.date_range[0],n=i.value.date_range[1],c=i.value.start_date;if(u()(c).isBetween(u()(a),u()(n))||a===c||n===c)return void t.root.$message.error("时间段不允许有重叠");const p=await _({project_id:parseInt(s,10),start_date:c,end_date:i.value.end_date.replace(/\./g,"-"),schedule_type:r.Ix.Month});if(!p.success)return void t.root.$message.error("查询排期信息失败，请稍后重试");if(e.value=p.data.length>0?0:1,0===e.value){const a=await(0,l.I)(t,{title:"被覆盖的时间段已存在排班信息，是否覆盖原有排班",confirmText:"直接覆盖",cancelText:"跳过该日期"});e.value=a?0:1}const{data:m}=await(0,o.il)(s,a,n,c,e.value);m.success?(t.root.$message.success(m.message),t.emit("update:visible",!1),t.emit("succeed")):t.root.$message.warning(m.message??"复制失败，稍后重试")}},m=2592e6,v=(0,d.ref)(),f=(0,d.ref)({disabledDate(e){const t=v.value,a=m;return!!t&&(e.getTime()>t.getTime()+a||e.getTime()<t.getTime()-a)},onPick({minDate:e,maxDate:t}){e&&!t&&(v.value=e),t&&(v.value=null)}});function h(e,t){const a=new Date(e),s=new Date(t),i=864e5,o=s.getTime()-a.getTime(),r=Math.round(o/i);return r}const g=e=>{if(i.value.date_range){const t=i.value.date_range[0],a=i.value.date_range[1],s=h(t,a),o=new Date(e);o.setDate(o.getDate()+s);const r=u()(o).format("YYYY.MM.DD");i.value.end_date=r}};return{...p,DataForm:i,pickerOptions:f,ChangeCopyToStartDate:g}}}),v=m,f=a(1001),h=(0,f.Z)(v,s,i,!1,null,null,null),g=h.exports},60600:function(e,t,a){a.d(t,{Z:function(){return C}});var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tg-live-project-form-dialog"},[s("el-drawer",{staticClass:"tg-dialog-classic",attrs:{title:e.formTitle,"close-on-click-modal":!1,"close-on-press-escape":!1,visible:e.visible,wrapperClosable:!1},on:{close:e.onCancelBtnClick}},[s("div",{staticClass:"tg-drawer-form-content"},[s("el-form",{ref:"formRef",attrs:{model:e.projectForm,rules:e.formRules,"label-position":"top",size:"small","label-width":"106px"}},[s("head-lines",{staticStyle:{margin:"10px 0px"},attrs:{title:"项目信息"}}),s("el-form-item",{staticClass:"one-item",attrs:{label:"项目名称",prop:"project_name"}},[s("el-input",{ref:"autoFocuseRef",attrs:{placeholder:"建议仅输入品牌名称",size:"small",maxlength:"20"},model:{value:e.projectForm.project_name,callback:function(t){e.$set(e.projectForm,"project_name",t)},expression:"projectForm.project_name"}})],1),e.isEditForm?s("el-form-item",{staticClass:"two-item-left",attrs:{label:"公司名称",prop:"company_id"}},[s("el-select",{attrs:{value:"",disabled:e.isEditForm,placeholder:e.projectForm.company_name?e.projectForm.company_name:"--",size:"small"}})],1):s("el-form-item",{staticClass:"two-item-left",attrs:{label:"公司名称",prop:"company_id"}},[s("el-select",{attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入并选择公司名称","remote-method":e.getAllCompanyName,size:"small"},on:{change:e.onCompanyIdChange},model:{value:e.projectForm.company_id,callback:function(t){e.$set(e.projectForm,"company_id",t)},expression:"projectForm.company_id"}},e._l(e.allCompanyName,(function(t,a){return s("el-option",{key:a,attrs:{label:t.company_name,value:t.id}},[s("span",[e._v(e._s(t.company_name))])])})),1)],1),e.isEditForm?s("el-form-item",{staticClass:"two-item-left",attrs:{label:"店铺名称",prop:"company_shop_id"}},[s("el-select",{attrs:{value:"",disabled:e.isEditForm,placeholder:e.projectForm.shop_name?e.projectForm.shop_name:"--",size:"small"}})],1):s("el-form-item",{staticClass:"two-item-left",attrs:{label:"店铺名称",prop:"company_shop_id"}},[s("el-select",{attrs:{placeholder:"请选择店铺",size:"small"},on:{change:e.onShopIdChange},model:{value:e.projectForm.company_shop_id,callback:function(t){e.$set(e.projectForm,"company_shop_id",t)},expression:"projectForm.company_shop_id"}},e._l(e.allStoreName,(function(t,a){return s("el-option",{key:a,attrs:{label:t.shop_name,value:t.shop_id}},[s("span",[e._v(e._s(t.shop_name))])])})),1)],1),e.isEditForm?s("el-form-item",{staticClass:"two-item-left",attrs:{label:"品牌"}},[s("el-input",{attrs:{disabled:"",size:"small"},model:{value:e.new_brand_name,callback:function(t){e.new_brand_name=t},expression:"new_brand_name"}})],1):s("el-form-item",{staticClass:"two-item-left",attrs:{label:"品牌"}},[s("el-input",{attrs:{disabled:"",size:"small"},model:{value:e.brand_name,callback:function(t){e.brand_name=t},expression:"brand_name"}})],1),e.isEditForm?s("el-form-item",{staticClass:"two-item-left",attrs:{label:"店铺类目"}},[s("el-input",{attrs:{disabled:"",size:"small"},model:{value:e.new_shop_cateogry_name,callback:function(t){e.new_shop_cateogry_name=t},expression:"new_shop_cateogry_name"}})],1):s("el-form-item",{staticClass:"two-item-left",attrs:{label:"店铺类目"}},[s("el-input",{attrs:{disabled:"",size:"small"},model:{value:e.shop_cateogry_name,callback:function(t){e.shop_cateogry_name=t},expression:"shop_cateogry_name"}})],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"business_type",label:"业务类型"}},[s("el-select",{staticClass:"select",attrs:{disabled:e.isEditForm,placeholder:"",size:"small"},on:{change:e.onBusinessTypeChange},model:{value:e.projectForm.business_type,callback:function(t){e.$set(e.projectForm,"business_type",t)},expression:"projectForm.business_type"}},[s("el-option",{key:-1,attrs:{label:"请选择",value:-1}}),e._l(e.BusinessTypeOptions,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],2)],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"cooperation_type",label:"合作类型"}},[s("el-select",{staticClass:"select",attrs:{disabled:e.isEditForm,placeholder:"",size:"small"},model:{value:e.projectForm.cooperation_type,callback:function(t){e.$set(e.projectForm,"cooperation_type",t)},expression:"projectForm.cooperation_type"}},[s("el-option",{attrs:{label:"请选择",value:-1}}),s("el-option",{attrs:{label:"自营",value:1}}),s("el-option",{attrs:{label:"区域",value:2}})],1)],1),e.projectForm.cooperation_type===e.CooperationTypeEnum.selfSupport?s("div",{staticClass:"one-item",staticStyle:{"margin-top":"-12px","margin-bottom":"18px",height:"90px",background:"#f7f8f9","border-radius":"2px",padding:"18px"}},[e.projectForm.cooperation_type===e.CooperationTypeEnum.selfSupport?s("el-form-item",{staticStyle:{width:"249px"},attrs:{label:"直播间",prop:"studio_id"}},[s("el-select",{staticClass:"select",attrs:{filterable:"",remote:"","reserve-keyword":"","remote-method":e.getAllStudioName,placeholder:"请选择直播间",size:"small"},on:{change:e.onStudioIdChange},model:{value:e.projectForm.studio_id,callback:function(t){e.$set(e.projectForm,"studio_id",t)},expression:"projectForm.studio_id"}},e._l(e.allStudioName,(function(t,a){return s("el-option",{key:a,attrs:{label:t.studio_name,value:t.id}},[s("span",[e._v(e._s(t.studio_name))])])})),1)],1):e._e(),e.projectForm.cooperation_type!==e.CooperationTypeEnum.selfSupport?s("el-form-item",{staticStyle:{width:"249px"},attrs:{label:"直播间"}},[s("el-select",{staticClass:"select",attrs:{disabled:"",placeholder:"请选择直播间",size:"small"},model:{value:e.projectForm.studio_id,callback:function(t){e.$set(e.projectForm,"studio_id",t)},expression:"projectForm.studio_id"}},[s("el-option",{attrs:{value:""}},[s("span")])],1)],1):e._e()],1):e._e(),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"start_date",label:"开始时间"}},[s("el-date-picker",{attrs:{placeholder:"开始时间",type:"date",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.projectForm.start_date,callback:function(t){e.$set(e.projectForm,"start_date",t)},expression:"projectForm.start_date"}})],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"end_date",label:"结束时间"}},[s("el-date-picker",{attrs:{placeholder:"结束时间",type:"date",size:"small","value-format":"yyyy-MM-dd"},model:{value:e.projectForm.end_date,callback:function(t){e.$set(e.projectForm,"end_date",t)},expression:"projectForm.end_date"}})],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"settlement_cycle_type",label:"结算周期"}},[s("el-select",{staticClass:"select",attrs:{placeholder:"",size:"small"},model:{value:e.projectForm.settlement_cycle_type,callback:function(t){e.$set(e.projectForm,"settlement_cycle_type",t)},expression:"projectForm.settlement_cycle_type"}},[s("el-option",{attrs:{label:"请选择",value:-1}}),s("el-option",{attrs:{label:"月结",value:1}}),s("el-option",{attrs:{label:"季结",value:2}}),s("el-option",{attrs:{label:"半年",value:3}})],1)],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"price_per_hour",label:"小时报价"}},[s("el-input",{attrs:{maxlength:"20",placeholder:"请输入报价",size:"small"},on:{input:e.getPricePerHour},model:{value:e.projectForm.price_per_hour,callback:function(t){e.$set(e.projectForm,"price_per_hour",t)},expression:"projectForm.price_per_hour"}},[s("template",{slot:"append"},[e._v("元/时")])],2)],1),e.is_douyin_self?s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"service_amount",label:"服务费"}},[s("el-input",{attrs:{placeholder:"请输入服务费",size:"small",maxlength:"20"},on:{input:e.getPriceServerAmount},model:{value:e.projectForm.service_amount,callback:function(t){e.$set(e.projectForm,"service_amount",t)},expression:"projectForm.service_amount"}},[s("template",{slot:"append"},[e._v("元")])],2)],1):e._e(),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"commission_rate",label:"佣金比例"}},[s("el-input",{attrs:{placeholder:"请输入佣金比例",size:"small"},on:{input:function(t){return e.inputPositiveInteger(t,"commission_rate")}},model:{value:e.projectForm.commission_rate,callback:function(t){e.$set(e.projectForm,"commission_rate",t)},expression:"projectForm.commission_rate"}},[s("template",{slot:"append"},[e._v("%")])],2)],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"customer_manager_id",label:"客户经理"}},[s("el-select",{attrs:{filterable:"",disabled:-1===e.projectForm.business_type,placeholder:"请输入并选择客户经理",size:"small"},model:{value:e.projectForm.customer_manager_id,callback:function(t){e.$set(e.projectForm,"customer_manager_id",t)},expression:"projectForm.customer_manager_id"}},e._l(e.allCustomerName,(function(t,a){return s("el-option",{key:a,attrs:{disabled:t.id===e.disabledManagerId,label:t.username,value:t.id}},[s("span",[e._v(e._s(t.username))])])})),1)],1),s("el-form-item",{staticClass:"two-item-left",attrs:{prop:"project_manager_id",label:"项目经理"}},[s("el-select",{attrs:{filterable:"",disabled:-1===e.projectForm.business_type,placeholder:"请输入并选择项目经理",size:"small"},model:{value:e.projectForm.project_manager_id,callback:function(t){e.$set(e.projectForm,"project_manager_id",t)},expression:"projectForm.project_manager_id"}},e._l(e.allManagerName,(function(t,a){return s("el-option",{key:a,attrs:{disabled:t.id===e.disabledProjectManagerId,label:t.username,value:t.id}},[s("span",[e._v(e._s(t.username))])])})),1)],1),s("el-form-item",{staticClass:"two-item-left",attrs:{label:"项目所属部门",prop:"feishu_department_id"}},[s("el-popover",{attrs:{placement:"bottom-start",trigger:"click",width:"267","popper-class":"live-department-tree-popper-class"}},[s("div",{staticClass:"repain-select",staticStyle:{display:"block"},attrs:{slot:"reference"},slot:"reference"},[s("el-input",{staticStyle:{color:"#999"},attrs:{value:e.projectForm.feishu_department_name,placeholder:"请选择项目所属部门",readonly:""},scopedSlots:e._u([{key:"suffix",fn:function(){return[s("i",{staticClass:"select-icon select-icon-user-add el-icon-arrow-down"})]},proxy:!0}])})],1),s("div",{staticClass:"department-tree"},[s("el-tree",{ref:"live_department_tree",attrs:{props:e.treeProps,"check-strictly":!0,"node-key":"id",data:e.feishuDepartmentList,"show-checkbox":"","default-checked-keys":e.default_checked_department_ids,"default-expanded-keys":e.default_checked_department_ids},on:{check:e.handleCheckChange}})],1)])],1),e.projectForm.business_type!==e.BusinessTypeEnum.taobao&&e.projectForm.business_type!==e.BusinessTypeEnum.douyin&&e.projectForm.business_type!==e.BusinessTypeEnum.douyinsh||1!==e.projectForm.cooperation_type?e._e():s("el-form-item",{staticStyle:{display:"inline-block",width:"100%"},attrs:{label:"",prop:"taobaoLiveBindAccounts"}},[s("label",{attrs:{slot:"label"},slot:"label"},[s("span",[e._v("直播账号 "),s("el-popover",{attrs:{offset:"10",placement:"top-end",trigger:"hover"}},[3!==e.projectForm.business_type&&7!==e.projectForm.business_type?[s("div",{staticClass:"tbLiveAccountFormLabel",staticStyle:{height:"100px"}},[s("div",{staticStyle:{float:"left",width:"174px",height:"100px"}},[s("img",{staticStyle:{width:"174px",height:"100px"},attrs:{src:a(53895),alt:""}})]),s("p",{staticStyle:{"font-size":"14px","font-weight":"400","font-family":"PingFangSC-Regular, PingFang SC",color:"#6a7b92","line-height":"20px",float:"left","margin-left":"18px",width:"209px",height:"100px"}},[e._v(" 该ID用于将插件收集的直播数据和天鸽内的直播场次进行匹配。获取方式：如图，登录直播中控台后在个人账号信息处查看用户"),s("br"),e._v(" ID ")])])]:[s("img",{staticStyle:{width:"700px"},attrs:{src:a(88529),alt:""}})],s("i",{staticClass:"el-icon-question",staticStyle:{color:"#c4cbd2","margin-right":"3px",cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"})],2)],1)]),s("div",{staticClass:"tbLiveAccountFormItem"},e._l(e.taobaoLiveBindAccounts,(function(t,a){return s("el-input",{key:a,attrs:{placeholder:"请输入直播账号ID",maxlength:"20"},on:{input:function(t){return e.getPositiveInteger(t)}},model:{value:t.account,callback:function(a){e.$set(t,"account","string"===typeof a?a.trim():a)},expression:"item.account"}})})),1)])],1),s("div",{staticClass:"tg-drawer-footer"},[s("tg-button",{attrs:{size:"small"},on:{click:e.onCancelBtnClick}},[e._v("取消")]),s("tg-button",{attrs:{size:"small",type:"primary"},on:{click:e.onSaveBtnClick}},[e._v("保存")])],1)],1)])],1)},i=[],o=(a(21703),a(26699),a(97434)),r=a(53451),l=a.n(r),n=a(3346),c=a(29625),d=a(3422),p=a(86863),u=a(78066),_=a(64236),m=a(61282),v=a(3293),f=a(26895);const{debounce:h}=l(),g=/0|100|[1-9]\d?/,y=(e,t)=>{const a=(0,o.ref)([{account:""},{account:""},{account:""},{account:""},{account:""}]),s=(0,o.ref)({service_amount:void 0,id:-1,project_name:"",company_id:"",company_name:"",shop_name:"",company_shop_id:"",business_type:t,cooperation_type:-1,studio_id:"",start_date:"",end_date:"",commission_rate:"",customer_manager_id:"",live_num_per_month:"",duration_per_live:"",month_duration:"",other_requirement:"",remark:"",settlement_cycle_type:-1,price_per_hour:"",project_manager_id:"",live_account_ids:[],feishu_department_id:void 0,feishu_department_name:void 0,region:0,feishu_department_level:0}),i=(0,o.ref)({company_id:[{required:!0,message:"请选择客户名称",trigger:"change"}],company_shop_id:[{required:!0,message:"请选择店铺",trigger:"change"}],project_name:[{required:!0,message:"请输入项目名称",trigger:"blur"}],business_type:[{required:!0,message:"请选择业务类型",trigger:"change"},{validator:(e,t,a)=>{-1===t?a(new Error("请选择业务类型")):a()},trigger:"change"}],commission_rate:[{required:!0,message:"请输入佣金比例",trigger:"change"},{validator:(e,t,a)=>{t>100?a(new Error("不能大于100")):t<0?a(new Error("不能小于0")):a()},trigger:"change"}],settlement_cycle_type:[{required:!0,message:"请选择结算周期",trigger:"change"},{validator:(e,t,a)=>{-1===t?a(new Error("请选择结算周期")):a()},trigger:"change"}],service_amount:[{required:!0,message:"请输入服务费",trigger:"blur"}],price_per_hour:[{required:!0,message:"请输入小时报价",trigger:"change"},{validator:(e,t,a)=>{t<0?a(new Error("小时报价不能为负数")):a()},trigger:"change"}],customer_manager_id:[{required:!0,message:"请选择客户经理",trigger:"change"}],project_manager_id:[{required:!0,message:"请选择项目经理",trigger:"change"}],cooperation_type:[{required:!0,message:"请选择合作类型",trigger:"change"},{validator:(e,t,a)=>{-1===t?a(new Error("请选择合作类型")):a()},trigger:"change"}],studio_id:[{required:!1,message:"请选择直播间",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"}],feishu_department_id:[{required:!0,message:"请选择项目所属部门",trigger:"change"}],taobaoLiveBindAccounts:[{trigger:"change",required:!0,message:"至少填写一个帐号",validator:(e,t,s)=>{const i=a.value;let o=!1;for(let a=0;a<i.length;a++)if(!/^\s*$/.test(i[a].account)){o=!0;break}o?s():s(e.message)}}]}),r=e=>{s.value.price_per_hour=(0,m.nA)(e)},l=e=>{s.value.service_amount=(0,m.nA)(e)},p=e=>(/[1-9]\d{0,8}/.exec(e.replace(/\D+/gu,""))??[""])[0],u=e=>(0,m.nA)(e),_=(e,t)=>{s.value[t]="commission_rate"===t?u(e):p(e)},v=(0,o.ref)([]),f=async e=>{const{data:t}=await(0,d.Q)({page_num:1,num:100,studio_name:e,business_type:s.value.business_type.toString()});v.value=t.success?t.data.data:[]},h=e=>{s.value.studio_id=e},g=(0,o.ref)([]),y=(0,o.ref)([]),b=e=>{f(e.studio_name)},w=async e=>{const{data:t}=await(0,n.Ln)({company_name:e,verify_status:1});y.value=t.success?t.data.data:[]},x=(0,o.computed)((()=>g.value.find((e=>{if(s.value.company_shop_id)return e.shop_id===s.value.company_shop_id})))),k=(0,o.computed)((()=>{const e=x.value?.brand_name;return e||"--"})),C=(0,o.computed)((()=>{const e=c.Bs.get(x.value?.category??-1);return e||"--"})),S=e=>{s.value.company_id=e,s.value.company_shop_id="";for(let t=0;t<y.value.length;t++)y.value[t].id===e&&(g.value=y.value[t].shops_info??[])},j=e=>{s.value.company_shop_id=e};return{getPositiveInteger:p,taobaoLiveBindAccounts:a,projectForm:s,formRules:i,getPricePerHour:r,getPriceServerAmount:l,inputPositiveInteger:_,getAllStudioName:f,onStudioIdChange:h,onCompanyIdChange:S,onShopIdChange:j,shop_cateogry_name:C,brand_name:k,allStoreName:g,allCompanyName:y,reloadFormItems:b,allStudioName:v,getAllCompanyName:w}};var b=(0,o.defineComponent)({name:"LiveProjectForm",props:{visible:{type:Boolean,required:!0},isEditForm:{type:Boolean,default:!1},project:{type:Object,required:!1}},setup(e,t){const a=(0,o.ref)(void 0),s=(0,o.ref)(null),i=(0,o.ref)(!1),r=(0,o.ref)("新增项目"),l=(0,o.ref)([]),n=(0,o.ref)(void 0),d={label:"name",children:"sons"},m=(0,o.computed)((()=>x.value.feishu_department_id?[x.value.feishu_department_id]:[])),{getPositiveInteger:b,taobaoLiveBindAccounts:w,projectForm:x,formRules:k,getPricePerHour:C,getPriceServerAmount:S,inputPositiveInteger:j,getAllStudioName:D,onStudioIdChange:$,shop_cateogry_name:A,brand_name:P,allStoreName:F,allCompanyName:R,reloadFormItems:M,allStudioName:E,getAllCompanyName:I,onCompanyIdChange:T,onShopIdChange:O}=y(void 0===e.project,e.project?.business_type??""),V=(0,o.ref)([]),Z=(0,o.ref)(-1),L=async()=>{if(""===x.value.business_type)return;const{data:t}=await(0,p.pc)({roles:"1008",business_type:x.value.business_type});V.value=t.success?t.data:[];const a=e.project?.customer_manager_id;a&&(V.value.map((e=>e.id.toString())).includes(a.toString())||(Z.value=a,V.value.push({id:a,username:e.project?.customer_manager??"--"})))},Y=(0,o.ref)(-1),N=(0,o.ref)([]),B=async()=>{if(""===x.value.business_type)return;const{data:t}=await(0,p.pc)({roles:"1003",business_type:x.value.business_type});N.value=t.success?t.data:[];const a=e.project?.project_manager_id;a&&(N.value.map((e=>e.id.toString())).includes(a.toString())||(Y.value=a,N.value.push({id:a,username:e.project?.project_manager??"--"})))},z=()=>{x.value.customer_manager_id="",x.value.project_manager_id="",x.value.studio_id="",L(),B(),x.value.cooperation_type===c.x3.selfSupport&&D()};(0,o.watch)((()=>w.value),(e=>{if(e){const e=w.value.map((e=>e.account));x.value.live_account_ids=e??[]}}),{deep:!0});const q=()=>{t.emit("dialog:close")},W=(0,o.ref)(""),U=(0,o.ref)(""),H=[c.WD.douyin,c.WD.douyinsh,c.WD.taobao],J=H,G=(0,o.computed)((()=>{const t=J.map((t=>1===e.project?.region&&e.isEditForm&&t===c.WD.douyin?{value:t,label:c.Zb.get(c.WD.douyinsh)}:{value:t,label:c.Zb.get(t)}));return t||"--"}));(0,o.watch)((()=>e.visible),(t=>{if(t)if(Q(),s.value?.resetFields(),r.value=void 0===e.project?"新增项目":"编辑项目",void 0!==e.project){if(e.isEditForm){const t=(0,o.computed)((()=>{const t=c.Bs.get(e.project?.category??-1);return t||"--"}));W.value=t.value,U.value=e.project.brand_name?e.project.brand_name:"--"}if(x.value.id=e.project.id,x.value.project_name=e.project.project_name,x.value.company_name=e.project.company_name,x.value.shop_name=e.project.shop_name,x.value.company_id=e.project.company_id,x.value.company_shop_id=e.project.customer_id,x.value.business_type=e.project.business_type,x.value.cooperation_type=e.project.cooperation_type,x.value.studio_id=e.project.studio_id,x.value.start_date=e.project.start_date,x.value.end_date=e.project.end_date,x.value.commission_rate=e.project.commission_rate,x.value.customer_manager_id=e.project.customer_manager_id,x.value.live_num_per_month=e.project.live_num_per_month,x.value.duration_per_live=e.project.duration_per_live,x.value.month_duration=e.project.month_duration,x.value.other_requirement=e.project.other_requirement,x.value.remark=e.project.remark,x.value.settlement_cycle_type=e.project.settlement_cycle_type,x.value.price_per_hour=e.project.price_per_hour,x.value.service_amount=e.project.service_amount,x.value.project_manager_id=e.project.project_manager_id,x.value.feishu_department_id=e.project.feishu_department_id,x.value.feishu_department_name=e.project.feishu_department_name,x.value.region=e.project.region,x.value.feishu_department_level=e.project.feishu_department_level,e.project.live_account_ids){x.value.live_account_ids=e.project.live_account_ids.toString().split(",");const t=[];x.value.live_account_ids.forEach(((e,a)=>{t.push({account:e})})),w.value=t}M(e.project),L(),B()}else(0,o.nextTick)((()=>{a.value?.focus()}))}));const Q=()=>{x.value.id=-1,x.value.company_id="",x.value.company_shop_id="",x.value.business_type=-1,x.value.cooperation_type=-1,x.value.studio_id="",x.value.start_date="",x.value.end_date="",x.value.commission_rate="",x.value.customer_manager_id="",x.value.live_num_per_month="",x.value.duration_per_live="",x.value.month_duration="",x.value.other_requirement="",x.value.remark="",x.value.settlement_cycle_type=-1,x.value.price_per_hour="",x.value.project_manager_id="",x.value.feishu_department_id=void 0,x.value.feishu_department_name=void 0,x.value.region=0,x.value.feishu_department_level=0,F.value=[],R.value=[],V.value=[],N.value=[],n.value?.setCheckedKeys([])},K=async()=>{if(i.value)return;const e=await new Promise((e=>s.value?.validate((t=>e(t)))));if(!e)return;const a={project_name:x.value.project_name,company_id:x.value.company_id,company_shop_id:x.value.company_shop_id,business_type:1===x.value.region&&3===x.value.business_type?7:x.value.business_type,cooperation_type:x.value.cooperation_type,studio_id:x.value.studio_id,start_date:x.value.start_date,end_date:x.value.end_date,commission_rate:x.value.commission_rate,customer_manager_id:x.value.customer_manager_id,live_num_per_month:x.value.live_num_per_month,duration_per_live:x.value.duration_per_live,month_duration:x.value.month_duration,other_requirement:x.value.other_requirement,remark:x.value.remark,settlement_cycle_type:x.value.settlement_cycle_type,price_per_hour:x.value.price_per_hour||void 0,service_amount:x.value.service_amount?Number(x.value.service_amount):void 0,project_manager_id:x.value.project_manager_id,live_account_ids:x.value.live_account_ids,feishu_department_id:x.value.feishu_department_id,feishu_department_name:void 0,feishu_department_level:x.value.feishu_department_level};if(-1!==x.value.id&&(a.id=x.value.id),x.value.start_date>=x.value.end_date)return void t.root.$message.error("结束时间需要晚于开始时间");if(!g.test(x.value.commission_rate))return void t.root.$message.error("佣金比例只能在1-100的范围");i.value=!0;const[{data:o},r]=await Promise.all([await(0,u.Mv)(a),await(0,_._v)(200)]);i.value=!1,o.success?(t.root.$message.success(o.message),t.emit("dialog:close",!0)):t.root.$message.error(o.message??"项目保存失败")},X=h(K,200),ee=async()=>{const e=await(0,v.o1)(),t=e.data.data.data;(0,f.$S)(t,!0,3),l.value=t};ee();const te=e=>{n.value?.setCheckedKeys([]),1!==e.level&&(e.id===x.value.feishu_department_id?(x.value.feishu_department_id=void 0,x.value.feishu_department_name=void 0):(x.value.feishu_department_id=e.id,x.value.feishu_department_name=e.name,n.value?.setCheckedKeys([e.id])),x.value.feishu_department_level=e.level)},ae=(0,o.computed)((()=>1===x.value.cooperation_type&&(3===x.value.business_type||7===x.value.business_type)));return{is_douyin_self:ae,autoFocuseRef:a,disabledProjectManagerId:Y,disabledManagerId:Z,getPositiveInteger:b,taobaoLiveBindAccounts:w,BusinessTypeEnum:c.WD,BusinessTypeOptions:G,formTitle:r,getPricePerHour:C,getPriceServerAmount:S,inputPositiveInteger:j,saveLoading:i,CooperationTypeEnum:c.x3,allCustomerName:V,getAllCustomerName:L,allManagerName:N,getAllManagerName:B,formRef:s,brand_name:P,shop_cateogry_name:A,new_shop_cateogry_name:W,new_brand_name:U,allStudioName:E,getAllStudioName:D,onStudioIdChange:$,getAllCompanyName:I,allStoreName:F,allCompanyName:R,onCompanyIdChange:T,onShopIdChange:O,onBusinessTypeChange:z,formRules:k,onCancelBtnClick:q,onSaveBtnClick:X,projectForm:x,feishuDepartmentList:l,treeProps:d,handleCheckChange:te,live_department_tree:n,default_checked_department_ids:m}}}),w=b,x=a(1001),k=(0,x.Z)(w,s,i,!1,null,null,null),C=k.exports},60097:function(e,t,a){a.d(t,{Z:function(){return _}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-final-dialog tg-dialog-vcenter"},[a("el-dialog",{staticClass:"customer-dialog project-form-modal",attrs:{width:"428px",visible:e.visible,"destroy-on-close":!0,"close-on-click-modal":!1},on:{close:e.closeDialog},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("项目完结")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button-line",{attrs:{"justify-content":"center"}},[a("tg-button",{on:{click:e.closeDialog}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("保存")])],1)]},proxy:!0}])},[a("div",{staticClass:"dialog-content dialog-content-form360"},[a("el-form",{ref:"ruleForm",attrs:{rules:e.rules,model:e.form,"label-width":"78px",size:"medium"}},[a("el-form-item",{attrs:{size:"medium",label:"执行结果：",prop:"end_type"}},[a("el-select",{staticClass:"form-select-two",staticStyle:{width:"310px"},attrs:{placeholder:"请选择执行结果"},model:{value:e.form.end_type,callback:function(t){e.$set(e.form,"end_type",t)},expression:"form.end_type"}},[e._l(e.enumEndType(),(function(t){return[e.status!==e.ProjectStatusEnum.executionEnd||3!==t.value?a("el-option",{key:t.value,attrs:{value:t.value,label:t.label}}):e._e()]}))],2)],1),2===e.form.end_type?a("el-form-item",{staticStyle:{"margin-top":"16px"},attrs:{label:"终止处理：",prop:"end_handle_type"}},e._l(e.enumEndHandleType(),(function(t){return a("el-radio",{key:t.value,attrs:{label:t.value},model:{value:e.form.end_handle_type,callback:function(t){e.$set(e.form,"end_handle_type",t)},expression:"form.end_handle_type"}},[e._v(e._s(t.label))])})),1):e._e(),2===e.form.end_handle_type?a("el-form-item",{attrs:{label:"",prop:"end_handle_detail"}},[a("el-input",{staticStyle:{width:"310px"},attrs:{type:"text",placeholder:"请输入处理方案",maxlength:"20","show-word-limit":""},model:{value:e.form.end_handle_detail,callback:function(t){e.$set(e.form,"end_handle_detail",t)},expression:"form.end_handle_detail"}})],1):e._e(),3!==e.form.end_type?a("el-form-item",{staticStyle:{"margin-top":"16px"},attrs:{label:"完结时间：",prop:"end_time"}},[a("el-date-picker",{staticStyle:{width:"310px"},attrs:{type:"date",placeholder:"请选择完结时间",format:"yyyy.MM.dd","value-format":"timestamp"},model:{value:e.form.end_time,callback:function(t){e.$set(e.form,"end_time",t)},expression:"form.end_time"}})],1):e._e()],1),3!==e.form.end_type?a("div",{staticStyle:{"margin-top":"16px",color:"#6a7b92"}},[e._v(" 项目完结后，不允许进行成本和收入结算 ")]):e._e()],1)])],1)},i=[],o=a(97434),r=a(17496),l=a(47583),n=a(29625),c=(0,o.defineComponent)({emit:["getDetail"],props:{visible:{type:Boolean,default:!1},IsMcn:{type:Boolean,default:!1},status:{type:Number}},setup(e,t){const a=(0,o.reactive)({form:{id:parseInt(t.root.$route.params.id,10),end_type:"",end_handle_type:1,end_handle_detail:"",end_time:void 0},rules:{end_type:[{required:!0,message:"请输入执行结果",trigger:"change"}],end_handle_type:[{required:!0,message:"请选择终止处理",trigger:"change"}],end_handle_detail:[{required:!0,message:"请输入处理方案",trigger:"blur"}],end_time:[{required:!0,message:"请选择完结时间",trigger:"change"}]}}),s=s=>{t.refs[s].validate((async s=>{if(!s)return!1;{const{end_time:s,end_handle_type:i,end_handle_detail:o,end_type:r,id:n}=a.form;if(e.IsMcn){const e=await(0,l.S)({end_handle_detail:o,end_handle_type:i,end_type:"3"===String(r)?void 0:r,execute_end:"3"===String(r)?1:void 0,id:n,end_time:(s??0)/1e3});e.data.success?(t.root.$message({type:"success",message:"保存成功"}),t.emit("ProjectFinalStep:close"),t.emit("getDetail")):t.root.$message({type:"error",message:e.data.message})}else{const e=await(0,l.U_)({end_handle_detail:o,end_handle_type:i,end_type:"3"===String(r)?void 0:r,execute_end:"3"===String(r)?1:void 0,id:n,end_time:(s??0)/1e3});e.data.success?(t.root.$message({type:"success",message:"保存成功"}),t.emit("ProjectFinalStep:close"),t.emit("getDetail")):t.root.$message({type:"error",message:e.data.message})}}}))},i=()=>{a.form.id=parseInt(t.root.$route.params.id,10),a.form.end_type="",a.form.end_handle_type=1,a.form.end_handle_detail=""},c=()=>{i(),t.emit("ProjectFinalStep:close")};return{ProjectStatusEnum:n.C_,...(0,o.toRefs)(a),enumEndHandleType:r.M4,enumEndType:r.Im,closeDialog:c,resetForm:i,submitForm:s}}}),d=c,p=a(1001),u=(0,p.Z)(d,s,i,!1,null,null,null),_=u.exports},86701:function(e,t,a){a.d(t,{Z:function(){return h}});var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticClass:"sty-add-dialog tg-dialog-vcenter",attrs:{"append-to-body":!0,visible:e.customerVisible,width:"800px",top:"70px","close-on-click-modal":!1},on:{"update:visible":function(t){e.customerVisible=t},close:e.close},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"title"},[s("span",[e._v("垫款申请详情")])])]},proxy:!0},{key:"footer",fn:function(){return[e.cost_show?s("span",{staticClass:"dialog-footer"},[e.revocationVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button color-9",attrs:{size:"small"},on:{click:e.revocation}},[e._v("撤销")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-red",attrs:{type:"primary",size:"small"},on:{click:e.refuse}},[e._v("拒绝")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-blue",attrs:{type:"primary",size:"small"},on:{click:e.agree}},[e._v("同意")]):e._e(),s("el-dialog",{staticClass:"userinfo-customer-dialog",attrs:{visible:e.approvalDialogVisible,width:"460px","close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{close:function(t){e.approvalDialogVisible=!1}},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-header"},[e._v("拒绝理由")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-footer"},[s("el-button",{staticClass:"big-button",attrs:{size:"small",plain:""},on:{click:function(t){e.approvalDialogVisible=!1}}},[e._v("取消")]),s("el-button",{staticClass:"btn-blue big-button",attrs:{size:"small",type:"primary"},on:{click:e.handleApprovalSubmitClick}},[e._v("确定")])],1)]},proxy:!0}],null,!1,3210623043)},[s("div",{staticClass:"approval-content"},[s("p",{staticStyle:{"text-align":"left",color:"#333","margin-bottom":"10px"}},[e._v("填写理由:")]),s("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:1,maxlength:30,placeholder:"请输入不超过30个字符"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)]),s("application-dialog",{ref:"ApplicationDialog",on:{"update-info":e.updateInfo,reloadTable:e.reloadList}})],1):e._e()]},proxy:!0}])},[s("div",{staticClass:"main"},[s("div",{staticClass:"main-header"},[s("div",{staticClass:"from-header-box"},[s("div",{staticClass:"from-header"},[s("span",[e._v("申请人:")]),s("span",[e._v(e._s(e.detail_data.username))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("申请部门:")]),s("span",[e._v(e._s(e.detail_data.create_department))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("发起时间:")]),s("span",[e._v(e._s(e.detail_data.gmt_create))])]),s("span",{staticClass:"left_icon"},[e.revocationVisiable()&&e.commitAgainVisible?s("div",{staticClass:"apply-click",on:{click:e.again}},[s("span",[s("img",{attrs:{src:a(15634)}})]),s("span",{staticClass:"hover-red"},[e._v("再次提交")])]):e._e(),s("div",{staticClass:"apply-click",on:{click:e.exportPdf}},[s("span",[s("img",{attrs:{src:a(97830)}})]),s("span",[e._v("下载PDF")])])])]),s("div",{staticClass:"title-right"},[s("span",{staticStyle:{"font-size":"16px",color:"#333","font-weight":"600"}},[e._v("审批编号：")]),s("span",{staticStyle:{color:"#333","font-weight":"600","font-size":"16px"}},[e._v(e._s(e.detail_data.approval_uid))]),s("span",{class:"status-color status-color-"+e.detail_data.approval_status},[1===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批中")]):e._e(),2===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批成功")]):e._e(),3===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批失败")]):e._e(),4===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("已撤销")]):e._e()])])]),s("div",{staticClass:"main-middle"},[s("div",{staticClass:"uls"},[s("ul",[s("li",[s("span",{staticClass:"color-6"},[e._v("垫款类型：")]),s("span",{staticClass:"color-3"},[e._v(e._s(1===e.detail_data.level_two_types?"成本安排":"--"))])]),s("li",[s("span",{staticClass:"color-6"},[e._v("垫款金额(元)：")]),s("span",{staticStyle:{"font-weight":"600",color:"#ff731e"}},[e._v(e._s("￥"+e.detail_data.borrowing_amount_str))])]),s("li",[s("span",{staticClass:"color-6"},[e._v("客户(公司)名称：")]),s("span",{staticClass:"color-3"},[e._v(e._s(e.detail_data.company_name))])]),s("li",[s("span",{staticClass:"color-6",staticStyle:{cursor:"pointer"}},[e._v("关联客户合同：")]),s("span",{staticClass:"color-blue",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.handleClick(e.detail_data.contract_id)}}},[e._v(e._s(e.detail_data.contract_uid))])])]),s("ul",[s("li",[s("span",{staticClass:"color-6"},[e._v("回款时间：")]),s("span",{staticClass:"color-3"},[e._v(e._s(e.detail_data.back_date?e.detail_data.back_date:"--"))])]),s("li",[s("span",{staticClass:"color-6"},[e._v("回款销售金额(元)：")]),s("span",{staticStyle:{"font-weight":"600",color:"#ff731e"}},[e._v(e._s(e.detail_data.back_amount_str?"￥"+e.detail_data.back_amount_str:"--"))])]),s("li",[s("span",{staticClass:"color-6"},[e._v("备注：")]),s("span",{staticClass:"break-all color-3"},[e._v(e._s(e.detail_data.remark?e.detail_data.remark:"--"))])])])]),s("div",{staticClass:"reason"},[s("span",{staticClass:"color-6"},[e._v("垫款理由：")]),s("span",{staticClass:"break-all"},[e._v(e._s(e.detail_data.borrowing_reason?e.detail_data.borrowing_reason:"--"))])])]),s("div",{staticClass:"main-footer"},[s("span",{staticClass:"title-text"},[e._v("附件")]),e.detail_data&&0!==e.detail_data.borrowing_apply_annex_list.length?s("div",{staticClass:"uploaded-list"},e._l(e.detail_data.borrowing_apply_annex_list,(function(t,a){return s("span",{key:a,staticStyle:{"margin-right":"10px","line-height":"30px"}},[s("a",{staticClass:"annex-list",staticStyle:{cursor:"pointer"},attrs:{target:"_blank"},on:{click:function(a){return a.stopPropagation(),e.preview(t)}}},[s("i",{staticClass:"iconfont icon-xiangqingyefujian"}),t?s("span",{staticClass:"uploaded-attachment-name"},[e._v(e._s(decodeURIComponent(t.split("/")[t.split("/").length-1]||"--")))]):e._e()])])})),0):s("span",{staticStyle:{color:"#c8cacc","margin-left":"10px"}},[e._v("未上传附件")]),s("p",{staticStyle:{height:"1px",background:"#f0f3f4",margin:"15px"}}),s("span",{staticClass:"title-text"},[e._v("图片")]),e.detail_data&&0!==e.detail_data.borrowing_apply_photo_list.length?s("div",{staticClass:"uploaded-list"},e._l(e.detail_data.borrowing_apply_photo_list,(function(t,a){return s("span",{key:a,staticClass:"img-list",staticStyle:{"margin-right":"10px","line-height":"30px"}},[s("a",{staticStyle:{cursor:"pointer"},attrs:{target:"_blank"},on:{click:function(a){return a.stopPropagation(),e.preview(t)}}},[s("img",{staticStyle:{"max-height":"70px"},attrs:{src:t+"?Authorization="+e.getToken()}})])])})),0):s("span",{staticStyle:{color:"#c8cacc","margin-left":"10px"}},[e._v("未上传图片")])])]),s("div",{staticClass:"flow",staticStyle:{"padding-left":"18px"}},[s("div",{staticClass:"invoice-info-title"},[e._v("审批流程")]),e.steps.length>0?s("tg-steps",{attrs:{direction:"vertical",steps:e.steps,active:e.activeNumber}}):s("span",[e._v("--")])],1)])},i=[],o=(a(26699),a(61871)),r=a(66117),l=a(74750),n=a(57325),c=a(1763),d=a(64479),p=a(32622),u=a(51351),_={components:{ApplicationDialog:o.Z},name:"applicationDetail",setup(e,t){return{...(0,p.o)(t)}},data(){return{getToken:l.LP,cost_show:!0,step_status:0,detail_data:"",customerVisible:!1,approvalDialogVisible:!1,commitAgainVisible:!0,remark:""}},async mounted(){this.currentUserInfo=this.$store.getters["user/getUserInfo"]},methods:{async getFlowStepData(e){const{data:t}=await(0,u.OC)({approval_id:e});t.success?this.$store.dispatch("workbench/setApproval",{...t.data}):this.$message.error(t.message??"获取审批详情失败")},handleClick(e){const t=this.$router.resolve({name:c.Z8.contract.customer.detail,params:{id:e},query:{partner_type:2}});window.open(t.href,"_blank")},updateInfo(e){},preview(e){const t=e,a=[".doc",".ppt",".xls"],s="https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(this.fixFileToken(t,!1));t.includes(a[0])||t.includes(a[1])||t.includes(a[2])?window.open(s):window.open(this.fixFileToken(t,!1))},fixFileToken:n.W,reloadList(){this.$emit("reload:application")},show(e,t,a=!0){const s={};this.commitAgainVisible=a,e.approval_id?s.approval_id=e.approval_id:s.approval_uid=e.borrowing_uid,(0,r.Ec)(s).then((e=>{e&&e.data&&e.data.success&&(this.detail_data=e.data.data,this.step_status=this.detail_data.steps),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1),this.customerVisible=!0})),this.getFlowStepData(e.approval_id)},revocationVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.add_by;return e},btnVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.now_id;return e},close(){this.$emit("close")},again(){const e=this.detail_data;this.$refs.ApplicationDialog.show(e)},exportPdf(){(0,d.m)(this.detail_data.approval_id)},revocation(){this.$confirm("你确定撤销吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:4};(0,r.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功"),this.$emit("reload:application")):this.$message.error("保存失败")}))})).catch((()=>!1))},agree(){this.$confirm("你确定同意该申请吗","提示",{confirmButtonText:"同意",cancelButtonText:"取消",type:"warning",iconClass:"success-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:2};(0,r.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功")):this.$message.error("保存失败")}))})).catch((()=>!1))},refuse(){this.approvalDialogVisible=!0},handleApprovalSubmitClick(){const e={approval_id:this.detail_data.approval_id,update_code:3,remark:this.remark};(0,r.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.approvalDialogVisible=!1,this.close(),this.$message.success("保存成功"),this.this.remark=""):this.$message.error("保存失败")})).catch((()=>!1))}}},m=_,v=a(1001),f=(0,v.Z)(m,s,i,!1,null,"58823db0",null),h=f.exports},61871:function(e,t,a){a.d(t,{Z:function(){return v}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("common-dialog",{ref:"applicationDialog",staticClass:"sty-add-dialog tg-dialog-vcenter-new",attrs:{isAppendToBody:!0,title:"垫款申请单",width:800,top:70,isfooter:!0},on:{"dialog-cancel":e.handledialogCancel,"dialog-submit":e.handledialogSubmit}},[a("div",{staticClass:"warp"},[a("el-form",{ref:"application_list",attrs:{rules:e.application_list_rules,model:e.application_list,"label-width":"130px"}},[a("el-form-item",{attrs:{prop:"level_two_types",label:"垫款类型："}},[a("el-radio",{attrs:{label:1},model:{value:e.application_list.level_two_types,callback:function(t){e.$set(e.application_list,"level_two_types",t)},expression:"application_list.level_two_types"}},[e._v("成本安排")])],1),a("el-form-item",{attrs:{label:"垫款金额：",prop:"borrowing_amount"}},[a("el-input",{ref:"autoFocuseRef",attrs:{maxlength:e.inputMaxL,placeholder:"请输入垫款金额"},on:{input:function(t){return e.application_list.borrowing_amount=e.getPositiveNumber(t)}},nativeOn:{mousewheel:function(e){e.preventDefault()}},scopedSlots:e._u([{key:"append",fn:function(){return[e._v("元")]},proxy:!0}]),model:{value:e.application_list.borrowing_amount,callback:function(t){e.$set(e.application_list,"borrowing_amount",t)},expression:"application_list.borrowing_amount"}})],1),a("el-form-item",{attrs:{label:"垫款理由：",prop:"borrowing_reason"}},[a("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入文本"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.application_list.borrowing_reason,callback:function(t){e.$set(e.application_list,"borrowing_reason","string"===typeof t?t.trim():t)},expression:"application_list.borrowing_reason"}})],1),a("el-form-item",{staticClass:"value-select",attrs:{label:"客户(公司)名称：",prop:"company_name"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请搜索并选择客户名称","remote-method":e.getAllStoreName,size:"medium"},on:{change:e.handleShopNameChange},model:{value:e.application_list.company_name,callback:function(t){e.$set(e.application_list,"company_name",t)},expression:"application_list.company_name"}},e._l(e.isShopName?e.allCompanyName:[],(function(t,s){return a("el-option",{key:s,attrs:{label:t.company_name,value:t.id}},[a("span",[e._v(e._s(t.company_name))]),a("span",{staticStyle:{color:"#999"}},[e._v(e._s(t.shop_name?"("+t.shop_name+")":"(--)"))])])})),1),""!==e.application_list.company_name?a("el-form-item",{staticClass:"v-bgc",attrs:{prop:"contract_uid","label-width":"127px"},scopedSlots:e._u([{key:"label",fn:function(){return[a("span",[e._v(" 关联客户合同: "),a("el-popover",{attrs:{placement:"top",trigger:"hover",effect:"light",content:"垫款申请需要先与客户签订合同"}},[a("template",{slot:"reference"},[a("i",{staticClass:"el-icon-question",staticStyle:{cursor:"pointer","margin-right":"5px"}})])],2)],1)]},proxy:!0}],null,!1,3246628582)},[a("el-select",{staticClass:"contract_el",staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",remote:"","reserve-keyword":"","remote-method":e.getContract,placeholder:"请搜索并选择客户合同"},on:{change:function(t){return e.selectContractUidChange(t)}},model:{value:e.application_list.contract_uid,callback:function(t){e.$set(e.application_list,"contract_uid",t)},expression:"application_list.contract_uid"}},e._l(e.application_list.contractVal?e.contract_uids:[],(function(e){return a("el-option",{key:e.contract_id,attrs:{label:e.contract_uid,value:e.contract_id}})})),1)],1):e._e()],1),a("el-form-item",{attrs:{label:"回款时间：",prop:"back_date"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small",placeholder:"请选择回款时间","value-format":"yyyy-MM-dd"},model:{value:e.application_list.back_date,callback:function(t){e.$set(e.application_list,"back_date",t)},expression:"application_list.back_date"}})],1),a("el-form-item",{attrs:{label:"回款销售金额："}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",maxlength:e.inputMaxL,placeholder:"请输入回款销售金额"},on:{input:function(t){e.inputMaxL=/^\d+\.?\d{0,1}$/.test(e.application_list.back_amount)?null:e.application_list.back_amount.length-1}},nativeOn:{mousewheel:function(e){e.preventDefault()}},scopedSlots:e._u([{key:"append",fn:function(){return[e._v("元")]},proxy:!0}]),model:{value:e.application_list.back_amount,callback:function(t){e.$set(e.application_list,"back_amount",t)},expression:"application_list.back_amount"}})],1),a("el-form-item",{attrs:{label:"附件：",prop:"gather_certificate_pic"}},[a("div",[[a("el-upload",{staticClass:"upload-btn-wrap",attrs:{action:"",disabled:5===e.borrowing_apply_annex.length,"show-file-list":!1,multiple:!1,"http-request":e.uploadAttachmentFile,accept:".docx,.doc,.xlsx,.xls"}},[a("el-button",{staticClass:"upload-btns btn-blue big-button",attrs:{size:"small",type:"primary",disabled:5===e.borrowing_apply_annex.length}},[a("i",{staticClass:"iconfont icon-zhongxinshangchuan"}),e._v(" "+e._s(5===e.borrowing_apply_annex.length?"最多传5个":"上传文件")+" ")]),a("span",{staticClass:"upload-tips"},[e._v("最多上传5个文件（单个文件大小不超过30M） 支持扩展名：.docx .doc .xlsx .xls ")])],1)],a("div",{staticClass:"uploaded-list"},e._l(e.borrowing_apply_annex,(function(t,s){return a("p",{key:s,staticClass:"uploaded-name",staticStyle:{"margin-right":"10px","line-height":"30px"}},[a("i",{staticClass:"iconfont iconfujian mr5"}),t?a("span",[e._v(e._s(decodeURIComponent(t.split("/")[t.split("/").length-1]||"--")))]):e._e(),t?a("i",{staticClass:"iconfont icon-shanchu",on:{click:function(t){return e.clearUploadedFile(s)}}}):e._e()])})),0)],2)]),a("el-form-item",{attrs:{label:"图片：",prop:"gather_certificate_pic"}},[a("div",[[a("el-upload",{staticClass:"upload-btn-wrap",attrs:{action:"",disabled:5===e.borrowing_apply_photo.length,multiple:!1,"http-request":e.uploadAttachmentImg,"show-file-list":!1,accept:".jpg,.jpeg"}},[a("el-button",{staticClass:"upload-btns btn-blue big-button",attrs:{size:"small",type:"primary",disabled:5===e.borrowing_apply_photo.length}},[a("i",{staticClass:"iconfont icon-zhongxinshangchuan"}),e._v(" "+e._s(5===e.borrowing_apply_photo.length?"最多传5个":"上传图片")+" ")]),a("span",{staticClass:"upload-tips"},[a("span",[e._v("最多上传5张图片（单张图片大小不超过2M）")]),a("span",[e._v("支持扩展名：.jpg .jpeg")])])],1)],a("div",{staticClass:"uploaded-list"},e._l(e.borrowing_apply_photo,(function(t,s){return a("span",{key:s,staticClass:"img-list",staticStyle:{"margin-right":"10px","line-height":"30px"}},[a("img",{attrs:{src:t+"?Authorization="+e.getToken()}}),t?a("span",{on:{click:function(t){return e.clearUploadedImg(s)}}},[e._v("x")]):e._e()])})),0)],2)]),a("el-form-item",{attrs:{label:"备注："}},[a("el-input",{attrs:{type:"textarea",rows:2,maxlength:"100",placeholder:"请输入文本"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.application_list.remark,callback:function(t){e.$set(e.application_list,"remark","string"===typeof t?t.trim():t)},expression:"application_list.remark"}})],1)],1)],1),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},i=[],o=a(66117),r=a(74750),l=a(79433),n=a(61282),c=a(97434),d=a(48606),p={name:"applicationDialog",setup(e,t){const a=(0,c.ref)(void 0);return{autoFocuseRef:a}},data(){return{loading:null,saveLoading:!1,inputMaxL:null,getToken:r.LP,isShopName:"",error_text:"",checkedIndex:"",approver_name:[],select_data:"",borrowing_apply_annex:[],borrowing_apply_photo:[],application_list:{approval_type:3,level_two_types:1,company_name:"",customer_id:"",contract_id:"",contract_uid:"",contractVal:"",borrowing_amount:"",back_amount:"",borrowing_reason:"",borrowing_apply_annex_list:"",borrowing_apply_photo_list:"",back_date:(new Date).toLocaleDateString().replace("/","-").replace("/","-"),remark:"",approval_stream:[]},allCompanyName:[],contract_uids:[],application_list_rules:{level_two_types:[{required:!0,message:"请搜索并选择垫款类型",trigger:"change"}],borrowing_amount:[{required:!0,message:"请输入垫款金额",trigger:"blur"}],borrowing_reason:[{required:!0,message:"请输入垫款理由",trigger:"blur"}],back_date:[{required:!0,message:"请选择回款时间",trigger:"blur"}],company_name:[{required:!0,message:"请搜索并选择客户名称",trigger:"change"}],contract_uid:[{required:!0,message:"请搜索并选择客户合同",trigger:"change"}]}}},activated(){this.getApprovalStreamSelect()},methods:{getPositiveNumber:n.nA,startLoading(){this.loading=d.Loading.service({lock:!0,text:"加载中……",background:"rgba(0, 0, 0, 0.7)"})},closeLoading(){this.loading.close()},getApprovalStreamSelect(){(0,o.SW)({approval_type:3}).then((e=>{e&&e.data&&e.data.success?(this.select_data=e.data.data,this.list=e.data.data):this.error_text=e.data.message}))},show(e){if(this.$refs.application_list?.resetFields(),this.getApprovalStreamSelect(),this.$refs.applicationDialog.dialogOpen(),e){this.application_list.level_two_types=e.level_two_types,this.application_list.borrowing_amount=e.borrowing_amount_str,this.application_list.borrowing_reason=e.borrowing_reason,this.application_list.company_name=e.company_name,this.application_list.customer_id=e.customer_id,this.application_list.contract_uid=e.contract_uid,this.application_list.contract_id=e.contract_id,this.application_list.back_date=e.back_date,this.application_list.back_amount=e.back_amount_str,this.borrowing_apply_annex=e.borrowing_apply_annex_list,this.borrowing_apply_photo=e.borrowing_apply_photo_list,this.application_list.remark=e.remark;const t=[];for(let a=0;a<e.approval_stream.length;a++)this.approver_name.push(e.approval_stream[a].username),t.push({index:e.approval_stream[a].index,user_id:e.approval_stream[a].user_id,role_code:e.approval_stream[a].role_code});this.application_list.approval_stream.splice(this.checkedIndex,1,...t)}else this.$nextTick((()=>{this.$refs.autoFocuseRef.focus()}))},handledialogSubmit(){this.application_list.borrowing_apply_photo_list=this.borrowing_apply_photo,this.application_list.borrowing_apply_annex_list=this.borrowing_apply_annex,this.application_list.borrowing_amount<1e5&&(6===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(4,2),5===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(4,1)),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount<5e5&&6===this.application_list.approval_stream.length&&this.application_list.approval_stream.splice(5,1),this.$refs.application_list.validate((e=>{e&&(0===this.application_list.borrowing_amount||0===this.application_list.back_amount&&""!==this.application_list.back_amount?this.$message.error("金额不得小于等于0"):(this.application_list.borrowing_amount<1e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable")):this.$message.error(e.data.message),this.saveLoading=!1}))),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount<5e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable")):this.$message.error(e.data.message),this.saveLoading=!1}))),this.application_list.borrowing_amount>=1e5&&this.application_list.borrowing_amount>=5e5&&(this.saveLoading=!0,(0,o.kF)(this.application_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.applicationDialog&&this.$refs.applicationDialog.dialogClose(),this.$parent.$parent.customerVisible&&(this.$parent.$parent.customerVisible=!1),this.$emit("reloadTable"),this.$emit("close")):this.$message.error(e.data.message),this.saveLoading=!1})))))}))},async getAllStoreName(e){this.isShopName=e;const{data:t}=await(0,l.G7)({shop_name:e});t.success?Array.isArray(t.data)&&(this.allCompanyName=t.data):this.$message.error(t.message)},getContract(e){this.application_list.contractVal=e,(0,o.v4)({partner_type:1,contract_status:2,partner_id:this.application_list.customer_id,flag:1,search:e}).then((({data:e})=>{this.$set(this,"contract_uids",e.data.data||[])}))},getAllContractUidSelect(e){(0,o.v4)({partner_type:1,contract_status:2,flag:1}).then((e=>{e.data.data.data instanceof Array?this.contract_uids=e.data.data.data:this.$message.error(e.data.message)}))},handleShopNameChange(e){this.isShopName="",this.application_list.contract_uid="",this.application_list.contractVal="";const t=this.allCompanyName.find((t=>t.id===e));t&&(this.application_list.company_name=t.company_name,this.application_list.customer_id=t.id,this.getAllContractUidSelect(t.id))},selectContractUidChange(e){this.application_list.contractVal="";const t=this.contract_uids.find((t=>t.contract_id===e));t&&(this.application_list.contract_uid=t.contract_uid,this.application_list.contract_id=t.contract_id)},selectUserId(e,t,a){this.checkedIndex=a;let s=[];for(let r=0;r<t.length;r++)e===t[r].username&&(s={index:a,user_id:t[r].user_id,role_code:t[r].role_code});this.application_list.approval_stream.length<this.approver_name.length?this.application_list.approval_stream.push(s):this.application_list.approval_stream.splice(a,1,s);let i=this.application_list.approval_stream;function o(e){return function(t,a){return t[e]-a[e]}}i=i.sort(o("index"))},uploadAttachmentFile(e){if(e.file.size>31488e3)return void this.$message.error("单个文件大小不超过30M");const t=new FormData;t.append("file",e.file),t.append("attachment_type","borrowing_apply_annex"),this.startLoading(),(0,o.pD)(t).then((e=>{this.closeLoading(),e.data.success?(this.borrowing_apply_annex.push(e.data.data.source),this.$message.success("上传附件成功")):this.$message.error(e.data.message)})).catch((e=>{this.closeLoading(),this.$message({type:"warning",message:"上传附件失败，稍后重试",showClose:!0,duration:2e3}),console.log(e.message)}))},uploadAttachmentImg(e){const t=new FormData;t.append("file",e.file),t.append("attachment_type","borrowing_apply_photo");const a=e.file.size/1024/1024<2;(0,o.pD)(t).then((e=>{e&&e.data&&e.data.success?a?(this.borrowing_apply_photo.push(e.data.data.source),this.$message.success("上传图片成功")):this.$message.error("上传图片大小不能超过 2MB!"):this.$message.error(e.data.message)}))},clearUploadedFile(e){this.borrowing_apply_annex.splice(e,1)},clearUploadedImg(e){this.borrowing_apply_photo.splice(e,1)},handledialogCancel(){this.application_list.remark="",this.application_list.back_amount="",this.application_list.approval_stream=[],this.borrowing_apply_annex=[],this.borrowing_apply_photo=[],this.approver_name=[],this.$refs.application_list.resetFields(),this.$emit("close")}}},u=p,_=a(1001),m=(0,_.Z)(u,s,i,!1,null,"49707702",null),v=m.exports},18728:function(e,t,a){a.d(t,{Z:function(){return b}});var s=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{staticStyle:{"border-radius":"10px"},attrs:{"append-to-body":!0,visible:e.customerVisible,width:"800px",top:"70px","close-on-click-modal":!1},on:{"update:visible":function(t){e.customerVisible=t},close:e.close},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",[s("span",{staticStyle:{"font-size":"18px","font-weight":"600",color:"#333"}},[e._v("用款申请详情")])])]},proxy:!0},{key:"footer",fn:function(){return[e.cost_show?s("span",{staticClass:"dialog-footer"},[s("div"),e.revocationVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button color-9",attrs:{size:"small"},on:{click:e.revocation}},[e._v("撤销")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-red",attrs:{type:"primary",size:"small"},on:{click:e.refuse}},[e._v("拒绝")]):e._e(),e.btnVisiable()&&1===e.detail_data.approval_status?s("el-button",{staticClass:"big-button btn-blue",attrs:{type:"primary",size:"small"},on:{click:e.agree}},[e._v("同意")]):e._e(),s("el-dialog",{staticClass:"userinfo-customer-dialog",attrs:{visible:e.approvalDialogVisible,width:"460px","close-on-click-modal":!1,"close-on-press-escape":!1,modal:!1},on:{close:function(t){e.approvalDialogVisible=!1}},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-header"},[e._v("拒绝理由")])]},proxy:!0},{key:"footer",fn:function(){return[s("div",{staticClass:"userinfo-customer-dialog-footer"},[s("el-button",{staticClass:"big-button",attrs:{size:"small",plain:""},on:{click:function(t){e.approvalDialogVisible=!1}}},[e._v("取消")]),s("el-button",{staticClass:"btn-blue big-button",attrs:{size:"small",type:"primary"},on:{click:e.handleApprovalSubmitClick}},[e._v("确定")])],1)]},proxy:!0}],null,!1,3210623043)},[s("div",{staticClass:"approval-content"},[s("p",{staticStyle:{"text-align":"left",color:"#333","margin-bottom":"10px"}},[e._v("填写理由:")]),s("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:3,maxlength:30,placeholder:"请输入不超过30个字符"},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)]),s("show-apply-dialog",{ref:"showApplyDialog",on:{"update-info":e.updateInfo}})],1):e._e()]},proxy:!0}])},[s("div",{staticClass:"main"},[s("div",{staticClass:"main-header"},[s("div",{staticClass:"from-header-box"},[s("div",{staticClass:"from-header"},[s("span",[e._v("申请人:")]),s("span",[e._v(e._s(e.detail_data.username))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("申请部门:")]),s("span",[e._v(e._s(e.detail_data.create_department))])]),s("div",{staticClass:"from-header"},[s("span",[e._v("发起时间:")]),s("span",[e._v(e._s(e.detail_data.gmt_create))])]),s("span",{staticClass:"left_icon"},[e._e(),s("div",{staticClass:"apply-click",on:{click:e.exportPdf}},[s("span",[s("img",{attrs:{src:a(97830)}})]),s("span",[e._v("下载PDF")])])])]),s("div",{staticClass:"title-right"},[s("span",{staticStyle:{"font-size":"16px",color:"#333"}},[e._v("审批编号:")]),s("span",{staticStyle:{color:"#333","font-weight":"600","font-size":"16px"}},[e._v(e._s(e.detail_data.approval_uid))]),s("span",{class:"status-color status-color-"+e.detail_data.approval_status},[1===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批中")]):e._e(),2===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批通过")]):e._e(),3===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("审批失败")]):e._e(),4===e.detail_data.approval_status?s("span",{staticClass:"approver-state"},[e._v("已撤销")]):e._e()])])]),s("div",{staticClass:"main-middle"},[s("el-row",{staticStyle:{"margin-right":"0"},attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle-first"},[s("span",{staticClass:"color-9"},[e._v("用款类型:")]),1===e.detail_data.level_two_types?s("span",[e._v("成本安排")]):e._e()])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle-first"},[s("span",{staticClass:"color-9"},[e._v("用款金额（元）:")]),s("span",{staticClass:"color-red",staticStyle:{"font-weight":"600"}},[e._v(e._s("￥"+e.detail_data.transfer_amount_str))])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle-first"},[s("span",{staticClass:"color-9"},[e._v("用款日期:")]),s("span",[e._v(e._s(e.detail_data.transfer_date))])])])],1),3===e.detail_data.level_three_types?[s("el-row",{staticStyle:{"margin-right":"0"},attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("收款方式：")]),s("span",[e._v("对公银行")])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("银行卡号：")]),s("span",[e._v(e._s(e.detail_data.bank_card_number))])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("开户行：")]),s("span",[e._v(e._s(e.detail_data.bank_of_deposit))])])])],1),s("el-row",{staticStyle:{"margin-right":"0"},attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle from-middle-company"},[s("span",{staticClass:"color-9"},[e._v("公司名称：")]),s("span",[e._v(e._s(e.detail_data.collecting_company))])])])],1)]:e._e(),4===e.detail_data.level_three_types?[s("el-row",{staticStyle:{"margin-right":"0"},attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("收款方式：")]),s("span",[e._v("对公支付宝")])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("收款人：")]),s("span",[e._v(e._s(e.detail_data.collecting_person))])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("支付宝账号：")]),s("span",[e._v(e._s(e.detail_data.alipay_account))])])])],1)]:e._e(),s("el-row",{staticStyle:{"margin-right":"0"},attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle"},[s("span",{staticClass:"color-9"},[e._v("店铺名称:")]),s("span",[e._v(e._s(e.detail_data.collecting_shop_name))])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle remark-text-remark"},[s("span",{staticClass:"color-9"},[e._v("备注:")]),s("span",[e._v(e._s(e.detail_data.remark?e.detail_data.remark:"--"))])])]),s("el-col",{attrs:{span:8}},[s("div",{staticClass:"from-middle remark-text-reason"},[s("span",{staticClass:"color-9"},[e._v("付款事由:")]),s("span",[e._v(e._s(e.detail_data.pay_reason?e.detail_data.pay_reason:"--"))])])])],1)],2)]),s("div",{staticClass:"flow",staticStyle:{"padding-left":"18px"}},[s("div",{staticClass:"invoice-info-title"},[e._v("审批流程")]),e.steps.length>0?s("tg-steps",{attrs:{direction:"vertical",steps:e.steps,active:e.activeNumber}}):s("span",[e._v("--")])],1)])},i=[],o=a(97434),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("common-dialog",{ref:"ApplyDialog",attrs:{isAppendToBody:!0,title:"用款申请单",width:800,top:70,isfooter:!0},on:{"dialog-cancel":e.handledialogCancel,"dialog-submit":e.handledialogSubmit}},[a("div",{staticClass:"warp"},[a("el-form",{ref:"transfer_list",attrs:{rules:e.transfer_list_rules,model:e.transfer_list}},[a("el-form-item",{attrs:{"label-width":"90px",prop:"radio"},scopedSlots:e._u([{key:"label",fn:function(){return[a("span",[a("span",{staticStyle:{color:"#f56c6c","margin-right":"3px"}},[e._v("*")]),e._v("用款类型: ")])]},proxy:!0}])},[a("el-radio",{attrs:{label:"1"},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v("成本安排")])],1),a("el-form-item",{attrs:{label:"用款金额：","label-width":"90px",prop:"transfer_amount"}},[a("el-input",{attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",maxlength:e.inputMaxL,placeholder:"请输入开票金额"},on:{input:function(t){e.inputMaxL=/^\d+\.?\d{0,1}$/.test(e.transfer_list.transfer_amount)?null:e.transfer_list.transfer_amount.length-1}},nativeOn:{mousewheel:function(e){e.preventDefault()}},scopedSlots:e._u([{key:"append",fn:function(){return[e._v("元")]},proxy:!0}]),model:{value:e.transfer_list.transfer_amount,callback:function(t){e.$set(e.transfer_list,"transfer_amount",t)},expression:"transfer_list.transfer_amount"}})],1),a("el-form-item",{attrs:{label:"用款日期：","label-width":"90px",prop:"transfer_date"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:!1,size:"small",placeholder:"请选择收款时间","value-format":"yyyy-MM-dd"},model:{value:e.transfer_list.transfer_date,callback:function(t){e.$set(e.transfer_list,"transfer_date",t)},expression:"transfer_list.transfer_date"}})],1),a("el-form-item",{attrs:{"label-width":"90px"},scopedSlots:e._u([{key:"label",fn:function(){return[a("p",{staticClass:"font-b"},[e._v("收款方式:")])]},proxy:!0}])},[a("p",{staticClass:"font-b"},[e._v("对公银行")]),a("div",{staticClass:"v-bgc"},[a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{attrs:{label:"银行卡号：","label-width":"90px",prop:"bank_card_number"}},[a("el-input",{attrs:{maxlength:"40",oninput:"value=value.replace(/[^\\d]/g,'')",placeholder:"请输入银行卡号"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.transfer_list.bank_card_number,callback:function(t){e.$set(e.transfer_list,"bank_card_number",t)},expression:"transfer_list.bank_card_number"}})],1),a("el-form-item",{attrs:{label:"公司名称：","label-width":"110px",prop:"collecting_company"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入公司名称"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.transfer_list.collecting_company,callback:function(t){e.$set(e.transfer_list,"collecting_company","string"===typeof t?t.trim():t)},expression:"transfer_list.collecting_company"}})],1)],1),a("div",{staticStyle:{display:"flex"}},[a("el-form-item",{staticClass:"bank-deposit",attrs:{label:"开户行：","label-width":"90px",prop:"bank_of_deposit"}},[a("el-input",{staticStyle:{width:"78%"},attrs:{maxlength:"40",placeholder:"请输入开户行"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.transfer_list.bank_of_deposit,callback:function(t){e.$set(e.transfer_list,"bank_of_deposit","string"===typeof t?t.trim():t)},expression:"transfer_list.bank_of_deposit"}})],1)],1)])]),a("el-form-item",{attrs:{label:"店铺名称：","label-width":"90px",prop:"collecting_shop_name"}},[a("el-input",{attrs:{maxlength:"40",placeholder:"请输入店铺名称"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.transfer_list.collecting_shop_name,callback:function(t){e.$set(e.transfer_list,"collecting_shop_name","string"===typeof t?t.trim():t)},expression:"transfer_list.collecting_shop_name"}})],1),a("el-form-item",{attrs:{label:"备注：","label-width":"90px"}},[a("el-input",{attrs:{maxlength:"100",placeholder:"请输入备注"},nativeOn:{mousewheel:function(e){e.preventDefault()}},model:{value:e.transfer_list.remark,callback:function(t){e.$set(e.transfer_list,"remark","string"===typeof t?t.trim():t)},expression:"transfer_list.remark"}})],1)],1)],1),a("div",{staticClass:"flow"},[a("el-form",[a("el-form-item",{attrs:{label:"审批流程：","label-width":"90px"}},[e.error_text?a("p",{staticStyle:{color:"#f43846"}},[e._v(e._s(e.error_text))]):e._e(),a("el-steps",{staticClass:"steps-line",attrs:{direction:"vertical"}},e._l(e.select_data,(function(t,s){return a("div",{key:s,class:[{"line-show-1":e.transfer_list.transfer_amount<1e5},{"line-show-2":e.transfer_list.transfer_amount>=1e5&&e.transfer_list.transfer_amount<5e5},{"line-show-3":e.transfer_list.transfer_amount>=5e5}]},[!e.select_data[s].limit_amount||e.transfer_list.transfer_amount>=e.select_data[s].limit_amount?a("el-step",{staticStyle:{height:"82px"},scopedSlots:e._u([{key:"title",fn:function(){return[804!==t.role_code&&802!==t.role_code?a("span",[e._v(e._s(t.role_name))]):e._e(),804===t.role_code?a("span",[e._v(e._s(t.role_name+"（用款金额大于10万元）"))]):e._e(),802===t.role_code?a("span",[e._v(e._s(t.role_name+"（用款金额大于50万元）"))]):e._e()]},proxy:!0},{key:"description",fn:function(){return[a("div",[a("span",{staticStyle:{color:"#f56c6c","margin-right":"3px"}},[e._v("*")]),a("span",{staticClass:"flow-select"},[e._v("审批人:")]),a("el-select",{attrs:{clearable:!1,filterable:"",placeholder:"请选择"},on:{change:function(t){return e.selectUserId(t,e.select_data[s].approval_user,s)}},model:{value:e.approver_name[s],callback:function(t){e.$set(e.approver_name,s,t)},expression:"approver_name[index]"}},e._l(e.select_data[s].approval_user?e.select_data[s].approval_user:"",(function(e){return a("el-option",{key:e.user_id,attrs:{value:e.username}})})),1)],1)]},proxy:!0}],null,!0)}):e._e()],1)})),0)],1)],1)],1)])},l=[],n=a(66117),c={name:"ApplyDialog",data(){return{error_text:"",checkedIndex:"",inputMaxL:null,approver_name:[],select_data:"",radio:"1",transfer_list:{approval_type:1,level_two_types:1,level_three_types:3,transfer_amount:"",transfer_date:(new Date).toLocaleDateString().replace("/","-").replace("/","-"),bank_card_number:"",bank_of_deposit:"",collecting_company:"",remark:"",collecting_shop_name:"",approval_stream:[]},transfer_list_rules:{transfer_amount:[{required:!0,message:"请输入用款金额",trigger:"blur"}],transfer_date:[{required:!0,message:"请输入用款日期",trigger:"blur"}],bank_card_number:[{required:!0,message:"请输入银行卡号",trigger:"blur"}],bank_of_deposit:[{required:!0,message:"请输入开户行",trigger:"blur"}],collecting_company:[{required:!0,message:"请输入公司名称",trigger:"blur"}],collecting_shop_name:[{required:!0,message:"请输入店铺名称",trigger:"blur"}]}}},activated(){this.getApprovalStreamSelect()},methods:{getApprovalStreamSelect(){(0,n.SW)({approval_type:1}).then((e=>{e&&e.data&&e.data.success?(this.select_data=e.data.data,this.list=e.data.data):this.error_text=e.data.message}))},show(e){if(this.getApprovalStreamSelect(),this.$refs.ApplyDialog.dialogOpen(),e){this.transfer_list.transfer_amount=e.transfer_amount_str,this.transfer_list.transfer_date=e.transfer_date,this.transfer_list.bank_card_number=e.bank_card_number,this.transfer_list.bank_of_deposit=e.bank_of_deposit,this.transfer_list.collecting_company=e.collecting_company,this.transfer_list.collecting_shop_name=e.collecting_shop_name,this.transfer_list.remark=e.remark;const t=[];for(let a=0;a<e.approval_stream.length;a++)this.approver_name.push(e.approval_stream[a].username),t.push({index:e.approval_stream[a].index,user_id:e.approval_stream[a].user_id,role_code:e.approval_stream[a].role_code});this.transfer_list.approval_stream.splice(this.checkedIndex,1,...t)}},handledialogSubmit(){this.transfer_list.transfer_amount<1e5&&(6===this.transfer_list.approval_stream.length&&this.transfer_list.approval_stream.splice(4,2),5===this.transfer_list.approval_stream.length&&this.transfer_list.approval_stream.splice(4,1)),this.transfer_list.transfer_amount>=1e5&&this.transfer_list.transfer_amount<5e5&&6===this.transfer_list.approval_stream.length&&this.transfer_list.approval_stream.splice(5,1),this.$refs.transfer_list.validate((e=>{e&&(this.transfer_list.transfer_amount<1e5&&(4!==this.transfer_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,n.jw)(this.transfer_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.ApplyDialog.dialogClose()):this.$message.error(e.data.message)}))),this.transfer_list.transfer_amount>=1e5&&this.transfer_list.transfer_amount<5e5&&(5!==this.transfer_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,n.jw)(this.transfer_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.ApplyDialog.dialogClose()):this.$message.error(e.data.message)}))),this.transfer_list.transfer_amount>=1e5&&this.transfer_list.transfer_amount>=5e5&&(6!==this.transfer_list.approval_stream.length?this.$message.error("请选择审批流程"):(0,n.jw)(this.transfer_list).then((e=>{e.data.success?(this.$message.success("保存成功"),this.$refs.ApplyDialog.dialogClose()):this.$message.error(e.data.message)}))))})),this.$emit("update-info","update")},selectUserId(e,t,a){this.checkedIndex=a;let s=[];for(let r=0;r<t.length;r++)e===t[r].username&&(s={index:a,user_id:t[r].user_id,role_code:t[r].role_code});this.transfer_list.approval_stream.length<this.approver_name.length?this.transfer_list.approval_stream.push(s):this.transfer_list.approval_stream.splice(a,1,s);let i=this.transfer_list.approval_stream;function o(e){return function(t,a){return t[e]-a[e]}}i=i.sort(o("index"))},handledialogCancel(){this.$refs.transfer_list.resetFields(),this.transfer_list.remark="",this.transfer_list.approval_stream=[],this.approver_name=[]}}},d=c,p=a(1001),u=(0,p.Z)(d,r,l,!1,null,"2f9aea11",null),_=u.exports,m=a(64479),v=a(32622),f=a(51351),h=(0,o.defineComponent)({components:{ShowApplyDialog:_},name:"ApplyDetail",data(){return{cost_show:!0,step_status:0,customerVisible:!0,approvalDialogVisible:!1,remark:""}},setup(e,t){const a=(0,o.ref)({});console.log({approval_flow_detail:a.value.approval_flow_detail});const s=(0,o.ref)([]);return(0,o.provide)("flows",s),{detail_data:a,approval_flow_detail:s,...(0,v.o)(t)}},async mounted(){this.currentUserInfo=this.$store.getters["user/getUserInfo"]},methods:{async getFlowStepData(e){const{data:t}=await(0,f.OC)({approval_id:e});t.success?this.$store.dispatch("workbench/setApproval",{...t.data}):this.$message.error(t.message??"获取审批详情失败")},updateInfo(e){e&&this.$parent.handleSearch()},show(e,t=0){e&&void 0===e.pay_way_detail&&1!==t?(0,n.Ec)({approval_id:e.approval_id}).then((e=>{e&&e.data&&e.data.success&&(this.detail_data=e.data.data,this.step_status=this.detail_data.steps),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1)})):(0,n.Ec)({approval_id:1===t?e.approval_id:e.pay_way_detail[0].approval_id}).then((e=>{e&&e.data&&e.data.success&&(this.detail_data=e.data.data,this.step_status=this.detail_data.steps,this.approval_flow_detail=this.detail_data.approval_flow_detail),2!==this.detail_data.approval_status&&3!==this.detail_data.approval_status||(this.step_status=this.step_status+1)})),this.getFlowStepData(e.approval_id)},revocationVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.add_by;return e},btnVisiable(){const e=this.currentUserInfo&&this.currentUserInfo.id===this.detail_data.now_id;return e},close(){this.$emit("close")},again(){const e=this.detail_data;this.$refs.showApplyDialog.show(e)},exportPdf(){(0,m.m)(this.detail_data.approval_id)},revocation(){this.$confirm("你确定撤销吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",iconClass:"warning-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:4};(0,n.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功"),this.$parent.handleSearch()):this.$message.error("保存失败")}))})).catch((()=>!1))},agree(){this.$confirm("你确定同意该申请吗","提示",{confirmButtonText:"同意",cancelButtonText:"取消",type:"warning",iconClass:"success-icon"}).then((()=>{const e={approval_id:this.detail_data.approval_id,update_code:2};(0,n.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.close(),this.$message.success("保存成功"),this.$parent.handleSearch()):this.$message.error("保存失败")}))})).catch((()=>!1))},refuse(){this.approvalDialogVisible=!0},handleApprovalSubmitClick(){const e={approval_id:this.detail_data.approval_id,update_code:3,remark:this.remark};(0,n.bM)(e).then((e=>{e&&e.data&&e.data.success?(this.approvalDialogVisible=!1,this.close(),this.$message.success("保存成功"),this.this.remark="",this.$parent.handleSearch()):this.$message.error("保存失败")})).catch((()=>!1))}}}),g=h,y=(0,p.Z)(g,s,i,!1,null,"36037be4",null),b=y.exports},47583:function(e,t,a){a.d(t,{Fy:function(){return n},S:function(){return o},U_:function(){return i},Yd:function(){return l},a$:function(){return r},js:function(){return c},uZ:function(){return d},xZ:function(){return p}});var s=a(76012);function i(e){return(0,s.ZP)({url:"/api/shop_live/end_project",method:"post",data:e})}function o(e){return(0,s.ZP)({url:"/api/shop_live/end_common_project",method:"post",data:e})}function r(e){return(0,s.ZP)({url:"/api/shop_live/update_project_try_live",method:"post",data:e})}function l(e){return(0,s.ZP)({url:"/api/medium/get_company_name_and_id",method:"get",params:e})}function n(e){return(0,s.ZP)({url:"/api/shop_live/update_area_execute",method:"post",data:e})}function c(e){return(0,s.ZP)({url:"/api/shop_live/save_kol_schedule",method:"post",data:e})}function d(e){return(0,s.ZP)({url:"/api/auth/get_user_by_role",method:"get",params:e})}function p(e){return(0,s.ZP)({url:"/api/shop_live/save_operator_schedule",method:"post",data:e})}},66117:function(e,t,a){a.d(t,{D_:function(){return n},Ec:function(){return r},Lc:function(){return c},SW:function(){return i},Uj:function(){return u},bM:function(){return l},jw:function(){return o},kF:function(){return _},pD:function(){return p},v4:function(){return d}});var s=a(76012);function i(e){return(0,s.ZP)({url:"/api/approval/get_approval_stream",method:"get",params:e})}function o(e){return(0,s.ZP)({url:"/api/approval/save_transfer_apply",method:"post",data:e})}function r(e){return(0,s.ZP)({url:"/api/approval/query_approval_info",method:"get",params:e})}function l(e){return(0,s.ZP)({url:"/api/approval/update_approval_info",method:"post",data:e})}function n(e){return(0,s.ZP)({url:"/api/approval/save_refund_apply",method:"post",data:e})}function c(e){return(0,s.ZP)({url:"/api/coop/query_achievement_uid",method:"get",params:e})}function d(e){return(0,s.ZP)({url:"/api/cont/query_contract_uid",method:"get",params:e})}function p(e){return(0,s.ZP)({url:"/api/approval/upload_attachment",method:"post",data:e})}function u(e){return(0,s.ZP)({url:"/api/approval/save_invoice_apply",method:"post",data:e})}function _(e){return(0,s.ZP)({url:"/api/approval/save_borrowing_apply",method:"post",data:e})}},6549:function(e,t,a){a.d(t,{C:function(){return i},j:function(){return s}});const s="/api/auth/query_user_v2",i="/api/auth/get_user_by_role"},50935:function(e,t,a){a.d(t,{g:function(){return r}});var s=a(3293),i=a(64236),o=a(97434);const r=()=>{const e=(0,o.ref)({kolSchedules:[],operatorSchedules:[]}),t=(0,o.ref)(!1),a=async t=>{const[{data:a}]=await(0,i.Dc)(300,(0,s.D2)(t));a.success?(e.value.kolSchedules=a.data.kol_schedule_list,e.value.operatorSchedules=a.data.operator_schedule_list):(e.value.kolSchedules=[],e.value.operatorSchedules=[])};return{loading:t,loadScheduleData:a,ScheduleData:e}}},3422:function(e,t,a){a.d(t,{Q:function(){return l},V:function(){return n}});var s=a(76012),i=a(64236);const o="/api/studio/query_studio",r="/api/studio/save_studio",l=async e=>(0,s.dX)(o,{params:{...(0,i.jG)(e)}}),n=async e=>(0,s.SO)(r,{...(0,i.jG)(e)})},14782:function(e,t,a){a.d(t,{g:function(){return o},s:function(){return r}});var s=a(76012),i=a(6549);const o=async()=>(0,s.dX)(i.C,{params:{roles:1003}}),r=async()=>(0,s.dX)(i.C,{params:{roles:1008}})},66870:function(e,t,a){var s;a.d(t,{Ix:function(){return r},dr:function(){return o},en:function(){return i},wG:function(){return s}}),function(e){e[e["waitingSchedule"]=1]="waitingSchedule",e[e["waitingLive"]=2]="waitingLive",e[e["waitingTypeIn"]=3]="waitingTypeIn",e[e["lived"]=4]="lived"}(s||(s={}));const i=new Map([[s.waitingSchedule,"待排班"],[s.waitingLive,"待直播"],[s.waitingTypeIn,"待录入"],[s.lived,"已直播"]]);new Map([[s.waitingSchedule,"yellow"],[s.waitingLive,"green"],[s.waitingTypeIn,"yellow"],[s.lived,"gray"]]);var o,r;(function(e){e[e["brand_name"]=1]="brand_name",e[e["studio_name"]=2]="studio_name",e[e["shop_name"]=3]="shop_name",e[e["project_uid"]=4]="project_uid",e[e["live_title"]=5]="live_title",e[e["kol_name"]=6]="kol_name",e[e["operation_assistant_name"]=7]="operation_assistant_name",e[e["project_name"]=8]="project_name"})(o||(o={})),function(e){e[e["Month"]=1]="Month",e[e["Week"]=2]="Week"}(r||(r={}))},43847:function(e,t,a){a.d(t,{Pc:function(){return r},oR:function(){return o}});var s=a(77944),i=a(97434);const o=()=>s.Z,r=()=>{const e=o(),t=(0,i.computed)((()=>e.getters["user/getUserInfo"]));return t}},40290:function(e,t,a){a.d(t,{k:function(){return i}});var s=a(1763);const i=e=>{const t={jumpProjectDetail:e=>{const a={name:s.FB.project.detail,params:{id:`${e.project_id}`,tab:e.tab??"projectInfo",liveType:e.liveType??"calendar"}},i=e.newWindow??!1;t.jump(a,i)},jumpLiveDisplayDetail:e=>{const a={name:s.FB.display.detail,params:{id:`${e.project_id}`,liveId:`${e.live_id}`,tab:"live",liveType:e.liveType??"calendar"}},i=e.newWindow??!1;t.jump(a,i)},jump:(t,a=!1)=>{if(a){const{href:a}=e.root.$router.resolve(t);window.open(a,"_blank")}else e.root.$router.push(t)}};return{...t}}},40884:function(e,t,a){var s=a(97434);t["Z"]=(0,s.defineComponent)({name:"TgBtnCapsule",model:{prop:"value",event:"click"},props:{value:{type:String,required:!0}},setup(e,t){const a=(0,s.ref)(e.value),i=(0,s.computed)((()=>"left"===a.value)),o=(0,s.computed)((()=>"right"===a.value)),r=(0,s.computed)((()=>["btn-capsule-left",i.value?"active":""])),l=(0,s.computed)((()=>["btn-capsule-right",o.value?"active":""])),n=e=>{a.value=e,t.emit("click",e)};return{isLeftActive:i,isRightActive:o,leftClass:r,rightClass:l,setActive:n}},render(){const e=arguments[0],t=e("div",{class:this.leftClass,on:{click:()=>{this.isLeftActive||this.setActive("left")}}},[this.$slots.left]),a=e("div",{class:this.rightClass,on:{click:()=>{this.isRightActive||this.setActive("right")}}},[this.$slots.right]);return e("div",{class:"btn-capsule"},[t,e("div",{class:"sep"}),a])}})},88529:function(e,t,a){e.exports=a.p+"static/img/live_account_douyin_tips.e893f2c9.jpg"},53895:function(e,t,a){e.exports=a.p+"static/img/live_account_tips.f30a6fcf.png"},97830:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACNElEQVRYR+2XP2gUURCHv0mCGMU/WJgrJNroEpAUFsZLCgsFG7GwUSwsFNw71FsjRmKlQkCb7GWjEg+JhZUgNhaKhYKFXgSxsAmxUQtB0UJBxEJ98rK5u70ju/uS3ayFbnW3NzO/734z7+1bIXD1ldTmNuEysBtYHfzN9HO+hxuujY2IMsmRWtCAo6zfMAWsNUkMi8n3AELFPUbRBKIOkHfUXWB/EnGdOwugL8WEW+B4HEQQ4OtibQ9C1wH8m9dcm5NREEEAo57FOdQCoMOvuDZOGEQWAJEQWQGgwCvbDLY6kRnAXOvG3IIMBtuYOsB2C9rbwidFCeWyLadrEakDWBtg3aroURXF6GhRzugoYwArB2cPzl/4zXuoPIBP36BzGWzdBB3t0RBuQWa1jQH29ML5I9FF7z+FkTs+RPd6WLMyvB2JAL7/gHcffJiNOVixvAF28SY8fBW3W0DVS+DA5y+w70JD5PYwdOf87y+moVTJGMDZCwf08xOYfgtHxzIGuHQYdm77Sw7o4Rw61JiDyXsw+XiJHQgrb2q/zk80hPMBPHkJ527F//NaRCIAvQqGrjfEZuaWpLl8Qgdal+FChFNzILgP/AfIxIHFiETlLHgV/BMAP4GYY0RqPvyqetKhq9UPJP0lNaOELalJRBQSxetn42I1AeRLykEweJCmgKg4VR0XrwkAlOxwuCpQDDqTglywhFIwMeVxAvy353oLalF9juoV2AV0pSz+UcGj5540Hdj+AM6Q8yGdbmEzAAAAAElFTkSuQmCC"},15634:function(e){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB00lEQVRYR+3XsU7bUBTG8f8BVAlVpRUDLBXq0kZIVcdCYASp6sobdChO1BJD1YfogoMpCCEQPEHnKkNXAisbvAFj98KpTHC4Nti+dkwkpHiKcs/198u519aNYFwzDX09JPwAFoExc8z2c3WaPc/BQURt5khYNO9q5QqOgRc2E5NqqtOAsOstU7dBdAFVV38BS72EB3OvAcGl7Hg1vmQhTMDfom030V1A58ttz2ElDWECrNYsq0MxQFD+03NwkxD9AKQi+gVAwW86rMU70TfAzdJteDVZM5exdMD7CgwPJe8UFZpNR76FFaUDKi9h/Fn6VhVlfb0u34OqngCfP3aC9n7fBo4+gbevYGQ4HeHV5Dq7MCAI//ShE3LYuouYmoDnT5OXoyeAGR7+zjgi633R9gt24L7wIohCgLTwvIjcAJvwPIhcgDzhIeKgBfvG0xHfE9aAIuE2CGtA0m4+2oiOzK1m7fvo+AAw6MCgA4+/A/me+rvV93XgH5BxjOg1tjv/su3LSORAMtfQMxXelBaRciNRzo82pRI9ETXURYi9YB+Io6y2N8WPAEBl1mVLoG4e1UomqMLOsc9X6Px77p4Jw6AZV98JLACTJYdfKPw58eXUvO9/kF7RIXH89QIAAAAASUVORK5CYII="}}]);