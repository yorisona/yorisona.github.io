"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[8422],{93295:function(e,t,a){a.d(t,{Z:function(){return m}});var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tree-container"},[a("el-tree",{ref:"single_tree",attrs:{data:e.c_treeData,"check-strictly":!0,"show-checkbox":"","node-key":"id",props:e.defaultProps},on:{check:e.check}})],1)},s=[],o=a(97434),n={props:{c_treeData:{type:Array}},emits:["handleTreeDataCall"],setup(e,t){const a=(0,o.reactive)({defaultProps:{label:"department_name",children:"sub_nodes"}}),r=e=>{t.refs.single_tree.setCheckedKeys([]),t.refs.single_tree.setCheckedKeys([e.id]),t.emit("handleTreeDataCall",e)},s=e=>{t.refs.single_tree.setCheckedKeys([e.department_info.id])},n=()=>{t.refs.single_tree.setCheckedKeys([])};return{...(0,o.toRefs)(a),check:r,editCheck:s,resetCheck:n}}},i=n,l=a(1001),c=(0,l.Z)(i,r,s,!1,null,null,null),m=c.exports},85341:function(e,t,a){a.d(t,{Z:function(){return Y}});a(21703);var r=a(36568),s=a.n(r),o=a(97434),n=a(93295),i=a(48606),l=a(87939),c=a(29625),m=a(3346),d=a(86863),p=a(3293),u=a(26895),_=a(11676),g=a(6933),f=a.n(g),v=a(88721),y=a(45781),b=a(78066),k=a(85937),w=a.n(k);const x=[...c.i8].map((e=>({label:e[1],value:e[0]}))),$=()=>{const e=(0,o.reactive)({company_id:void 0,company_id_options:[],project_name:"",company_shop_id:void 0,company_shop_id_options:[],business_type:l._.Douyin,cooperation_type:c.x3.selfSupport,new_shop_cateogry_name:"",start_date:void 0,end_date:void 0,settlement_cycle_type:void 0,customer_manager_id:void 0,customer_manager_id_options:[],project_manager_id:void 0,project_manager_id_options:[],feishu_department_id:void 0,feishu_department_level:void 0,feishu_department_id_input:"",feishu_department_id_show:!1,feishu_department_id_list:[],attachment_url:[],estimated_data_list:[],remark:void 0,total_gmv:void 0,total_income:void 0,total_cost:void 0,total_profit:void 0,default_checked_keys:[]}),t=(0,o.computed)((()=>{let t=0,a=0,r=0,s=0;e.estimated_data_list.forEach((e=>{isNaN(e.gmv)||(t+=1e4*Number(e.gmv)),isNaN(e.income)||(a+=1e4*Number(e.income)),isNaN(e.cost)||(r+=1e4*Number(e.cost))})),isNaN(a)||isNaN(r)||(s=a-r);const o=t,n=a,i=r,l=s;t=y.Z.formatPriceFormYuan(t,2,!0),a=y.Z.formatPriceFormYuan(a,2,!0),r=y.Z.formatPriceFormYuan(r,2,!0);const c=s<0;return s=y.Z.formatPriceFormYuan(Math.abs(s),2,!1),c&&(s=`-${s}`),"--"!==s&&(s=`￥${s}`),{gmv:t,total_gmv:o,income:a,total_income:n,cost:r,total_cost:i,profit:s,total_profit:l}})),a=async t=>{const{data:a}=await(0,m.Ln)({company_name:t,verify_status:1});e.company_id_options=a.success?a.data.data:[]},r=t=>{const a=e.company_id_options.find((e=>e.id===t));a&&(e.project_name||a.shops_info?.length>0&&(e.project_name=a.shops_info[0].brand_name),e.company_shop_id_options=a.shops_info,a.shops_info.length>0?(e.company_shop_id=a.shops_info[0].shop_id,s(e.company_shop_id)):(e.company_shop_id=void 0,e.new_shop_cateogry_name=""))},s=t=>{const a=e.company_shop_id_options.find((e=>e.shop_id===t));a&&(e.new_shop_cateogry_name=c.Bs.get(a.category))},n=async()=>{const{data:t}=await(0,d.pc)({roles:"1008",business_type:e.business_type});e.customer_manager_id_options=t.success?t.data:[];const{data:a}=await(0,d.pc)({roles:"1003",business_type:e.business_type});e.project_manager_id_options=a.success?a.data:[];const r=await(0,p.o1)(),s=r.data.data.data;(0,u.$S)(s,!0,3),e.feishu_department_id_list=s};n();const _=a=>{a.estimated_data_list=a.estimated_data.estimated_data_list,a.feishu_department_id_input=a.department_name,Object.keys(e).forEach((t=>{void 0!==a[t]&&(e[t]=a[t])})),e.company_id_options=[{company_name:a.company_name,id:a.company_id}],e.default_checked_keys=[a.feishu_department_id],e.company_shop_id=a.customer_id,e.company_shop_id_options=[{shop_name:a.customer_manager_name,shop_id:a.customer_id}],e.new_shop_cateogry_name=a.category_name,e.attachment_url=[a.attachment_url],t.value},h=async()=>{const a={...e};delete a.company_shop_id_options,delete a.company_id_options,delete a.customer_manager_id_options,delete a.feishu_department_id_list,delete a.project_manager_id_options,a.total_gmv=t.value.total_gmv,a.total_income=t.value.total_income,a.total_cost=t.value.total_cost,a.total_profit=t.value.total_profit,a.estimated_data_list=e.estimated_data_list.map((e=>{const{gmv:t,income:a,cost:r}=e;return{gmv:new(w())(t??0).mul(new(w())(1e4)).toNumber(),income:new(w())(a??0).mul(new(w())(1e4)).toNumber(),cost:new(w())(r??0).mul(new(w())(1e4)).toNumber(),date:f()(e.date).format("YYYY.MM")}})),a.attachment_url=e.attachment_url[0],a.start_date=f()(e.start_date).format("YYYY-MM-DD"),a.end_date=f()(e.end_date).format("YYYY-MM-DD");const{data:r}=await(0,b.pB)(a);if(!r.success)throw i.Message.error(r.message??"项目保存失败"),new Error("项目保存失败");i.Message.success(r.message)};return(0,o.reactive)({edit:_,...(0,o.toRefs)(e),getAllCompanyName:a,onChangeCompany:r,onChangeShop:s,submit:h,totalSum:t})},A=(e=[],t="label",a="value")=>e.map(((e,r)=>h("el-option",{key:r,attrs:{label:e[t],value:e[a]}})));var N,C,P=(0,o.defineComponent)({components:{singleTrees:n.Z},setup(e,t){const a=(0,o.ref)(null),r=$(),s=(0,o.ref)(),n=(0,o.reactive)({step:1,cleanText:"取消",okText:"下一步",clean:()=>{2===n.step?(n.step=1,n.okText="下一步",n.cleanText="取消"):t.emit("close")},submit:()=>{1===n.step?Promise.resolve().then((()=>new Promise(((e,t)=>{a.value?.validate((a=>{a?e(a):t()}))})))).then((()=>{const e=f()(r.start_date),t=f()(r.end_date);if(t.isBefore(e))throw new Error("结束时间不能小于开始时间");const a=[];while(!e.isAfter(t)){let t=r.estimated_data_list.shift();void 0===t?t={date:e.clone(),gmv:"",income:"",cost:""}:t.date=e.clone(),e.add(1,"months"),a.push(t)}r.estimated_data_list=a})).then((()=>{n.step=2,n.okText="提交",n.cleanText="上一步"})).catch((e=>{i.Message.error(e.message)})):Promise.resolve().then((()=>new Promise(((e,t)=>{a.value?.validate((a=>{a?e(a):t()}))})).then((async()=>{await r.submit(),t.emit("close"),t.emit("submit")}))))}}),l=e=>{e&&e.estimated_data_list&&r.edit(e)};return{show:l,artForm:r,formRef:a,treeRef:s,steps:n}},render(){const e=arguments[0],t=this.artForm;return e("div",{class:"dialog-import"},[1===this.steps.step&&e("div",{class:"header-title"},[e("tg-icon",{attrs:{name:"ico-warn"}}),"创建项目流程：1、客户管理中创建客户公司、店铺、品牌信息；2、发起项目立项审批；3、审批通过后系统自动创建项目。"]),e("div",{class:"content"},[1===this.steps.step&&e("div",{class:"artificial"},[e("head-lines",{style:"margin: 10px 0px 15px 0px",attrs:{title:"项目信息"}}),e("el-form",s()([{ref:"formRef",attrs:{"label-width":"70px","label-position":"top",size:"small","hide-required-asterisk":!0}},{attrs:{model:t}}]),[e("div",{class:"artificial-item"},[e("el-form-item",{attrs:{label:"公司名称",prop:"project_name",rules:{required:!0,message:"请选择公司名称",trigger:["blur"]}}},[e("el-select",{style:"width:100%",attrs:{"remote-method":t.getAllCompanyName,filterable:!0,remote:!0,placeholder:"请选择"},on:{change:t.onChangeCompany},model:{value:t.company_id,callback:e=>{this.$set(t,"company_id",e)}}},[A(t.company_id_options,"company_name","id")])]),e("el-form-item",{attrs:{label:"项目名称",prop:"project_name",rules:{required:!0,message:"请填写项目名称",trigger:["blur"]}}},[e("el-input",{style:"width:100%",attrs:{placeholder:"请输入项目名称"},model:{value:t.project_name,callback:e=>{this.$set(t,"project_name",e)}}})]),e("el-form-item",{attrs:{label:"店铺名称",prop:"company_shop_id",rules:{required:!0,message:"请选择",trigger:["blur"]}}},[e("el-select",{style:"width:100%",attrs:{placeholder:"请选择",disabled:!t.company_id},on:{change:t.onChangeShop},model:{value:t.company_shop_id,callback:e=>{this.$set(t,"company_shop_id",e)}}},[A(t.company_shop_id_options,"shop_name","shop_id")])]),e("el-form-item",{attrs:{label:"店铺类目",prop:"new_shop_cateogry_name",rules:{required:!0,message:"请填写店铺类目",trigger:["blur"]}}},[e("el-input",{attrs:{disabled:!0},style:"width:100%",model:{value:t.new_shop_cateogry_name,callback:e=>{this.$set(t,"new_shop_cateogry_name",e)}}})]),e("el-form-item",{attrs:{label:"开始时间",prop:"start_date",rules:{required:!0,message:"请选择开始时间",trigger:["blur"]}}},[e("el-date-picker",{attrs:{placeholder:"请选择"},style:"width:100%",model:{value:t.start_date,callback:e=>{this.$set(t,"start_date",e)}}})]),e("el-form-item",{attrs:{label:"结束时间",prop:"end_date",rules:{required:!0,message:"请选择开始时间",trigger:["blur"]}}},[e("el-date-picker",{attrs:{placeholder:"请选择"},style:"width:100%",model:{value:t.end_date,callback:e=>{this.$set(t,"end_date",e)}}})]),e("el-form-item",{attrs:{label:"结算周期",prop:"settlement_cycle_type",rules:{required:!0,message:"请选择",trigger:["blur"]}}},[e("el-select",{style:"width:100%",attrs:{placeholder:"请选择"},model:{value:t.settlement_cycle_type,callback:e=>{this.$set(t,"settlement_cycle_type",e)}}},[A(x)])]),e("el-form-item",{attrs:{label:"客户经理",prop:"customer_manager_id",rules:{required:!0,message:"请输入客户经理花名",trigger:["blur"]}}},[e("el-select",{style:"width:100%",attrs:{placeholder:"请输入客户经理花名",filterable:!0},model:{value:t.customer_manager_id,callback:e=>{this.$set(t,"customer_manager_id",e)}}},[A(t.customer_manager_id_options,"username","id")])]),e("el-form-item",{attrs:{label:"项目经理",prop:"project_manager_id",rules:{required:!0,message:"请输入客户经理花名",trigger:["blur"]}}},[e("el-select",{style:"width:100%",attrs:{placeholder:"请输入项目经理花名"},model:{value:t.project_manager_id,callback:e=>{this.$set(t,"project_manager_id",e)}}},[A(t.project_manager_id_options,"username","id")])]),e("el-form-item",{attrs:{label:"所属部门",prop:"feishu_department_id",rules:{required:!0,message:"请选择归属部门",trigger:"change"}}},[e("el-popover",{attrs:{placement:"top",trigger:"click","popper-class":"live-project-addproject-popper","popper-options":{boundariesElement:"body"}},model:{value:t.feishu_department_id_show,callback:e=>{this.$set(t,"feishu_department_id_show",e)}}},[e("el-input",{attrs:{placeholder:"请选择",readonly:!0,value:t.feishu_department_id_input},slot:"reference"},[e("template",{slot:"suffix"},[e("i",{class:"select-icon select-icon-user-add el-icon-arrow-down"})])]),e("el-tree",{attrs:{"show-checkbox":!0,"check-strictly":!0,"node-key":"id",data:t.feishu_department_id_list,"default-checked-keys":t.default_checked_keys},ref:"treeRef",on:{check:e=>{this.treeRef.setCheckedKeys([]),this.treeRef.setCheckedKeys([e.department_id]),t.feishu_department_id=e.id,t.feishu_department_id_input=e.name,t.feishu_department_id_show=!1,t.feishu_department_level=e.level}},props:{props:{label:"name",children:"sons"}}})])])])])]),2===this.steps.step&&e("div",{class:"artificial"},[e("head-lines",{style:"margin: 10px 0px 15px 0px",attrs:{title:"项目预估数据"}}),e("el-form",s()([{ref:"formRef",attrs:{"label-width":"70px","label-position":"top",size:"small","hide-required-asterisk":!0}},{attrs:{model:t}}]),[e("div",{class:"artificial-item"},[t.estimated_data_list.map(((t,a)=>{const r=f()(t.date),s=r.month()+1,o=r.year();return e("fragments",[e("el-form-item",{attrs:{label:`${o}年${s}月GMV (万)`,prop:`estimated_data_list.${a}.gmv`,rules:{required:!0,message:"请填写GMV",trigger:["blur"]}}},[e("el-input",{style:"width:100%",attrs:{placeholder:"请输入",maxLength:12},on:{input:e=>{t.gmv=v.Z.IntergerAndDecimals(e)}},model:{value:t.gmv,callback:e=>{this.$set(t,"gmv",e)}}})]),e("el-form-item",{attrs:{label:`${o}年${s}月营收 (万)`,prop:`estimated_data_list.${a}.income`,rules:{required:!0,message:"请填写营收",trigger:["blur"]}}},[e("el-input",{style:"width:100%",attrs:{placeholder:"请输入",maxLength:12},on:{input:e=>{t.income=v.Z.IntergerAndDecimals(e)}},model:{value:t.income,callback:e=>{this.$set(t,"income",e)}}})]),e("el-form-item",{attrs:{label:`${o}年${s}月成本费用 (万)`,prop:`estimated_data_list.${a}.cost`,rules:{required:!0,message:"请填写成本费用",trigger:["blur"]}}},[e("el-input",{style:"width:100%",attrs:{placeholder:"请输入",maxLength:12},on:{input:e=>{t.cost=v.Z.IntergerAndDecimals(e)}},model:{value:t.cost,callback:e=>{this.$set(t,"cost",e)}}})])])}))]),e("div",{class:"summation"},[e("div",[e("span",["总GMV∶"]),e("span",[t.totalSum.gmv])]),e("div",[e("span",["总营收∶"]),e("span",[t.totalSum.income])]),e("div",[e("span",["总成本费用∶"]),e("span",[t.totalSum.cost])]),e("div",[e("span",["总利润∶"]),e("span",[t.totalSum.profit])])]),e("el-form-item",{attrs:{label:"备注",prop:"remark"}},[e("el-input",{attrs:{maxLength:100,placeholder:"限100字"},style:"width:100%",model:{value:t.remark,callback:e=>{this.$set(t,"remark",e)}}})]),e("el-form-item",{attrs:{label:"附件",prop:"attachment_url",rules:{required:!0,message:"请上传附件",trigger:["blur"]}}},[e("tg-upload",{attrs:{"show-file-list":!1,action:"/api/resources/upload_file",data:{type:"settlement"},beforeUpload:_.Z.ValidationFileUpload({excel:!0,fileSize:10,doc:!0,pdf:!0}),success:e=>{e.success?t.attachment_url=[e.data.source]:i.Message.error(e.message)}},style:"margin-bottom:16px"},[e("tg-button",{attrs:{icon:"ico-upload-lite"}},["上传文件"])]),e("upload-file-list",{model:{value:t.attachment_url,callback:e=>{this.$set(t,"attachment_url",e)}}})])])])]),e("div",{class:"footer"},[e("tg-button",{on:{click:this.steps.clean}},[this.steps.cleanText]),e("tg-button",{on:{click:this.steps.submit},attrs:{type:"primary"}},[this.steps.okText])])])}}),T=P,F=a(1001),M=(0,F.Z)(T,N,C,!1,null,"859c5360",null),Y=M.exports},87939:function(e,t,a){var r,s;a.d(t,{_:function(){return r},o:function(){return s}}),function(e){e[e["Marketing"]=1]="Marketing",e[e["Taobao"]=2]="Taobao",e[e["Douyin"]=3]="Douyin",e[e["Base"]=4]="Base",e[e["Mcn"]=5]="Mcn",e[e["Area"]=6]="Area"}(r||(r={})),function(e){e[e["Summary"]=0]="Summary",e[e["Gmv"]=1]="Gmv",e[e["LiveDuration"]=2]="LiveDuration",e[e["GmvPercent"]=3]="GmvPercent",e[e["OperatingAmount"]=4]="OperatingAmount",e[e["CommissionAmount"]=5]="CommissionAmount",e[e["Roi"]=6]="Roi",e[e["AnchorCount"]=7]="AnchorCount",e[e["PromoteAmountTop"]=8]="PromoteAmountTop",e[e["NetSalesAmount"]=9]="NetSalesAmount",e[e["IncomeAmount"]=10]="IncomeAmount",e[e["AvgStay"]=11]="AvgStay",e[e["PromoteAmount"]=12]="PromoteAmount",e[e["IncomeAmountPercent"]=13]="IncomeAmountPercent",e[e["LiveCount"]=14]="LiveCount",e[e["MaxUv"]=15]="MaxUv",e[e["NewFansCount"]=16]="NewFansCount"}(s||(s={}))},45781:function(e,t,a){var r=a(49187),s=a(8581),o=a(61282);const n=new r.ZP;t["Z"]={formatEmpty(e,t){return null===e||void 0===e||""===e||e instanceof Array&&e.length<=0?"--":void 0!==t?`${e}${t}`:e},formatTime(e){try{return null===e||void 0===e||""===e?"--":e.replace(/-/g,".")}catch(t){return e}},formatTimespan(e){try{if(null===e||void 0===e||""===e)return"--";const t=new Date;return t.setTime(1e3*e),(0,s.WU)(t,"YYYY.mm.dd")}catch(t){return e}},formatPrice(e,t=r.WL.Fen,a=!0){try{if(null===e||void 0===e||""===e)return"--";const r=n.format(n.parse(e,t));return a?`￥${r}`:r}catch(s){return e}},formatPriceFormYuan(e,t=2,a=!0){try{if(null===e||void 0===e||""===e)return"--";let r=e;return r=e>1e8?(e/1e8).toFixed(t)+"亿":e>1e4?(e/1e4).toFixed(t)+"w":(e-0).toFixed(t),a&&(r=`￥${r}`),r}catch(r){return e}},formatPriceToThousand(e,t=2,a=!0,r=!1){try{if(null===e||void 0===e||""===e)return"--";let s=e;return e>1e4?s=(e/1e4).toFixed(t)+"w":(s=(e-0).toFixed(t),r&&(s=(e-0).toFixed(0))),a&&(s=`￥${s}`),s}catch(s){return e}},formatPriceToThousandformatAmount(e,t=2,a=!0,r=!1){try{if(null===e||void 0===e||""===e)return"--";let s=e;return e>1e4?s=(0,o.dN)((e/1e4).toFixed(2),"None")+"w":(s=(0,o.dN)((e-0).toFixed(t),"None",0===t),r&&(s=(e-0).toFixed(0))),a&&(s=`￥${s}`),s}catch(s){return e}},tranNumber(e,t=2){if(null===e||void 0===e||""===e)return"--";if(!(e>=0))return e||"-";e+="";const a=e.toString(),r=a.split(".")[0],s=r.length;if(s<5)return a;if(s>8){const e=r.substring(r.length-8,r.length-8+t);return parseFloat(parseInt(r/1e8+"",10)+"."+e)+"亿"}if(s>4){const e=r.substring(r.length-4,r.length-4+t);return parseFloat(parseInt(r/1e4+"",10)+"."+e)+"w"}}}},88721:function(e,t,a){var r=a(41572);a(97434);const s={IntergerAndDecimals(e){const t=/(\d+)$|\d+\.?\d{0,2}/.exec(e);return t?t[0]:""},Interger(e){return e.replace(/[^\d]/g,"")},NumberRange(e,t){return a=>{const r=this.IntergerAndDecimals(a);if(""===r)return r;const s=Number(r);return s<e?e+"":s>t?t+"":r}},Thousands(e){if(null===e||void 0===e||""===e)return e;e+="";const t=/^(\d+)(\.\d+$)?$/.exec(e+"");if(!t)return e;const a=t[1],r=t[2];let s=a.replace(/(\d{1,3})(?=(\d{3})+$)/g,(e=>`${e},`));return void 0!==r&&(s=`${s}${r}`),s},NineIntergerAndDecimals(e){const t=(/(?:0|[1-9]\d{0,8})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(r.Pj,""))??[""])[0];return t}};t["Z"]=s},67910:function(e,t,a){a.d(t,{P6:function(){return l},zY:function(){return i}});var r=a(97434),s=a(61282),o=a(85937),n=a.n(o);const i=(e,t,a,o=20)=>(0,r.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,s.QN)(a(e,!0)))),(0,s.QN)(t)))+o+6)),l=(e,t=!0)=>{let a;return a=""===e||void 0===e?"--":(0,s.SJ)(new(n())(e??0)),t?(0,r.h)("span",[`￥${a}`]):(0,r.h)("span",[`${a}`])}}}]);