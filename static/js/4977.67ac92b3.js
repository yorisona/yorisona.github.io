"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[4977],{90144:function(e,t,a){a.r(t),a.d(t,{default:function(){return N}});var s,r,l,n,i=a(36568),o=a.n(i),m=a(97434),u=a(21495),c=a(59563),p=a(70437),d=a(15681),f=a(1763),g=a(23624),_=a(44928),v=a(43773),b=a(2906),k=a(48606),y=a(64236),x=(0,m.defineComponent)({setup(e,t){const a=(0,m.ref)({}),s=e=>{a.value=e},r=(0,m.ref)(),l=(0,c.Q)(g.JP,{manual:!0});(0,g.n5)().then((e=>{e.data.success&&(r.value=e.data.data[0])}));const n=(0,m.computed)((()=>{let e="";const t=r.value?.config_list||[];if(0===t.length)return e;if((0,y.xb)(i.value.score))return e;const a=Number(i.value?.score);for(let s=0;s<t.length;s++){const r=t[s];if(a>r.gt_score&&a<=r.lte_score){e=r.name;break}}return e})),i=(0,m.ref)({}),o=async()=>{u.value?.validate(((e,s)=>{if(!e){const e=s[Object.keys(s)[0]];return void k.Message.error(e[0].message)}if((0,y.xb)(n.value))return void k.Message.error("分数没有匹配到等级");const r={};r.score=i.value.score,r.level=n.value,r.remark=i.value.remark,r.assessment_detail_id=a.value.id,l.runAsync(r).then((()=>{k.Message.success("调整成功"),t.emit("submit"),t.emit("close")}))}))},u=(0,m.ref)();return{onSaveBtnClick:o,show:s,formData:i,formRef:u,assessmentInfo:a,scoreRange:r,level:n}},render(){const e=arguments[0],{formData:t,assessmentInfo:a}=this;return e("div",{class:"dialog-container"},[e("el-form",o()([{attrs:{size:"small","show-message":!1},ref:"formRef"},{attrs:{model:t}}]),[e("div",{class:"level-info"},[e("span",[e("span",{class:"label"},["考核名称："]),a.assessment_management_name]),e("span",[e("span",{class:"label"},["员工姓名："]),a.username,"（",a.real_name,"）"])]),e("div",{class:"revise-box"},[e("div",{class:"th"},[e("div"),e("div",["分数"]),e("div",["等级"])]),e("div",[e("div",["调整前"]),e("div",[a.result]),e("div",[a.level])]),e("div",[e("div",["调整后"]),e("div",[e("div",{class:"input-box"},[e("el-form-item",{attrs:{prop:"score",rules:{required:!0,message:"请输入分数",trigger:["change"]}}},[e("el-input",{attrs:{placeholder:"请输入分数"},model:{value:t.score,callback:e=>{this.$set(t,"score",e)}}})])])]),e("div",[e("div",{class:"input-box"},[e("el-form-item",[e("el-input",{attrs:{disabled:!0,value:this.level}})])])])])]),e("el-form-item",{attrs:{label:"调整说明",prop:"remark",rules:{required:!0,message:"请输入调整说明",trigger:["change"]}}},[e("el-input",{attrs:{placeholder:"请输入调整说明",type:"textarea"},model:{value:t.remark,callback:e=>{this.$set(t,"remark",e)}}})])])])}}),w=x,D=a(1001),R=(0,D.Z)(w,s,r,!1,null,"63d3d6b7",null),C=R.exports,L=a(31165),q=a(3293),Z=a(21757),S=(0,m.defineComponent)({setup:()=>{const e=(0,_.t)(),t=(0,Z.gI)(),a=Number(e.currentRoute.params.id),s=[{label:"花名",align:"left",prop:"username"},{label:"真名",align:"left",prop:"real_name"},{label:"部门",align:"left",formatter:e=>e.department_name},{label:"考评组",align:"left",prop:"evaluation_group_name"},{label:"当前节点",align:"left",prop:"department_name",formatter:e=>d.Kg.get(e.present_stage)},{label:"待办人员",align:"center",formatter:e=>e.present_person.username},{label:"考核结果",align:"center",prop:"result"},{align:"center",label:"绩效等级",prop:"level"},{label:"操作",minWidth:120,align:"left",formatter:s=>h("div",[h("tg-button",{attrs:{type:"link"},on:{click:()=>{e.push({name:f.Gr.assessment.manage.detailDetail,params:{id:a,userid:s.id}})}}},["查看"]),t.assessment_management_result&&h("tg-button",{attrs:{type:"link",disabled:Number(s.present_stage||null)<d.__.SIGNATURE},class:"mgl-12",on:{click:async()=>{o.show(s)}}},["调整考核结果和等级"])])}],r=(0,m.ref)({feishu_department_id_list:[],department_id_input:"",assessment_management_id:a}),l=(0,m.computed)((()=>{const e={...r.value};return e.stage&&(e.stage=e.stage.join(",")),e})),n=(0,c.h)(g.g,{defaultParams:[{page_num:1,num:20},r.value]}),i=(0,v.R)({title:"发起考核",component:b.Z,width:"700px"}),o=(0,v.R)({component:C,title:"调整考核结果和等级",width:"463px",on:{submit(){n.reload()}}}),u=(0,v.R)({component:L.Z,title:"发起评分",width:"600px",okText:"确定",on:{submit(){n.reload()}}}),p={reset(){r.value={department_id_input:"",feishu_department_id_list:[]}}},k=(0,c.h)(g.g,{defaultParams:[{page_num:1,num:20},r.value],transform(e){return e.evaluation_group_name_list.map((e=>({label:e.name,value:e.id})))}}),y=(0,c.Q)(q.o1,{transform(e){return e.data}}),x=(0,m.ref)(),w=(e,t)=>(t.push(e.id),e.sons?.forEach((e=>w(e,t))),t.join(","));return{formData:r,config:p,columns:s,reqList:n,dialogLauch:i,dialogSetLevel:o,dialogLaunchScore:u,assessment_management_id:a,groupOptions:k,reqFeishuDep:y,treeRef:x,eachDemp:w,permission:t,formDataC:l}},render(){const e=arguments[0],{formData:t,config:a,permission:s,formDataC:r}=this;return e(u.L,{attrs:{columns:this.columns,service:this.reqList,value:r,config:a,routes:[{title:"考核管理",name:f.Gr.assessment.manage.list},{title:"考核详情"}]}},[e("el-form-item",{attrs:{label:"员工花名："}},[e("el-input",{attrs:{placeholder:"请填写"},model:{value:t.username,callback:e=>{this.$set(t,"username",e)}}})]),e("el-form-item",{attrs:{label:"考核部门："}},[e("el-popover",{attrs:{placement:"bottom-start",trigger:"click","popper-class":"marketing-department-tree-popper-class"}},[e("div",{slot:"reference",class:"repain-select",style:"display: block"},[e("el-input",{attrs:{value:this.formData.department_id_input,placeholder:"请选择项目所属部门",readonly:!0},style:"color: #999",class:"department-input"},[e("i",{class:"select-icon select-icon-user-add el-icon-arrow-down",slot:"suffix"})])]),e("div",{class:"department-tree"},[e("el-tree",o()([{ref:"treeRef"},{props:{props:{label:"name",children:"sons"}}},{attrs:{"check-strictly":"true","node-key":"id",data:this.reqFeishuDep.data,"show-checkbox":!0},on:{check:e=>{this.treeRef?.setCheckedKeys([]),e.name!==t.department_id_input?(this.treeRef?.setCheckedKeys([e.id]),(0,m.set)(t,"department_id_input",e.name),(0,m.set)(t,"feishu_department_id_list",this.eachDemp(e,[]))):((0,m.set)(t,"department_id_input",""),(0,m.set)(t,"feishu_department_id_list",[]))}}}]))])])]),e("el-form-item",{attrs:{label:"考评组："}},[e(p.Z,{attrs:{options:this.groupOptions.data,filterable:!0},model:{value:t.evaluation_group_id,callback:e=>{this.$set(t,"evaluation_group_id",e)}}})]),e("el-form-item",{attrs:{label:"考核阶段："}},[e(p.Z,{attrs:{options:d.Tp,multiple:!0,"collapse-tags":!0},model:{value:t.stage,callback:e=>{this.$set(t,"stage",e)}}})]),s.assessment_management_score&&e("div",{slot:"btnLine",class:"btns-line"},[e("tg-button",{attrs:{type:"primary",size:"small"},on:{click:()=>{this.dialogLaunchScore.show(this.assessment_management_id)}}},["发起评分"])])])}}),$=S,I=(0,D.Z)($,l,n,!1,null,"03e140ea",null),N=I.exports}}]);