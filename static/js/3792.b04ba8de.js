"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[3792],{23792:function(e,t,a){a.r(t),a.d(t,{default:function(){return j}});var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-public-studio-page"},[a("tg-card",{staticClass:"flex-none",attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[a("el-form",{attrs:{size:"small","show-message":!1,"label-width":"85px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("div",{staticClass:"filter-form-div"},[a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{label:"标签组名称："}},[a("el-input",{staticClass:"input",attrs:{placeholder:"请输入标签组名称"},model:{value:e.queryForm.keyword,callback:function(t){e.$set(e.queryForm,"keyword",t)},expression:"queryForm.keyword"}})],1)],1),a("div",{staticClass:"filter-form-item single"},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"filter-form-item-btn"},[a("tg-button",{attrs:{type:"primary"},on:{click:e.onQuerySearchClick}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.onQueryResetClick}},[e._v("重置")])],1)])],1)])])],1),a("tg-card",e._b({staticClass:"mgt-12 flex-auto",attrs:{padding:[12,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[e.Permission.canEdit?a("div",{staticClass:"btns-line"},[a("tg-button",{staticClass:"mgb-12",attrs:{type:"primary",icon:"ico-btn-add"},on:{click:function(t){return e.toggleAddTagModalVisible(!0)}}},[e._v(" 新增标签组 ")])],1):e._e(),e.Permission.canViewList?a("el-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",data:e.list},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"没有查询到该标签组"}})]},proxy:!0}],null,!1,2968240514)},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,n){return a("el-table-column",e._b({key:n},"el-table-column",t,!1))})),1):e._e(),!e.loading&&e.total>0&&e.Permission.canViewList?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.queryForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.queryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.queryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.queryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}}):e._e()],1),a("AddTag",{attrs:{tagsRoleList:e.tagsRoleList,visible:e.AddTagVisible,tag:e.currentTag},on:{"dialog:close":e.onAddTagModalClose}})],1)},l=[],s=a(97434),r=a(64236),i=a(76012);const o="/api/tag_manage/list_tag_groups",u="/api/tag_manage/list_tag_group_roles",c="/api/tag_manage/save_tag_group",d="/api/tag_manage/tag_group_detail",g="/api/tag_manage/delete_tag_group",m=async e=>(0,i.dX)(o,{params:{...(0,r.jG)(e)}}),p=()=>(0,i.dX)(u),v=async e=>(0,i.SO)(c,{...(0,r.jG)(e)}),f=e=>(0,i.dX)(d+e),h=async e=>(0,i.SO)(g,{...(0,r.jG)({id:e})});var y=a(82741),_=a(78902),b=a(21757),C=a(61282),k=a(67910);const w=e=>{const t=(0,s.computed)((()=>{const e=(0,b.kG)(_.HN.tag_role_read),t=(0,b.kG)(_.HN.tag_role_update),a=(0,b.kG)(_.HN.tag_role_delete);return{canEdit:t,canViewList:e,canDelete:a}})),a=(0,s.ref)(!1),n=(0,s.ref)(!1),l=(0,s.ref)(void 0),i=(0,s.ref)([]),o=(e=!1)=>{a.value=e},u=(0,s.ref)([]),c=(0,s.ref)(0),d=(0,s.ref)({}),g=async t=>{d.value=t,n.value=!0;const[{data:a}]=await(0,r.Dc)(500,m(t));n.value=!1,a.success?(u.value=a.data.data,c.value=a.data.total):(u.value=[],c.value=0,e.root.$message({type:"warning",message:a.message??"查询失败，稍后重试",duration:2e3,showClose:!0}))},v=e=>{l.value=e,o(!0)},f=(e,t,a)=>{const n=e[t]||"--",{is_folded:l,folded_text:r}=(0,C.zb)(n,12);return a?r:l?(0,s.h)("el-popover",{props:{placement:"right",trigger:"hover",content:n}},[(0,s.h)("span",{slot:"reference"},[r])]):r},w=(e,t)=>f(e,"name",t),x=(0,k.zY)(u,"账号名称",w),F=e=>e.roles.join("、"),N=(0,k.zY)(u,"账号名称",F),T=(0,s.ref)([{label:"序号",type:"index",width:52},{label:"标签组名称",property:"name",minWidth:x.value,formatter:e=>w(e,!1)},{label:"标签数量",property:"tags_count",align:"center",minWidth:86},{label:"标签组权限",minWidth:N.value+10,formatter:F},{label:"创建人",property:"creator_name",align:"center",minWidth:80},{label:"创建时间",align:"center",property:"gmt_created",minWidth:178},{label:"操作",width:92,align:"left",headerAlign:"left",formatter:a=>{const n=[];return t.value.canEdit&&n.push((0,s.h)("a",{on:{click:()=>v(a)}},["编辑"])),t.value.canDelete&&n.push((0,s.h)("a",{on:{click:()=>H(e,a)}},["删除"])),(0,s.h)("div",{class:"operation"},n)}}]),H=async(e,t)=>{const a=await(0,y.I)(e,{title:"确认删除该标签组？",content:"删除之后该标签组内的所有标签都会删除，已经打标的商品对应的该标签也会删除。"});if(a){const[{data:a}]=await(0,r.Dc)(500,h(t.id));a.success?(e.root.$message.success("删除成功"),await g({...d,page_num:1,num:20})):e.root.$message({type:"warning",message:a.message??"删除失败，稍后重试",duration:2e3,showClose:!0})}},R=async()=>{const[{data:e}]=await(0,r.Dc)(500,p());e.success&&(i.value=e.data)};return{currentTag:l,list:u,total:c,columns:T,toggleAddTagModalVisible:o,AddTagVisible:a,tagsRole:R,tagsRoleList:i,loading:n,loadData:g}};var x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"customer-dialog tag-form-modal tg-dialog-vcenter",attrs:{visible:e.visible,"close-on-click-modal":!1,"close-on-press-escape":!1,width:"1086px",center:""},on:{close:e.onCancelBtnClick},scopedSlots:e._u([{key:"title",fn:function(){return[a("span",[e._v(e._s(e.formTitle))])]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.onCancelBtnClick}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.onSaveBtnClick}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"dialog-content"},[a("el-form",{ref:"formRef",staticStyle:{margin:"0 24px"},attrs:{rules:e.tagsFormRules,model:e.tagForm,"label-width":"92px","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"sssss-form-item",attrs:{label:"标签组名称",prop:"name"}},[a("el-input",{ref:"autoFocuseRef",staticStyle:{width:"300px"},attrs:{size:"small",maxlength:20,placeholder:"请输入标签组名称(最多20字)"},on:{input:e.tagNameHandler},model:{value:e.tagForm.name,callback:function(t){e.$set(e.tagForm,"name","string"===typeof t?t.trim():t)},expression:"tagForm.name"}})],1),a("el-form-item",{staticClass:"checkbox-form-item",attrs:{label:"标签组权限",prop:"roles"}},[a("el-checkbox-group",{model:{value:e.tagForm.roles,callback:function(t){e.$set(e.tagForm,"roles",t)},expression:"tagForm.roles"}},e._l(e.tagsRoleList,(function(t,n){return a("el-checkbox",{key:n,staticClass:"studio-checkbox",attrs:{label:t.value}},[e._v(e._s(t.name))])})),1)],1)],1),a("div",{staticClass:"tag-list"},[a("div",{staticClass:"title"},[a("span",[e._v("标签")]),a("span",[e._v("（最多添加100个标签）")])]),a("div",{staticClass:"alert"},[a("i",{staticClass:"el-icon-warning"}),a("span",{staticClass:"msg"},[e._v(" 鼠标hover标签可对其进行修改、删除操作，修改后，已经打标的商品对应的该标签名称也会修改 ")])]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tagLoading,expression:"tagLoading"}],staticClass:"main"},[a("div",{staticClass:"input"},[a("el-input",{staticStyle:{width:"368px"},attrs:{placeholder:"请输入标签（10个字以内）",size:"small",maxLength:10},on:{input:e.singleTagNameHandler},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addHandler.apply(null,arguments)}},scopedSlots:e._u([{key:"append",fn:function(){return[a("el-button",{staticClass:"add",attrs:{disabled:e.tagForm.tags.length>=100},on:{click:e.addHandler}},[e._v(" 新增 ")])]},proxy:!0}]),model:{value:e.currentTagName,callback:function(t){e.currentTagName="string"===typeof t?t.trim():t},expression:"currentTagName"}})],1),e.tagForm.tags.length?a("div",{staticClass:"list"},e._l(e.tagForm.tags,(function(t,n){return a("tag-btn",{key:n,attrs:{tag:t,"tag-key":n},on:{delete:function(t){return e.deleteHandler(n)},change:e.changeHandler}})})),1):a("div",{staticClass:"empty"},[a("empty-common",{attrs:{"detial-text":"暂无标签"}})],1)])])],1)])},F=[],N=(a(26699),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"single-btn",on:{mouseenter:function(t){e.hoverFlag=!0},mouseleave:function(t){e.hoverFlag=!1}}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.editFlag&&!e.hoverFlag,expression:"!editFlag && !hoverFlag"}],staticClass:"default-tag"},[e._v(e._s(e.tag.name))]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.editFlag&&e.hoverFlag,expression:"!editFlag && hoverFlag"}],staticClass:"hover-tag"},[a("span",{staticClass:"icon el-icon-edit-outline",on:{click:e.editHandler}}),a("span",{staticClass:"icon el-icon-delete",on:{click:function(t){return t.stopPropagation(),e.deleteConfirm.apply(null,arguments)}}})]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.editFlag,expression:"editFlag"}],staticClass:"input-tag"},[a("el-input",{attrs:{size:"small",autofocus:"",placeholder:"请输入标签名称",maxLength:10},on:{blur:e.blurHandler},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.blurHandler.apply(null,arguments)}},model:{value:e.defaultName,callback:function(t){e.defaultName="string"===typeof t?t.trim():t},expression:"defaultName"}})],1)])}),T=[],H=(0,s.defineComponent)({name:"SingleBtn",props:{tag:{type:Object,required:!0},tagKey:{type:Number,default:0}},setup(e,t){const a=(0,s.ref)(!1),n=(0,s.ref)(!1),l=(0,s.ref)(""),r=async()=>{const e=await(0,y.I)(t,{title:"确认删除该标签吗？",content:"删除之后，已经打标的商品对应的该标签也会删除。"});e&&t.emit("delete")};return{hoverFlag:a,editFlag:n,deleteConfirm:r,defaultName:l}},methods:{blurHandler(){const e=this.$parent.$parent;this.defaultName&&this.defaultName!==this.tag.name&&(e.validateName(this.defaultName)?this.$emit("change",this.tagKey,this.defaultName):this.$message.error("该标签名称已存在")),this.defaultName="",this.editFlag=!1},editHandler(e){this.editFlag=!0,this.defaultName=this.tag.name,this.$nextTick((()=>{const t=e.target?.parentElement?.parentElement,a=t?.querySelectorAll("input.el-input__inner")[0];a?.focus()}))}}}),R=H,$=a(1001),S=(0,$.Z)(R,N,T,!1,null,"c6f85332",null),P=S.exports,q=a(53451),E=a.n(q);const{debounce:L}=E();var z=(0,s.defineComponent)({name:"AddStudio",components:{tagBtn:P},props:{visible:{type:Boolean,required:!0},tag:{type:Object,required:!1},tagsRoleList:{type:Array,required:!0}},setup(e,t){const a=(0,s.ref)(null),n=(0,s.ref)(void 0),l=(0,s.ref)("新增标签组"),i=(0,s.ref)(!1),o=()=>{t.emit("dialog:close"),d()},u=(e,t)=>{const a=c.value.tags;a[e].name=t},c=(0,s.ref)({roles:[1],tags:[],name:"",id:-1}),d=()=>{c.value.roles=[1],c.value.tags=[],c.value.id=-1,c.value.name="",g.value=""},g=(0,s.ref)(""),m=e=>{const t=c.value.tags?c.value.tags.map((e=>e.name)):[];return!t.includes(e)},p=()=>{g.value&&(m(g.value)?"undefined"!==typeof c.value.tags&&(c.value.tags.push({name:g.value,id:-1}),g.value=""):t.root.$message.error("该标签名称已存在"))},h=async e=>{i.value=!0;const[t,{data:a}]=await Promise.all([await(0,r._v)(500),await f("?id="+e)]);c.value.roles=a.data.roles,c.value.tags=a.data.tags,i.value=!1};(0,s.watch)((()=>e.visible),(t=>{a.value?.clearValidate(),t&&(l.value=void 0===e.tag?"新增标签组":"编辑标签组",void 0!==e.tag?(c.value.name=e.tag.name,c.value.id=e.tag.id,h(e.tag.id)):(0,s.nextTick)((()=>{n.value?.focus()})))}));const y=(0,s.ref)({name:[{required:!0,message:"请输入标签组名称",trigger:"blur"}],roles:[{required:!0,message:"请选择标签组权限",trigger:"change"}]}),_=async()=>{if(void 0===c?.value)return;const e=await new Promise((e=>a.value?.validate((t=>e(t)))));if(!e)return;const n={name:c.value.name,roles:c.value.roles,id:c.value.id||-1,tags:c.value.tags},{data:l}=await v(n);l.success?(t.root.$message.success(l.message),t.emit("dialog:close",!0),d()):t.root.$message.error(l.message??"直播间保存失败")},b=e=>{c.value.tags&&c.value.tags.splice(e,1)},C=L(_,200),k=e=>{c.value.name=e.replace(/\s/gi,"")},w=e=>{g.value=e.replace(/\s/gi,"")};return{autoFocuseRef:n,formTitle:l,singleTagNameHandler:w,formRef:a,tagsFormRules:y,tagForm:c,onSaveBtnClick:C,validateName:m,currentTagName:g,deleteHandler:b,changeHandler:u,addHandler:p,tagNameHandler:k,onCancelBtnClick:o,tagLoading:i}}}),A=z,B=(0,$.Z)(A,x,F,!1,null,null,null),D=B.exports,M=a(58302),O=(0,s.defineComponent)({name:"TgPublicTag",components:{AddTag:D},setup(e,t){const a=(0,s.ref)({keyword:"",page_num:1,num:20}),n=w(t),l=async(e=!0)=>{e&&(a.value.page_num=1);const t={page_num:a.value.page_num,num:a.value.num};a.value.keyword&&(t.keyword=a.value.keyword),await n.loadData(t)},r=()=>{l()},i=async e=>{n.currentTag.value=void 0,n.toggleAddTagModalVisible(),e&&await l()},o=()=>{a.value.keyword="",l()},u=e=>{a.value.page_num=e,l(!1)},c=e=>{a.value.num=e,l()},d=(0,s.computed)((()=>{const e=(0,b.kG)(_.HN.tag_role_read),t=(0,b.kG)(_.HN.tag_role_update),a=(0,b.kG)(_.HN.tag_role_delete);return{canEdit:t,canViewList:e,canDelete:a}})),g=32,m=34,p=36,v=31,f=(0,s.ref)(0),h=e=>{f.value=e.height},y=(0,M.Z)({compensation:(0,s.computed)((()=>g+m+p+v+(d.value.canEdit?-30:0))),fixedBlockHeightRefs:[f],tableMinHeight:100});return{reload:l,queryForm:a,Permission:d,onQueryResetClick:o,onQuerySearchClick:r,handleCurrentChange:u,handlePageSizeChange:c,onAddTagModalClose:i,...n,onTopCardRectUpdate:h,...y}},mounted(){this.queryTagList(),this.getTagRoles()},methods:{queryTagList(){this.reload()},getTagRoles(){this.tagsRole()}}}),V=O,G=(0,$.Z)(V,n,l,!1,null,null,null),j=G.exports},82741:function(e,t,a){a.d(t,{I:function(){return l},u:function(){return s}});var n=a(71340);const l=(e,t)=>{const a="string"===typeof t?{title:t}:t;return new Promise((t=>{e.root.$TDialog({...a,onConfirm:()=>t(!0),onCancel:()=>t(!1)})}))},s=e=>{const t="string"===typeof e?{title:e}:e;return new Promise(((e,a)=>{(0,n.t)({...t,onConfirm:()=>e(!0),onCancel:()=>a()})}))}},58302:function(e,t,a){var n=a(97434),l=a(77944),s=a(52140);const r=e=>{const t=(0,n.computed)((()=>l.Z.getters["global/scrollbarSetting"])),a=(0,n.computed)((()=>void 0!==e.pagename?!0!==t.value.find((t=>t.key===e.pagename))?.value:e.disable??!1)),r=(0,n.computed)((()=>{const t=(e.fixedBlockHeightRefs??[]).map((e=>(0,n.unref)(e))).reduce(((e,t)=>(0,n.unref)(e)+(0,n.unref)(t)),0);return a.value?"max-content":`calc(100vh - ${(0,n.unref)(t)+56+36}px)`})),i=(0,n.computed)((()=>(a.value,"flex-auto"))),o=(0,n.computed)((()=>({height:r.value,overflowInBody:!a.value}))),u=(0,n.ref)(0),c=(0,n.computed)((()=>a.value?{}:{height:Math.max(u.value-(0,n.unref)((0,n.unref)(e.compensation)),e.tableMinHeight??0)})),d=a.value?()=>{}:e=>{u.value!==e&&(u.value=e,(0,s.S)())},g=a.value?()=>{}:t=>{0===u.value?setTimeout((()=>{d(t.height)}),e.delay??1200):d(t.height)};return{cardHeight:r,tableProps:c,onRectUpdate:g,rectHeight:u,cardFlexClass:i,cardProps:o}};t["Z"]=r},52140:function(e,t,a){a.d(t,{S:function(){return n},n:function(){return l}});const n=()=>{const e=document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)},l=()=>{const{width:e,height:t}=document.body.getBoundingClientRect();return{width:e,height:t}}},67910:function(e,t,a){a.d(t,{P6:function(){return o},zY:function(){return i}});var n=a(97434),l=a(61282),s=a(85937),r=a.n(s);const i=(e,t,a,s=20)=>(0,n.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,l.QN)(a(e,!0)))),(0,l.QN)(t)))+s+6)),o=(e,t=!0)=>{let a;return a=""===e||void 0===e?"--":(0,l.SJ)(new(r())(e??0)),t?(0,n.h)("span",[`￥${a}`]):(0,n.h)("span",[`${a}`])}}}]);