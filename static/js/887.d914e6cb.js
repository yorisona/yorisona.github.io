"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[887],{85658:function(t,e,a){a.r(e),a.d(e,{default:function(){return O}});var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tg-live-display-detail-page"},[a("TgBreadcrumbs",{staticClass:"flex-none",attrs:{routes:t.routes}}),t.inProjectTeam?t._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.PermissionCheckLoading,expression:"PermissionCheckLoading"}],staticClass:"abnormal-empty",staticStyle:{background:"#fff"}},[a("div",{staticClass:"abnormal-empty-content"},[a("empty-common",{attrs:{"detial-text":void 0===t.inProjectTeam?"获取场次详情失败，请稍后重试":"暂无查看当前场次的权限"}})],1)]),t.inProjectTeam&&void 0!==t.displayInfo?a("div",{staticStyle:{height:"100%","flex-grow":"1",background:"white","overflow-y":"overlay","overflow-x":"auto"}},[a("div",{staticStyle:{"min-width":"1212px"}},[a("tg-block",{staticClass:"tg-live-display-info flex-none"},[a("div",{staticClass:"dis-display-title"},[a("div",{staticClass:"dis-display-title-left"},[a("tg-icon",{staticClass:"diaplay-icon",attrs:{name:t.business_icon(t.displayInfo.business_type)}}),a("span",[t._v(t._s(t.displayInfo.live_title))]),t.displayInfo.live_status?a("span",{class:t.statusClasses(t.displayInfo.live_status)},[t._v(t._s(t.liveStatus(t.displayInfo.live_status)))]):t._e()],1),t.displayInfo.project_uid?a("div",{staticClass:"dis-display-title-edit"},[a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[t.Permission.canEdit&&t.displayInfo.live_status!==t.LiveDisplayStatus.lived||t.Permission.canEditLived&&t.displayInfo.live_status===t.LiveDisplayStatus.lived?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:t.handleEditDisplayAction},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):t._e()],1),t.Permission.canEdit&&t.displayInfo.live_status!==t.LiveDisplayStatus.lived?a("span",{staticClass:"verLine"},[t._v("|")]):t._e(),a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"删除","popper-class":"tg-live-display-detail-custom-popover"}},[t.Permission.canEdit&&t.displayInfo.live_status!==t.LiveDisplayStatus.lived?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:t.handleDeleteDisplayAction},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-delete"}})],1):t._e()],1),t.Permission.canEdit&&t.displayInfo.live_status!==t.LiveDisplayStatus.lived?a("span",{staticClass:"verLine"},[t._v("|")]):t._e(),a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"关闭","popper-class":"tg-live-display-detail-custom-popover"}},[t.Permission.canEdit&&t.displayInfo.live_status!==t.LiveDisplayStatus.lived?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:t.handleCloseDisplayAction},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-power"}})],1):t._e()],1)],1):t._e()]),a("div",{staticClass:"display-datetime-info",staticStyle:{"margin-top":"-9px","font-size":"14px",color:"#6a7b92"}},[t._v(" 直播时间："+t._s(t.display_live_date_range_str)+" ")]),a("div",{staticClass:"div-display-info"},[a("div",{staticClass:"display-info-block",staticStyle:{width:"43.103%"}},[a("div",{staticClass:"display-info-block-header",staticStyle:{display:"flex",width:"auto"}},[a("div",{staticStyle:{"border-radius":"1px",height:"14px","margin-top":"2px","line-height":"18px",width:"3px","border-left":"3px solid rgba(40, 119, 255, 0.9)"}}),t._v(" 直播数据 "),t.isTaobaoDisplay?a("div",[0===t.TaobaoLiveLogs.length?a("div",{staticStyle:{color:"rgba(60, 82, 105, 0.4)"}},[t._v(" 未关联场次 ")]):a("div",{staticStyle:{color:"#2877ff"}},[a("el-popover",{attrs:{placement:"top",trigger:"hover","popper-class":"tg-live-display-detail-custom-popover"}},[a("div",t._l(t.TaobaoLiveLogs,(function(e,i){return a("div",{key:i,staticStyle:{"margin-bottom":"12px"}},[a("span",{staticStyle:{color:"#6a7b92"}},[t._v(t._s(e.title))]),t._v("  "),a("span",{staticStyle:{color:"#3c5269"}},[t._v(t._s(t.formDateRangeStr(e.start_time,e.end_time)))])])})),0),a("span",{staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},slot:"reference"},[t._v(" 已关联场次 ")])])],1)]):t._e()]),0!==t.TaobaoLiveLogs.length?a("div",{staticClass:"display-info-block-live-data",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("引导成交金额（万）")]),a("div",{staticStyle:{"font-size":"14px",color:"#3c5269"}},[t._v(" "+t._s(t.LiveStatData.promote_order_amount)+" ")])]),a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("引导成交件数")]),a("div",{staticStyle:{"font-size":"14px",color:"#3c5269"}},[t._v(" "+t._s(t.LiveStatData.promote_order_num)+" ")])]),a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("引导成交人数")]),a("div",{staticStyle:{"font-size":"14px",color:"#3c5269"}},[t._v(" "+t._s(t.LiveStatData.promote_order_person)+" ")])])]):a("div",{staticStyle:{width:"100%","text-align":"center","font-size":"14px",color:"#a4b2c2"}},[t.isTaobaoDisplay?a("div",{staticStyle:{"padding-top":"50px"}},[t._v("暂无数据")]):t._e(),t.isTaobaoDisplay||t.shopLiveStatistic?t._e():a("div",{staticStyle:{"font-size":"14px",color:"rgba(60, 82, 105, 0.4)","padding-top":"50px"}},[t._v(" 暂未获取场次数据 ")]),!t.isTaobaoDisplay&&t.shopLiveStatistic?a("div",{staticClass:"display-info-live-data-douyin-grid",staticStyle:{"font-size":"14px",color:"rgba(60, 82, 105, 0.4)",display:"grid"}},[a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("GMV")]),a("div",{staticClass:"item-value",class:"--"===t.formatNum(t.shopLiveStatistic.gmv,!0)?"":"price"},[t._v(" "+t._s(t.formatNum(t.shopLiveStatistic.gmv,!0))+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("曝光-进入率")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s("--"===t.formatNum(t.shopLiveStatistic.watch_cnt_show_ratio,!0,!0)?"--":t.formatNum(t.shopLiveStatistic.watch_cnt_show_ratio,!0,!0)+"%")+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("人均观看时长")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s("--"===t.formatNum(t.shopLiveStatistic.avg_watch_duration,!1)?"--":t.formatNum(t.shopLiveStatistic.avg_watch_duration,!1)+"秒")+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("分钟评论次数")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s(t.formatNum(t.shopLiveStatistic.avg_min_comment_cnt,!1))+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("千次观看转化")]),a("div",{staticClass:"item-value",class:"--"===t.formatNum(t.shopLiveStatistic.gpm,!0)?"":"price"},[t._v(" "+t._s(t.formatNum(t.shopLiveStatistic.gpm,!0))+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("观看成交转化率")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s("--"===t.formatNum(t.shopLiveStatistic.watch_pay_ucnt_ratio,!1,!0)?"--":t.formatNum(t.shopLiveStatistic.watch_pay_ucnt_ratio,!1,!0)+"%")+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("粉丝购买占比")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s("--"===t.formatNum(t.shopLiveStatistic.old_fans_pay_ucnt_ratio,!1,!0)?"--":t.formatNum(t.shopLiveStatistic.old_fans_pay_ucnt_ratio,!1,!0)+"%")+" ")])]),a("div",{staticClass:"display-info-live-data-douyin-grid-item"},[a("div",{staticClass:"item-label"},[t._v("成交人数")]),a("div",{staticClass:"item-value"},[t._v(" "+t._s(t.formatNum(t.shopLiveStatistic.pay_ucnt,!1))+" ")])])]):t._e()]),0!==t.TaobaoLiveLogs.length?a("div",{staticClass:"display-info-block-live-data"},[a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("引导成交转化率")]),a("div",{staticStyle:{"font-size":"14px",color:"#3c5269"}},[t._v(" "+t._s(t.LiveStatData.promote_order_conversion_rate)+" ")])]),a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("粉丝成交金额占比")]),a("div",{staticStyle:{"font-size":"14px",color:"#3c5269"}},[t._v(" "+t._s(t.LiveStatData.fans_order_amount_percent)+" ")])]),a("div",{staticClass:"display-info-data-block"},[a("div",{staticStyle:{"font-size":"12px",color:"#a4b2c2"}},[t._v("更多数据")]),a("div",{staticStyle:{cursor:"pointer","font-size":"14px",color:"#2877ff"}},[t.LiveStatData.view_link?a("a",{attrs:{href:t.LiveStatData.view_link,target:"_blank"}},[t._v("查看")]):t._e()])])]):t._e()]),a("div",{staticClass:"display-info-block",staticStyle:{width:"27.586%"}},[a("div",{staticClass:"display-info-block-header"},[a("div",{staticStyle:{"border-radius":"1px",height:"14px","margin-top":"2px","line-height":"18px",width:"3px","border-left":"3px solid rgba(40, 119, 255, 0.9)"}}),t._v(" 主播排班 "),a("el-popover",{staticStyle:{"margin-left":"8px"},attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditKOLSchedule&&!t.isAutoObtain?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(e){return t.handleEditDisplayScheduleAction("anchor")}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):t._e()],1)],1),a("div",{staticStyle:{"margin-top":"20px","margin-left":"27px","padding-right":"18px",color:"#3c5269","font-family":"PingFangSC-Regular","line-height":"18px",height:"110px",overflow:"auto"}},[t.kolScheduleList.length>0?a("div",t._l(t.kolScheduleList,(function(e,i){return a("div",{key:i,staticStyle:{"margin-bottom":"12px",display:"flex"}},[a("div",{staticStyle:{"min-width":"140px"}},[t._v(t._s(e.date_range_str))]),a("div",{staticStyle:{"min-width":"120px"}},[t._v(t._s(e.users_str))])])})),0):a("div",{staticStyle:{"margin-top":"30px",width:"100%","text-align":"center","font-size":"14px",color:"#a4b2c2"}},[t._v(" 暂无排班 ")])])]),a("div",{staticClass:"display-info-block",staticStyle:{width:"27.586%"}},[a("div",{staticClass:"display-info-block-header"},[a("div",{staticStyle:{"border-radius":"1px",height:"14px","margin-top":"2px","line-height":"18px",width:"3px","border-left":"3px solid rgba(40, 119, 255, 0.9)"}}),t._v(" 运营排班 "),a("el-popover",{staticStyle:{"margin-left":"8px"},attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditOperatorSchedule?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(e){return t.handleEditDisplayScheduleAction("assistant")}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):t._e()],1)],1),a("div",{staticStyle:{"margin-top":"20px","margin-left":"27px","padding-right":"18px",color:"#3c5269","font-family":"PingFangSC-Regular","line-height":"18px",height:"110px",overflow:"auto"}},[t.OperatorScheduleList.length>0?a("div",t._l(t.OperatorScheduleList,(function(e,i){return a("div",{key:i,staticStyle:{"margin-bottom":"12px",display:"flex"}},[a("div",{staticStyle:{"min-width":"140px"}},[t._v(t._s(e.date_range_str))]),a("div",{staticStyle:{"min-width":"120px"}},[t._v(t._s(e.users_str))])])})),0):a("div",{staticStyle:{"margin-top":"30px",width:"100%","text-align":"center","font-size":"14px",color:"#a4b2c2"}},[t._v(" 暂无排班 ")])])])])]),t.isTaobaoDisplay?a("tg-card",{staticClass:"pane-block mgt-18 flex-auto",staticStyle:{height:"calc(100% - 320px)"},attrs:{padding:[18,18,0,18]}},[a("div",[a("div",{staticClass:"live-record-info-block-header"},[a("div",{staticStyle:{display:"flex",height:"18px","margin-top":"7px"}},[a("div",{staticStyle:{"border-radius":"1px",height:"14px","margin-top":"3px","line-height":"18px",width:"3px","border-left":"3px solid rgba(40, 119, 255, 0.9)"}}),t._v(" 直播留档 ")]),t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{staticStyle:{"margin-left":"18px"},attrs:{type:"primary",icon:"ico-btn-add"},on:{click:t.AddLiveRecordHandler}},[t._v("留档信息")]):t._e()],1),t.Permission.canEditArchive&&0===t.ShopLiveRecordDataList.length?a("div",{staticStyle:{color:"#a4b2c2","font-size":"16px","text-align":"center","margin-top":"120px"}},[a("empty-common",{attrs:{"detial-text":"暂无留档信息"}})],1):t._e(),t.Permission.canEditArchive?t._e():a("div",{staticStyle:{color:"#a4b2c2","font-size":"16px","text-align":"center","margin-top":"120px"}},[a("empty-common",{attrs:{"detial-text":"暂无查看留档信息的权限"}})],1),t.Permission.canEditArchive?a("div",t._l(t.ShopLiveRecordDataList,(function(e,i){return a("div",{key:i,staticClass:"live-record-info-block"},[a("div",{staticClass:"live-record-info-data-block"},[a("div",{staticStyle:{display:"flex","margin-bottom":"12px"}},[a("div",{staticStyle:{width:"400px",display:"flex"}},[a("div",{staticClass:"label"},[t._v("录入人：")]),a("div",{staticClass:"data"},[t._v(t._s(e.live_data_add_by_username))])]),a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"label"},[t._v("录入时间：")]),a("div",{staticClass:"data"},[t._v(t._s(e.gmt_create))])])]),a("div",{staticStyle:{display:"flex","margin-bottom":"12px"}},[a("div",{staticStyle:{width:"400px",display:"flex"}},[a("div",{staticClass:"label"},[t._v("直播时间：")]),a("div",{staticClass:"data"},[t._v(" "+t._s(t.GetDateRangeStr(e.real_start_time,e.real_end_time))+" ")])]),a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"label"},[t._v("直播时长：")]),a("div",{staticClass:"data"},[t._v(t._s(e.real_duration)+" 小时")])])]),a("div",{staticStyle:{display:"flex","margin-bottom":"12px"}},[a("div",{staticClass:"label"},[t._v("直播链接：")]),a("div",{staticClass:"data",staticStyle:{color:"#2877ff"}},[a("a",{attrs:{href:"#",target:"_blank"}},[t._v(t._s(e.live_url))])])]),a("div",{staticStyle:{display:"flex","margin-bottom":"12px"}},[a("div",{staticClass:"label"},[t._v("直播时长截图：")]),e.duration_screenshot?a("div",{staticClass:"image-data",staticStyle:{width:"477px",height:"107px"}},[e.duration_screenshot?a("el-image",{staticClass:"avatar",staticStyle:{"max-height":"95px"},attrs:{src:e.duration_screenshot+"?Authorization="+t.JWToken,"preview-src-list":[e.data_screenshot+"?Authorization="+t.JWToken,e.duration_screenshot+"?Authorization="+t.JWToken]}}):t._e()],1):t._e()]),a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"label"},[t._v("直播数据截图：")]),e.data_screenshot?a("div",{staticClass:"image-data",staticStyle:{width:"656px",height:"112px"}},[e.data_screenshot?a("el-image",{staticClass:"avatar",staticStyle:{"max-height":"100px"},attrs:{src:e.data_screenshot+"?Authorization="+t.JWToken,"preview-src-list":[e.data_screenshot+"?Authorization="+t.JWToken,e.duration_screenshot+"?Authorization="+t.JWToken]}}):t._e()],1):t._e()])]),t.CanEditStatus&&t.Permission.canEditArchive?a("div",{staticClass:"live-record-info-edit-block taoabao-edit"},[a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(a){return t.handleUpdateDisplayInfoDataAction(e)}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):t._e()],1),t.CanEditStatus&&t.Permission.canEditArchive?a("span",{staticClass:"verLine"},[t._v("|")]):t._e(),a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"删除","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(a){return t.handleDeleteDisplayInfoDataAction(e.id)}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-delete"}})],1):t._e()],1)],1):t._e()])})),0):t._e()])]):a("tg-card",{staticClass:"pane-block flex-auto",staticStyle:{height:"calc(100% - 320px)","margin-top":"24px"},attrs:{padding:[0,18,0,18]}},[a("div",[a("div",{staticClass:"live-record-info-block-header"},[a("div",{staticStyle:{display:"flex",height:"18px","margin-top":"7px"}},[a("div",{staticStyle:{"border-radius":"1px",height:"14px","margin-top":"3px","line-height":"18px",width:"3px","border-left":"3px solid rgba(40, 119, 255, 0.9)"}}),t._v(" 直播留档 ")]),t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{staticStyle:{"margin-left":"18px"},attrs:{type:"primary"},on:{click:t.AddLiveRecordHandler}},[t._v("提交留档")]):t._e()],1),t.Permission.canEditArchive&&0===t.ShopLiveRecordDataList.length?a("div",{staticStyle:{color:"#a4b2c2","font-size":"16px","text-align":"center","margin-top":"120px"}},[a("empty-common",{attrs:{"detial-text":"暂无留档信息"}})],1):t._e(),t.Permission.canEditArchive?t._e():a("div",{staticStyle:{color:"#a4b2c2","font-size":"16px","text-align":"center","margin-top":"120px"}},[a("empty-common",{attrs:{"detial-text":"暂无查看留档信息的权限"}})],1),t.Permission.canEditArchive?a("div",t._l(t.ShopLiveRecordDataList,(function(e,i){return a("div",{key:i,staticClass:"live-record-info-block"},[a("div",{staticClass:"live-record-info-data-block"},[a("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[a("div",{staticStyle:{display:"grid","grid-template-columns":"repeat(4, auto)",width:"733px"}},[a("div",[a("span",{staticClass:"label"},[t._v("录入人：")]),a("span",{staticClass:"data"},[t._v(t._s(e.live_data_add_by_username))])]),a("div",[a("span",{staticClass:"label"},[t._v("录入时间：")]),a("span",{staticClass:"data"},[t._v(t._s(e.gmt_create))])]),a("div",[a("span",{staticClass:"label"},[t._v("直播时长：")]),a("span",{staticClass:"data"},[t._v(t._s(e.real_duration)+" 小时")])]),a("div",[a("span",{staticClass:"label"},[t._v("场次数据：")]),a("tg-button",{staticStyle:{color:"#2877ff"},attrs:{type:"link"},on:{click:function(){return t.onDownloadLiveData(e)}}},[t._v("下载")])],1)]),t.CanEditStatus&&t.Permission.canEditArchive?a("div",{staticClass:"live-record-info-edit-block"},[a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(a){return t.handleUpdateDisplayInfoDataAction(e)}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-edit"}})],1):t._e()],1),t.CanEditStatus&&t.Permission.canEditArchive?a("span",{staticClass:"verLine"},[t._v("|")]):t._e(),a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"删除","popper-class":"tg-live-display-detail-custom-popover"}},[t.CanEditStatus&&t.Permission.canEditArchive?a("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:function(a){return t.handleDeleteDisplayInfoDataAction(e.id)}},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-delete"}})],1):t._e()],1)],1):t._e()]),a("div",{staticStyle:{display:"flex","margin-top":"24px"}},[a("div",{staticClass:"label"},[t._v("直播留档截图：")]),e.duration_screenshot?a("div",{staticClass:"image-data",staticStyle:{"max-width":"1000px"}},[e.duration_screenshot?a("el-image",{staticClass:"avatar",attrs:{src:e.duration_screenshot+"?Authorization="+t.JWToken,"preview-src-list":[e.duration_screenshot+"?Authorization="+t.JWToken]}}):t._e()],1):t._e()])])])})),0):t._e()])]),a("liveDisplayAddDialog",{attrs:{title:"编辑场次",defaultDisplay:t.displayInfo,visible:t.shouldEditing},on:{succeed:t.handleSaveSucceedAction,closeAction:t.handleCloseAction}}),a("tg-mask-loading",{attrs:{visible:t.deleteLoading||t.closeLoading,content:t.deleteLoading?"  正在删除，请稍候...":"  正在关闭，请稍候..."}}),a("TgLiveDisplayDataInputDialog",{attrs:{visible:t.AddLiveDataInputVisible,DisplayInfo:t.LiveDisplayInfoData},on:{"dialog:close":t.onAddDataInputModalClose}}),a("TgLiveScheduleDialog",{attrs:{schedules:t.LiveSchedules,visible:t.LiveScheduleDialogVisible,type:t.LiveScheduleType,detailData:t.displayInfo},on:{"update:visible":function(e){t.LiveScheduleDialogVisible=e},succeed:t.handleUpdateScheduleAction}}),a("liveData",{ref:"liveDataRef",on:{save:t.onLiveDataSave}})],1)]):t._e()],1)},s=[],o=a(97434),l=a(1763),r=a(45028),n=a(3293),c=a(82741),d=a(66870),v=a(78902),p=a(21757),u=a(64236),_=a(44928),m=a(74751),f=a(74750),g=a(22112),h=a(6933),y=a.n(h),S=(a(21703),a(76012)),b=a(48606);const x=t=>{if(!0!==t.data.success)throw new Error(t.data.message);return t.data.data},C=t=>{throw b.Message.error(t.message||"请求错误"),t},D=async t=>(0,S.dX)(`/api/shop_live/${t}/live_analyse`).then(x).catch(C);var w,k,L=a(29625),A=a(61282),E=a(50935),T=a(36568),I=a.n(T),P=a(11676),$=a(85937),z=a.n($),R=(0,o.defineComponent)({setup(t,e){const a=()=>({id:void 0,shop_live_id:void 0,real_start_time:"",real_end_time:"",detail_file:[],duration_screenshot:"",real_duration:void 0}),i=(0,o.inject)("liveDisplay"),s=(0,o.ref)(a()),l=(0,o.ref)(!1),r=(0,o.ref)(!1),c=(0,o.ref)(void 0),d={show(t){if(l.value=!0,t){const{real_start_time:e,real_end_time:i,...o}=t;s.value={...a(),real_start_time:1e3*parseInt(`${e}`,10),real_end_time:1e3*parseInt(`${i}`,10),...o}}else s.value=a()},onClose(){l.value=!1,d.clearValid()},onSave(){c.value?.validate((t=>{t&&d.submit()}))},beforeDataUpload(t){return(0,P.K)({excel:!0,fileSize:10})(t)},beforePicUpload(t){return(0,P.K)({image:!0,fileSize:2})(t)},dataSuccessHandle(t){if(!0!==t.success)e.root.$message.error(t.message??"上次失败");else{const e=t.data.source;s.value.detail_file=[e],c.value?.clearValidate("detail_file")}},picSuccessHandle(t){if(!0!==t.success)e.root.$message.error(t.message??"上次失败");else{const e=t.data.source;s.value.duration_screenshot=e}},clearValid(){setTimeout((()=>{c.value?.clearValidate()}),300)},onPicDelete(t){s.value.duration_screenshot="",t.stopPropagation()},imageTokenUrl(t){return`${t}?Authorization=${(0,f.LP)()}`},submit:async()=>{const t="yyyy-MM-DD HH:mm",a=(0,o.ref)({duration_screenshot:s.value.duration_screenshot??"",real_start_time:s.value.real_start_time?y()(s.value.real_start_time).format(t):"",real_end_time:s.value.real_end_time?y()(s.value.real_end_time).format(t):"",detail_file:s.value.detail_file?.[0],business_type:i?.value.business_type,real_duration:s.value.real_duration??d.reloadDuration()}),l=(0,o.computed)((()=>s.value.id??-1));-1!==l.value?a.value.id=l.value:a.value.shop_live_id=i?.value.id,r.value=!0;const{data:c}=await(0,n.Mv)(a.value);r.value=!1,c.success?(e.root.$message.success(c.message),e.emit("save"),d.onClose()):e.root.$message.error(c.message)},calcDuration:(t,e)=>{const a=y()(t).toDate(),i=y()(e).toDate(),s=(i.getTime()-a.getTime())/36e5,o=new(z())(s.toString()).toFixed(1);return o},reloadDuration:()=>{if(s.value.real_start_time&&s.value.real_end_time)return d.calcDuration(s.value.real_start_time,s.value.real_end_time)}};return{loading:r,visible:l,formData:s,formRef:c,...d}},render(){const t=arguments[0],{loading:e,visible:a,formData:i}=this;return t("div",{class:"live-display-live-daata-page-container"},[t("el-dialog",{attrs:{visible:a,title:"直播数据留档",width:"376px","close-on-click-modal":!1,"close-on-press-escape":!1},on:{close:this.onClose},class:"tg-dialog-classic workbench-use-seal-dialog tg-dialog-vcenter-new"},[t("el-form",I()([{attrs:{size:"small","label-position":"top"},ref:"formRef"},{props:{model:i}}]),[t("el-form-item",{attrs:{label:"电商罗盘直播间详情导出数据",prop:"detail_file",rules:{required:!0,message:"请上传文件",trigger:"change"}}},[t("div",{class:"upload-box-data"},[t("tg-upload",{attrs:{disabled:i.detail_file.length>=1,action:"/api/resources/upload_file",data:{type:"shop_live_detail_file"},beforeUpload:this.beforeDataUpload,success:this.dataSuccessHandle,"show-file-list":!1}},[t("tg-button",{attrs:{disabled:i.detail_file.length>=1,size:"medium",icon:"ico-btn-upload"}},["上传文件"])])]),t("div",{class:"file-list-box"},[t("upload-file-list",{model:{value:i.detail_file,callback:t=>{this.$set(i,"detail_file",t)}}})])]),t("el-form-item",{style:"margin-top: 24px;",attrs:{label:"直播留档截图"}},[t("div",{class:"upload-box-pic",style:"margin-top: 4px;"},[t("tg-upload",{attrs:{action:"/api/resources/upload_file",data:{type:"shop_live_screenshot"},beforeUpload:this.beforePicUpload,success:this.picSuccessHandle,"show-file-list":!1}},[t("div",{class:"update-item"},[t("div",{class:"update-item-add"},[(i.duration_screenshot?.length??0)>0?t("img",{class:"update-item-img",attrs:{src:this.imageTokenUrl(i.duration_screenshot),alt:""}}):t("fragments",[t("i",{class:"update-add-icon el-icon-plus"}),t("div",{class:"update-add-desc"},["上传图片"])])]),(i.duration_screenshot?.length??0)>0&&t("tg-icon",{class:"update-item-delete",attrs:{name:"ico-cross-sm",hoverName:"ico-cross-red-sm"},on:{click:this.onPicDelete}})])]),t("div",{class:"upload-box-pic-desc"},["大小不超过2M"])])])]),t("template",{slot:"footer"},[t("tg-button",{on:{click:this.onClose}},["取消"]),t("tg-button",{attrs:{type:"primary"},on:{click:this.onSave}},["保存"])])]),t("tg-mask-loading",{attrs:{visible:e&&a,content:"正在保存，请稍候..."}})])}}),N=R,H=a(1001),j=(0,H.Z)(N,w,k,!1,null,null,null),M=j.exports;const U=(0,f.LP)();var G=(0,o.defineComponent)({name:"TgLiveDisplay",components:{liveDisplayAddDialog:r.Z,TgLiveDisplayDataInputDialog:m.Z,TgLiveScheduleDialog:g.Z,liveData:M},props:{id:{type:Number,required:!0}},setup(t,e){const a=(0,p.gI)(),i=(0,_.t)(),s=i.currentRoute.params.liveId,r=i.currentRoute.params.id,n=V(e,r,s),c=[{name:l.FB.project.list,title:"项目管理"},{name:l.FB.project.detail,title:"项目详情",params:{id:i.currentRoute.params.id,tab:i.currentRoute.params.tab,liveType:i.currentRoute.params.liveType}},{path:"",title:"场次详情"}];return(0,o.reactive)({routes:c,permission:a,...n})}});function V(t,e,a){const i=(0,o.ref)(void 0),s=(0,o.ref)("anchor");(0,o.provide)("liveDisplay",i);const r=(0,o.ref)(!1),m=(0,o.ref)(!1),g=(0,o.ref)(!1),h=(0,o.ref)(!1),S=(0,o.ref)(void 0),b=(0,o.ref)(void 0),x=(0,_.t)(),C=async()=>{const i=await(0,c.I)(t,"确认删除本场直播？");if(i){g.value=!0;const i=await(0,n.Uk)(a);g.value=!1,i.data.success?(t.root.$message.success("删除成功"),t.root.$router.push({name:l.FB.project.detail,params:{id:e,tab:x.currentRoute.params.tab,liveType:x.currentRoute.params.liveType}})):t.root.$message.error(i.data.message??"删除失败，稍后重试")}},w=async()=>{const e=await(0,c.I)(t,"关闭后场次相关信息无法修改，确认是否关闭");if(e){m.value=!0;const e=await(0,n.j3)(a);m.value=!1,e.data.success?(t.root.$message.success("关闭成功"),k()):t.root.$message.error(e.data.message??"关闭失败，稍后重试")}},k=async()=>{const{data:e}=await(0,n.nZ)(a);e.success?i.value=e.data:t.root.$message.error(e.message??"查询失败，稍后重试")},T=async()=>{if(_t.value)return;const e=await(0,n._p)(a);e.data.success?b.value=e.data.data:t.root.$message.error(e.data.message??"查询失败，稍后重试")},I=(0,o.ref)(!1),P=()=>{h.value=!1},$=async()=>{h.value=!1,await W()},z=(t,e)=>{if(!t||!e)return"";const a=`${t} ~ ${e}`;return a.replace(/-/g,".")},R=t=>t===d.wG.lived?"已归档":"未归档",N=t=>t===d.wG.lived?"status-green-color":"status-light-color",H=(0,o.computed)((()=>{const t=(0,p.kG)(v.HN.live_display_save),e=(0,p.kG)(v.HN.live_display_lived_edit),a=(0,p.kG)(v.HN.live_streamer_schedule),i=(0,p.kG)(v.HN.live_operation_schedule),s=(0,p.kG)(v.HN.view_shop_live_archive);return{canEdit:t,canEditLived:e,canEditArchive:s,canEditKOLSchedule:a,canEditOperatorSchedule:i}})),j=t=>{if(t)switch(t){case 2:return"ico-taobao";case 3:return"ico-douyin";default:return}},{loadScheduleData:M,ScheduleData:G,...V}=(0,E.g)(),W=async()=>{I.value=!0,await k(),await O(),await F(),await B(),await M(a),await T(),I.value=!1};(0,o.provide)("reload",W);const J=(0,o.ref)([]),O=async()=>{const{data:e}=await(0,n.cK)(a);e.success?J.value=e.data:t.root.$message.warning("直播留档数据获取失败")},Y=(0,o.ref)({contrast_live_id:"",promote_order_amount:"",promote_order_num:"",promote_order_person:"",promote_order_conversion_rate:"",view_link:"",fans_order_amount_percent:""}),F=()=>{const t=t=>{D(t).then((t=>{const e=t.order_analyse;Y.value.view_link=t.view_link,Y.value.contrast_live_id=t.contrast_live_id;const a=(0,A.dN)(e.promote_order_amount);Y.value.promote_order_amount="￥"===a?"--":a,Y.value.promote_order_num=e.promote_order_num??"--",Y.value.promote_order_person=e.promote_order_person??"--";const i=""===e.promote_order_conversion_rate?null:e.promote_order_conversion_rate;Y.value.promote_order_conversion_rate=i?i+" %":"--";const s=e.fans_order_amount_percent;Y.value.fans_order_amount_percent=s?s+" %":"--"}))};t(parseInt(a,10))},K=(0,o.ref)([]),Z=(0,o.computed)((()=>i.value?.business_type)),B=async()=>{if(Z.value===L.WD.taobao){const t=async()=>{const t=await(0,n.u2)(a);K.value=t.data.data};t()}},q=(0,o.ref)(!1),X=()=>{if(_t.value)return et.value={id:-1,live_url:"",real_start_time:"",real_end_time:"",duration_screenshot:"",data_screenshot:"",real_duration:""},void(q.value=!0);let t;i.value?.live_start_time&&i.value.live_end_time&&(t={real_end_time:i.value.live_end_time?y()(i.value.live_end_time).format("X"):"",real_start_time:i.value.live_start_time?y()(i.value.live_start_time).format("X"):"",duration_screenshot:"",detail_file:[]}),S.value?.show(t)},Q=async t=>{q.value=!1,t&&await O()},tt=async()=>{await O()},et=(0,o.ref)({id:-1,live_url:"",real_start_time:"",real_end_time:"",duration_screenshot:"",data_screenshot:"",real_duration:""}),at=(0,o.ref)(!1),it=(0,o.ref)({kol:[],operator:[]}),st=t=>{at.value=!0,s.value=t,"anchor"===t?it.value.kol=G.value.kolSchedules.map((t=>(t.id=t.kol_id,t))):it.value.operator=G.value.operatorSchedules.map((t=>(t.id=t.user_id,t)))},ot=(t,e)=>{const a=y()(t),i=y()(e),s=a.isSame(i,"d");let o=`${a.format("HH:mm")} ~ ${i.format("HH:mm")}`;return s||(o=`${o}(次日)`),o},lt=(t,e)=>{if(t&&e){t*=1e3,e*=1e3;const a=y()(t),i=y()(e),s=a.isSame(i,"d");let o=`${a.format("YYYY.MM.DD HH:mm")} ~ ${i.format("HH:mm")}`;return s||(o=`${o}(次日)`),o}},rt=async e=>{const a=await(0,c.I)(t,"确认删除留档数据吗？");if(!a)return;const[{data:i}]=await(0,u.Dc)(200,(0,n.wG)(e));i.success?(t.root.$message.success(i.message??"删除成功"),await O()):t.root.$message.error(i.message??"删除失败")},nt=(0,o.computed)((()=>{if(i.value?.live_start_time&&i.value?.live_end_time){const t=y()(i.value?.live_start_time),e=y()(i.value?.live_end_time),a=t.isSame(e,"d");let s=`${t.format("YYYY.MM.DD HH:mm")} ~ ${e.format("HH:mm")}`;return a||(s=`${s}(次日)`),s}return""})),ct=async t=>{if(_t.value)return q.value=!0,et.value.duration_screenshot=t.duration_screenshot,et.value.data_screenshot=t.data_screenshot,et.value.live_url=t.live_url,et.value.id=t.id,et.value.real_start_time=t.real_start_time,et.value.real_end_time=t.real_end_time,void(et.value.real_duration=t.real_duration);const{detail_file:e,...a}=t;S.value?.show({detail_file:e?.length?[e]:[],...a})},dt=async()=>{await M(a)},vt=(0,o.computed)((()=>i.value?.live_status!==d.wG.lived)),pt=(0,o.computed)((()=>{const t=new Map,e=[];return G.value.kolSchedules.forEach((e=>{const a=ot(e.start_time,e.end_time),i="("+(e.real_name??"--")+")",s=e.kol_name?e.kol_name+i:"";if(t.get(a)){const e=t.get(a);e.push(s),t.set(a,e)}else t.set(a,[s])})),t.forEach((function(t,a){e.push({date_range_str:a,users_str:t.join("、")})})),e})),ut=(0,o.computed)((()=>{const t=new Map,e=[];return G.value.operatorSchedules.forEach((e=>{const a=ot(e.start_time,e.end_time);if(t.get(a)){const i=t.get(a);i.push(e.operator_name),t.set(a,i)}else t.set(a,[e.operator_name])})),t.forEach((function(t,a){e.push({date_range_str:a,users_str:" "+t.join("、")})})),e})),_t=(0,o.computed)((()=>i.value?.business_type===L.WD.taobao)),mt=(0,o.ref)(void 0),ft=(0,o.ref)(!1),gt={queryInProjectTeam:async()=>{ft.value=!0;const t=await(0,n.gs)(e.toString());ft.value=!1,t.data.success&&(mt.value=!!t.data.data.in_project,mt.value&&W())}},ht=async()=>{if(H.value.canEdit&&i.value?.live_status!==d.wG.lived)h.value=!0;else if(H.value.canEditLived&&i.value?.live_status===d.wG.lived){const e=await(0,c.I)(t,{title:"是否设置成未归档？",cancelText:"否",confirmText:"是"});if(e){const e=await(0,n.Kn)({shop_live_id:a});e.data.success?(t.root.$message.success(e.data.message),W()):t.root.$message.error(e.data.message)}}},yt=(e,a)=>{const i={headers:{Authorization:(0,f.LP)()??""}};fetch(e,i).then((async i=>{const s=i.clone();try{const e=await s.json();t.root.$message.error(e.message)}catch{if(200===i.status){const t=await i.blob(),s=a??decodeURIComponent(e.split("/")[e.split("/").length-1]);(0,u.uA)(t,s)}else t.root.$message.error("下载失败")}}))},St=e=>{if(!e.detail_file?.length)return void t.root.$message.error("文件不存在，下载失败");let a=e.detail_file?.split("/").pop();a?(a=decodeURI(a),yt(e.detail_file,a)):t.root.$message.error("文件不存在，下载失败")};(0,o.onBeforeMount)((()=>{gt.queryInProjectTeam()}));const bt=(t,e,a=!1)=>void 0===t||null===t?"--":a?t:(0,A.dN)(t,"None",!e),xt=(0,o.computed)((()=>!i.value?.allow_update_kol_schedule&&!!i.value?.compass_shop_live_room_id));return{ReloadDetailLoading:I,PermissionCheckLoading:ft,inProjectTeam:mt,isTaobaoDisplay:_t,TaobaoLiveLogs:K,OperatorScheduleList:ut,kolScheduleList:pt,CanEditStatus:vt,formDateRangeStr:ot,LiveStatData:Y,handleUpdateScheduleAction:dt,LiveSchedules:it,handleUpdateDisplayInfoDataAction:ct,display_live_date_range_str:nt,handleDeleteDisplayInfoDataAction:rt,GetDateRangeStr:lt,Permission:H,reload:W,isExpand:r,displayInfo:i,closeLoading:m,deleteLoading:g,shouldEditing:h,liveDataRef:S,handleEditDisplayAction:ht,handleCloseDisplayAction:w,handleDeleteDisplayAction:C,handleCloseAction:P,handleSaveSucceedAction:$,liveTime:z,liveStatus:R,LiveDisplayStatus:d.wG,statusClasses:N,business_icon:j,ScheduleData:G,ShopLiveRecordDataList:J,LiveDisplayInfoData:et,AddLiveDataInputVisible:q,onAddDataInputModalClose:Q,AddLiveRecordHandler:X,handleEditDisplayScheduleAction:st,LiveScheduleDialogVisible:at,JWToken:U,LiveScheduleType:s,onDownloadLiveData:St,shopLiveStatistic:b,onLiveDataSave:tt,formatAmount:A.dN,formatNum:bt,isAutoObtain:xt}}var W=G,J=(0,H.Z)(W,i,s,!1,null,null,null),O=J.exports},11676:function(t,e,a){a.d(e,{K:function(){return v}});a(26699);var i=a(48606);const s=[".pdf",".doc",".docx",".ppt",".pptx"],o=[".mp4"],l=[".png",".jpg",".jpeg"],r=[".xls",".xlsx",".csv"],n=[".doc",".docx"],c=[".pdf"],d=[".csv"],v=t=>e=>{const a=/(\.[^.]+)$/.exec(e.name);let v="";a&&(v=a[1]);const p=[];if(t.image&&p.push(...l),t.file&&p.push(...s),t.video&&p.push(...o),t.excel&&p.push(...r),t.pdf&&p.push(...c),t.doc&&p.push(...n),t.csv&&p.push(...d),t.extensions&&p.push(...t.extensions),p.length>0&&!p.includes(v))return i.Message.warning(`文件格式不正确，请使用 ${p.join(";")}`),!1;if(void 0!==t.fileSize){const a=e.size/1024/1024<t.fileSize;if(!a)return i.Message.warning(`文件不能超过${t.fileSize}MB!`),!1}return!0};e["Z"]={ValidationFileUpload:v}}}]);