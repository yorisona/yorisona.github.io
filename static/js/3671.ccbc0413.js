"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[3671],{19958:function(e,t,s){s.d(t,{Z:function(){return v}});var a,r,n=s(97434),i=s(1763),l=s(64236),o=(0,n.defineComponent)({setup(e,t){const s=(0,n.ref)(),a=(0,n.ref)(!1),r=(0,n.ref)(),i=e=>{e&&(s.value=e,a.value=!0)},o=(0,n.ref)(""),u=(0,n.computed)((()=>{const e=o.value,t=s.value?.by_evaluation_person||[];return(0,l.xb)(e)?t:t.filter((t=>-1!==t.username.indexOf(e)))}));return{show:i,formData:s,visible:a,selected:r,filterValue:o,filterList:u}},render(){const e=arguments[0];return e("el-drawer",{attrs:{title:"选择模拟被考核人员",size:"378px",visible:this.visible},on:{close:()=>{this.visible=!1}}},[e("div",{class:"assessor-container"},[e("div",{class:"search"},[e("el-input",{attrs:{size:"small",placeholder:"输入姓名查找 "},model:{value:this.filterValue,callback:e=>{this.filterValue=e}}},[e("i",{slot:"prefix",class:"el-input__icon el-icon-search"})])]),e("div",{class:"body"},[e("el-radio-group",{model:{value:this.selected,callback:e=>{this.selected=e}}},[this.filterList.map((t=>e("div",{class:"assessor-item"},[e("el-radio",{attrs:{name:"assessor",label:t.user_id}},[t.username," (",t.real_name,")"])])))])]),e("div",{class:"footer"},[e("tg-button",{attrs:{size:"small"},on:{click:()=>this.visible=!1}},["取消"]),e("tg-button",{attrs:{size:"small",type:"primary"},class:"mgl-18",on:{click:()=>{this.selected&&(this.$router.push({name:i.Gr.assessment.preview,query:{user_id:this.selected+""}}),this.visible=!1)}}},["确定"])])])])}}),u=o,c=s(1001),m=(0,c.Z)(u,a,r,!1,null,"b3c041e4",null),v=m.exports},3671:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});s(21703);var a=s(97434),r=s(1763),n=s(44928),i=s(23624),l=s(59563),o=s(48606),u=s(99205),c=s(19958),m=s(64236),v=s(82741);const h=[{title:"考评组",name:r.Gr.assessment.list},{title:"新增考评组"}],d=[{title:"基础信息",name:r.Gr.assessment.create.base},{title:"模板指标",name:r.Gr.assessment.create.indicators},{title:"考评流程",name:r.Gr.assessment.create.process}];var f,p,g=(0,a.defineComponent)({components:{SelectAssessor:c.Z},beforeRouteLeave(e,t,s){this.saveLocal(),s()},setup(){const e=(0,n.t)(),t=(0,a.ref)(),s=(0,a.ref)(),c=(0,a.ref)((0,u.Sr)());(0,a.provide)("formData",c);const h=(0,l.Q)(i.iL,{manual:!0}),d=()=>(0,u.lL)(c.value),f=()=>{Promise.resolve().then(p).then((()=>{s.value?.show(c.value)})).catch((e=>{o.Message.error(e.message)}))},p=async()=>{if((0,m.xb)(c.value.name))throw new Error("基础信息：请填写考评组名称");if((0,m.xb)(c.value.cycle_type))throw new Error("基础信息：请选择周期类型");if(0===c.value.by_evaluation_person.length)throw new Error("基础信息：请选择被考核人员");if(0===c.value.assessment_dimension_list.length)throw new Error("模板指标：请至少维护一个考核维度");const e=c.value.assessment_dimension_list.find((e=>!1===e.is_modify_delete&&0===e.indicator_list.length));if(e)throw new Error(`模板指标：因[${e.name}]维度不允许被考核人编辑和删除指标，请至少维护一个考核指标`);if(c.value.is_target_confirmed){if((0,m.xb)(c.value.operator))throw new Error("考评流程：请选择目标制定人");if((0,m.xb)(c.value.confirmer))throw new Error("考评流程：请选择目标确认人")}if(c.value.is_self_evaluation&&(0,m.xb)(c.value.weight))throw new Error("考评流程：请填写自评权重");if(c.value.is_superior_rating)for(let t=0;t<c.value.superior_rating.length;t++){const e=c.value.superior_rating[t];if((0,m.xb)(e.weight))throw new Error("考评流程：请填写上级评分人权重");void 0===e.is_transfer&&(e.is_transfer=!1)}},g=s=>{Promise.resolve().then((()=>{if(t.value?.validate)return t.value?.validate()})).then((()=>{e.push({name:s})}))},_=()=>{Promise.resolve().then(p).then((()=>(0,i.q0)({user_id_list:c.value.by_evaluation_person.map((e=>e.user_id)),cycle_type:c.value.cycle_type,evaluation_group_id:c.value.id}).then((e=>{if(!e.data.success)throw new Error(e.data.message);const t=e.data.data.data;if(0===t.length)return;const s=t.map((e=>e.username)).join("、");return(0,v.u)({title:void 0,content:`${s}已被添加到其他考评组中，是否确认变更到${c.value.name}考评组？若原考评组已发起考核，则原考核会被取消。`}).then((()=>{c.value.remove_user_id_list=t.map((e=>e.user_id))})).catch((()=>new Promise((()=>{}))))})))).then((()=>{const t={...c.value};t.is_superior_rating||t.superior_rating.forEach((e=>{e.weight=null})),t.is_self_evaluation||(t.weight=null),h.runAsync(t).then((()=>{o.Message.success(c.value.id?"修改成功":"添加成功"),e.push({name:r.Gr.assessment.list})}))})).catch((e=>{o.Message.error(e.message)}))};return{saveLocal:d,createRef:t,jumpTab:g,preview:f,submit:_,selectAssessorRef:s}},render(){const e=arguments[0],t=this.$route.name;return e("div",{class:"tg-page-container page-content-container"},[e("tg-breadcrumbs",{attrs:{routes:h}}),e("div",{class:"tg-tabs tg-tabs-line bg-white"},[e("div",{class:"tg-tabs-header flex-fill"},[e("div",{class:"tg-tabs-header-tab-list",style:"height:48px;line-height:48px"},[d.map((s=>{const a=s.name===t;return e("div",{class:"tg-tabs-header-tab-item "+(a?"tg-tabs-header-tab-item-active":""),on:{click:()=>{a||this.jumpTab(s.name)}}},[s.title])}))])]),e("div",{class:"group"},[e("tg-button",{attrs:{size:"small"},on:{click:this.preview}},["预览"]),e("tg-button",{attrs:{size:"small",type:"primary"},on:{click:this.submit}},["保存"])])]),e("div",{class:"assessment_content"},[e("router-view",{ref:"createRef"})]),e("select-assessor",{ref:"selectAssessorRef"})])}}),_=g,b=s(1001),w=(0,b.Z)(_,f,p,!1,null,"7eb4bdb7",null),y=w.exports},59563:function(e,t,s){s.d(t,{Q:function(){return n},h:function(){return i}});s(21703);var a=s(97434),r=s(48606);const n=(e,{manual:t,onError:s,onSuccess:n,defaultParams:i,transform:l}={})=>{const o=(0,a.ref)(),u=(0,a.ref)(),c=(0,a.ref)(!1),m=(0,a.ref)([]),v=()=>{h(...m.value)},h=(...t)=>Promise.resolve(t||i).then((()=>{c.value=!0})).then((()=>0===t.length&&i&&i.length>0?i:t)).then((e=>(m.value=e,e))).then((t=>e(...t))).then((e=>{if(!e.data.success)throw new Error(e.data.message);return o.value=l?l(e.data.data):e.data.data,n&&n(o.value,e.data),e})).then((()=>{c.value=!1})).catch((e=>{throw c.value=!1,u.value=e.message,s&&s(e),r.Message.error(e.message),e})),d=h;return t||h(...i||[]),(0,a.reactive)({data:o,error:u,loading:c,reload:v,run:h,runAsync:d,params:m})},i=(e,t={})=>{const{defaultPageSize:s=20,defaultParams:r=[],transform:i,...l}=t,o=(0,a.ref)(),u=(0,a.reactive)({total:0,page_num:1,page_size:s,onCurrentChange:e=>{const t=[...v.params];t[0]?t[0].page_num=e:t[0]={num:s,page_num:e},v.runAsync(...t).then((()=>{u.page_num=e}))},refresh:()=>u.onCurrentChange(1),reQuery(...e){const t=[];return v.params[0]?(t[0]=v.params[0],t[0].page_num=1,u.page_num=1):(t[0]={num:s,page_num:1},u.page_num=1),t.push(...e),v.runAsync(...t)}}),[c={num:s,page_num:1},...m]=r,v=n(e,{defaultParams:[c,...m],...l,onSuccess(e,s){o.value=i?i(e):e.data,u.total=e.total,t.onSuccess&&t.onSuccess(o.value,s)}}),{data:h,...d}=(0,a.toRefs)(v);return(0,a.reactive)({...d,data:o,pagination:u})}}}]);