"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[5819],{87903:function(t,e,s){s.d(e,{Z:function(){return M}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-dialog",{staticClass:"tg-dialog-classic settlement-dialog-a",attrs:{visible:t.settlementVisible,width:"942px","close-on-click-modal":!1,"destroy-on-close":!0,top:t.top?t.top:"15vh"},on:{close:t.closeHandler},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("收入结算")]},proxy:!0},{key:"footer",fn:function(){return[2===t.currentcolumn.status||!t.Permission.canUpdate||t.readonly||t.is_unity_settlement?t._e():s("tg-button-line",{attrs:{"justify-content":"center"}},[s("tg-button",{on:{click:t.unpassHandler}},[t._v("不通过")]),s("tg-button",{attrs:{type:"primary"},on:{click:t.passHandler}},[t._v("确认结算")])],1)]},proxy:!0}])},[s("div",{staticClass:"settlement-main"},[t.isMerchantSettlement?s("merchant-settlement",{attrs:{readonly:!0}}):s("settlement-detail",{attrs:{item:t.currentcolumn}})],1)]),s("settlement-dialog",{ref:"settlementDialog",on:{unpass:t.unpassReasonHandler}})],1)},a=[],l=s(97434),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"settlement-detail",style:t.isMCNType?"height:580px":""},[s("div",{staticClass:"amount"},[s("top-card",{attrs:{amount:""+t.item.total_settle_amount,taxed:t.item.is_include_tax,name:t.item.company_name,type:"value2",tax_rate_disabled:!0,tax_rate:""+t.item.tax_rate}})],1),s("div",{staticClass:"detail"},[t.isTbdb?s("div",{staticClass:"detail-item server"},[t._m(0),s("div",{staticClass:"amount"},[s("i",{staticClass:"amount-bold"},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.service_amount))+" 元")])])]):t._e(),t.isTbdb?s("div",{staticClass:"detail-item commission"},[t._m(1),s("div",{staticClass:"amount"},[s("div",{staticClass:"p1"},[t._v("共 "+t._s(t.item.record_count)+" 条记录")]),s("div",{staticClass:"p2",staticStyle:{"font-weight":"400"}},[t._v(" 合计种草成交金额 "),s("span",{staticStyle:{"font-weight":"600"}},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.recommend_amount))+" 元")])]),s("div",{staticClass:"p3"},[t._v("佣金")]),s("div",{staticClass:"p4"},[t._v(" = "+t._s(t.formatAmountWithoutPrefix(t.item.recommend_amount))+" * (1-"+t._s(t.item.refund_rate)+"%) * "+t._s(t.item.commission_rate)+"% ")]),s("div",{staticClass:"p5"},[t._v(" = "),s("i",{staticClass:"amount-bold"},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.commission))+" 元")])])])]):t._e(),t.isDydb?s("div",{staticClass:"detail-item commission",style:{height:t.isDydb&&t.isSelf?"240px":"220px"}},[(t.isSelf,s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("收入信息")])])),s("div",{staticClass:"amount"},[s("div",{staticClass:"p1"},[t._v("共 "+t._s(t.item.record_count)+" 条记录")]),s("div",{staticClass:"p2",staticStyle:{"font-weight":"400"}},[t.isSelf?[t._v("合计净销额")]:[t._v("合计销售金额")],s("span",{staticStyle:{"margin-left":"4px",color:"#3c5269","font-style":"normal","font-weight":"600"}},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.sale_amount))+" 元")])],2),s("div",{staticClass:"p3"},[t._v("佣金")]),s("div",{staticClass:"p4"},[t._v(" = "+t._s(t.formatAmountWithoutPrefix(t.item.sale_amount))+" * "+t._s(t.item.commission_rate)+"% ")]),s("div",{staticClass:"p5"},[t._v(" = "),s("i",{staticClass:"amount-bold"},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.commission))+" 元")])]),t.isSelf?s("div",{staticClass:"p3",staticStyle:{display:"inline-block"}},[t._v("服务费")]):t._e(),t.isSelf?s("div",{staticClass:"amount-bold",staticStyle:{display:"inline-block","margin-left":"0"}},[t._v("  "+t._s(t.formatAmountWithoutPrefix(t.item.service_amount||0))+" 元 ")]):t._e()])]):t._e(),t.isMCNType?s("div",{staticClass:"detail-item server",class:t.isMCNDouyinType?"douyincpn-width":"",style:t.ItemHeightStyle},[s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v(t._s((t.isMCNDouyinType,"收入信息"))+" ")])]),t.isMCNDouyinType?s("div",[s("div",{staticClass:"douyin-cps-detail"},[t.douyin_cps_amount_info_list.length>0?t._l(t.douyin_cps_amount_info_list,(function(e,i){return s("div",{key:i,staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v(" "+t._s(10===e.type?"CPS收入":11===e.type?"佣金":12===e.type?"佣金(服务费)":13===e.type?"技术服务费":t.douyin_cps_income_type(e.type))+"： ")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.amount?t.formatAmountWithoutPrefix(e.amount)+" 元":"--")+" ")]),1===e.type?s("tg-button",{staticClass:"amount-download",attrs:{type:"link"},on:{click:t.downloadPitFeeDetail}},[t._v("下载明细")]):t._e(),e.file?s("a",{staticClass:"amount-download",staticStyle:{"font-size":"14px"},attrs:{href:e.file+"?Authorization="+t.getToken()}},[t._v("下载明细")]):t._e()],1),e.remark?s("p",{staticClass:"amount-text"},[t._v(t._s(e.remark))]):t._e()])])})):t._e()],2)]):s("div",[s("div",{staticStyle:{margin:"18px 18px 12px 18px",height:"18px","line-height":"18px"}},[s("div",{staticStyle:{display:"inline-block",color:"#6a7b92"}},[t._v("收入")]),s("div",{staticStyle:{display:"inline-block",float:"right"}},[s("i",{staticClass:"amount-bold"},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.income_amount))+"元")])])]),s("div",{staticStyle:{margin:"0 18px","border-bottom":"1px dashed rgba(164, 178, 194, 0.3)"}}),s("div",{staticStyle:{"overflow-y":"auto",padding:"12px 0 0 18px",height:"235px"}},[s("div",{staticStyle:{width:"250px"}},t._l(t.item.excel_data,(function(e,i){return s("div",{key:i},[["技术服务费","服务费","其他费用","专项服务费"].includes(e.name)?s("div",{style:t.getExcelDataStyle(t.item,i)},[s("div",{staticStyle:{display:"inline-block",color:"#6a7b92"}},[t._v(t._s(e.name))]),s("div",{staticStyle:{display:"inline-block",float:"right"}},[e.value<0?s("span",{staticStyle:{color:"#ec1e1e"}},[t._v(t._s(t.formatAmountWithoutPrefix(e.value)))]):s("span",{staticStyle:{color:"#3c5269"}},[t._v(t._s(t.formatAmountWithoutPrefix(e.value)))])])]):s("div",{staticStyle:{"margin-bottom":"8px","line-height":"18px",height:"18px"}},[s("div",{staticStyle:{display:"inline-block",width:"142px",color:"#3c5269"}},[s("el-popover",{attrs:{placement:"top","open-delay":300,trigger:"hover",content:e.name}},[s("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[t._v(" "+t._s(e.name)+" ")])])],1),s("div",{staticStyle:{display:"inline-block",float:"right",color:"#3c5269"}},[e.value<0?s("span",{staticStyle:{color:"#ec1e1e"}},[t._v(t._s(t.formatAmountWithoutPrefix(e.value)))]):s("span",[t._v(t._s(t.formatAmountWithoutPrefix(e.value)))])])])])})),0)])])]):t._e(),t.isDyCps?s("div",{staticClass:"detail-item server",class:t.isMCNDouyinType?"douyincpn-width":"",style:t.ItemHeightStyle},[t._m(2),s("div",[s("div",{staticClass:"douyin-cps-detail"},[t.douyin_cps_amount_info_list.length>0?t._l(t.douyin_cps_amount_info_list,(function(e,i){return s("div",{key:i},[10===e.type?[s("div",{staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v("总GMV：")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.total_gmv?t.formatAmountWithoutPrefix(e.total_gmv)+" 元":"--")+" ")])])])]),s("div",{staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v("退货率：")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.refund_rate?e.refund_rate+"%":"--")+" ")])])])]),2===e.version?s("div",{staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v("预估机构佣金：")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.commission_rate?t.formatAmountWithoutPrefix(e.commission_amount)+"元":"--")+" ")])])])]):s("div",{staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v("平均佣金比例：")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.commission_rate?e.commission_rate+"%":"--")+" ")])])])])]:t._e(),s("div",{staticClass:"douyin-cps-amount"},[s("p",{staticClass:"amount-label"},[t._v(" "+t._s(10===e.type?"CPS收入":11===e.type?"佣金":12===e.type?"佣金(服务费)":13===e.type?"技术服务费":t.douyin_cps_income_type(e.type))+"： ")]),s("div",{staticClass:"amount-detail"},[s("div",{staticClass:"amount-amount"},[s("p",{staticClass:"amount-fee"},[t._v(" "+t._s(e.amount?t.formatAmountWithoutPrefix(e.amount)+" 元":"--")+" ")]),1===e.type?s("tg-button",{staticClass:"amount-download",attrs:{type:"link"},on:{click:t.downloadPitFeeDetail}},[t._v("下载明细")]):t._e(),e.file?s("a",{staticClass:"amount-download",staticStyle:{"font-size":"14px"},attrs:{href:e.file+"?Authorization="+t.getToken()}},[t._v("下载明细")]):t._e()],1),e.remark?s("p",{staticClass:"amount-text"},[t._v(t._s(e.remark))]):t._e()])])],2)})):t._e()],2)])]):t._e(),t.isBusinessType?s("div",{staticClass:"detail-item server"},[t._m(3),s("div",{staticClass:"amount"},[t._v(" 服务费 "),s("i",{staticClass:"amount-bold"},[t._v(t._s(t.formatAmountWithoutPrefix(t.item.income_amount))+" 元")])])]):t._e(),s("div",{staticClass:"detail-item manual",style:t.ItemHeightStyle},[t._m(4),s("div",{staticClass:"amount",style:t.isMCNType?"height:285px":"height:178px"},[s("div",{staticClass:"p1"},[t._v("调账 "+t._s(t.item.adjust_info.length)+" 笔")]),s("div",{staticClass:"p2"},[s("span",[t._v("共")]),s("span",{staticStyle:{"margin-left":"4px"}},[t._v(t._s(t.formatAmountWithoutPrefix(t.adjust_info_total))+" 元")])]),s("div",{staticClass:"row"},t._l(t.item.adjust_info,(function(e,i){return s("div",{key:i,staticClass:"manual-item"},[s("span",[t._v(t._s(i+1)+". ")]),s("div",[t._v(" 调整金额："+t._s(t.formatAmountWithoutPrefix(e.adjust_amount))+" 元；调整原因："+t._s(e.adjust_reason)+" ")])])})),0)])])]),t.isMCNType&&(t.item.income_file||t.item.detail_file&&!t.item.unity_settlement_id)?s("div",{staticClass:"mcn-range-recommend"},[t.fileName(t.item.income_file)?s("div",{staticClass:"mcn-download-item"},[s("span",{staticClass:"label"},[t._v("收入文件：")]),s("FileItem",{key:1006,attrs:{showPreview:!0,filepath:t.item.income_file,readonly:!0}})],1):t._e(),t.fileName(t.item.detail_file)&&!t.item.unity_settlement_id?s("div",{staticClass:"mcn-download-item"},[s("span",{staticClass:"label"},[t._v("结算明细：")]),s("FileItem",{key:1005,attrs:{showPreview:!0,filepath:t.item.detail_file,readonly:!0}})],1):t._e()]):t._e(),!t.isMCNType&&(t.item.income_file||t.item.order_file&&!t.item.unity_settlement_id||t.item.live_file&&1===t.item.cooperation_type||t.item.recommend_file)?s("div",{staticClass:"range-recommend"},[t.fileName(t.item.income_file)?s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("收入文件：")]),s("FileItem",{key:1004,attrs:{showPreview:!0,filepath:t.item.income_file,readonly:!0}})],1):t._e(),t.fileName(t.item.order_file)&&!t.item.unity_settlement_id?s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("订单文件：")]),s("FileItem",{key:1003,attrs:{showPreview:!0,filepath:t.item.order_file,readonly:!0}})],1):t._e(),t.fileName(t.item.live_file)&&1===t.item.cooperation_type?s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("时长文件：")]),s("FileItem",{key:1001,attrs:{showPreview:!0,filepath:t.item.live_file,readonly:!0}})],1):t._e(),t.fileName(t.item.recommend_file)?s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("种草文件：")]),s("FileItem",{key:1002,attrs:{showPreview:!0,filepath:t.item.recommend_file,readonly:!0}})],1):t._e()]):t._e(),s("div",{staticClass:"download"},[t.item.settlement_files.length?s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("结算单：")]),s("div",t._l(t.item.settlement_files,(function(t,e){return s("div",{key:t,staticClass:"file-item"},[s("FileItem",{key:e,attrs:{showPreview:!0,filepath:t,readonly:!0}})],1)})),0)]):t._e()]),s("div",{staticClass:"download",staticStyle:{"padding-bottom":"10px","margin-top":"0px"}},[s("div",{staticClass:"download-item"},[s("span",{staticClass:"label"},[t._v("关联合同：")]),t.item.contract_id&&t.item.sign_type_name?s("div",{staticStyle:{color:"#3c5269"}},[t._v(" "+t._s(t.item.sign_type_name+": "+t.item.contract_uid+" ("+t.item.coop_start_date+"-"+t.item.coop_end_date+")")+" ")]):s("div",{staticStyle:{color:"#3c5269"}},[t._v("--")])])])])},n=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("服务费")]),s("span",{staticClass:"formula"},[t._v("服务费 = 单价 + 时长")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("佣金")]),s("span",{staticClass:"formula"},[t._v("佣金 = 种草金额*(1-退货率)*佣金比例")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("结算详情 ")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("收入信息")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"label"},[s("span",{staticClass:"part"},[t._v("手工调账")])])}],c=(s(26699),s(61282)),m=s(74750),r=s(64236),d=s(94559),u=s(28348),_=s(67957),p=s(57412),v=(0,l.defineComponent)({components:{TopCard:d.Z},props:{item:{type:Object,default:()=>({})}},filters:{iconName(t){return t.includes("xls")?"ico-excel":t.includes("pdf")?"ico-pdf":t.includes("docx")?"ico-word":"ico-picture"}},setup(t,e){const s=(0,l.computed)((()=>{if(Array.isArray(t.item.adjust_info)){const e=t.item.adjust_info.map((t=>Number(t.adjust_amount)));return e.reduce(((t,e)=>t+e),0)}return 0})),i=t=>{if(t){const e=t.split("/");return e.pop()}return""},a=t=>{const e=`${t}?Authorization=${(0,m.LP)()}`;t.includes(".png")||t.includes(".jpg")||t.includes(".jpeg")||t.includes(".pdf")?window.open(e):window.open("https://view.officeapps.live.com/op/view.aspx?src="+encodeURIComponent(e))},o=t=>{if(!t)return!1;const s={headers:{Authorization:(0,m.LP)()??""}};fetch(t,s).then((async s=>{const i=s.clone();try{const t=await i.json();e.root.$message.error(t.message)}catch{if(200===s.status){const e=await s.blob(),i=decodeURIComponent(t.split("/")[t.split("/").length-1]);(0,r.uA)(e,i)}else e.root.$message.error("下载失败")}}))},n=(0,l.computed)((()=>1===t.item.settlement_type)),d=(0,l.computed)((()=>2===t.item.settlement_type)),v=(0,l.computed)((()=>1===t.item.cooperation_type)),f=(0,l.computed)((()=>[4,5,6].includes(t.item.settlement_type))),y=(0,l.computed)((()=>5===t.item.settlement_type)),C=(0,l.computed)((()=>[8].includes(t.item.settlement_type))),h=t=>u.Ti.get(t),g=(0,l.computed)((()=>{const e=t.item?.json_data?.amount_info_list??[];return e.sort(((t,e)=>t.type-e.type)),e})),x=(0,l.computed)((()=>[3,7].includes(t.item.settlement_type))),b=(0,l.computed)((()=>n.value||d.value)),w=(0,l.computed)((()=>f.value?"height: 327px":d.value&&v.value?"height: 240px":"")),S=()=>{const e=(0,_.e2)(t.item.id,t.item.company_id);window.open(e)},k=(t,e)=>{const s=t.excel_data[e+1]?t.excel_data[e+1].name:"";return["技术服务费","服务费","其他费用","专项服务费"].includes(s)?"margin-bottom: 8px; line-height: 18px; height: 18px":"margin-bottom: 18px; line-height: 18px; height: 18px"},P=t=>p.Z.basename(t);return{isSelf:v,basename:P,downloadPitFeeDetail:S,getToken:m.LP,douyin_cps_amount_info_list:g,douyin_cps_income_type:h,getExcelDataStyle:k,isBusinessType:x,isShopLiveType:b,ItemHeightStyle:w,formatAmountWithoutPrefix:c.FU,adjust_info_total:s,proviewFile:a,downFile:o,fileName:i,isTbdb:n,isDydb:d,isDyCps:C,isMCNType:f,isMCNDouyinType:y}}}),f=v,y=s(1001),C=(0,y.Z)(f,o,n,!1,null,"465eae11",null),h=C.exports,g=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-dialog",{staticClass:"tg-dialog-classic",attrs:{visible:t.visible,width:"440px",top:"35vh","close-on-click-modal":!1,"destroy-on-close":!0},on:{close:t.closeAction},scopedSlots:t._u([{key:"title",fn:function(){return[t._v("不通过原因")]},proxy:!0},{key:"footer",fn:function(){return[s("tg-button",{staticClass:"big-button color-999",on:{click:function(e){t.visible=!1}}},[t._v("取 消")]),s("tg-button",{attrs:{disabled:!t.textarea,type:"primary"},on:{click:t.confirmHandler}},[t._v("确定")])]},proxy:!0}])},[s("div",{staticClass:"settlement-dialog"},[s("div",{staticClass:"textarea"},[s("el-input",{attrs:{type:"textarea",rows:3,maxLength:50,placeholder:"请输入不通过原因"},model:{value:t.textarea,callback:function(e){t.textarea=e},expression:"textarea"}})],1)])])],1)},x=[],b=(0,l.defineComponent)({setup(t,e){const s=(0,l.ref)(!1),i=(0,l.ref)(""),a=()=>{s.value=!1,i.value=""},o=()=>{s.value=!0},n=()=>{e.emit("unpass",i.value)};return{visible:s,closeAction:a,show:o,textarea:i,confirmHandler:n}}}),w=b,S=(0,y.Z)(w,g,x,!1,null,"d2a011b2",null),k=S.exports,P=s(78902),A=s(21757),T=s(82741),N=s(42386),W=s(87425),D=s(71963),H=(0,l.defineComponent)({name:"BuessinessSettlement",components:{SettlementDetail:h,SettlementDialog:k,MerchantSettlement:W.Z},props:{readonly:{type:Boolean,default:!1}},setup(t,e){const s=(0,l.ref)({});(0,l.provide)("settlement",s);const i=(0,l.ref)(!1),a=(0,l.ref)(""),o=(0,l.computed)((()=>s.value?.shop_live_live_goods_id)),n=t=>{s.value=t,console.log("cl",t),i.value=!0,(0,l.nextTick)((()=>{const t=document.body.clientHeight,e=document.querySelectorAll(".settlement-dialog-a > .el-dialog")[0].clientHeight;a.value=(t-e)/2+"px"}))},c=(0,l.computed)((()=>{const t=(0,A.kG)(P.HN.settlement_income_update);return{canUpdate:t}})),m=()=>{i.value=!1,e.refs.settlementDialog.closeAction()},r=()=>{e.refs.settlementDialog.show()},d=async()=>{const t=await(0,T.I)(e,"确定通过这条结算吗？");if(t){const{data:t}=o.value?await(0,D.Qp)(s.value.id):await(0,N.g8)(s.value.id);t.data?(e.root.$message({type:"success",message:"提交成功",duration:2e3,showClose:!0}),m(),e.emit("success")):e.root.$message({type:"warning",message:t.message??"提交失败，稍后重试",duration:2e3,showClose:!0})}},u=async t=>{const{data:i}=o.value?await(0,D.xR)({id:s.value.id,refuse_reason:t}):await(0,N.k)({id:s.value.id,refuse_reason:t});i.data?(e.root.$message({type:"success",message:"提交成功",duration:2e3,showClose:!0}),m(),e.emit("success")):e.root.$message({type:"warning",message:i.message??"提交失败，稍后重试",duration:2e3,showClose:!0})},_=(0,l.computed)((()=>5===s.value?.settlement_type&&s.value?.unity_settlement_id));return{unpassHandler:r,show:n,top:a,is_unity_settlement:_,passHandler:d,currentcolumn:s,closeHandler:m,settlementVisible:i,Permission:c,unpassReasonHandler:u,isMerchantSettlement:o}}}),$=H,j=(0,y.Z)($,i,a,!1,null,null,null),M=j.exports}}]);