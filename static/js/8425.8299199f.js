"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[8425],{41312:function(t,e,a){a.r(e),a.d(e,{default:function(){return z}});var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tg-contract-page flex-auto"},[a("tg-card",{staticClass:"flex-none",attrs:{padding:18},on:{"rect:update":t.onTopCardRectUpdate}},[a("el-form",{staticClass:"filter-form flex-form",attrs:{inline:!0,size:"medium","show-message":!1,"label-width":"84px"}},[a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"合同类别："}},[a("el-select",{staticClass:"select",attrs:{placeholder:"请选择"},model:{value:t.queryForm.partner_type,callback:function(e){t.$set(t.queryForm,"partner_type",e)},expression:"queryForm.partner_type"}},t._l(t.contractTypeOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"业务类型："}},[a("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"请选择"},model:{value:t.queryForm.business_type,callback:function(e){t.$set(t.queryForm,"business_type",e)},expression:"queryForm.business_type"}},t._l(t.businessTypeOptions,(function(t){return a("el-option",{key:t.value,attrs:{"合同搜索":"",label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"签约类型："}},[a("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"请选择"},model:{value:t.queryForm.sign_type,callback:function(e){t.$set(t.queryForm,"sign_type",e)},expression:"queryForm.sign_type"}},t._l(t.saleContractTypeOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"合同状态："}},[a("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"请选择"},model:{value:t.queryForm.contract_status,callback:function(e){t.$set(t.queryForm,"contract_status",e)},expression:"queryForm.contract_status"}},t._l(t.ApprovalStatusOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"合同扫描件："}},[a("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"请选择"},model:{value:t.queryForm.contract_scan_flag,callback:function(e){t.$set(t.queryForm,"contract_scan_flag",e)},expression:"queryForm.contract_scan_flag"}},t._l(t.ContractScanFlagOptions,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),a("el-form-item",{staticClass:"flex-form-item",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"是否收回："}},[a("el-select",{staticClass:"select",attrs:{clearable:"",placeholder:"请选择"},model:{value:t.queryForm.is_recycled,callback:function(e){t.$set(t.queryForm,"is_recycled",e)},expression:"queryForm.is_recycled"}},[a("el-option",{attrs:{label:"全部",value:void 0}}),a("el-option",{attrs:{label:"已收回",value:1}}),a("el-option",{attrs:{label:"未收回",value:0}})],1)],1),a("el-form-item",{staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"结束日期："}},[a("el-date-picker",{attrs:{type:"date",size:"small",placeholder:"请选择日期","start-placeholder":"结束日期","value-format":"yyyy-MM-dd"},model:{value:t.queryForm.coop_end_date,callback:function(e){t.$set(t.queryForm,"coop_end_date",e)},expression:"queryForm.coop_end_date"}})],1),a("el-form-item",{staticClass:"flex-form-item form-item-group",staticStyle:{"margin-right":"20px","margin-bottom":"12px"},attrs:{label:"合同搜索："}},[a("el-input",{staticClass:"contract-input",attrs:{placeholder:t.parther_select_placeholder,clearable:""},nativeOn:{keypress:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.reload.apply(null,arguments)}},model:{value:t.queryForm.partner_name,callback:function(e){t.$set(t.queryForm,"partner_name",e)},expression:"queryForm.partner_name"}},[a("el-select",{staticStyle:{width:"116px"},attrs:{slot:"prepend"},slot:"prepend",model:{value:t.partner_select_type,callback:function(e){t.partner_select_type=e},expression:"partner_select_type"}},[a("el-option",{attrs:{value:1,label:"客户名称"}}),a("el-option",{attrs:{value:2,label:"供应商名称"}}),a("el-option",{attrs:{value:3,label:"合同编号"}}),a("el-option",{attrs:{value:4,label:"创建人"}}),a("el-option",{attrs:{value:5,label:"项目名称"}}),a("el-option",{attrs:{value:6,label:"项目编号"}})],1)],1)],1),a("el-form-item",{staticClass:"flex-form-item order-100",staticStyle:{"margin-right":"20px","margin-bottom":"14px","margin-left":"10px"}},[a("tg-button",{attrs:{type:"primary"},on:{click:t.reload}},[t._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:t.reset}},[t._v("重置")])],1)],1)],1),a("tg-card",t._b({staticClass:"result-list Customer-contract mgt-12",class:t.cardFlexClass,attrs:{padding:[18,18,0,18]},on:{"rect:update":t.onRectUpdate}},"tg-card",t.cardProps,!1),[t.Permission.canViewContractList?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{stripe:"",border:"",data:t.list,"row-style":{cursor:"pointer"},height:"100%"},on:{"selection-change":t.handleSelectionChange,"row-click":t.handleRowClick},scopedSlots:t._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无合同数据"}})]},proxy:!0}],null,!1,3611815005)},t._l(t.columns,(function(e,o){return a("el-table-column",t._b({key:o},"el-table-column",e,!1))})),1):t._e(),t.Permission.canViewContractList&&t.list.length?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":t.queryForm.page_num,"page-sizes":[10,20,50,100,200],"page-size":t.queryForm.num,layout:"total,prev, pager, next, sizes, jumper",total:t.total},on:{"update:currentPage":function(e){return t.$set(t.queryForm,"page_num",e)},"update:current-page":function(e){return t.$set(t.queryForm,"page_num",e)},"current-change":t.handleCurrentChange,"size-change":t.handlePageSizeChange}}):t._e()],1),a("review-dialog",{ref:"reviewDialog",on:{approved:t.queryContract}}),a("add-contract-copy-dialog",{ref:"addContractCopyDialogRef",attrs:{contractId:t.contractId},on:{added:t.queryContract}}),a("AnnexDialog",{on:{"dialog:close":t.onAnnexDialogClose}}),a("tg-mask-loading",{attrs:{visible:t.approvalLoading,content:"正在保存，请稍候..."}})],1)},r=[],l=(a(26699),a(97434)),n=(a(93889),a(89935)),c=a(37808),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"addContractCopyDialog"}},[a("common-dialog",{ref:"addContractCopyDialog",attrs:{isAppendToBody:!0,title:t.title,width:500,isfooter_upload:!0},on:{"dialog-cancel":t.dialogCancelHandle,"dialog-submit":t.dialogCancelSubmit}},[a("div",{staticClass:"upload_box",class:{upload_box_bgc:0!==t.contract_copy.length}},t._l(this.contract_copy,(function(e,o){return a("div",{key:o},[""!==t.contract_copy?a("div",{staticClass:"upload-item",staticStyle:{"text-align":"center"}},[a("i",{staticClass:"iconfont iconfujian mr5"}),a("span",{staticClass:"brand-color mr5"},[t._v(t._s(decodeURIComponent(e.split("/")[e.split("/").length-1]||"--")))]),a("i",{staticClass:"iconfont icon-shanchu",on:{click:function(e){return t.clearUploadedFile(o)}}})]):t._e()])})),0),a("div",{staticStyle:{"padding-bottom":"15px","text-align":"center"}},[a("el-upload",{staticStyle:{padding:"10px 50px"},attrs:{disabled:t.no_upload_click,action:"","http-request":t.uploadPlans,"show-file-list":!1,accept:"application/msword, application/pdf, application/vnd.openxmlformats-officedocument.wordprocessingml.document"},scopedSlots:t._u([{key:"tip",fn:function(){return[a("p",{staticClass:"el-upload__tip"},[t._v("支持扩展名：.pdf .doc .docx...(最多上传20个文件)")])]},proxy:!0}])},[a("el-button",{staticClass:"upload-btn btn-blue big-button",staticStyle:{width:"110px"},attrs:{size:"small",type:"primary",disabled:t.no_upload_click}},[a("i",{staticClass:"iconfont icon-zhongxinshangchuan"}),t._v(" "+t._s(20===this.contract_copy.length?"最多传20个":"上传文件")+" ")])],1)],1)])],1)},i=[],p=a(97484),u={name:"addContractCopyDialog",data(){return{title:"",contract_id:"",no_upload_click:!1,descriptionAccepts:["pdf","doc","docx"],loading:!1,contract_copy:[]}},computed:{},props:["contractId"],methods:{show(t){if(this.no_upload_click=!1,this.contract_copy=[],t.contract_detail.contract_scan_urls.length>19&&(this.no_upload_click=!0),t.contract_detail.contract_scan_urls.length>0){this.title="编辑合同扫描件";for(let e=0;e<t.contract_detail.contract_scan_urls.length;e++)this.contract_copy.push(t.contract_detail.contract_scan_urls[e].url)}else this.title="上传合同扫描件",this.contract_copy=[];this.$refs.addContractCopyDialog.dialogOpen(),setTimeout((()=>{this.contract_id=this.contractId}),10)},uploadPlans(t){const e=t.file,a=e.name.split(".")[e.name.split(".").length-1],o=this.descriptionAccepts.find((t=>t.toLowerCase()===a.toLowerCase()));if(!o)return void this.$message.error("上传格式不正确！");this.loading=!0;const r=new FormData;r.append("file",e),r.append("type","contract/scan"),(0,p.cT)(r).then((t=>{this.loading=!1,t.data&&t.data.success?(this.contract_copy.push(t.data.data.source),20===this.contract_copy.length?this.no_upload_click=!0:this.no_upload_click=!1):this.$message.error("上传失败！")})).catch((()=>{this.loading=!1}))},clearUploadedFile(t){this.contract_copy.splice(t,1),this.no_upload_click=!1},dialogCancelHandle(){Object.assign(this.$data,this.$options.data())},dialogCancelSubmit(){(0,p.Y7)({contract_scan_urls:this.contract_copy,contract_id:this.contract_id}).then((t=>{t.data.success?(this.$message.success("上传成功"),this.$refs.addContractCopyDialog.dialogClose(),this.$emit("upload:success")):this.$message.error("上传失败")}))}}},d=u,m=a(1001),_=(0,m.Z)(d,s,i,!1,null,"5908e548",null),g=_.exports,y=a(37144),h=a(86863),f=a(62707),v=a(57325),b=a(7039),C=a(64236),x=a(49998),k=a(17890),w=(a(82741),a(1763)),q=a(21757),$=a(78902),F=a(44928),S=a(58302),D=a(43773),O=a(72253),R=a(83005);const T=!1;var A=(0,l.defineComponent)({name:"ContractApproval",components:{ReviewDialog:y.Z,AddContractCopyDialog:g,AnnexDialog:x.Z},setup(t,e){const a=(0,F.t)(),o=(0,l.computed)((()=>{const t=(0,q.kG)($.HN.law_contract_view),e=(0,q.kG)($.HN.marketing_contract_edit);return{canEditContract:e,canViewContractList:t}}));(0,l.provide)("Permission",o);const r=(0,l.ref)(null),s=(0,l.ref)([]),i=(0,l.ref)(1),p=(0,l.computed)((()=>{let t="";switch(i.value){case 1:t="客户名称";break;case 2:t="供应商名称";break;case 3:t="合同编号";break;case 4:t="创建人";break;case 5:t="项目名称";break;case 6:t="项目编号";break}return`请输入${t}`})),u=(0,l.ref)({sign_type:void 0,contract_status:"console"===a.currentRoute.query.source?2:void 0,manager_id:void 0,is_recycled:"console"===a.currentRoute.query.source?0:void 0,contract_uid:"",partner_type:void 0,last_annex_status:void 0,partner_name:"",page_num:1,num:20,coop_end_date:"",business_type:void 0,contract_scan_flag:void 0,project_name:void 0,project_uid:void 0}),d=()=>{u.value={contract_sign_type:void 0,contract_status:void 0,manager_id:void 0,is_recycled:void 0,contract_uid:"",partner_type:void 0,last_annex_status:void 0,partner_name:"",page_num:1,num:20,coop_end_date:"",business_type:void 0,contract_scan_flag:void 0,project_name:void 0,project_uid:void 0},i.value=1},m=(0,D.R)({component:O.Z,title:"扫描件审核",okText:"驳回",width:"400px",on:{submit:t=>{h(t)}}}),_=(0,b.sm)(e,{dialogProject:m}),g=async(t=!0)=>{await A(t),s.value=_.list.value.map((t=>({status:1===t.contract_info.is_recycled,loading:!1})))},y=(0,l.ref)(!1),h=async t=>{t.status=3,y.value=!0;const a=await(0,R.f6)(t);y.value=!1,a.data.success?(e.root.$message.success(a.data.message??"驳回成功"),g()):e.root.$message.error(a.data.message??"请求失败，请重试")},v=(0,l.ref)(null),x=(0,l.ref)(null),A=async(t=!0)=>{t&&(u.value.page_num=1);const{...e}=u.value,a={...e},o=a.partner_name;switch(a.partner_name=void 0,i.value){case 1:a.partner_name=o;break;case 2:a.provider_name=o;break;case 3:a.contract_uid=o;break;case 4:a.add_by_name=o;break;case 5:a.project_name=o;break;case 6:a.project_uid=o}await _.loadData(a)},P=async()=>{d(),await A()},j=(0,l.computed)((()=>Object.values(f.Rs).includes((x.value??{id:-1}).id))),z=async()=>{u.value.contract_status=2,u.value.num=200,await A()},I=(0,l.ref)({contract_sign_type:2,contract_status:3,is_recycled:5,coop_end_date:7,add_by_name:6,partner_name:1,contract_uid:0}),L=(t,a)=>{if(a){if("操作"===a.label)return;if("项目信息"===a.label&&t.project_infos.length>0)return}1===t.contract_info.contract_type||2===t.contract_info.contract_type||5===t.contract_info.contract_type?e.root.$router.push({name:t.template_info?w.l6.contracts.customer.detailTemplate:w.l6.contracts.customer.detail,params:{id:`${t.contract_info.id}`}}):3===t.contract_info.contract_type||4===t.contract_info.contract_type||6===t.contract_info.contract_type?e.root.$router.push({name:t.template_info?w.l6.contracts.supplier.detailTemplate:w.l6.contracts.supplier.detail,params:{id:`${t.contract_info.id}`},query:{contract_type:`${t.contract_info.contract_type}`}}):e.root.$router.push({name:w.l6.contracts.anchor.detailTemplate,params:{id:`${t.contract_info.id}`},query:{contract_type:`${t.contract_info.contract_type}`}})};(0,l.provide)("contract",(0,l.ref)(void 0)),(0,l.provide)("project_add_id",void 0);const U=0,E=46,M=30,Z=4,H=(0,l.ref)(0),N=t=>{H.value=t.height},V=(0,S.Z)({compensation:U+E+M+Z,fixedBlockHeightRefs:[H],pagename:"legal_contract",delay:100});return{approvalLoading:y,Permission:o,contractId:r,recycledStatusList:s,partner_select_type:i,parther_select_placeholder:p,CONSTRACT_APPROVER:f.Rs,ROLE_CODE:c.b,contractTypeOptions:[{value:void 0,label:"全部"},...n.w1],ApprovalStatusOptions:[{value:void 0,label:"全部"},...k.l7],ContractScanFlagOptions:[{value:void 0,label:"全部"},...k.OX],businessTypeOptions:[{value:void 0,label:"全部"},...n.$X,{value:5,label:"S2B2C"}],saleContractTypeOptions:[{value:void 0,label:"全部"},{value:1,label:"单次合作"},{value:2,label:"框架合同"},{value:3,label:"长期合作"},{value:4,label:"合作协议"},{value:-1,label:"补充协议"},{value:-2,label:"从合同"},{value:-3,label:"解除协议"},{value:-4,label:"结算协议"},{value:11,label:"客户销售合同"},{value:12,label:"供应商采买"}],supplierContractTypeOptions:n.YK,accountManager:[],queryForm:u,..._,reload:A,reset:P,currentUserInfo:x,hasApprovalRight:j,recycled:!1,whitespace:"　",fetchStatements:T?z:C.mz,formItemOrder:I,addContractCopyDialogRef:v,handleRowClick:L,onTopCardRectUpdate:N,queryContract:g,...V}},async mounted(){await this.getAccountManager(),this.currentUserInfo=this.$store.getters["user/getUserInfo"],this.queryContract()},activated(){},methods:{showAddContractCopyDialog(t){this.contractId=t.contract_detail.contract_id,this.$refs.addContractCopyDialogRef.show(t)},getAccountManager(){return new Promise(((t,e)=>{(0,h.em)({role:c.b.customer_manager}).then((a=>{a.data.success?(this.accountManager=a.data.data.user_data,t(!0)):(this.$message({type:"warning",message:a.data.message,duration:2e3,showClose:!0}),e(a.data.message))})).catch((t=>{this.$message({type:"error",message:"客户经理获取失败，稍后重试",duration:2e3,showClose:!0}),e(t)}))}))},handleSelectionChange(t){this.selection=t},handleReviewContractClick(t){this.$refs.reviewDialog.show(t)},handleCurrentChange(t){this.queryForm.page_num=t,this.queryContract(!1)},handlePageSizeChange(t){this.queryForm.num=t,this.queryContract()},fixFileToken:v.W},watch:{$route:{handler(t,e){"StatisticsContact"===t.name&&"StatisticSupplierContractDetailTemplate"!==e.name&&"StatisticCustomerContractDetailTemplate"!==e.name&&"StatisticSupplierContractDetail"!==e.name&&"StatisticCustomerContractDetail"!==e.name&&this.reset()}}}}),P=A,j=(0,m.Z)(P,o,r,!1,null,"f3ec0890",null),z=j.exports}}]);