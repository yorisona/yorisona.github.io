(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[376],{40376:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return k}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"commodity-analysis-week-popular"},[a("TgBreadcrumbs",{attrs:{routes:t.routes}}),a("tg-card",{staticClass:"flex-none",attrs:{padding:[18]},on:{"rect:update":t.onTopCardRectUpdate}},[a("el-form",{staticClass:"filter-form flex-form",attrs:{size:"small","show-message":!1,inline:!0,"label-width":"70px"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"项目名称："}},[a("el-select",{staticStyle:{width:"204px"},attrs:{disabled:"",value:"1"}},[a("el-option",{attrs:{value:"1",label:t.queryForm.project_name}})],1)],1),a("el-form-item",{attrs:{label:"排行规则："}},[a("el-select",{staticStyle:{width:"204px"},model:{value:t.queryForm.sort,callback:function(e){t.$set(t.queryForm,"sort",e)},expression:"queryForm.sort"}},[a("el-option",{attrs:{value:"shop_gmv",label:"销售额"}}),a("el-option",{attrs:{value:"shop_sale_count",label:"销量"}})],1)],1),a("el-form-item",{attrs:{label:"三级类目："}},[a("el-select",{staticStyle:{width:"204px"},model:{value:t.queryForm.third_tiange_cat_id,callback:function(e){t.$set(t.queryForm,"third_tiange_cat_id",e)},expression:"queryForm.third_tiange_cat_id"}},[a("el-option",{attrs:{value:"",label:"全部"}}),t._l(t.cateList,(function(t){return a("el-option",{key:t.id,attrs:{value:t.id,label:t.cat_name}})})),a("el-option",{attrs:{value:2,label:"西装"}})],2)],1),a("el-form-item",{attrs:{label:"对比时间："}},[a("el-date-picker",{staticStyle:{width:"204px"},attrs:{"picker-options":t.pickerOptions,type:"week",clearable:!1,format:"yyyy-MM-dd 第 WW 周","value-format":"yyyy-MM-dd",placeholder:"选择周"},on:{change:t.timeChange},model:{value:t.queryForm.start_date,callback:function(e){t.$set(t.queryForm,"start_date",e)},expression:"queryForm.start_date"}})],1),a("el-form-item",[a("div",{staticStyle:{display:"flex"}},[a("tg-button",{attrs:{type:"primary"},on:{click:t.onSearchClick}},[t._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:t.onResetClick}},[t._v("重置")]),t.lastLastData.length||t.lastData.length?a("tg-button",{staticClass:"mgl-12",attrs:{icon:"ico-btn-export"},on:{click:t.exportImage}},[t._v("导出")]):t._e()],1)])],1)],1),a("tg-card",t._b({staticClass:"flex-auto mgt-12",attrs:{padding:[0,0,18]}},"tg-card",t.cardProps,!1),[a("div",{ref:"imageTofile",staticClass:"main"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main-item",class:0===t.lastData.length&&0===t.lastLastData.length?"isnodata":""},[a("h3",{staticClass:"main-item-title"},[t._v("第"+t._s(t.lastLastWeekNum)+"周TOP")]),a("Table",{attrs:{list:t.lastLastData,"row-style":t.rowColors}})],1),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"main-item last-week",class:0===t.lastData.length&&0===t.lastLastData.length?"isnodata":"",staticStyle:{"padding-right":"18px"}},[a("h3",{staticClass:"main-item-title"},[t._v("第"+t._s(t.lastWeekNum)+"周TOP")]),a("Table",{attrs:{list:t.lastData,"row-style":t.rowColors,rank:!0}})],1)])]),a("tg-mask-loading",{attrs:{visible:t.exprotImageLoading,content:"图片生成中，请稍候..."}})],1)},n=[],o=a(97434),s=a(20809),i=a(1763),l=a(44928),c=a(6933),u=a.n(c),d=a(99575),m=a(88520),f=a(64236),p=a(44801),g=a.n(p);const _=[{name:i.xx.commodityAnalysis,title:"品牌商品分析"},{path:"",title:"每周爆款对比"}],h=["#fdf9df","#e9f9fc","#f0f8f3","#eff3fd","#fef3e7","#fef0fb","#e5fdf3","#deedff","#f5f4da","#fee2e2"];var v=(0,o.defineComponent)({name:"TgCommodityAnalysisWeekPopular",components:{Table:m.Z},setup(t,e){const{tableHeightLogic:a,onTopCardRectUpdate:r}=(0,s.Z)(),n=(0,l.t)(),{project_id:i,project_name:c}=n.currentRoute.query,m=(0,o.reactive)({project_id:i,project_name:c,sort:"shop_gmv",start_date:u()().weekday(-7).format("YYYY-MM-DD"),third_tiange_cat_id:""}),p=(0,o.ref)([]),v=async()=>{const[{data:t}]=await(0,f.Dc)(500,(0,d.LC)());t.success?p.value=t.data:e.root.$message({type:"warning",message:t.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},y=(0,o.ref)(!1),w=(0,o.ref)(u()().weekday(-7).format("WW")),b=(0,o.ref)(u()().weekday(-14).format("WW")),k=(0,o.ref)([]),x=(0,o.ref)([]),C=({row:t})=>{let e={};if(k.value.length>0&&x.value.length>0){const a=new Set(k.value),r=new Set(x.value),n=[...r].filter((t=>[...a].some((e=>e.item_id===t.item_id))));return n.map(((a,r)=>{t.item_id===a.item_id&&(e={"background-color":`${h[r]}`})})),e}},F=async()=>{const t={project_id:m.project_id,start_date:m.start_date,sort:m.sort,third_tiange_cat_id:m.third_tiange_cat_id};y.value=!0;const[{data:a}]=await(0,f.Dc)(500,(0,d.PG)(t));y.value=!1,a.success?(x.value=a.data.shop_live_douyin_items??[],k.value=a.data.last_week_shop_live_douyin_items??[]):e.root.$message({type:"warning",message:a.message??"查询失败，稍后重试",duration:2e3,showClose:!0})};(0,o.onBeforeMount)((()=>{v(),F()}));const D=()=>{F()},T=()=>{m.start_date=u()().weekday(-7).format("YYYY-MM-DD"),w.value=u()().weekday(-7).format("WW"),b.value=u()().weekday(-14).format("WW"),m.third_tiange_cat_id="",m.sort="shop_gmv",F()},S=t=>{m.start_date=u()(t).subtract(1,"days").format("YYYY-MM-DD"),w.value=u()(t).format("w"),b.value=u()(t).weekday(-7).format("w"),F()},Y={disabledDate(t){return t.getTime()>new Date(`${u()().weekday(-1).format("YYYY/MM/DD")} 00:00:01`).getTime()||t.getTime()<new Date("2022/01/1 00:00:00").getTime()},firstDayOfWeek:1},P=(0,o.ref)(void 0),W=(0,o.ref)(!1),$=async()=>{W.value=!0;const t=()=>new Promise(((t,e)=>{const a=document.createElement("canvas"),r=P.value;if(!r)return void e();const n=1,o=r.clientWidth,s=r.clientHeight;a.width=o*n,a.height=s*n,a.style.width=o*n+"px",a.style.height=s*n+"px";const i=a.getContext("2d");if(!i)return void e();i.scale(n,n);const l={scale:n,backgroundColor:"white",canvas:a,useCORS:!0,height:s,width:o};g()(r,l).then((e=>{const a=e.toDataURL("image/png");t(a)}),(()=>{e()}))}));setTimeout((async()=>{const e=await t();e&&L(e),W.value=!1}),100)},L=t=>{const e=document.createElement("a");e.href=t,e.download="每周爆款对比",e.click()};return{routes:_,onTopCardRectUpdate:r,...a,queryForm:m,timeChange:S,onSearchClick:D,onResetClick:T,lastLastWeekNum:b,lastWeekNum:w,lastLastData:k,lastData:x,loading:y,rowColors:C,cateList:p,pickerOptions:Y,exportImage:$,imageTofile:P,exprotImageLoading:W}}}),y=v,w=a(1001),b=(0,w.Z)(y,r,n,!1,null,"4155f98a",null),k=b.exports},88520:function(t,e,a){"use strict";a.d(e,{Z:function(){return p}});var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"popular-top-table"},[a("el-table",{attrs:{data:t.list,border:"","row-style":t.rowStyle},scopedSlots:t._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无数据"}})]},proxy:!0}])},[a("el-table-column",{attrs:{type:"index",label:"排行",width:"50",align:"center"}}),a("el-table-column",{attrs:{label:"商品信息","min-width":"320"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"commodity-box"},[a("div",{staticClass:"pic-box"},[a("el-image",{staticStyle:{cursor:"pointer"},attrs:{fit:"contain",src:e.row.image_url||t.emptyGoods},on:{click:function(a){return t.openDouyin(e.row.item_id)}}})],1),a("div",{staticClass:"info-box"},[a("div",{staticClass:"id-line"},[a("p",{staticClass:"commodity-id"},[t._v(t._s(e.row.item_id))]),t.rank&&e.row.last_week_rank?a("p",{staticClass:"rank"},[t._v(" 上周第"+t._s(t.rankChinese(e.row.last_week_rank))+" ")]):t._e()]),a("p",{staticClass:"commodity-name",on:{click:function(a){return t.openDouyin(e.row.item_id)}}},[t._v(" "+t._s(e.row.title)+" ")]),a("p",{staticClass:"code"},[t._v(t._s(e.row.item_sn?e.row.item_sn:"--"))])])])]}}])}),a("el-table-column",{attrs:{label:"官方类目","min-width":"82",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.first_tiange_cat+"-"+e.row.second_tiange_cat+"-"+e.row.third_tiange_cat))]}}])}),a("el-table-column",{attrs:{label:"单价 (元)","min-width":"90",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.formatPriceFormYuan(e.row.discount_price/100,2,!1)))]}}])}),a("el-table-column",{attrs:{label:"销量","min-width":"75",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.numberFormat(e.row.shop_sale_count,0,".",",")))]}}])}),a("el-table-column",{attrs:{label:"销售额 (元)","min-width":"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.formatPriceFormYuan(e.row.shop_gmv/100,2,!1)))]}}])}),t.rank?a("el-table-column",{attrs:{label:"发货前退款额 (元)",width:"130",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t.formatPriceFormYuan(e.row.shop_refund_status21_gmv/100,2,!1)))]}}],null,!1,2988502600)}):t._e(),t.rank?a("el-table-column",{attrs:{label:"发货前退款比例",width:"120",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.shop_refund_status21_gmv_rate)+"%")]}}],null,!1,2811215568)}):t._e(),t.rank?a("el-table-column",{attrs:{width:"100",align:"right"},scopedSlots:t._u([{key:"header",fn:function(e){return[t._v(t._s(e.column.label)+" "),a("el-popover",{attrs:{placement:"top",trigger:"hover",content:"截止到今日凌晨库存"}},[a("span",{attrs:{slot:"reference"},slot:"reference"},[t._v(" 当日库存 "),a("tg-icon",{staticStyle:{color:"#939393"},attrs:{name:"ico-question"}})],1)])]}},{key:"default",fn:function(e){return[t._v(t._s(e.row.stock_num))]}}],null,!1,3596674283)}):t._e()],1)],1)},n=[],o=a(97434),s=a(45781),i=a(24643),l=a(59760);const{formatPriceFormYuan:c}=s.Z;var u=(0,o.defineComponent)({name:"TgCommodityAnalysisWeekPopularTable",props:{list:{type:Array,default:()=>[]},rowStyle:{type:Function},rank:{type:Boolean,default:!1}},setup(){const t=t=>{window.open(`https://haohuo.jinritemai.com/views/product/item2?id=${t}`)},e=t=>{switch(t){case 1:return"春季";case 2:return"夏季";case 3:return"秋季";case 4:return"冬季";default:return"其他"}},a=t=>{switch(t){case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五";case 6:return"六";case 7:return"七";case 8:return"八";case 9:return"九";case 10:return"十";default:return t}};return{emptyGoods:l,openDouyin:t,formatPriceFormYuan:c,numberFormat:i.Y4,seasonType:e,rankChinese:a}}}),d=u,m=a(1001),f=(0,m.Z)(d,r,n,!1,null,"3b36b21a",null),p=f.exports},58302:function(t,e,a){"use strict";var r=a(97434),n=a(77944),o=a(52140);const s=t=>{const e=(0,r.computed)((()=>n.Z.getters["global/scrollbarSetting"])),a=(0,r.computed)((()=>void 0!==t.pagename?!0!==e.value.find((e=>e.key===t.pagename))?.value:t.disable??!1)),s=(0,r.computed)((()=>{const e=(t.fixedBlockHeightRefs??[]).map((t=>(0,r.unref)(t))).reduce(((t,e)=>(0,r.unref)(t)+(0,r.unref)(e)),0);return a.value?"max-content":`calc(100vh - ${(0,r.unref)(e)+56+36}px)`})),i=(0,r.computed)((()=>(a.value,"flex-auto"))),l=(0,r.computed)((()=>({height:s.value,overflowInBody:!a.value}))),c=(0,r.ref)(0),u=(0,r.computed)((()=>a.value?{}:{height:Math.max(c.value-(0,r.unref)((0,r.unref)(t.compensation)),t.tableMinHeight??0)})),d=a.value?()=>{}:t=>{c.value!==t&&(c.value=t,(0,o.S)())},m=a.value?()=>{}:e=>{0===c.value?setTimeout((()=>{d(e.height)}),t.delay??1200):d(e.height)};return{cardHeight:s,tableProps:u,onRectUpdate:m,rectHeight:c,cardFlexClass:i,cardProps:l}};e["Z"]=s},44928:function(t,e,a){"use strict";a.d(e,{t:function(){return n}});var r=a(86834);const n=()=>{const t=new Proxy({},{get(t,e){return Reflect.get(r.Z,e)}});return t}},20809:function(t,e,a){"use strict";var r=a(97434),n=a(58302);e["Z"]=()=>{const t=32,e=34,a=36,o=31,s=(0,r.ref)(0),i=t=>{s.value=t.height},l=(0,n.Z)({compensation:(0,r.computed)((()=>t+e+a+o)),fixedBlockHeightRefs:[s,25],tableMinHeight:100});return{tableHeightLogic:l,onTopCardRectUpdate:i}}},52140:function(t,e,a){"use strict";a.d(e,{S:function(){return r},n:function(){return n}});const r=()=>{const t=document.createEvent("Event");t.initEvent("resize",!0,!0),window.dispatchEvent(t)},n=()=>{const{width:t,height:e}=document.body.getBoundingClientRect();return{width:t,height:e}}},45781:function(t,e,a){"use strict";var r=a(49187),n=a(8581),o=a(61282);const s=new r.ZP;e["Z"]={formatEmpty(t,e){return null===t||void 0===t||""===t||t instanceof Array&&t.length<=0?"--":void 0!==e?`${t}${e}`:t},formatTime(t){try{return null===t||void 0===t||""===t?"--":t.replace(/-/g,".")}catch(e){return t}},formatTimespan(t){try{if(null===t||void 0===t||""===t)return"--";const e=new Date;return e.setTime(1e3*t),(0,n.WU)(e,"YYYY.mm.dd")}catch(e){return t}},formatPrice(t,e=r.WL.Fen,a=!0){try{if(null===t||void 0===t||""===t)return"--";const r=s.format(s.parse(t,e));return a?`￥${r}`:r}catch(n){return t}},formatPriceFormYuan(t,e=2,a=!0){try{if(null===t||void 0===t||""===t)return"--";let r=t;return r=t>1e8?(t/1e8).toFixed(e)+"亿":t>1e4?(t/1e4).toFixed(e)+"w":(t-0).toFixed(e),a&&(r=`￥${r}`),r}catch(r){return t}},formatPriceToThousand(t,e=2,a=!0,r=!1){try{if(null===t||void 0===t||""===t)return"--";let n=t;return t>1e4?n=(t/1e4).toFixed(e)+"w":(n=(t-0).toFixed(e),r&&(n=(t-0).toFixed(0))),a&&(n=`￥${n}`),n}catch(n){return t}},formatPriceToThousandformatAmount(t,e=2,a=!0,r=!1){try{if(null===t||void 0===t||""===t)return"--";let n=t;return t>1e4?n=(0,o.dN)((t/1e4).toFixed(2),"None")+"w":(n=(0,o.dN)((t-0).toFixed(e),"None",0===e),r&&(n=(t-0).toFixed(0))),a&&(n=`￥${n}`),n}catch(n){return t}},tranNumber(t,e=2){if(null===t||void 0===t||""===t)return"--";if(!(t>=0))return t||"-";t+="";const a=t.toString(),r=a.split(".")[0],n=r.length;if(n<5)return a;if(n>8){const t=r.substring(r.length-8,r.length-8+e);return parseFloat(parseInt(r/1e8+"",10)+"."+t)+"亿"}if(n>4){const t=r.substring(r.length-4,r.length-4+e);return parseFloat(parseInt(r/1e4+"",10)+"."+t)+"w"}}}},44801:function(t,e,a){t.exports=a(70680)(61120)}}]);