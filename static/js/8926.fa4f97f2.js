"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[8926],{53455:function(e,a,t){t.r(a),t.d(a,{default:function(){return P}});var s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"tg-live-display-detail-page"},[t("TgBreadcrumbs",{staticClass:"flex-none",attrs:{routes:e.routes}}),e.inProjectTeam?e._e():t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.PermissionCheckLoading,expression:"PermissionCheckLoading"}],staticClass:"abnormal-empty",staticStyle:{background:"#fff"}},[t("div",{staticClass:"abnormal-empty-content"},[t("empty-common",{attrs:{"detial-text":void 0===e.inProjectTeam?"获取场次详情失败，请稍后重试":"暂无查看当前场次的权限"}})],1)]),e.inProjectTeam&&void 0!==e.displayInfo?t("div",{staticStyle:{height:"100%","flex-grow":"1"}},[t("tg-block",{staticClass:"tg-live-display-info flex-none"},[t("div",{staticClass:"dis-display-title"},[t("div",{staticClass:"dis-display-title-left"},[t("tg-icon",{staticClass:"diaplay-icon",attrs:{name:e.business_icon(e.displayInfo.project_platform_type)}}),t("span",[e._v(e._s(e.displayInfo.live_title))]),e.displayInfo.live_status?t("span",{class:e.statusClasses(e.displayInfo.live_status)},[e._v(e._s(e.liveStatus(e.displayInfo.live_status)))]):e._e()],1),e.displayInfo.project_uid?t("div",{staticClass:"dis-display-title-edit"},[t("el-popover",{attrs:{placement:"top",trigger:"hover",content:"编辑","popper-class":"tg-live-display-detail-custom-popover"}},[e.Permission.canEdit&&e.displayInfo.live_status!==e.LiveDisplayStatus.lived||e.Permission.canEditLived&&e.displayInfo.live_status===e.LiveDisplayStatus.lived?t("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:e.handleEditDisplayAction},slot:"reference"},[t("tg-icon",{attrs:{name:"ico-edit"}})],1):e._e()],1),e.Permission.canEdit&&e.displayInfo.live_status!==e.LiveDisplayStatus.lived?t("span",{staticClass:"verLine"},[e._v("|")]):e._e(),t("el-popover",{attrs:{placement:"top",trigger:"hover",content:"删除","popper-class":"tg-live-display-detail-custom-popover"}},[e.Permission.canEdit&&e.displayInfo.live_status!==e.LiveDisplayStatus.lived?t("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:e.handleDeleteDisplayAction},slot:"reference"},[t("tg-icon",{attrs:{name:"ico-delete"}})],1):e._e()],1),e.Permission.canEdit&&e.displayInfo.live_status!==e.LiveDisplayStatus.lived?t("span",{staticClass:"verLine"},[e._v("|")]):e._e(),t("el-popover",{attrs:{placement:"top",trigger:"hover",content:"关闭","popper-class":"tg-live-display-detail-custom-popover"}},[e.Permission.canEdit&&e.displayInfo.live_status!==e.LiveDisplayStatus.lived?t("tg-button",{attrs:{slot:"reference",type:"link"},on:{click:e.handleCloseDisplayAction},slot:"reference"},[t("tg-icon",{attrs:{name:"ico-power"}})],1):e._e()],1)],1):e._e()]),t("div",{staticClass:"display-datetime-info"},[t("span",[e._v("直播时间："+e._s(e.display_live_date_range_str))]),t("span",[e._v("场次类型："+e._s(e.live_type_str))])])]),t("tg-card",{staticClass:"pane-block flex-auto",attrs:{padding:[0,18,0,18]}},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",stripe:"",height:"calc(100vh - 245px)",data:e.ShopLiveDataList},scopedSlots:e._u([{key:"empty",fn:function(){return[t("empty-common",{attrs:{"detial-text":"暂无商品，快去添加吧~"}})]},proxy:!0}],null,!1,2256302526)},e._l(e.ShopLiveColumns,(function(a,s){return t("el-table-column",e._b({key:s},"el-table-column",a,!1))})),1),t("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.QueryForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.QueryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(a){return e.$set(e.QueryForm,"page_num",a)},"update:current-page":function(a){return e.$set(e.QueryForm,"page_num",a)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}})],1),t("liveDisplayAddDialog",{attrs:{title:"编辑场次",defaultDisplay:e.displayInfo,visible:e.shouldEditing},on:{succeed:e.handleSaveSucceedAction,closeAction:e.handleCloseAction}}),t("tg-mask-loading",{attrs:{visible:e.deleteLoading||e.closeLoading,content:e.deleteLoading?"  正在删除，请稍候...":"  正在关闭，请稍候..."}}),t("TgLiveDisplayDataInputDialog",{attrs:{visible:e.AddLiveDataInputVisible,DisplayInfo:e.LiveDisplayInfoData},on:{"dialog:close":e.onAddDataInputModalClose}}),t("TgLiveScheduleDialog",{attrs:{schedules:e.LiveSchedules,visible:e.LiveScheduleDialogVisible,type:e.LiveScheduleType,detailData:e.displayInfo},on:{"update:visible":function(a){e.LiveScheduleDialogVisible=a},succeed:e.handleUpdateScheduleAction}})],1):e._e(),t("el-dialog",{staticClass:"tg-dialog-classic el-dialog-center-rewrite",attrs:{title:"场次归档",visible:e.dialogVisible,"close-on-click-modal":!1,"close-on-press-escape":!1,wrapperClosable:!1,width:"300px"},on:{close:e.onCancelBtnClick},scopedSlots:e._u([{key:"footer",fn:function(){return[t("tg-button",{on:{click:e.onCancelBtnClick}},[e._v("取消")]),t("tg-button",{attrs:{type:"primary"},on:{click:e.onSaveBtnClick}},[e._v("确定")])]},proxy:!0}])},[t("el-form",{ref:"dialogActualRef",attrs:{"label-width":"106px",size:"small",rules:e.dialog_rules,model:e.dialog_form}},[t("div",{staticClass:"form-box"},[t("el-form-item",{attrs:{label:"实际GMV",prop:"actual_gmv"}},[t("el-input",{attrs:{maxlength:11,placeholder:"请填写实际GMV"},on:{input:e.limitGMV},model:{value:e.dialog_form.actual_gmv,callback:function(a){e.$set(e.dialog_form,"actual_gmv",a)},expression:"dialog_form.actual_gmv"}})],1)],1)])],1)],1)},i=[],l=t(97434),o=t(1763),r=t(8284),n=t(3293),c=t(82741),d=t(88721),u=t(66870),p=t(78902),v=t(21757),m=t(64236),_=t(44928),g=t(74751),f=t(74750),h=t(22112),y=t(6933),D=t.n(y),S=t(29625);const b=()=>{const e=(0,l.ref)({kolSchedules:[],operatorSchedules:[]}),a=(0,l.ref)(!1),t=async a=>{const[{data:t}]=await(0,m.Dc)(300,(0,n.D2)(a));t.success?(e.value.kolSchedules=t.data.kol_schedule_list,e.value.operatorSchedules=t.data.operator_schedule_list):(e.value.kolSchedules=[],e.value.operatorSchedules=[])};return{loading:a,loadScheduleData:t,ScheduleData:e}};var L=t(83626),C=t(24643),k=t(61282),w=t(67910);const I=(0,f.LP)();var $=(0,l.defineComponent)({name:"TgLiveDisplay",components:{liveDisplayAddDialog:r.Z,TgLiveDisplayDataInputDialog:g.Z,TgLiveScheduleDialog:h.Z},props:{id:{type:Number,required:!0}},setup(e,a){const t=(0,v.gI)(),s=(0,_.t)(),i=s.currentRoute.params.liveId,r=s.currentRoute.params.id,n=A(a,r,i),c=(0,l.ref)(!1),d=(0,l.ref)([]),u=(0,l.ref)({page_num:1,num:10,live_id:i}),p=(0,l.ref)(0),m=(0,l.ref)({}),g=(0,l.ref)(!1),f=()=>{g.value=!0,m.value={}},h=()=>{g.value=!1,z()},y=()=>{g.value=!1,a.root.$message.success("编辑成功"),z(!1)},D=e=>{g.value=!0,m.value=e},S=async e=>{const t=await new Promise((e=>{a.root.$TDialog({title:"你确定删除吗",onConfirm:()=>{e(!0)},onCancel:()=>{e(!1)}})}));if(!t)return;const s=await(0,L.R5)(e.id);s.data.success?(a.root.$message.success("删除成功"),z(!1)):a.root.$message.error(s.data.message)},b=(e,a,t,s)=>{const i=e[a]||"--",{is_folded:o,folded_text:r}=(0,k.zb)(i,t);return s||!o?r:(0,l.h)("el-popover",{props:{placement:"right",trigger:"hover",content:i}},[(0,l.h)("span",{slot:"reference"},[r]),(0,l.h)("DefText",{props:{content:e[a]}})])},I=(e,a)=>b(e,"product_code",8,a),$=(0,w.zY)(d,"商品ID",I),x=(e,a)=>b(e,"product_name",14,a),E=(0,w.zY)(d,"商品名称",x),T=(e,a)=>b(e,"company_name",14,a),P=(0,w.zY)(d,"所属公司",T),G=(e,a)=>b(e,"shop_name",10,a),H=(0,w.zY)(d,"所属店铺",G),M=(e,a)=>b(e,"brand_name",10,a),j=(0,w.zY)(d,"品牌",M),R=(0,l.computed)((()=>[{label:"商品ID",minWidth:$.value,formatter:e=>I(e,!1)},{label:"商品名称",minWidth:E.value,formatter:e=>x(e,!1)},{label:"所属公司",minWidth:P.value,formatter:e=>T(e,!1)},{label:"所属店铺",minWidth:H.value,formatter:e=>G(e,!1)},{label:"品牌",minWidth:j.value,formatter:e=>M(e,!1)},{label:"收入坑位费 (元)",minWidth:130,align:"right",formatter:e=>e.has_pit_fee?(0,C.rH)(e.income_pit_fee,2,".",",",!1):"--"},{label:"支出坑位费 (元)",minWidth:130,align:"right",formatter:e=>e.has_pit_fee?(0,C.rH)(e.expend_pit_fee,2,".",",",!1):"--"},{label:"招商人员",minWidth:104,align:"center",formatter:e=>e.add_by_name}])),z=async e=>{e&&(u.value.page_num=1);const t=await(0,L.Iq)({page_num:u.value.page_num,num:u.value.num,live_id:i,project_id:r});t.data.success?(d.value=t.data.data.data,p.value=t.data.data.total):(d.value=[],p.value=0,a.root.$message.warning(t.message??"查询失败，稍后重试"))},Y=[{name:o.u3.project.list,title:"项目管理"},{name:o.u3.project.detail,title:"项目详情",params:{id:s.currentRoute.params.id,tab:s.currentRoute.params.tab,liveType:s.currentRoute.params.liveType}},{path:"",title:"场次详情"}];z();const N=e=>{u.value.page_num=e,z(!1)},V=e=>{u.value.num=e,z()};return(0,l.reactive)({routes:Y,permission:t,total:p,ShopLiveDataList:d,ShopLiveColumns:R,QueryForm:u,GetProjectShopLive:z,addGoodsDialogVisible:g,addMerchantGoodsClick:f,onMerchantGoodsSave:h,onMerchantGoodsEdit:y,merchantGoods:m,handleCurrentChange:N,handlePageSizeChange:V,loading:c,onEditBtnClick:D,onDeleteBtnClick:S,...n})}});function A(e,a,t){const s=(0,l.ref)(void 0),i=(0,l.ref)("anchor");(0,l.provide)("liveDisplay",s);const r=(0,l.ref)(!1),g=(0,l.ref)(!1),f=(0,l.ref)(!1),h=(0,l.ref)(!1),y=async()=>{if(R.value.canEdit&&s.value?.live_status!==u.wG.lived)h.value=!0;else if(R.value.canEditLived&&s.value?.live_status===u.wG.lived){const a=await(0,c.I)(e,{title:"是否设置成未归档？",cancelText:"否",confirmText:"是"});if(a){const a=await(0,n.Xz)({shop_live_id:t});a.data.success?(e.root.$message.success(a.data.message),W()):e.root.$message.error(a.data.message)}}},L=(0,_.t)(),C=async()=>{const s=await(0,c.I)(e,"确认删除本场次？");if(s){f.value=!0;const s=await(0,n.Ct)(t);f.value=!1,s.data.success?(e.root.$message.success("删除成功"),e.root.$router.push({name:o.u3.project.detail,params:{id:a,tab:L.currentRoute.params.tab,liveType:L.currentRoute.params.liveType}})):e.root.$message.error(s.data.message??"删除失败，稍后重试")}},k=(0,l.ref)(),w=(0,l.ref)(),$=async()=>new Promise(((e,a)=>{ge.value.actual_gmv="",me.value=!0,k.value=e,w.value=a})),A=async()=>{let a;60===s.value?.live_type&&(a=await $());const i=await(0,c.I)(e,"关闭后场次相关信息无法修改，确认是否关闭");if(i){g.value=!0;const s=await(0,n.ls)(t,a);g.value=!1,s.data.success?(e.root.$message.success("关闭成功"),x()):e.root.$message.error(s.data.message??"关闭失败，稍后重试")}},x=async()=>{const{data:a}=await(0,n.g)(t);a.success?s.value=a.data:e.root.$message.error(a.message??"查询失败，稍后重试")},E=(0,l.computed)((()=>{let e;switch(void 0!==s.value&&void 0!==s.value.live_type&&(e=s.value.live_type),e){case 60:return"直播";case 61:return"短视频";case 62:return"图文";default:return""}})),T=(0,l.ref)(!1),P=()=>{h.value=!1},G=async()=>{h.value=!1,await W()},H=(e,a)=>{if(!e||!a)return"";const t=`${e} ~ ${a}`;return t.replace(/-/g,".")},M=e=>e===u.wG.lived?"已归档":"未归档",j=e=>e===u.wG.lived?"status-green-color":"status-light-color",R=(0,l.computed)((()=>{const e=(0,v.kG)(p.HN.mcn_save_shop_live),a=(0,v.kG)(p.HN.mcn_lived_edit_shop_live),t=(0,v.kG)(p.HN.live_streamer_schedule),s=(0,v.kG)(p.HN.live_operation_schedule),i=(0,v.kG)(p.HN.view_shop_live_archive);return{canEdit:e,canEditLived:a,canEditArchive:i,canEditKOLSchedule:t,canEditOperatorSchedule:s}})),z=e=>{if(e)switch(e){case 2:return"ico-taobao";case 1:return"ico-douyin";default:return""}},{loadScheduleData:Y,ScheduleData:N,...V}=b(),W=async()=>{T.value=!0,await x(),T.value=!1};(0,l.provide)("reload",W);const B=(0,l.ref)([]),Q=async()=>{const{data:a}=await(0,n.cK)(t);a.success?B.value=a.data:e.root.$message.warning("直播留档数据获取失败")},Z=(0,l.ref)({contrast_live_id:"",promote_order_amount:"",promote_order_num:"",promote_order_person:"",promote_order_conversion_rate:"",view_link:"",fans_order_amount_percent:""}),q=(0,l.ref)([]),F=(0,l.ref)(!1),O=()=>{J.value={id:-1,live_url:"",real_start_time:"",real_end_time:"",duration_screenshot:"",data_screenshot:"",real_duration:""},F.value=!0},U=async e=>{F.value=!1,e&&await Q()},J=(0,l.ref)({id:-1,live_url:"",real_start_time:"",real_end_time:"",duration_screenshot:"",data_screenshot:"",real_duration:""}),K=(0,l.ref)(!1),X=(0,l.ref)({kol:[],operator:[]}),ee=e=>{K.value=!0,i.value=e,"anchor"===e?X.value.kol=N.value.kolSchedules.map((e=>(e.id=e.kol_id,e))):X.value.operator=N.value.operatorSchedules.map((e=>(e.id=e.user_id,e)))},ae=(e,a)=>{const t=D()(e),s=D()(a),i=t.isSame(s,"d");let l=`${t.format("HH:mm")} ~ ${s.format("HH:mm")}`;return i||(l=`${l}(次日)`),l},te=(e,a)=>{if(e&&a){e*=1e3,a*=1e3;const t=D()(e),s=D()(a),i=t.isSame(s,"d");let l=`${t.format("YYYY.MM.DD HH:mm")} ~ ${s.format("HH:mm")}`;return i||(l=`${l}(次日)`),l}},se=async a=>{const t=await(0,c.I)(e,"确认删除留档数据吗？");if(!t)return;const[{data:s}]=await(0,m.Dc)(200,(0,n.wG)(a));s.success?(e.root.$message.success(s.message??"删除成功"),await Q()):e.root.$message.error(s.message??"删除失败")},ie=(0,l.computed)((()=>{if(s.value?.live_start_time&&s.value?.live_end_time){const e=D()(s.value?.live_start_time),a=D()(s.value?.live_end_time),t=e.isSame(a,"d");let i=`${e.format("YYYY.MM.DD HH:mm")} ~ ${a.format("HH:mm")}`;return t||(i=`${i}(次日)`),i}return""})),le=async e=>{F.value=!0,J.value.duration_screenshot=e.duration_screenshot,J.value.data_screenshot=e.data_screenshot,J.value.live_url=e.live_url,J.value.id=e.id,J.value.real_start_time=e.real_start_time,J.value.real_end_time=e.real_end_time,J.value.real_duration=e.real_duration},oe=async()=>{await Y(t)},re=(0,l.computed)((()=>s.value?.live_status!==u.wG.lived)),ne=(0,l.computed)((()=>{const e=new Map,a=[];return N.value.kolSchedules.forEach((a=>{const t=ae(a.start_time,a.end_time),s="("+(a.real_name??"--")+")",i=a.kol_name?a.kol_name+s:"";if(e.get(t)){const a=e.get(t);a.push(i),e.set(t,a)}else e.set(t,[i])})),e.forEach((function(e,t){a.push({date_range_str:t,users_str:e.join("、")})})),a})),ce=(0,l.computed)((()=>{const e=new Map,a=[];return N.value.operatorSchedules.forEach((a=>{const t=ae(a.start_time,a.end_time);if(e.get(t)){const s=e.get(t);s.push(a.operator_name),e.set(t,s)}else e.set(t,[a.operator_name])})),e.forEach((function(e,t){a.push({date_range_str:t,users_str:" "+e.join("、")})})),a})),de=(0,l.computed)((()=>s.value?.business_type===S.WD.taobao)),ue=(0,l.ref)(void 0),pe=(0,l.ref)(!1),ve={queryInProjectTeam:async()=>{pe.value=!0;const e=await(0,n.gs)(a.toString());pe.value=!1,e.data.success&&(ue.value=!0,ue.value&&W())}};(0,l.onBeforeMount)((()=>{ve.queryInProjectTeam()}));const me=(0,l.ref)(!1),_e=(0,l.ref)(),ge=(0,l.ref)({actual_gmv:""}),fe={actual_gmv:[{required:!0,message:"请填写实际GMV",trigger:"blur"}]},he=()=>{_e.value?.validate((e=>{e&&(me.value=!1,k.value(100*ge.value.actual_gmv))}))},ye=()=>{me.value=!1},De=e=>{const a=d.Z.IntergerAndDecimals(e);return ge.value.actual_gmv=a,a};return{limitGMV:De,onCancelBtnClick:ye,onSaveBtnClick:he,dialogActualRef:_e,dialog_rules:fe,dialog_form:ge,dialogVisible:me,live_type_str:E,ReloadDetailLoading:T,PermissionCheckLoading:pe,inProjectTeam:ue,isTaobaoDisplay:de,TaobaoLiveLogs:q,OperatorScheduleList:ce,kolScheduleList:ne,CanEditStatus:re,formDateRangeStr:ae,LiveStatData:Z,handleUpdateScheduleAction:oe,LiveSchedules:X,handleUpdateDisplayInfoDataAction:le,display_live_date_range_str:ie,handleDeleteDisplayInfoDataAction:se,GetDateRangeStr:te,Permission:R,reload:W,isExpand:r,displayInfo:s,closeLoading:g,deleteLoading:f,shouldEditing:h,handleEditDisplayAction:y,handleCloseDisplayAction:A,handleDeleteDisplayAction:C,handleCloseAction:P,handleSaveSucceedAction:G,liveTime:H,liveStatus:M,LiveDisplayStatus:u.wG,statusClasses:j,business_icon:z,ScheduleData:N,ShopLiveRecordDataList:B,LiveDisplayInfoData:J,AddLiveDataInputVisible:F,onAddDataInputModalClose:U,AddLiveRecordHandler:O,handleEditDisplayScheduleAction:ee,LiveScheduleDialogVisible:K,JWToken:I,LiveScheduleType:i,shop_live_id:t}}var x=$,E=t(1001),T=(0,E.Z)(x,s,i,!1,null,"cfadea2c",null),P=T.exports},88721:function(e,a,t){var s=t(41572);t(97434);const i={IntergerAndDecimals(e){const a=/(\d+)$|\d+\.?\d{0,2}/.exec(e);return a?a[0]:""},Interger(e){return e.replace(/[^\d]/g,"")},NumberRange(e,a){return t=>{const s=this.IntergerAndDecimals(t);if(""===s)return s;const i=Number(s);return i<e?e+"":i>a?a+"":s}},Thousands(e){if(null===e||void 0===e||""===e)return e;e+="";const a=/^(\d+)(\.\d+$)?$/.exec(e+"");if(!a)return e;const t=a[1],s=a[2];let i=t.replace(/(\d{1,3})(?=(\d{3})+$)/g,(e=>`${e},`));return void 0!==s&&(i=`${i}${s}`),i},NineIntergerAndDecimals(e){const a=(/(?:0|[1-9]\d{0,8})(?:\.\d{0,2})?/u.exec(e.replace(/[^.\d]+/gu,"").replace(s.Pj,""))??[""])[0];return a}};a["Z"]=i},67910:function(e,a,t){t.d(a,{P6:function(){return n},zY:function(){return r}});var s=t(97434),i=t(61282),l=t(85937),o=t.n(l);const r=(e,a,t,l=20)=>(0,s.computed)((()=>Math.ceil(Math.max(...e.value.map((e=>(0,i.QN)(t(e,!0)))),(0,i.QN)(a)))+l+6)),n=(e,a=!0)=>{let t;return t=""===e||void 0===e?"--":(0,i.SJ)(new(o())(e??0)),a?(0,s.h)("span",[`￥${t}`]):(0,s.h)("span",[`${t}`])}}}]);