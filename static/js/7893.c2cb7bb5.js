"use strict";(self["webpackChunkgoumee_star_temp"]=self["webpackChunkgoumee_star_temp"]||[]).push([[7893],{2698:function(e,t,a){a.d(t,{Z:function(){return f}});var i=a(97434),s=a(49187),l=a(85937),n=a.n(l);const o=new s.ZP,r=e=>""===e||void 0===e?"--":`${o.format(e,s.WL.Yuan)}`;var c,u,d=(0,i.defineComponent)({props:{write_off_infos:Array,write_off_header:{type:Array,default:()=>[]},write_off_status:{type:Number},is_reverse:{type:Boolean,default:!1}},name:"WriteOff",render(){const e=arguments[0],t=[];let a=0;return 3===(this.write_off_header?.length??0)&&(a=-1),2===this.write_off_status?t.push(e("div",{class:"status",key:"key1"},[e("label",["状态："]),e("span",["已核销"])])):1===this.write_off_status?t.push(e("div",{class:"status",key:"key2"},[e("label",["状态："]),e("span",{class:"yellow"},["部分核销"])])):0===this.write_off_status&&t.push(e("div",{class:"status",key:"key3"},[e("label",["状态："]),e("span",{class:"yellow"},["未核销"])])),(this.write_off_infos?.length??0)>0&&t.push(e("div",{class:"status",key:"key4"},[e("label",["详情："]),e("el-popover",{attrs:{placement:"bottom-end",trigger:"hover","popper-class":"achievement-popover"}},[e("a",{slot:"reference"},["预览"]),e("div",{style:0===a?"width: 604px":"width: 444px",class:"writeoff-popover-content"},[e("div",{class:"table-header"},[e("table",[e("colgroup",[0===a?e("col",{style:"width:170px"}):"",e("col"),e("col",{style:"width:128px"}),e("col",{style:"width:102px"})]),e("thead",[e("tr",[0===a?e("th",[this.write_off_header[a]]):"",e("th",[this.write_off_header[a+1]]),e("th",{attrs:{align:"right"}},[this.write_off_header[a+2]]),e("th",[this.write_off_header[a+3]])])])])]),e("div",{class:"table-body"},[e("table",[e("colgroup",[0===a?e("col",{style:"width:170px"}):"",e("col"),e("col",{style:"width:128px"}),e("col",{style:"width:102px"})]),e("tbody",[this.write_off_infos?.map((t=>{const i=/-/u.test(t[a+2]);return e("tr",[0===a?e("td",[t[a]]):"",e("td",{class:i?"reverse-red":""},[t[a+1]]),e("td",{class:i||new(n())(t[a+2]).lessThan(new(n())(0))?"reverse-red":"",attrs:{align:"right"}},[r(t[a+2])]),e("td",[e("div",[t[a+3]]),e("div",{class:"label"},[t[a+4]])])])}))])])])])])])),e("div",[t])}}),p=d,m=a(1001),_=(0,m.Z)(p,c,u,!1,null,"76e5bcce",null),f=_.exports},62068:function(e,t,a){a.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-popover",{attrs:{trigger:"hover","popper-class":"pop-receivable",placement:"bottom-end"}},[a("div",{staticClass:"pop-receivable-detail"},[a("div",{staticClass:"receivable-detail-content"},[a("div",{staticClass:"detail-header"},[e.showSettlementUid?a("div",{staticClass:"header column-width"},[e._v("结算单编号")]):e._e(),a("div",{staticClass:"header column-width"},[e._v(e._s(e.firstColumnHeader))]),a("div",{staticClass:"header right column-width"},[e._v("核销金额 (元)")]),a("div",{staticClass:"header column-width"},[e._v("核销人/日期")])]),a("div",{staticClass:"detail-body"},e._l(e.list,(function(t,i){return a("div",{key:i,staticClass:"body-row"},[e.showSettlementUid?a("div",{staticClass:"rg right column-width"},[a("span",[e._v(e._s(t.settlement_uid))])]):e._e(),"receivable"===e.type?a("div",{staticClass:"rg right column-width"},[a("span",{style:String(t.write_off_amount).startsWith("-")?"color: #e91313":""},[e._v(e._s(t.receipt_uid))])]):e._e(),"receive"===e.type?a("div",{staticClass:"rg right column-width"},[a("span",{style:String(t.write_off_amount).startsWith("-")?"color: #e91313":""},[e._v(e._s(t.receivable_uid))])]):e._e(),"payable"===e.type?a("div",{staticClass:"rg right column-width"},[a("span",{style:String(t.write_off_amount).startsWith("-")?"color: #e91313":""},[e._v(" "+e._s(t.cost_id)+" ")])]):e._e(),"commonBusinessPayableActual"===e.type?a("div",{staticClass:"rg right column-width"},[a("span",{style:String(t.write_off_amount).startsWith("-")?"color: #e91313":""},[e._v(" "+e._s(t.payable_uid)+" ")])]):e._e(),a("div",{staticClass:"rg right column-width"},[a("span",{style:t.write_off_amount<0?"color: #e91313":""},[e._v(e._s(e.formatAmount(t.write_off_amount,"")))])]),a("div",{staticClass:"rg column-width"},[a("div",[a("p",[e._v(e._s(t.write_off_user))]),a("span",{staticClass:"write-date"},[e._v(e._s(t.write_off_time))])])])])})),0)])]),a("tg-button",{style:{color:e.btncolor},attrs:{slot:"reference",type:"link"},slot:"reference"},[e._v(e._s(e.btntitle))])],1)},s=[],l=a(97434),n=a(61282),o=(0,l.defineComponent)({props:{list:{type:Array,default:()=>[]},type:{type:String,default:"receivable"},btntitle:{type:String,default:"预览"},btncolor:{type:String,default:"#2877ff"},showSettlementUid:{type:Boolean,default:!1}},setup(e,t){const a=(0,l.computed)((()=>{let t="";return"receivable"===e.type?t="单据编号":"receive"===e.type?t="应收编号":"payable"===e.type?t="单据编号":"commonBusinessPayableActual"===e.type&&(t="应付编号"),t}));return{firstColumnHeader:a,formatAmount:n.dN}}}),r=o,c=a(1001),u=(0,c.Z)(r,i,s,!1,null,"6ce85114",null),d=u.exports},96752:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ze}});var i,s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"finance-invoice-page"},[a("tg-block",{staticClass:"flex-none",staticStyle:{height:"48px"},attrs:{bodyStyle:{padding:"0"}}},[a("tg-tabs",{attrs:{tabs:e.tabs,bottom:""},on:{change:e.onTabChange},model:{value:e.checkedTab,callback:function(t){e.checkedTab=t},expression:"checkedTab"}})],1),a(e.tabPane,{tag:"component",staticClass:"flex-auto"})],1)},l=[],n=a(97434),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("tg-card",{attrs:{padding:[18,18,6,18]},on:{"rect:update":e.onTopCardRectUpdate}},[a("el-form",{attrs:{size:"small","label-width":"70px"},nativeOn:{submit:function(t){return t.preventDefault(),e.onFilterFormSubmit.apply(null,arguments)}}},[a("div",{staticClass:"filter-form-div"},[a("div",{staticClass:"filter-form-item",staticStyle:{"min-width":"314px"}},[a("el-form-item",{attrs:{label:"项目搜索："}},[a("el-input",{staticClass:"input-with-select",staticStyle:{width:"244px"},attrs:{placeholder:"请输入关键字"},model:{value:e.filterForm.search_value,callback:function(t){e.$set(e.filterForm,"search_value",t)},expression:"filterForm.search_value"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.filterForm.search_type,callback:function(t){e.$set(e.filterForm,"search_type",t)},expression:"filterForm.search_type"}},[a("el-option",{attrs:{label:"项目名称",value:1}}),a("el-option",{attrs:{label:"项目编码",value:2}}),a("el-option",{attrs:{label:"客户名称",value:3}}),a("el-option",{attrs:{label:"结算编号",value:5}})],1)],1)],1)],1),a("div",{staticClass:"filter-form-item"},[a("el-form-item",{attrs:{label:"结算状态："}},[a("el-select",{staticStyle:{width:"100%"},model:{value:e.filterForm.status,callback:function(t){e.$set(e.filterForm,"status",t)},expression:"filterForm.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._l(e.SettlementStatusOptions,(function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})}))],2)],1)],1),a("div",{staticClass:"filter-form-item"},[a("el-form-item",{attrs:{label:"结算周期："}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"month",placeholder:"选择月","value-format":"yyyy-MM"},model:{value:e.filterForm.month,callback:function(t){e.$set(e.filterForm,"month",t)},expression:"filterForm.month"}})],1)],1),a("div",{staticClass:"filter-form-item",staticStyle:{"min-width":"274px"}},[a("el-form-item",{attrs:{"label-width":"0"}},[a("div",{staticClass:"filter-form-item-btn"},[a("tg-button",{attrs:{type:"primary"},on:{click:e.onSearchClick}},[e._v("查询")]),a("tg-button",{staticClass:"mgl-12",on:{click:e.onResetClick}},[e._v("重置")])],1)])],1)])])],1),a("tg-card",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"mgt-12",class:e.cardFlexClass,attrs:{padding:[0,18,0,18]},on:{"rect:update":e.onRectUpdate}},"tg-card",e.cardProps,!1),[a("tg-button-line",{staticClass:"mgt-12"},[a("tg-button",{attrs:{icon:"ico-btn-add",type:"primary"},on:{click:e.onApproveBtnClick}},[e._v("结算单审批")])],1),a("el-table",e._b({staticClass:"mgt-12",attrs:{stripe:"",border:"",data:e.data},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common")]},proxy:!0}])},"el-table",e.tableProps,!1),e._l(e.columns,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),1),e.total>0?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.filterForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.filterForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.filterForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.filterForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}}):e._e(),a("SettlementDialog",{ref:"settlementRef",on:{close:e.onDialogClose}}),a("buessiness-settlement",{ref:"BuessinessSettlement",attrs:{readonly:e.onlyCheckDetail},on:{success:e.reload}}),a("achievement",{ref:"achievementRef",on:{ok:e.reload}}),a("reverseOrderDialog",{ref:"reverseOrderDialogRef"}),a("make-invoice-dialog",{ref:"MakeInvoiceDialogRef",attrs:{reload:!0},on:{success:e.reload}}),a("settlementApprove",{attrs:{isMerchant:!0,visible:e.approveVisible},on:{"update:visible":function(t){e.approveVisible=t},"dialog:close":e.onApproveClose}}),a("reverseAuditDialog",{ref:"reverseAuditDialogRef"}),a("el-dialog",{staticClass:"tg-dialog-classic tg-dialog-vcenter",attrs:{visible:e.reasonDialogVisible,width:"440px"},on:{close:e.onReasonDialogClose},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.reasonDialogTitle))]},proxy:!0}])},[a("div",{staticClass:"reason-dialog-content"},[e._v(e._s(e.reason))])])],1),a("tg-mask-loading",{attrs:{visible:e.ladingStatus,content:e.loadingText}})],1)},r=[],c=a(20809),u=a(28348),d=a(99166),p=a(64236),m=a(71963),_=a(10079),f=a(67578),v=a(85937),h=a.n(v),g=a(61282),y=a(67910),b=a(21757);(function(e){e[e["edit"]=0]="edit",e[e["delete"]=1]="delete",e[e["check"]=2]="check",e[e["checkReason"]=3]="checkReason",e[e["financeComfirm"]=4]="financeComfirm",e[e["writeOff"]=5]="writeOff",e[e["writeOffAgain"]=6]="writeOffAgain",e[e["writeOffConfirm"]=7]="writeOffConfirm",e[e["collection"]=8]="collection",e[e["billing"]=9]="billing",e[e["refundedCheck"]=10]="refundedCheck",e[e["refundedCheckResaon"]=11]="refundedCheckResaon"})(i||(i={}));const w=(e,t)=>{const a=(0,n.ref)(!1),s=(0,n.ref)(0),l=(0,n.ref)([]),o=async t=>{a.value=!0;const[i,{data:n}]=await Promise.all([await(0,p._v)(500),await(0,m.W_)(t)]);a.value=!1,n.success?(l.value=n.data.data,s.value=n.data.total):e.root.$message({type:"warning",message:n.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},{settlement_number_column:r,settlement_company_column:c,settlement_cycle_column:v,settlement_money_column:w,settlement_tax_rate_column:C,settlement_tax_amount_column:k,settlement_no_tax_amount_column:x,settlement_status_column:S,write_off_status_column:A,settlement_person_column:j,submit_date_column:D,confirm_person_column:F,confirm_date_column:$,settlement_bill_column:P}=(0,d.S)(l),R=(e,t)=>{const a=e.project_name||"--",{is_folded:i,folded_text:s}=(0,g.zb)(a);return t?s:i?(0,n.h)("el-popover",{props:{placement:"bottom",trigger:"hover",content:a}},[(0,n.h)("span",{slot:"reference"},[s])]):s},I=(0,y.zY)(l,"项目名称",R),T=(0,b.gI)(),O=(0,n.computed)((()=>[r.value,v.value,c.value,w.value,C.value,k.value,x.value,{label:"相关项目",property:"project_name",minWidth:I.value,formatter:e=>R(e,!1)},{label:"招商收入 (元)",minWidth:120,align:"right",formatter:e=>{const t=(0,g.SJ)(new(h())(e.merchant_income_amount??0));return t}},{label:"项目收入 (元)",minWidth:120,align:"right",formatter:e=>{const t=(0,g.SJ)(new(h())(e.project_income_amount??0));return t}},S.value,A.value,j.value,D.value,F.value,$.value,P.value,{label:"操作",minWidth:200,fixed:"right",formatter:e=>{const a=[],s=(0,n.h)("a",{on:{click:a=>{t(i.edit,e),a.stopPropagation()}},class:"line-clamp-1"},["编辑"]),l=T.merchant_settlement_del?(0,n.h)("a",{on:{click:a=>{t(i.delete,e),a.stopPropagation()}},class:"line-clamp-1"},["删除"]):void 0,o=(0,n.h)("a",{on:{click:a=>{t(i.check,e),a.stopPropagation()}},class:"line-clamp-1"},["查看"]),r=(0,n.h)("a",{on:{click:a=>{t(i.checkReason,e),a.stopPropagation()}},class:"line-clamp-1"},["查看原因"]),c=T.merchant_settlement_confirmed?(0,n.h)("a",{on:{click:a=>{t(i.financeComfirm,e),a.stopPropagation()}},class:"line-clamp-1"},["财务确认"]):void 0,d=(0,n.h)("a",{on:{click:a=>{t(i.writeOff,e),a.stopPropagation()}},class:"line-clamp-1",style:{color:"#e91313"}},["冲销"]),p=T.merchant_settlement_collection?(0,n.h)("tg-button",{props:{type:"link",disabled:(e.settlement_no_register_amount??0)<=0},on:{click:a=>{e.settlement_no_register_amount&&e.settlement_no_register_amount>0&&t(i.collection,e),a.stopPropagation()}},class:"line-clamp-1"},["收款"]):void 0,m=T.merchant_settlement_invoice?(0,n.h)("a",{on:{click:a=>{t(i.billing,e),a.stopPropagation()}},class:"line-clamp-1"},["开票申请"]):void 0,v=(0,n.h)("a",{on:{click:a=>{t(i.writeOffAgain,e),a.stopPropagation()}},class:"line-clamp-1"},["重新提交"]),h=(0,n.h)("a",{on:{click:a=>{t(i.writeOffConfirm,e),a.stopPropagation()}},class:"line-clamp-1"},["冲销确认"]),g=(0,n.h)("a",{on:{click:a=>{t(i.refundedCheck,e),a.stopPropagation()}},class:"line-clamp-1"},["查看"]),y=(0,n.h)("a",{on:{click:a=>{t(i.refundedCheckResaon,e),a.stopPropagation()}},class:"line-clamp-1"},["查看原因"]);if((0,_.Ep)(e)){const{refund_status:t=1}=e;switch(t){case 1:break;case 2:a.push(g);break;case 3:a.push(y),a.push(l);break;default:break}}else if((0,_.vs)(e))switch(e.reverse_status){case f.h0.refused:a.push(l),a.push(v),a.push(r);break;case f.h0.wait_confirm:a.push(h);break;default:a.push(o);break}else switch(e.status){case u.ne.unsubmit:a.push(s),a.push(l);break;case u.ne.wait_confirm:a.push(o),a.push(c);break;case u.ne.refused:a.push(r),a.push(s),a.push(l);break;case u.ne.confirmed:if(a.push(o),!e.reverse_id){1!==e.has_refund_settlement&&a.push(d),e.settlement_no_write_off_amount&&a.push(p);const t=e.write_off_amount?`${e.write_off_amount}`:"0",i=e.tax_included_amount?`${e.tax_included_amount}`:"0";t!==i&&a.push(m)}break;case u.ne.wait_project_confirm:a.push(o);break;case u.ne.nopass_project_confirm:a.push(r),a.push(s),a.push(l);break;default:break}return(0,n.h)("div",{class:"operation"},a)}}]));return{loadData:o,loading:a,total:s,data:l,columns:O}};var C;(function(e){e[e["unsubmitted"]=0]="unsubmitted",e[e["wait_confirm"]=1]="wait_confirm",e[e["confirmed"]=2]="confirmed",e[e["refused"]=3]="refused",e[e["wai_project_confirm"]=4]="wai_project_confirm",e[e["project_confirm_fail"]=5]="project_confirm_fail"})(C||(C={}));new Map([[C.unsubmitted,"未提交"],[C.wait_confirm,"待确认"],[C.confirmed,"已确认"],[C.refused,"退回"],[C.wai_project_confirm,"待项目确认"],[C.project_confirm_fail,"项目确认不通过"]]);const k=[{value:C.unsubmitted,label:"未提交"},{value:C.wait_confirm,label:"待确认"},{value:C.confirmed,label:"已确认"},{value:C.refused,label:"退回"},{value:C.wai_project_confirm,label:"待项目确认"},{value:C.project_confirm_fail,label:"项目确认不通过"}];var x,S,A=a(73297),j=a(82741),D=a(87903),F=a(98560),$=a(83626),P=a(42386),R=a(10114),I=a(80972),T=a(22770),O=a(66626),L=a(77944),N=a(57046),q=a(79443),V=(0,n.defineComponent)({name:"TgInvestmentSettlementPage",components:{SettlementDialog:A.Z,BuessinessSettlement:D.Z,achievement:F.Z,reverseOrderDialog:R.Z,MakeInvoiceDialog:I.Z,reverseAuditDialog:T.Z,settlementApprove:O.Z},setup(e,t){const a=(0,n.ref)(195),s=(0,n.ref)(!1),l=(0,n.ref)(void 0),o=(0,n.ref)(null),r=(0,n.ref)(void 0);(0,n.provide)("project",r),(0,n.provide)("project_add_id",a),(0,n.provide)("contract",(0,n.ref)(void 0));const u=(0,n.ref)(!1),d=(0,n.ref)(""),v=(0,n.ref)(""),h=(0,b.gI)(),g=(0,n.ref)(null),y=(0,n.ref)(!1),C=(0,n.ref)(null),x=(0,n.ref)(!0),{tableHeightLogic:S,onTopCardRectUpdate:A}=(0,c.Z)(),D=(0,n.ref)(void 0),F=(0,n.computed)((()=>L.Z.getters["user/getUserInfo"])),R=(0,n.reactive)({search_type:1,search_value:"",status:"",month:"",page_num:1,num:20,add_by:h.merchant_settlement_view_all?void 0:h.merchant_settlement_view?F.value.id:void 0}),I=()=>{R.search_type=1,R.search_value="",R.status="",R.month="",R.page_num=1,R.num=20},T=async(e=!0)=>{h.merchant_settlement_view_all||h.merchant_settlement_view?(e&&(R.page_num=1),await K.loadData({...R})):t.root.$message.error("没有查看结算数据的权限")},O=()=>{T()},V=()=>{I(),T()},W=e=>{R.page_num=e,T(!1)},Z=e=>{R.num=e,T()},B=e=>{switch(s.value=!0,e){case"ProjectDetail":l.value="正在获取项目详情，请稍等...";break;case"Delete":l.value="正在删除结算单，请稍等...";break;case"SettlementDetail":l.value="正在获取结算单详情，请稍等...";break;default:break}},M=()=>{s.value=!1,l.value=void 0},z=async(e,a="确认要删除这条结算吗？")=>{const i=await(0,j.I)(t,{title:a,content:void 0});if(!i)return;B("Delete");const[{data:s}]=await(0,p.Dc)(1200,(0,m.t)(e.id));M(),s.success?(t.root.$message.success("删除成功"),await T()):t.root.$message.error(s.message??"删除失败")},Y=()=>{y.value=!1,T()},E=()=>{ee(`${a.value}`,(()=>{y.value=!0}))},X=e=>{(0,_.vs)(e)?e.reverse_status===f.h0.refused?(d.value="冲销退回原因",v.value=e.reverse_back_reason,u.value=!0):(d.value="冲销原因",v.value=e.reverse_reason,u.value=!0):(d.value="退回原因",v.value=e.refuse_reason,u.value=!0)},J=e=>{2===e.refund_status?(d.value="冲销原因",v.value=e.refund_reason||""):3===e.refund_status&&(d.value="退回原因",v.value=e.refund_back_reason||""),u.value=!0},G=(e,a)=>{x.value=a,t.refs.BuessinessSettlement.show(e)},U=async(e,a,i)=>{const s={id:e.id,reverse_reason:a,reverse_type:f.Jd.settlement_income};let l;return l=i?await(0,P.Xz)(s):await(0,P.Tu)(s),l.data.success?(t.root.$message.success(l.data.message??"冲销成功"),T()):t.root.$message.error(l.data.message??"冲销失败"),l.data.success},Q=async(e,a,i)=>{const s={id:e.id,reverse_type:f.Jd.settlement_income,is_pass:a,reverse_back_reason:i},l=await(0,P.Un)(s);return l.data.success?(t.root.$message.success(l.data.message??"确认成功"),T()):t.root.$message.error(l.data.message??"确认失败"),l.data.success},H=(0,n.ref)(null),K=w(t,(async(e,a)=>{switch(e){case i.check:G(a,!0);break;case i.edit:D.value?.open(a);break;case i["delete"]:z(a);break;case i.checkReason:X(a);break;case i.financeComfirm:G(a,!1);break;case i.collection:ee(a.project_id.toString(),(()=>{let e=(0,N.I8)(a);e={...e,gather_amount:e.settlement_no_register_amount},o.value?.show(e,{isMcn:!0,isBrand:!1,isMarketing:!1,isMerchant:!0})}));break;case i.writeOff:C.value?.open((e=>U(a,e,!1)));break;case i.writeOffAgain:C.value?.open((e=>U(a,e,!0)));break;case i.writeOffConfirm:H.value?.open(a.reverse_reason,((e,t)=>Q(a,e,t)));break;case i.billing:{B("SettlementDetail");const e=await(0,q.S_)("common",{id:a.id});M(),e.data.success?g.value?.show(e.data.data??a):t.root.$message.error(e.data.message??"获取结算单详情失败");break}case i.refundedCheck:J(a);break;case i.refundedCheckResaon:J(a);break;default:break}})),ee=async(e,a)=>{B("ProjectDetail");const i=await(0,$.$q)(e);M(),i.data.success?(r.value=i.data.data,a?.()):t.root.$message.error(i.data.message??"获取项目详情失败")},te=()=>{v.value="",u.value=!1},ae=async()=>{await T()},ie=()=>{T()};return(0,n.onBeforeMount)((()=>{T()})),{onlyCheckDetail:x,reason:v,reasonDialogTitle:d,reasonDialogVisible:u,onReasonDialogClose:te,onTopCardRectUpdate:A,...S,...K,filterForm:R,settlementRef:D,onSearchClick:O,onResetClick:V,SettlementStatusOptions:k,handleCurrentChange:W,handlePageSizeChange:Z,onDialogClose:ae,achievementRef:o,reload:T,reverseOrderDialogRef:C,onApproveBtnClick:E,onSettlementAdded:ie,MakeInvoiceDialogRef:g,ladingStatus:s,loadingText:l,reverseAuditDialogRef:H,onApproveClose:Y,approveVisible:y}}}),W=V,Z=a(1001),B=(0,Z.Z)(W,o,r,!1,null,"0b001fa2",null),M=B.exports,z=(a(26699),a(36568)),Y=a.n(z),E=a(91538),X=a(78066),J=a(48606),G={useShopLiveAchievment(){const e=(0,n.ref)(!1),t=(0,n.ref)(!1),a=(0,n.ref)([]),i=(0,n.ref)({page_num:1,num:20,total:0}),s=async(s=i.value.page_num,l=i.value.num)=>{t.value=!0;const n=await(0,X.yC)(195,s,l);if(t.value=!1,n.data.success){const t=n.data.data;a.value=t.data,i.value.total=t.total,e.value=!0}else J.Message.error(n.data.message)},l=()=>{s()},o=e=>(0,X.qG)(e+"").then((e=>{e.data.success?(J.Message.success(e.data.message),l()):J.Message.error(e.data.message)}));return{init:e,loading:t,data:a,query:s,queryForm:i,reload:l,deleteShopLiveAchievement:o}}},U=a(89935),Q=a(64519),H=a(45781),K=a(49187),ee=a(43847),te=a(6933),ae=a.n(te),ie=a(93889),se=a(39716),le=a(31279),ne=a(2698),oe=a(58302),re=a(57325),ce=a(6283),ue=a(79546),de=(0,n.defineComponent)({components:{invoicelist:E.Z,InvoiceDetail:se.Z,FirstStep:le.Z,reverseOrderDialog:R.Z,refundDialog:ce.Z,RefundWriteOff:ue.Z,achievement:F.Z},setup(e,t){const a=(0,n.ref)(void 0),i=(0,n.ref)(null),s=(0,n.ref)(!1),l=(0,n.ref)(void 0);(0,n.provide)("project",l);const o=(0,n.ref)(null),r=(0,n.ref)(void 0),c=(0,n.ref)(!1),d=(0,n.ref)(""),p=(0,n.ref)(""),m=(0,n.ref)(!1),_=(0,n.ref)(!1),f=(0,n.ref)(void 0),v=(0,n.ref)(void 0),w=(0,n.ref)(void 0),C=(0,b.gI)(),k=G.useShopLiveAchievment();k.query();const x=async(e,a)=>{const i=await(0,j.I)(t,a);i&&k.deleteShopLiveAchievement(e).then((()=>{k.reload()}))},S=(0,n.ref)(!1),A=(0,n.ref)({achievement_id:"",achievement_uid:"",project_name:"",gather_amount:0,project_id:"",business_type:""}),D=e=>{A.value.achievement_id=e.achievement_id,A.value.achievement_uid=e.achievement_uid,A.value.project_name=e.project_name,A.value.gather_amount=e.gather_amount,A.value.project_id=e.project_id,A.value.business_type=e.business_type,S.value=!0},F=()=>{A.value.achievement_id="",A.value.achievement_uid="",A.value.project_name="",A.value.gather_amount=0,A.value.project_id="",A.value.business_type="",S.value=!1},R=(0,ee.Pc)(),I=(e,t)=>[ie.RJ.Sales,ie.RJ.Framework].includes(e)?"/legal/contract/customer/"+t.toString():[ie.RJ.ServiceContract].includes(e)?"/legal/contract/customerTemplate/"+t.toString():[ie.RJ.Purchase,ie.RJ.SupplierFramework].includes(e)?"/legal/contract/supplier/"+t.toString()+"?contract_type="+e.toString():[ie.RJ.SupplierContract].includes(e)?"/legal/contract/supplierTemplate/"+t.toString()+"?contract_type="+e.toString():[ie.RJ.AnchorContract].includes(e)?"/legal/contract/anchorTemplate/"+t.toString()+"?contract_type="+e.toString():"",T=(0,n.ref)(null),O=async(e,a,i)=>{const s={id:e.achievement_id,reverse_reason:a,reverse_type:u.Jd.receive};let l;return c.value=!0,l=i?await(0,P.Xz)(s):await(0,P.Tu)(s),c.value=!1,l.data.success?(t.root.$message.success(l.data.message??"冲销成功"),k.reload()):t.root.$message.error(l.data.message??"冲销失败"),l.data.success},L=e=>{d.value=e.reverse_reason,m.value=!0,p.value="冲销原因"},N=e=>{d.value=e.reverse_back_reason,m.value=!0,p.value="冲销退回原因"},q=()=>{d.value="",m.value=!1},V=async(e,a)=>{s.value=!0;const i=await(0,$.$q)(e);s.value=!1,i.data.success?(l.value=i.data.data,a?.()):t.root.$message.error(i.data.message??"获取项目详情失败")},W=e=>{V(e.project_id?.toString(),(()=>{const t={achievement_name:e.achievement_name,gather_type:e.gather_type,gather_amount:e.gather_amount,gather_way:e.gather_way,contract_id:e.contract_id,is_invoice:e.is_invoice,invoice_apply_id:e.invoice_apply_id,achievement_id:e.achievement_id,id:e.settlement_id,company_name:e.customer_company_name},i=e.gather_way_detail;if(i&&(t.order_date=i.order_date,t.order_wangwang_id=i.order_wangwang_id,t.task_id=i.task_id,t.pay_company_name=i.pay_company_name),e.gather_certificate_pic){const a=new RegExp("\\/([^\\/]+)$"),i=a.exec(e.gather_certificate_pic);let s;i&&(s=i[1]),t.gather_certificate_pic={name:s,value:e.gather_certificate_pic}}e.contract_id&&(t.search_contract_list_value=[{label:e.contract_uid,value:e.contract_id}]),e.invoice_apply_id&&(t.search_invoice_apply_value=[{label:e.approval_uid,value:e.invoice_apply_id}]),a.value?.show(t,{isMcn:!0,isBrand:!1,isMarketing:!1,isMerchant:!0})}))},Z=32,B=0,M=0,z=0,Y=(0,n.ref)(164),E=(0,oe.Z)({compensation:(0,n.computed)((()=>Z+B+M+z)),fixedBlockHeightRefs:[Y],tableMinHeight:100}),X=(e,t)=>{if(t)return(0,g.QN)(e.achievement_uid)>(0,g.QN)(e.achievement_name)?e.achievement_uid:e.achievement_name;{const t=e.reversed_id?"reverse-red":void 0;return(0,n.h)("div",{class:"table_achievement"},[(0,n.h)("div",{class:t},[e.achievement_uid]),(0,n.h)("div",{class:"text"},[e.achievement_name])])}},J=(0,y.zY)(k.data,"收款编号/名称",X,30),H=e=>{const t=null!==e.reversed_id,a=t?"冲销":U.qw.find((t=>t.value===e.gather_type))?.label;return(0,n.h)("span",t?{class:"reverse-red"}:void 0,[a])},K=(e,t)=>{const a=`${(0,g.SJ)(new(h())(e.gather_amount))}`;return t||null===e.reversed_id?a:(0,n.h)("span",{class:"reverse-red"},[a])},te=(0,y.zY)(k.data,"收款金额 （元）",K),ae=(0,n.computed)((()=>[{label:"收款编号/名称",fixed:"left",minWidth:J.value,formatter:e=>X(e,!1)},{label:"收款类型",minWidth:80,align:"center",prop:"gather_type",formatter:H},{label:"收款金额 (元)",prop:"gather_amount",align:"right",minWidth:te.value,formatter:e=>K(e,!1)},{label:"收款账户",minWidth:130,align:"center",formatter:e=>{const t=U.Fj.find((t=>t.value===e.gather_way))?.label;return(0,n.h)("div",{class:"column-cell",style:{paddingLeft:"5px"}},[(0,n.h)("div",{class:"column-cell-line",style:{justifyContent:"center"}},[(0,n.h)("div",{class:"label",style:{width:"40px",textAlign:"right"}},["方式："]),(0,n.h)("div",{class:"text",style:{width:"60px",textAlign:"left",display:"inline-block"}},[t])]),(0,n.h)("div",{class:"column-cell-line",style:{justifyContent:"center"}},[(0,n.h)("div",{class:"label",style:{width:"40px",textAlign:"right"}},["详情："]),(0,n.h)("el-popover",{props:{trigger:"hover",placement:"left"}},[(0,n.h)("div",{class:"pop-container pop-finance"},[(0,n.h)("div",{class:"pop-header"},["收款账户"]),(0,n.h)("div",{class:"pop-row"},[(0,n.h)("span",{class:"label"},["收款方式："]),(0,n.h)("span",{class:"text"},[t])]),...1===e.gather_way?[(0,n.h)("div",{class:"pop-row"},[(0,n.h)("span",{class:"label"},["旺旺号"]),(0,n.h)("span",{class:"text"},[e.gather_way_detail.order_wangwang_id])]),(0,n.h)("div",{class:"pop-row"},[(0,n.h)("span",{class:"label"},["V任务ID："]),(0,n.h)("span",{class:"text"},[e.gather_way_detail.task_id])]),(0,n.h)("div",{class:"pop-row"},[(0,n.h)("span",{class:"label"},["接单时间："]),(0,n.h)("span",{class:"text"},[e.gather_way_detail.order_date])])]:[],...2===e.gather_way||3===e.gather_way?[(0,n.h)("div",{class:"pop-row"},[(0,n.h)("span",{class:"label"},["打款公司："]),(0,n.h)("span",{class:"text"},[e.gather_way_detail.pay_company_name])])]:[]]),(0,n.h)("a",{slot:"reference",style:{width:"60px",textAlign:"left",display:"inline-block"}},["查看"])])])])}},{label:"收款凭证",minWidth:80,align:"center",formatter:e=>e.gather_certificate_pic?(0,n.h)("button",{class:"tg-button",on:{click:()=>{Q.Z.showDetail((0,re.W)(e.gather_certificate_pic,!1))}}},["查看"]):"--"}]));return{columns:ae,invoiceDialogRef:o,getContractJumpLink:I,deleteCollection:x,...k,invoicelistRef:i,permission:C,userinfo:R,firstStepRef:r,writeOffLoading:c,reverseOrderDialogRef:T,onWriteOffConfirmResolve:O,onViewReverseReason:L,reasonDialogTitle:p,onViewReverseBackReason:N,onReasonDialogClose:q,reason:d,reasonDialogVisible:m,...E,onRefundViewBtnClick:D,refundRow:A,refundDialogVisible:S,onRefundDialogClose:F,refundWriteOffId:f,refundWriteOffAchievementId:v,refundWriteOffAmount:w,refundWriteOffVisible:_,achievementRef:a,editAction:W,projectLoading:s}},render(){const e=arguments[0],t={on:{["rect:update"]:this.onRectUpdate},style:{...this.cardProps}};return e("tg-card",Y()([{class:"project-collection flex-auto tg-mcn-collection",attrs:{padding:[18,18,0,18]}},t,{attrs:{loading:this.loading}},{directives:[{name:"loading",value:this.loading}]}]),[e("el-table",{attrs:{stripe:!0,border:!0,height:this.tableProps.height,loading:this.loading,data:this.data},class:"collection-table",scopedSlots:{empty:()=>e("div",{style:"position: static;"},[e("empty-common")])}},[this.columns.map(((t,a)=>e("el-table-column",Y()([{},{props:{...t}},{key:a}])))),e("el-table-column",{attrs:{label:"是否开票","min-width":94,align:"center"},scopedSlots:{default:({row:t})=>e("div",{class:"column-cell"},[e("div",{class:"column-cell-line",style:"justify-content: center;"},[e("span",{class:"label",style:"width:50px;text-align:right"},["开票："]),e("span",{class:"text",style:"width:30px;text-align:left"},[1===t.is_invoice?"是":"否"])]),e("div",{class:"column-cell-line",style:"justify-content: center;"},[e("span",{class:"label",style:"width:50px;text-align:right"},["发票："]),1===t.is_invoice&&t.invoice_info.length>0&&e("button",{slot:"reference",style:"width:30px;text-align:left",class:"tg-button",on:{click:()=>{this.invoicelistRef?.show({title:"发票详情",list:t.invoice_info.map((e=>(e.info=[{label:"发票号码",value:H.Z.formatEmpty(e.invoice_num)},{label:"开票时间",value:H.Z.formatTime(e.invoice_date)},{label:"开票金额",value:H.Z.formatPrice(e.amount,K.WL.Yuan)},{label:"开票公司",value:H.Z.formatEmpty(e.institution)}],e))),type:0})}}},["查看"]),(1!==t.is_invoice||0===t.invoice_info.length)&&e("span",{style:"width:30px;text-align:left"},["--"])])])}}),e("el-table-column",{attrs:{label:"关联单据","min-width":238},scopedSlots:{default:({row:t})=>{const a=!!t.contract_id;return e("div",{class:"column-cell column-cell-start"},[e("div",{class:"column-cell-line"},[e("span",{class:"label"},["关联合同："]),a?e("span",{class:"text",style:"color: #2877FF; cursor: pointer",on:{click:()=>{const e=this.getContractJumpLink(t.contract_type,t.contract_id);e&&window.open(e)}}},[H.Z.formatEmpty(t.contract_uid)]):e("span",{class:"text"},["--"])]),e("div",{class:"column-cell-line"},[e("span",{class:"label"},["开票审批："]),e("span",Y()([{class:t.approval_uid?"hover-link":""},{on:{click:()=>{t.invoice_apply_id&&this.invoiceDialogRef?.open(t.invoice_apply_id)}}}]),[t.approval_uid??"--"])])])}}}),e("el-table-column",{attrs:{label:"财务确认信息","min-width":150},scopedSlots:{default({row:t}){const a=1===t.is_gather,i=1!==t.gather_way;return 1!==t.is_gather?e("span",{style:{color:"#FF7A36"}},["待确认"]):e("div",{class:"column-cell"},[e("div",{class:"column-cell-line"},[e("span",{class:"label"},["状态："]),e("span",{class:"text"},[1===t.is_gather?"已确认":"未确认"])]),e("div",{class:"column-cell-line"},[e("span",{class:"label"},["收款时间："]),e("span",{class:"text"},[H.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.order_date:"")])]),i&&e("div",{class:"column-cell-line"},[e("span",{class:"label"},["详情："]),e("el-popover",{attrs:{trigger:"hover",placement:"left"}},[e("div",{class:"pop-container pop-finance"},[e("div",{class:"pop-header"},["财务确认信息"]),e("div",{class:"pop-row"},[e("span",{class:"label"},["收款时间："]),e("span",{class:"text"},[H.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.order_date:"")])]),e("div",{class:"pop-row"},[e("span",{class:"label"},["名称："]),e("span",{class:"text"},[H.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.pay_company_name:"")])]),e("div",{class:"pop-row"},[e("span",{class:"label"},["账号："]),e("span",{class:"text"},[H.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.account:"")])]),3===t.gather_way&&e("div",{class:"pop-row"},[e("span",{class:"label"},["开户行："]),e("span",{class:"text"},[H.Z.formatEmpty(t.gather_confirm_detail?t.gather_confirm_detail.bank_of_deposit:"")])])]),a?e("button",{slot:"reference",class:"tg-button"},["预览"]):e("span",{slot:"reference"},["--"])])])])}}}),e("el-table-column",{attrs:{label:"核销状态","min-width":120},scopedSlots:{default({row:t}){let a=[];a=5===t.gather_type?(t.refund_write_off_info_items||[]).map((e=>[e.settlement_uid,e.payable_uid,-1*(e.write_off_amount??0),e.write_off_user,e.write_off_time])):(t.write_off_infos||[]).map((e=>[e.settlement_uid,e.receivable_uid,e.write_off_amount,e.write_off_user,e.write_off_time]));const i=["结算单编号",5===t.gather_type?"应付编号":"应收编号","核销金额 (元)","核销人/日期"];return e(ne.Z,{attrs:{is_reverse:!!t.reversed_id,write_off_header:i,write_off_infos:a,write_off_status:5===t.gather_type?t.refund_write_off_status:t.write_off_status}})}}}),e("el-table-column",{attrs:{label:"冲销状态","min-width":80,align:"center"},scopedSlots:{default({row:t}){let a;return 1===t.reverse_status?a=e("div",{style:"color: #ff7a36"},["待确认"]):2===t.reverse_status?a=e("div",{style:"color: #02ba3c"},["已确认"]):3===t.reverse_status&&(a=e("div",{style:"color: #e91313"},["退回"])),a??"--"}}}),e("el-table-column",{attrs:{label:"录入人/日期","min-width":102},scopedSlots:{default:({row:t})=>e("div",{class:"table_achievement"},[e("div",[t.add_by??"--"]),e("div",{class:"text"},[ae()(t.gmt_create).format("YYYY.MM.DD")])])}}),e("el-table-column",{attrs:{label:"操作",width:160},scopedSlots:{default:({row:t})=>{const a=t.add_by_id===this.userinfo.id,i=0===t.is_gather,s=this.permission.merchant_settlement_write_off;let l,n;const o=t.not_refund_amount>0&&1===t.is_gather&&!t.reverse_id&&(1===t.gather_type||2===t.gather_type||3===t.gather_type),r=1===t.is_gather&&5===t.gather_type&&!t.reverse_id&&!t.reversed_id&&2!==t.refund_write_off_status,c=e("tg-button",{class:"mgr-12",attrs:{type:"link"},on:{click:()=>{this.refundWriteOffAmount=new(h())(t.gather_amount?t.gather_amount:0).sub(new(h())(t.refund_write_off_amount?t.refund_write_off_amount:0)).toNumber(),this.refundWriteOffId=t.refund_cost_id,this.refundWriteOffAchievementId=t.achievement_id,this.refundWriteOffVisible=!0}}},["核销"]);return t.reversed_id?n=3!==t.reverse_status?e("a",{on:{click:()=>{this.onViewReverseReason(t)}}},["查看"]):e("div",[e("a",{on:{click:()=>{this.deleteCollection(t.achievement_id,"是否删除该冲销单")}},class:"mgr-12"},["删除"]),e("a",{on:{click:()=>{this.reverseOrderDialogRef?.open((e=>this.onWriteOffConfirmResolve(t,e,!0)),t.reverse_reason)}},class:"mgr-12"},["重新提交"]),e("a",{on:{click:()=>{this.onViewReverseBackReason(t)}}},["退回原因"])]):t.reverse_id||(0!==t.write_off_status&&1!==t.write_off_status||!s||1===t.is_gather&&4!==t.business_type&&5!==t.gather_type&&(l=e("a",{class:"mgr-12",on:{click:()=>{this.firstStepRef?.show({type:"isActualIncome",id:t.achievement_id,amount:t.not_write_off_amount,leaf:"common_business",busType:t.business_type,receivable_uid:t.receivable_uid||t.achievement_uid})}}},["核销"])),1!==t.is_gather||5===t.gather_type||t.has_refund||(n=e("a",{on:{click:()=>{this.reverseOrderDialogRef?.open((e=>this.onWriteOffConfirmResolve(t,e,!1)))}},class:"reverse-red mgr-12"},["冲销"]))),e("div",{class:"operation-column"},[n,l,a&&i&&e("button",{class:"tg-button",on:{click:()=>{this.editAction(t)}}},["编辑"]),a&&i&&e("button",{on:{click:()=>this.deleteCollection(t.achievement_id,"确认删除该业绩？")},class:"tg-button"},["删除"]),o&&e("button",{on:{click:()=>this.onRefundViewBtnClick(t)},class:"tg-button mgr-12"},["退款"]),r&&c])}}})]),this.queryForm.total>0&&e("el-pagination",{attrs:{"current-page":this.queryForm.page_num,"page-sizes":[10,20,50,100,200],pageSize:this.queryForm.num,total:this.queryForm.total,layout:"total, prev, pager, next, sizes, jumper"},on:{"current-change":e=>{this.query(e,this.queryForm.num)},"size-change":e=>{this.queryForm.num=e,this.query(this.queryForm.page_num,this.queryForm.num)}}}),e(E.Z,{ref:"invoicelistRef"}),e(se.Z,Y()([{},{ref:"invoiceDialogRef"}])),e("first-step",{ref:"firstStepRef",on:{submit:()=>{this.reload()}}}),e("el-dialog",{class:"tg-dialog-classic tg-dialog-vcenter",attrs:{visible:this.reasonDialogVisible,width:"440px",title:this.reasonDialogTitle},on:{close:()=>{this.onReasonDialogClose()}}},[e("div",{class:"reason-dialog-content"},[this.reason])]),e("refund-write-off",{attrs:{type:"pay",notWriteOffAmount:this.refundWriteOffAmount,refund_cost_id:this.refundWriteOffId,achievement_id:this.refundWriteOffAchievementId,visible:this.refundWriteOffVisible},on:{cancel:()=>this.refundWriteOffVisible=!1,save:()=>{this.refundWriteOffVisible=!1,this.reload()}}}),e(R.Z,{ref:"reverseOrderDialogRef"}),e(F.Z,{attrs:{type:1},ref:"achievementRef",on:{ok:()=>{this.reload()}}}),this.refundDialogVisible?e(ce.Z,Y()([{attrs:{visible:this.refundDialogVisible,row:this.refundRow}},{on:{"dialog:close":()=>{this.refundDialogVisible=!1,this.reload()}}}])):"",e("tg-mask-loading",{attrs:{visible:this.writeOffLoading,content:"正在提交冲销，请稍候..."}}),e("tg-mask-loading",{attrs:{visible:this.projectLoading,content:""}})])}}),pe=de,me=(0,Z.Z)(pe,x,S,!1,null,"cc5d669c",null),_e=me.exports,fe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"finance-payment-page flex-auto"},[a("tg-card",{staticClass:"flex-auto finance-payment-table-card",attrs:{padding:[18,18,0,18]}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{border:"",stripe:"",data:e.list,height:"calc(100% - 50px)","cell-style":{cursor:"pointer"}},on:{"row-click":function(t){return t.target!==t.currentTarget?null:e.onRowClick.apply(null,arguments)}},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无数据"}})]},proxy:!0}])},[e._l(e.columns,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),a("el-table-column",{attrs:{label:"付款事由","min-width":"188"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"line-info"},[a("p",{staticClass:"clamp-1"},[e._v(e._s(e._f("emptyData")(t.row.pay_reason)))])])]}}])}),a("el-table-column",{attrs:{label:"供应商",width:"208"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"line-info"},[a("p",{staticClass:"clamp-1"},[e._v(e._s(e._f("emptyData")(t.row.cost_company_name)))])])]}}])}),a("el-table-column",{attrs:{className:"ProjectInfoColumn",label:"项目信息","min-width":"178"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{on:{click:function(a){return a.stopPropagation(),e.goProjectDetail(t.row)}}},[t.row.project_name&&t.row.project_name.length>12?a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:t.row.project_name}},[a("p",{staticClass:"line-clamp-1 empty-data-line hover-link",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.project_name)+" ")])]):a("p",{staticClass:"line-clamp-1 empty-data-line hover-link"},[e._v(" "+e._s(t.row.project_name||"--")+" ")])],1)]}}])}),a("el-table-column",{attrs:{label:"业务类型","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(" "+e._s(1===t.row.business_type?"营销业务":2===t.row.business_type?"淘宝店播":3===t.row.business_type?"抖音店播":4===t.row.business_type?"基地业务":"S2B2C")+" ")])]}}])}),a("el-table-column",{attrs:{label:"是否开票","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.is_invoice?a("div",[e._v("否")]):a("div",[t.row.invoice_info.length>0?a("span",[e._v("是(已上传)")]):a("span",[e._v("是(未上传)")])])]}}])}),a("el-table-column",{attrs:{label:"付款时间","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"line-info",staticStyle:{width:"100%"}},[a("p",{staticClass:"clamp-1",staticStyle:{"text-align":"center"}},[e._v(" "+e._s(t.row.pay_date.replace(/-/g,".")||"--")+" ")])])]}}])}),a("el-table-column",{attrs:{label:"付款凭证","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.pay_certificate_pic?a("div",{staticClass:"button-item",staticStyle:{"text-align":"center",width:"100%"},on:{click:function(a){return a.stopPropagation(),e.checkoutCertificateBtn(t.row.pay_certificate_pic)}}},[e._v(" 查看 ")]):a("span",[e._v("--")])]}}])}),a("el-table-column",{attrs:{label:"核销状态","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.business_type&&8===t.row.new_cost_type||2===t.row.business_type&&0===t.row.is_split||3===t.row.business_type&&0===t.row.is_split?a("div",{staticStyle:{"text-align":"center",width:"100%","justify-content":"center"}},[a("p",{staticClass:"write-off"},[e._v("--")])]):a("div",[a("div",{staticClass:"line-info",staticStyle:{"text-align":"center",width:"100%","justify-content":"center"}},[2===t.row.write_off_status?a("p",{staticClass:"write-on"},[e.writeOffPopoverVisible(t.row)?a("write-list-pop",{attrs:{list:e.writeOffPopoverInfo(t.row),type:2===t.row.pay_type?"receive":"commonBusinessPayableActual",btntitle:"已核销",btncolor:"#3c5269",showSettlementUid:!0}}):[e._v("已核销")]],2):1===t.row.write_off_status?a("p",{staticClass:"write-off"},[e.writeOffPopoverVisible(t.row)?a("write-list-pop",{attrs:{list:e.writeOffPopoverInfo(t.row),type:2===t.row.pay_type?"receive":"commonBusinessPayableActual",btntitle:"部分核销",btncolor:"#ff7a36",showSettlementUid:!0}}):[e._v("部分核销")]],2):a("p",{staticClass:"write-off"},[e._v("未核销")])])])]}}])}),a("el-table-column",{attrs:{label:"单据状态","min-width":"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[null!==t.row.reversed_id?a("div",{staticStyle:{color:"#ff7a36"}},[a("span",[e._v("冲销")]),1===t.row.reverse_status?a("span",{staticStyle:{color:"#ff7a36"}},[e._v("(待确认)")]):2===t.row.reverse_status?a("span",{staticStyle:{color:"#02ba3c"}},[e._v("(已确认)")]):3===t.row.reverse_status?a("span",{staticStyle:{color:"#e91313"}},[e._v("(退回)")]):e._e()]):a("div",[0===t.row.is_pay?a("div",{staticClass:"to-pay"},[e._v("待打款")]):a("div",[e._v("已打款")])])]}}])}),e._e()],2),e.total>0?a("el-pagination",{staticStyle:{margin:"8px 0"},attrs:{"current-page":e.queryForm.page_num,"page-sizes":[10,20,50,100],"page-size":e.queryForm.num,layout:"total, prev, pager, next, sizes, jumper",total:e.total},on:{"update:currentPage":function(t){return e.$set(e.queryForm,"page_num",t)},"update:current-page":function(t){return e.$set(e.queryForm,"page_num",t)},"current-change":e.handleCurrentChange,"size-change":e.handlePageSizeChange}}):e._e()],1),a("div",{staticClass:"tg-dialog-vcenter"},[a("el-dialog",{staticClass:"tg-dialog-classic",attrs:{visible:e.paymentConfirmVisible,width:"440px","close-on-click-modal":!1,"destroy-on-close":!0},on:{close:e.paymentConfirmCloseAction},nativeOn:{paste:function(t){return function(t){return e.handlePaste(t,-1)}.apply(null,arguments)}},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.commonTitle))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.paymentConfirmCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.handlePaymentConfirmSaveAction("paymentConfirmRef")}}},[e._v("保存")])]},proxy:!0}])},[a("el-form",{ref:"paymentConfirmRef",staticStyle:{"margin-top":"20px"},attrs:{model:e.paymentConfirmFrom,rules:e.paymentConfirmFromRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"打款时间：",size:"medium",prop:"pay_date"}},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"date",placeholder:"请选择打款时间","value-format":"yyyy-MM-dd"},model:{value:e.paymentConfirmFrom.pay_date,callback:function(t){e.$set(e.paymentConfirmFrom,"pay_date",t)},expression:"paymentConfirmFrom.pay_date"}})],1),e.permission.payment_upload_edit_pay_evidence&&0===e.row_is_pay?a("el-form-item",{attrs:{label:"打款账号：",size:"medium",prop:"bank_account_id"}},[a("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",placeholder:"请选择打款账号"},model:{value:e.paymentConfirmFrom.bank_account_id,callback:function(t){e.$set(e.paymentConfirmFrom,"bank_account_id",t)},expression:"paymentConfirmFrom.bank_account_id"}},e._l(e.bank_account_list,(function(e){return a("el-option",{key:e.id,attrs:{label:e.account_number+" ("+e.bank_name+")",value:e.id}})})),1)],1):e._e(),a("el-form-item",{attrs:{label:"打款凭证：",size:"medium",rules:{required:!0,message:"请上传打款凭证",trigger:["blur","change"]}}},[a("div",{staticStyle:{display:"flex"}},[e._l(e.urlShowList,(function(t,i){return a("div",{key:i,staticClass:"confirm-img-box"},[a("el-button",{staticClass:"item-close",attrs:{icon:"el-icon-close",circle:""},on:{click:function(t){return e.deleteConfirmItemBtn(i)}}}),a("img",{staticClass:"confirm-img",attrs:{src:t}})],1)})),e.urlShowList.length<3?a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","http-request":e.uploadConfirmImage.bind(this,!1),"before-upload":e.beforeUpload,"show-file-list":!1,accept:".jpeg,.jpg,.png"}},[a("div",{staticClass:"uploader-icon-box"},[a("p",{staticClass:"el-icon-plus"}),a("p",[e._v("上传图片")])])]):e._e()],2),a("div",{staticClass:"el-upload__tip",staticStyle:{"line-height":"16px",color:"#a4b2c2"}},[e._v(" 点击任意区域，粘贴（ctrl+V）添加图片 ")])])],1)],1)],1),a("div",{staticClass:"tg-dialog-vcenter"},[a("el-dialog",{staticClass:"tg-dialog-classic upload-dialog-box",attrs:{visible:e.uploadVisible,width:"550px","close-on-click-modal":!1,"destroy-on-close":!0},on:{close:e.uploadCloseAction},nativeOn:{click:function(t){return e.clearInvoiceListItemActiveIndex.apply(null,arguments)}},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.commonTitle))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.uploadCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.uploadSaveAction("uploadRef")}}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticStyle:{"margin-top":"20px"}},[a("span",{staticStyle:{"margin-left":"45px"}},[e._v("税额：")]),a("el-input",{staticStyle:{width:"430px"},attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",placeholder:"请输入税点金额",clearable:""},on:{input:function(t){return e.inputLoanAmountCost(1,t,2)}},model:{value:e.tax_point,callback:function(t){e.tax_point="string"===typeof t?t.trim():t},expression:"tax_point"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("div",{staticClass:"upload-invoice-div"},[a("el-form",{ref:"uploadRef",staticClass:"upload-invoice-form",attrs:{model:e.uploadForm,"label-width":"100px"}},[a("div",{staticClass:"list-form-box"},[a("p",{staticClass:"list-form-title"},[e._v("发票凭证：")]),e._l(e.uploadForm.list,(function(t,i){return a("div",{key:i,class:e.invoiceListItemActiveIndex===i?"list-form-item list-form-item-active":"list-form-item",on:{paste:function(t){return e.handlePaste(t,i)},click:function(t){t.stopPropagation(),e.invoiceListItemActiveIndex=i}}},[e.uploadForm.list.length>1?a("el-button",{staticClass:"form-item-close",attrs:{icon:"el-icon-close",circle:""},on:{click:function(t){return e.deleteUploadItemBtn(i)}}}):e._e(),a("el-form-item",{attrs:{prop:"list."+i+".show_url",label:"发票截图：",size:"medium",rules:{required:!0,message:"请上传发票截图",trigger:["change","blur"]}}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","http-request":e.uploadImage.bind(this,i,!1),"before-upload":e.beforeUpload,"show-file-list":!1,accept:".jpeg,.jpg,.png"}},[t.show_url&&t.show_url.includes(".pdf")?a("tg-icon",{staticStyle:{"font-size":"90px"},attrs:{name:"ico-pdf"}}):t.show_url?a("img",{staticClass:"avatar",attrs:{src:t.show_url}}):a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"avatar-uploader-icon"},[a("i",{staticClass:"el-icon-plus"}),a("p",[e._v("上传发票")])]),a("div",{staticStyle:{position:"absolute",right:"-50px",top:"32px",color:"rgb(164, 178, 194)"}},[e._v(" 支持pdf，图片格式发票上传 ")]),a("div",{staticClass:"el-upload__tip",staticStyle:{"line-height":"16px",color:"#a4b2c2"},attrs:{slot:"tip"},slot:"tip"},[e._v(" 选中灰色区域，粘贴（ctrl+V）添加图片 ")])],1)],1),a("el-form-item",{attrs:{label:"发票号码：",size:"medium"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",placeholder:"请输入8位发票号码",maxlength:"8",clearable:""},model:{value:t.invoice_num,callback:function(a){e.$set(t,"invoice_num","string"===typeof a?a.trim():a)},expression:"item.invoice_num"}})],1),a("el-form-item",{attrs:{label:"开票时间：",size:"medium"}},[a("el-date-picker",{staticStyle:{width:"300px"},attrs:{type:"date",placeholder:"请选择开票时间","value-format":"yyyy-MM-dd"},model:{value:t.invoice_date,callback:function(a){e.$set(t,"invoice_date",a)},expression:"item.invoice_date"}})],1),a("el-form-item",{attrs:{label:"开票金额：",size:"medium"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",placeholder:"请输入开票金额",clearable:""},on:{input:function(t){return e.inputLoanAmountCost(i,t,1)}},model:{value:t.amount,callback:function(a){e.$set(t,"amount","string"===typeof a?a.trim():a)},expression:"item.amount"}},[a("template",{slot:"append"},[e._v("元")])],2)],1),a("el-form-item",{attrs:{label:"开票单位名称：",size:"medium"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入开票单位名称",maxlength:"100",clearable:""},model:{value:t.institution,callback:function(a){e.$set(t,"institution","string"===typeof a?a.trim():a)},expression:"item.institution"}})],1)],1)}))],2)])],1),e.uploadForm.list.length<3?a("el-button",{staticClass:"add-upload-form-btn",attrs:{icon:"el-icon-plus"},on:{click:e.addUploadItemBtn}},[e._v("点击添加")]):e._e()],1)],1),a("div",{staticClass:"tg-dialog-vcenter"},[a("el-dialog",{staticClass:"tg-dialog-classic upload-dialog-box",attrs:{visible:e.costSplitVisible,width:"510px","close-on-click-modal":!1,"destroy-on-close":!0},on:{close:e.costSplitCloseAction},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("成本拆分")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.costSplitCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:function(t){return e.costSplitSaveAction("costSplitRef")}}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticClass:"cost-split-scroll"},[a("div",{staticClass:"dialog-line"},[a("span",{staticClass:"label-70"},[e._v("打款金额：")]),a("span",[e._v(e._s(e.numberMoneyFormat(e.costSplitForm.pay_amount,2)))])]),a("div",{staticClass:"dialog-line"},[a("span",{staticClass:"label-70"},[e._v("成本类型：")]),a("span",[e._v(e._s(e.costType(e.costSplitForm.new_cost_type)))])]),a("div",{staticClass:"dialog-line"},[a("span",{staticClass:"label-70"},[e._v("业务类型：")]),a("span",[e._v(e._s(1===e.costSplitForm.business_type?"营销业务":2===e.costSplitForm.business_type_str?"淘宝店播":3===e.costSplitForm.business_type_str?"抖音店播":4===e.costSplitForm.business_type_str?"基地业务":"S2B2C"))])]),a("el-form",{ref:"costSplitRef",staticStyle:{"margin-top":"10px"},attrs:{model:e.costSplitForm,"label-width":"80px"}},[a("div",{staticClass:"list-form-box"},e._l(e.costSplitForm.cost,(function(t,i){return a("div",{key:i,staticClass:"list-form-item cost-list-form-item"},[e.costSplitForm.cost.length>1?a("el-button",{staticClass:"form-item-close",attrs:{icon:"el-icon-close",circle:""},on:{click:function(t){return e.deleteCostSplitItemBtn(i)}}}):e._e(),a("el-form-item",{attrs:{label:"所属项目：",size:"medium",prop:"cost."+i+".project_id",rules:{required:!0,message:"请输入项目编号",trigger:["blur","change"]}}},[a("el-select",{staticStyle:{width:"325px"},attrs:{filterable:"",remote:"","reserve-keyword":"",clearable:"",placeholder:"请输入所属项目","remote-method":e.getCustmerByContractNo,size:"medium"},model:{value:t.project_id,callback:function(a){e.$set(t,"project_id",a)},expression:"item.project_id"}},e._l(e.project_options,(function(e){return a("el-option",{key:e.id,attrs:{label:e.project_uid,value:e.id}})})),1)],1),a("el-form-item",{attrs:{label:"费用金额：",size:"medium",prop:"cost."+i+".price",rules:{required:!0,message:"请输入项目分摊金额",trigger:["blur","change"]}}},[a("el-input",{staticStyle:{width:"325px"},attrs:{oninput:"value=value.replace(/[^\\d.]/g,'')",placeholder:"请输入项目分摊金额",clearable:""},on:{input:function(t){return e.inputLoanAmountCost(i,t,3)}},model:{value:t.price,callback:function(a){e.$set(t,"price","string"===typeof a?a.trim():a)},expression:"item.price"}},[a("template",{slot:"append"},[e._v("元")])],2)],1)],1)})),0)])],1),a("el-button",{staticClass:"cost-split-form-btn",attrs:{icon:"el-icon-plus"},on:{click:e.addCostSplitItemBtn}},[e._v("点击添加")])],1)],1),a("div",{staticClass:"tg-dialog-vcenter"},[a("el-dialog",{staticClass:"tg-dialog-classic",attrs:{width:"868px",visible:e.linkPaymentVisible,"close-on-click-modal":!1,"destroy-on-close":!0},on:{close:e.linkPaymentCloseAction},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("关联付款")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.linkPaymentCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary"},on:{click:e.linkPaymentSubmitAction}},[e._v("提交")])]},proxy:!0}])},[a("div",{staticClass:"main-box"},[a("div",{staticClass:"link-payment-tips"},[a("tg-icon",{staticStyle:{"font-size":"20px"},attrs:{name:"ico-warn"}}),a("p",[e._v(" 注意：关联后不可撤销，谨慎操作，如果存在多条已确认的收款，需要选择一条保留并共享打款凭证及发票等信息；如同时含有已打款和未打款的记录，合并后会自动更新为已打款 ")])],1),a("div",{staticClass:"link-payment-search"},[a("div",{staticClass:"link-payment-header"},[a("p",{staticClass:"title"},[e._v("选择付款")]),a("el-input",{staticStyle:{width:"182px","margin-top":"6px"},attrs:{size:"mini",placeholder:"请输入付款ID","suffix-icon":"el-icon-search"},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onEnterPressLinkPayment.apply(null,arguments)},click:function(t){return e.onEnterPressLinkPayment.apply(null,arguments)}},model:{value:e.link_id,callback:function(t){e.link_id=t},expression:"link_id"}})],1),a("el-table",{staticClass:"customer-table",attrs:{stripe:"",data:e.search_link_payment,"header-cell-style":{padding:"0",color:"#98A7BA",background:"#ffffff",fontWeight:400,border:"none",height:"40px"},"cell-style":{border:"none"}},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"请搜索付款ID"}})]},proxy:!0}])},[a("el-table-column",{attrs:{align:"left",label:"付款ID",width:"96"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cost_id))]}}])}),a("el-table-column",{attrs:{align:"right",label:"金额",width:"136"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.numberMoneyFormat(t.row.pay_amount,2)))]}}])}),a("el-table-column",{attrs:{align:"left",label:"收款方",width:"356"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.pay_way?[t.row.pay_way_detail.company_name&&t.row.pay_way_detail.company_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.company_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.company_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.company_name))+" ")])]:e._e(),2===t.row.pay_way?[t.row.pay_way_detail.wangwang_name&&t.row.pay_way_detail.wangwang_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.wangwang_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.wangwang_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.wangwang_name))+" ")])]:e._e(),4===t.row.pay_way?[t.row.pay_way_detail.name&&t.row.pay_way_detail.name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.name))+" ")])]:e._e(),1===t.row.pay_way?[t.row.pay_way_detail.real_name&&t.row.pay_way_detail.real_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.real_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.real_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.real_name))+" ")])]:e._e()]}}])}),a("el-table-column",{attrs:{align:"left",label:"打款状态",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_pay?a("p",[e._v("已打款")]):a("p",[e._v("待打款")])]}}])}),a("el-table-column",{attrs:{align:"right",label:"",width:"56"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.active_id?a("el-button",{staticClass:"add-btn-link",attrs:{type:"primary",disabled:"",size:"mini"}},[e._v("添加")]):a("el-button",{staticClass:"add-btn-link",attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.handlePushClick(t.row,t.$index)}}},[e._v("添加")])]}}])})],1)],1),a("div",{staticClass:"link-payment-main"},[a("div",{staticClass:"link-payment-header"},[a("p",{staticClass:"title"},[e._v("关联以下付款")])]),a("el-table",{staticClass:"customer-table",attrs:{stripe:"","max-height":"250",data:e.link_payment_list,"header-cell-style":{padding:"0",color:"#98A7BA",background:"#ffffff",fontWeight:400,border:"none",height:"40px"},"cell-style":{border:"none"}},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无数据"}})]},proxy:!0}])},[a("el-table-column",{attrs:{align:"left",label:"付款ID",width:"96"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.cost_id))]}}])}),a("el-table-column",{attrs:{align:"right",label:"金额",width:"116"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e.numberMoneyFormat(t.row.pay_amount,2)))]}}])}),a("el-table-column",{attrs:{align:"left",label:"收款方",width:"310"},scopedSlots:e._u([{key:"default",fn:function(t){return[3===t.row.pay_way?[t.row.pay_way_detail.company_name&&t.row.pay_way_detail.company_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.company_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.company_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.company_name))+" ")])]:e._e(),2===t.row.pay_way?[t.row.pay_way_detail.wangwang_name&&t.row.pay_way_detail.wangwang_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.wangwang_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.wangwang_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.wangwang_name))+" ")])]:e._e(),4===t.row.pay_way?[t.row.pay_way_detail.name&&t.row.pay_way_detail.name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.name))+" ")])]:e._e(),1===t.row.pay_way?[t.row.pay_way_detail.real_name&&t.row.pay_way_detail.real_name.length>20?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover",content:t.row.pay_way_detail.real_name}},[a("p",{staticClass:"line-clamp-1",attrs:{slot:"reference"},slot:"reference"},[e._v(" "+e._s(t.row.pay_way_detail.real_name)+" ")])]):a("p",{staticClass:"line-clamp-1"},[e._v(" "+e._s(e._f("emptyData")(t.row.pay_way_detail.real_name))+" ")])]:e._e()]}}])}),a("el-table-column",{attrs:{align:"left",label:"打款状态",width:"86"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_pay?a("p",[e._v("已打款")]):a("p",[e._v("待打款")])]}}])}),a("el-table-column",{attrs:{align:"left",label:"凭证及发票",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_pay?a("el-radio",{attrs:{label:t.row.cost_id},model:{value:e.choose_radio,callback:function(t){e.choose_radio=t},expression:"choose_radio"}},[e._v("保留此条")]):e._e()]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"56"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"add-btn-link",staticStyle:{"font-size":"14px"},attrs:{type:"text",size:"mini"},on:{click:function(a){return e.handleRemoveClick(t.$index,t.row.cost_id)}}},[e._v("移除")])]}}])})],1)],1)])])],1),a("finance-invoice-detail-dialog",{attrs:{visible:e.financeInvoiceDetailVisible,list:e.invoiceList},on:{closeFinanceInvoiceDetailAction:e.closeFinanceInvoiceDetailAction}}),a("Invoicelist",{ref:"invoicelistRef"}),e.applyDetailDialogVisible?a("PaymentDetailDialog",{attrs:{visible:e.applyDetailDialogVisible,info:e.approval},on:{"dialog:close":function(t){e.applyDetailDialogVisible=!1}}}):e._e(),e.refundVisible?a("refund-detail-dialog",{attrs:{visible:e.refundVisible,info:e.approval},on:{"dialog:close":function(t){e.refundVisible=!1}}}):e._e(),e.applicationVisible?a("AdvanceDetailDialog",{attrs:{visible:e.applicationVisible,info:e.approval},on:{"dialog:close":function(t){e.applicationVisible=!1}}}):e._e(),e.invoicesVisible?a("invoices-detail",{ref:"invoicesDetailDialog",on:{close:function(t){e.invoicesVisible=!1}}}):e._e(),a("reverseAuditDialog",{ref:"reverseAuditDialogRef"}),a("tg-mask-loading",{attrs:{visible:e.reverseAuditLoading,content:"正在提交，请稍候..."}}),a("el-dialog",{staticClass:"tg-dialog-classic tg-dialog-vcenter-new",attrs:{visible:e.reasonDialogVisible,width:"440px"},on:{close:e.onReasonDialogClose},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("冲销原因")]},proxy:!0}])},[a("div",{staticClass:"reason-dialog-content"},[e._v(e._s(e.reason))])]),a("div",{staticClass:"tg-dialog-vcenter"},[e.loanDetailVisible?a("LoanfinanceDetailModal",{attrs:{visible:e.loanDetailVisible,detailroval:e.detailroval},on:{"dialog:closerow":e.onLoanDetailClose,"dialog:openpaymentcertificate":e.checkoutCertificateBtn,"dialog:openpaymentinvoice":e.checkoutInvoiceDetailBtn,"dialog:openpaymentcontract":e.goContractDetail,"dialog:openpaymentapproval":e.handleClickApprovalBtn,"dialog:openpaymentimprest":e.handleClickApplicationBtn}}):e._e()],1)],1)},ve=[],he=a(24643),ge=a(86611),ye=a(29625),be=a(33018),we=a(92656),Ce=a(34137),ke=a(74750),xe=a(17809),Se=a(51351),Ae=a(62068),je=a(7629),De=a(41532),Fe=a(5968),$e=a(40290),Pe=(0,n.defineComponent)({name:"FinancePayment",setup(e,t){const{jumpProjectDetail:a}=(0,$e.k)(t),i=(0,b.gI)(),s=(0,n.computed)((()=>t.root.$store.state.workbench)),l=(0,n.computed)((()=>s.value.approval)),o=(0,n.ref)([]),r=(0,n.ref)([]),c=(0,n.ref)(),d=32,p=46,m=30,_=12,v=(0,n.ref)(!1),w=(0,n.ref)(""),C=(0,n.ref)(0),k=e=>{C.value=e.height},x=(0,oe.Z)({compensation:d+p+m+_,fixedBlockHeightRefs:[C]}),S=(0,n.ref)(null),A=async(e,a,i)=>{v.value=!0;const s={id:e.cost_id,reverse_type:u.Jd.payment,is_pass:a,reverse_back_reason:i},l=await(0,P.aH)(s);return v.value=!1,l.data.success?(t.root.$message.success(l.data.message??"确认成功"),c.value&&c.value()):t.root.$message.error(l.data.message??"确认失败"),l.data.success},j=e=>{S.value?.open(e.reverse_reason,((t,a)=>A(e,t,a)))},D=(0,n.ref)(!1),F=(0,n.ref)(""),$=e=>{F.value=e.reverse_reason,D.value=!0},R=()=>{F.value="",D.value=!1},I=(0,n.ref)([]),T=(0,n.ref)([]),O=(e,t)=>t?e.uid:(0,n.h)("span",{class:null!==e.reversed_id?"reverse-red":""},[e.uid]),L=(0,y.zY)(T,"付款编号",O),N=(e,t)=>{const a=`${(0,g.SJ)(new(h())(e.pay_amount))}`;return t?a:(0,n.h)("span",{class:null!==e.reversed_id?"reverse-red":""},[a])},q=(0,y.zY)(T,"付款金额（元）",N),V=(e,t)=>{const a=1===e.pay_type?"成本":2===e.pay_type?"退款":"--",i=9!==e.new_cost_type?f.rt.get(e.new_cost_type)??"--":"冲销";return t?(0,g.QN)(a)>(0,g.QN)(i)?a:i:[(0,n.h)("div",[a])]},W=(0,y.zY)(T,"付款类型",V),Z=(e,t)=>{const a=1===e.pay_way?"银行卡":2===e.pay_way?"v任务":3===e.pay_way?"对公银行":4===e.pay_way?"支付宝":"--";return t?a:[(0,n.h)("div",[a])]},B=(0,y.zY)(T,"付款方式",Z),M=(0,n.computed)((()=>[{label:"付款编号",fixed:"left",align:"center",minWidth:L.value,formatter:e=>O(e,!1)},{align:"right",label:"付款金额 (元)",minWidth:q.value,formatter:e=>N(e,!1)},{label:"付款类型",align:"center",minWidth:W.value,formatter:e=>V(e,!1)},{label:"付款方式",align:"center",minWidth:B.value,formatter:e=>Z(e,!1)}])),z=e=>{let t=!1;return t=2===e.pay_type?e.refund_write_off_infos&&e.refund_write_off_infos.length>0:e.write_off_infos&&e.write_off_infos.length>0,t},Y=e=>{let t=[];return t=2===e.pay_type?(e.refund_write_off_infos??[]).map((e=>{const t={...e};return t.write_off_amount=-1*t.write_off_amount,t})):e.write_off_infos??[],t},E=(0,n.ref)([]),X=()=>{(0,P.k6)().then((e=>{e?.data?.success?E.value=e.data.data:t.root.$message.error(e?.data?.message??"获取银行账号列表失败")}))},J=(0,n.ref)(!1),G=(0,n.ref)({name:"123"}),U=e=>{G.value=e,J.value=!0},Q=()=>{J.value=!1};return{jumpProjectDetail:a,search_link_payment:I,list:T,columns:M,permission:i,workbenchState:s,approval:l,urlList:o,urlShowList:r,onTopCardRectUpdate:k,...x,onReasonViewBtnClick:$,onReasonDialogClose:R,onReverseAuditConfirm:A,reverseAuditDialogRef:S,reverseAuditLoading:v,reasonDialogVisible:D,reason:F,handleReverseAduit:j,reloadFunc:c,writeOffPopoverVisible:z,writeOffPopoverInfo:Y,queryBankAccounts:X,bank_account_list:E,row_is_pay:w,onRowClick:U,loanDetailVisible:J,detailroval:G,onLoanDetailClose:Q,numberFormat:he.Y4}},components:{LoanfinanceDetailModal:we.Z,FinanceInvoiceDetailDialog:ge.Z,Invoicelist:E.Z,InvoicesDetail:be.Z,WriteListPop:Ae.Z,reverseAuditDialog:T.Z,PaymentDetailDialog:je.Z,RefundDetailDialog:De.Z,AdvanceDetailDialog:Fe.Z},data(){const e="console"===this.$router.currentRoute.query.source;return{link_payment_list:[],linkPaymentVisible:!1,link_id:"",active_id:!1,choose_radio:"",invoiceListItemActiveIndex:void 0,applyDetailDialogVisible:!1,refundVisible:!1,applicationVisible:!1,invoicesVisible:!1,total:0,statistics:null,queryForm:{business_type:"",pay_type:"",new_cost_type:"",is_invoice:"",is_pay:e?0:"",pay_way:"",is_split:"",write_off_status:"",query_date_type:3,pay_date:"",search_value:"",search_type:1,page_num:1,num:20},loading:!1,financeInvoiceDetailVisible:!1,invoiceList:[],paymentConfirmVisible:!1,paymentConfirmFrom:{pay_date:"",bank_account_id:""},paymentConfirmFromRules:{pay_date:{required:!0,message:"请选择打款时间",trigger:["change","blur"]},bank_account_id:{required:!0,message:"请选择打款账号",trigger:["blur","change"]}},fileList:[],uploadVisible:!1,tax_point:"",uploadForm:{list:[{invoice_date:"",invoice_num:"",institution:"",amount:"",pic_url:"",show_url:""}]},costSplitVisible:!1,costSplitForm:{},commonTitle:"",project_options:[]}},filters:{emptyData(e){return""===e||void 0===e||null===e?"--":e}},computed:{timeDefault(){const e=new Date,t=ae()(e.getTime()-2592e6).format("YYYY-MM-DD"),a=ae()(e.getTime()).format("YYYY-MM-DD");return[t,a]}},created(){this.queryForm.pay_date=this.timeDefault,this.reloadFunc=()=>{this.getList()},this.getList(),this.costType(1),this.$store.hasModule("workbench")||this.$store.registerModule("workbench",xe.T)},methods:{clearInvoiceListItemActiveIndex(){this.invoiceListItemActiveIndex=void 0},onEnterPressLinkPayment(){this.getLinkPaymentList()},handlePushClick(e,t){this.search_link_payment.splice(t,1),this.link_payment_list.unshift(e),this.link_id=""},handleRemoveClick(e,t){this.link_payment_list.splice(e,1),t===this.choose_radio&&(this.choose_radio="")},async getLinkPaymentList(){if(""===this.link_id)return!1;const e=await(0,m.Nz)({cost_id:this.link_id});if(e.data.success){const t=e.data.data;if(t.data.length>0)if("{}"===JSON.stringify(t.data[0].associate_cost)){const e=this.link_id;this.active_id=this.link_payment_list.some((t=>t.cost_id.toString()===e)),this.search_link_payment=t.data}else this.$message.warning("该付款记录已完成关联!");else this.$message.warning("请输入正确的付款ID!")}else this.$message.warning("请输入正确的付款ID!")},showLinkPaymentBtnClick(){this.linkPaymentVisible=!0},linkPaymentCloseAction(){this.linkPaymentVisible=!1,this.link_payment_list=[],this.search_link_payment=[],this.link_id="",this.choose_radio=""},async linkPaymentSubmitAction(){if(this.link_payment_list.length<2)return this.$message.warning("请添加至少2条付款记录！"),!1;const e=this.link_payment_list,t=e.every((e=>0===e.is_pay));if(!t&&""===this.choose_radio)return this.$message.warning("请选择需要保留的凭证及发票！"),!1;{const t=[];for(let i=0;i<e.length;i++)t.push(e[i].cost_id);const a=await(0,Ce.GF)({cost_ids:t,reserve_id:this.choose_radio,confirm:!1});a.data.success?this.$confirm("确认将这些付款记录进行关联? 关联成功后不可撤销","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((async()=>{const e=await(0,Ce.GF)({cost_ids:t,reserve_id:this.choose_radio,confirm:!0});e.data.success?(this.$message({type:"success",message:"关联成功!"}),this.linkPaymentCloseAction(),this.getList()):this.$message({type:"error",message:e.data.message})})).catch((()=>{this.$message({type:"info",message:"已取消"})})):this.$message({type:"error",message:a.data.message})}},handlePaste(e,t){if(-1===t&&3===this.urlList.length)return;const a=(e.clipboardData||window.clipboardData).items;let i=null;if(!a||0===a.length)return void this.$message.error("当前浏览器不支持本地");for(let l=0;l<a.length;l++)if(-1!==a[l].type.indexOf("image")){i=a[l].getAsFile();break}if(!i)return void this.$message.error("粘贴内容非图片");const s=new FileReader;s.onload=()=>{},s.readAsDataURL(i),i&&this.beforeUpload(i)&&(-1===t?this.uploadConfirmImage(!0,{file:i}):this.uploadImage(t,!0,{file:i}))},getToken:ke.LP,numberMoneyFormat:he.rH,inputLoanAmountCost(e,t,a){const i=t.replace(/[^\d.]+/gu,"").replace(/^0+(?=\d)/gu,"")??"",s=/\d+(?:\.\d{0,2})?/gu.exec(i)??[""];1===a?this.uploadForm.list[e].amount=s[0]:2===a?this.tax_point=s[0]:3===a&&(this.costSplitForm.cost[e].price=s[0])},async fetchApprovalInfo(e,t){const{data:a}=await(0,Se.OC)({approval_id:""===e?void 0:e,approval_uid:t});return a.success?this.$store.dispatch("workbench/setApproval",a.data):this.$message.error(a.message??"获取审批详情失败"),a.data},async handleClickApprovalBtn(e){if(2===e.pay_type)return void(e.business_type===ye.WD.marketing?window.open("/marketing/project/"+e.cooperation_id+"/achievement"):e.business_type===ye.WD.taobao||e.business_type===ye.WD.douyin?window.open("/live/project/"+e.project_id+"/collection/week"):window.open("/commonbusiness/project/"+e.project_id+"/collection"));const t=await this.fetchApprovalInfo(e.approval_id);t&&(1===e.approval_type?this.applyDetailDialogVisible=!0:2===e.approval_type?this.refundVisible=!0:3===e.approval_type?this.applicationVisible=!0:4===e.approval_type&&(this.invoicesVisible=!0,this.$nextTick((()=>{this.$refs.invoicesDetailDialog.show({approval_id:e.approval_id})}))))},async handleClickApplicationBtn(e){if(!e.borrowing_approval_id)return;const t=await this.fetchApprovalInfo(e.borrowing_approval_id);t&&(this.applicationVisible=!0)},costType(e){return new Map([[1,"人员工资"],[2,"主播服务费"],[3,"固定资产采购"],[4,"水电"],[5,"装修"],[6,"房租"],[7,"营销成本"],[8,"返点"]]).get(e)??"--"},checkoutCertificateBtn(e){const t=e.split(",");1===t.length?Q.Z.showDetail(t[0]+"?Authorization="+(0,ke.LP)()):this.$refs.invoicelistRef.show({title:"打款凭证",list:t.map((e=>e+"?Authorization="+(0,ke.LP)())),type:1})},exportBtnClick(){const e=this.getParams();(0,Ce.KY)({...(0,p.jG)(e)})},async getCustmerByContractNo(e){const t=await(0,Ce.QC)({project_uid:e,business_type:this.costSplitForm.business_type});t.data.success?this.project_options=t.data.data:this.$message({type:"error",message:t.data.message})},async getList(){this.loading=!0;const e=await(0,m.Nz)({...(0,p.jG)({...this.getParams(),page_num:this.queryForm.page_num,num:this.queryForm.num})});if(e.data.success){const t=e.data.data;this.list=t.data,this.total=t.total,this.loading=!1,this.statistics=t.statistics_data}else this.$message({type:"error",message:e.data.message})},async goProjectDetail(e){e.business_type===ye.WD.marketing?window.open("/marketing/project/"+e.project_id):e.business_type===ye.WD.taobao||e.business_type===ye.WD.douyin?this.jumpProjectDetail({project_id:e.project_id,newWindow:!0}):window.open("/commonbusiness/project/"+e.project_id)},async goContractDetail(e,t){if(e)if(1===t||2===t)window.open("/legal/contract/customer/"+e);else if(3===t||4===t)window.open("/legal/contract/supplier/"+e);else if(5===t)window.open("/legal/contract/customerTemplate/"+e);else if(6===t)window.open("/legal/contract/supplierTemplate/"+e);else{if(7!==t)return;window.open("/legal/contract/anchorTemplate/"+e)}},getParams(){const e=this.queryForm;return{search_type:e.search_type,search_value:e.search_value,business_type:e.business_type,pay_type:e.pay_type,new_cost_type:e.new_cost_type,is_invoice:e.is_invoice,is_pay:e.is_pay,pay_way:e.pay_way,is_split:e.is_split,write_off_status:e.write_off_status,query_date_type:e.query_date_type,start_date:e.pay_date?e.pay_date[0]:"",end_date:e.pay_date?e.pay_date[1]:""}},onQuerySearchClick(){this.queryForm.page_num=1,this.getList()},onQueryResetClick(){this.queryForm={business_type:"",pay_type:"",new_cost_type:"",is_invoice:"",is_pay:"",pay_way:"",is_split:"",write_off_status:"",query_date_type:3,pay_date:"",search_value:"",search_type:1,page_num:1,num:20},this.queryForm.pay_date=this.timeDefault,this.getList()},handleCurrentChange(e){this.queryForm.page_num=e,this.getList()},handlePageSizeChange(e){this.queryForm.page_num=1,this.queryForm.num=e,this.getList()},checkoutInvoiceDetailBtn(e){this.invoiceList=e,this.financeInvoiceDetailVisible=!0},closeFinanceInvoiceDetailAction(){this.financeInvoiceDetailVisible=!1},paymentConfirmClick(e){this.commonTitle="打款确认",this.row_is_pay=e.is_pay,this.cost_id=e.cost_id,this.paymentConfirmVisible=!0,this.queryBankAccounts()},editConfirmClick(e){this.commonTitle="编辑打款凭证",this.cost_id=e.cost_id,this.paymentConfirmFrom.pay_date=e.pay_date,this.paymentConfirmFrom.bank_account_id=e.bank_account_id,this.row_is_pay=e.is_pay;const t=e.pay_certificate_pic.split(","),a=[];this.urlList=t;for(const i of t)a.push(i+`?Authorization=${(0,ke.LP)()}`);this.urlShowList=a,this.paymentConfirmVisible=!0},paymentConfirmCloseAction(){this.paymentConfirmVisible=!1,this.paymentConfirmFrom={pay_date:"",bank_account_id:""},this.urlList=[],this.urlShowList=[]},handlePaymentConfirmSaveAction(e){this.$refs[e].validate((async e=>{if(this.urlList.length<1)return this.$message({message:"请上传打款凭证",type:"warning"}),!1;if(!e)return!1;{const e={cost_id:this.cost_id,pay_certificate_pic:this.urlList,pay_date:this.paymentConfirmFrom.pay_date,bank_account_id:this.paymentConfirmFrom.bank_account_id},t=await(0,Ce.S8)(e);t.data.success?(this.paymentConfirmVisible=!1,this.urlList=[],this.urlShowList=[],this.paymentConfirmFrom={pay_date:"",bank_account_id:""},this.getList(),this.$message({type:"success",message:t.data.message})):this.$message({type:"error",message:t.data.message})}}))},deleteConfirmItemBtn(e){this.urlList.splice(e,1),this.urlShowList.splice(e,1)},async uploadConfirmImage(e,t){const a=this.cost_id,i=new FormData;i.append("file",t.file),i.append("type","certificate/cost_pay_certificate"),i.append("achievement_or_cost_id",a);const{data:s}=await(0,Ce.G1)(i);s.success?(this.urlShowList.push(s.data.source+`?Authorization=${(0,ke.LP)()}`),this.urlList.push(s.data.source),e&&this.$message.success("粘贴成功！")):this.$message.error("上传失败！")},costSplitBtnClick(e){this.costSplitForm={pay_amount:e.pay_amount,business_type:e.business_type,new_cost_type:e.new_cost_type,cost_id:e.cost_id,cost:[{project_id:"",price:""}]},this.costSplitVisible=!0},costSplitCloseAction(){this.costSplitVisible=!1},costSplitSaveAction(e){this.$refs[e].validate((async e=>{if(!e)return!1;{const e={cost_id:this.costSplitForm.cost_id,cost:this.costSplitForm.cost},t=await(0,Ce.pt)(e);t.data.success?(this.costSplitVisible=!1,this.costSplitForm={},this.$message({type:"success",message:t.data.message}),this.getList()):this.$message({type:"error",message:t.data.message})}}))},addCostSplitItemBtn(){this.costSplitForm.cost.push({project_id:"",price:""})},deleteCostSplitItemBtn(e){this.costSplitForm.cost.splice(e,1)},uploadCloseAction(){this.uploadVisible=!1,this.clearInvoiceListItemActiveIndex(),this.uploadForm={list:[{invoice_date:"",invoice_num:"",institution:"",amount:"",pic_url:"",show_url:""}]}},uploadSaveAction(e){this.$refs[e].validate((async e=>{if(Number(this.tax_point)<0)return this.$message({message:"税点金额不能小于0",type:"warning"}),!1;const t=this.uploadForm.list;for(let a=0;a<t.length;a++)if(Number(t[a].amount)<0)return this.$message({message:"开票金额不能小于0",type:"warning"}),!1;if(!e)return!1;{const e={cost_id:this.cost_id,tax_point:this.tax_point,invoice_info:t},a=await(0,Ce.Jr)(e);a.data.success?(this.uploadVisible=!1,this.uploadForm={list:[{invoice_date:"",invoice_num:"",institution:"",amount:"",pic_url:"",show_url:""}]},this.getList(),this.$message({type:"success",message:a.data.message})):this.$message({type:"error",message:a.data.message})}}))},beforeUpload(e){const t=e.size/1024/1024<5;return["image/jpeg","image/jpg","image/png"].includes(e.type)||[".jpg",".jpeg",".png"].includes((0,p.mD)(e.name))?!!t||(this.$message.error("上传图片大小不能超过 5MB!"),!1):(this.$message.warning("文件格式不正确，请使用 png / jpg / jpeg"),!1)},async uploadImage(e,t,a){const i=JSON.parse(JSON.stringify(this.uploadForm.list)),s=new FormData;s.append("file",a.file),s.append("type","certificate/cost_invoice_certificate");const{data:l}=await(0,Ce.G1)(s);if(l.success){const a=l.data.source;i[e].show_url=(0,re.W)(a,!1),i[e].pic_url=a,this.uploadForm.list=i,t&&this.$message.success("粘贴成功！")}else this.$message.error("上传失败！")},addUploadItemBtn(){this.uploadForm.list.push({invoice_date:"",invoice_num:"",institution:"",amount:"",pic_url:"",show_url:""})},deleteUploadItemBtn(e){this.uploadForm.list.splice(e,1)}}}),Re=Pe,Ie=(0,Z.Z)(Re,fe,ve,!1,null,"b9e917a0",null),Te=Ie.exports,Oe=a(23812),Le=a(1763);const Ne=new Map([["settlement","Settlement"],["collection","Collection"],["Refund","Refund"]]);var qe=(0,n.defineComponent)({props:{tab:{type:String,default:"settlement"}},components:{Settlement:M,Collection:_e,Refund:Te},setup(e,t){const a=(0,Oe.YE)([{label:"结算",value:"settlement"},{label:"收款",value:"collection"},{label:"退款",value:"Refund"}],e.tab),i=e=>{a.checkedTab.value=e.value;const i=a.tabs[0].value===e.value?{name:Le.A.settlement}:{name:Le.A.collection,params:{tab:e.value}};t.root.$router.push(i)},s=(0,n.computed)((()=>Ne.get(a.checkedTab.value)??"settlement"));return{...a,tabPane:s,onTabChange:i}}}),Ve=qe,We=(0,Z.Z)(Ve,s,l,!1,null,null,null),Ze=We.exports},79546:function(e,t,a){a.d(t,{Z:function(){return v}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tg-live-project-dialog-collection-refund-write-off"},[a("el-dialog",{staticClass:"customer-dialog tg-dialog-vcenter-new",attrs:{visible:e.visible,width:"920px",top:"278px","close-on-click-modal":!1},on:{close:e.handleCloseAction},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s("pay"===e.type?"付款退款核销":"收款退款核销"))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.handleCloseAction}},[e._v("取消")]),a("tg-button",{attrs:{disabled:e.saveDisabled,type:"primary"},on:{click:e.handleSaveAction}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticStyle:{height:"570px"}},[a("div",{staticClass:"write-off-amount"},[a("span",[e._v(e._s("退款可核销金额："))]),a("span",[e._v(e._s(e.formatAmount(e.notWriteOffAmount)))])]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],attrs:{height:510,stripe:"",data:e.data},on:{"selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"empty",fn:function(){return[a("empty-common",{attrs:{"detial-text":"暂无项目"}})]},proxy:!0}])},[e._l(e.columns,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),a("el-table-column",{attrs:{label:"本次核销金额",align:"right",width:178},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[a("el-input",{attrs:{value:t.row.type_in_write_off_amount,size:"small",disabled:e.typeInInputDisabled(t.row)},on:{input:function(a){return e.typeInAmountChanged(a,t.$index)}}},[a("span",{attrs:{slot:"prefix"},slot:"prefix"},[e._v("￥")])])],1)]}}])})],2)],1)]),a("tg-mask-loading",{attrs:{visible:e.saveLoading,content:"  正在保存，请稍候..."}})],1)},s=[],l=a(97434),n=a(61282),o=a(29625),r=a(3293),c=a(41572),u=a(85937),d=a.n(u),p=(0,l.defineComponent)({name:"RefundWriteOff",props:{visible:{type:Boolean,default:!1},invoiceId:{type:String},costId:{type:Number},costSplitId:{type:Number},type:{type:String,default:"receive"},projectType:{type:Number,default:o.kA.live},notWriteOffAmount:{type:Number},refund_cost_id:{type:String},achievement_id:{type:Number}},setup(e,t){const a=(0,l.computed)((()=>e.invoiceId??"")),i=(0,l.computed)((()=>e.projectType)),s=(0,l.ref)(!1),o=(0,l.ref)(!1),u=(0,l.ref)([]),p=(0,l.ref)([]),m=(0,l.computed)((()=>!u.value.length)),_=(0,l.computed)((()=>[{type:"selection",width:40},{label:"pay"===e.type?"应付编号":"应收编号",width:174,property:"receivable_uid",formatter:e=>e.receivable_uid},{label:"pay"===e.type?"原付款编号":"原收款编号",width:188,property:"receipt_uid",formatter:e=>e.receipt_uid},{label:"原单核销金额",width:152,align:"right",property:"write_off_amount",formatter:e=>(0,n.dN)(e.write_off_amount)},{label:"退款已核销金额",width:140,align:"right",property:"refund_write_off_amount",formatter:e=>(0,n.dN)(e.refund_write_off_amount)}])),f={handleCloseAction:()=>{t.emit("cancel"),t.emit("update:visible",!1)},handleSaveAction:()=>{const a=u.value.reduce(((e,t)=>new(d())(t.type_in_write_off_amount?t.type_in_write_off_amount:0).add(e)),new(d())(0));if(!a.lessThanOrEqualTo(new(d())(e.notWriteOffAmount??0)))return void t.root.$message.warning("所有记录的核销金额总和不能大于退款可核销金额");const i=u.value.find((e=>!e.type_in_write_off_amount||""===e.type_in_write_off_amount||0===Number(e.type_in_write_off_amount)));i?t.root.$message.warning("核销金额不能为0"):"pay"===e.type?f.savePayRefundWriteOffRequest():f.saveReceiveRefundWriteOffRequest()},formatAmount:n.dN,handleSelectionChange:e=>{u.value=e},typeInInputDisabled:e=>-1===u.value.indexOf(e),getPositivePriceNumber:(e,t=8)=>{const a=new RegExp(`(?:0|[1-9]\\d{0,${t-1}})(?:\\.\\d{0,2})?`,"u"),i=(a.exec(e.replace(/[^.\d]+/gu,"").replace(c.Pj,""))??[""])[0];return i},typeInAmountChanged:(e,t)=>{const a=p.value[t],i=a.write_off_amount?a.write_off_amount:0,s=a.refund_write_off_amount?a.refund_write_off_amount:0,l=new(d())(i).sub(new(d())(s)),n=f.getPositivePriceNumber(e);new(d())(n||0).lessThanOrEqualTo(l)&&(a.type_in_write_off_amount=n)},getReceivablesRefundForWriteOffList:async()=>{s.value=!0;const e=await(0,r.rX)(a.value,i.value);s.value=!1,e.data.success?p.value=e.data.data.map((e=>({...e,type_in_write_off_amount:void 0}))):p.value=[]},getPayRefundForWriteOffList:async()=>{s.value=!0;const t=await(0,r.$4)(e.refund_cost_id??"");s.value=!1,t.data.success?p.value=t.data.data.map((e=>({id:e.id,receipt_uid:e.cost_uid,receivable_uid:e.payable_uid,write_off_amount:e.write_off_amount,refund_write_off_amount:e.refund_write_off_amount,type_in_write_off_amount:void 0}))):p.value=[]},savePayRefundWriteOffRequest:async()=>{const a={achievement_id:e.achievement_id,write_off_list:u.value.map((e=>({pay_write_off_id:e.id,write_off_amount:e.type_in_write_off_amount??""})))};o.value=!0;const i=await(0,r.oj)(a);o.value=!1,i.data.success?(t.emit("save"),t.root.$message.success(i.data.message??"保存成功")):t.root.$message.error(i.data.message??"保存失败")},saveReceiveRefundWriteOffRequest:async()=>{const i={achievement_uid:a.value,cost_id:void 0,cost_split_id:void 0,write_off_list:u.value.map((e=>({id:e.id,write_off_amount:e.type_in_write_off_amount??""})))};e.costId?i["cost_id"]=e.costId:e.costSplitId&&(i["cost_split_id"]=e.costSplitId),o.value=!0;const s=await(0,r.Iu)(i);o.value=!1,s.data.success?(t.emit("save"),t.root.$message.success(s.data.message??"保存成功")):t.root.$message.error(s.data.message??"保存失败")}};return(0,l.watch)([()=>e.invoiceId,()=>e.type,()=>e.projectType,()=>e.visible,()=>e.refund_cost_id,()=>e.costSplitId],(([e,t,a,i,s])=>{e||s?"receive"===t?f.getReceivablesRefundForWriteOffList():"pay"===t&&f.getPayRefundForWriteOffList():p.value=[],i||(u.value=[],p.value=[])})),{data:p,saveLoading:o,listLoading:s,columns:_,...f,selectedList:u,saveDisabled:m}}}),m=p,_=a(1001),f=(0,_.Z)(m,i,s,!1,null,null,null),v=f.exports},31279:function(e,t,a){a.d(t,{Z:function(){return k}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic tg-dialog-vcenter-new write-off-first",attrs:{visible:e.writeOffVisible,width:"868px","close-on-click-modal":!1,"destroy-on-close":!0},on:{close:e.closeHandler},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(e._s(e.pageConst.dialogTitle))]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button-line",{attrs:{"justify-content":"center"}},[a("tg-button",{on:{click:e.closeHandler}},[e._v("取消")]),e.nextFlag?a("tg-button",{attrs:{disabled:0===e.selectedYxywIsActualIncome.length,type:"primary"},on:{click:e.submitHandler}},[e._v(" 提交 ")]):a("tg-button",{attrs:{type:"primary"},on:{click:e.nextStep}},[e._v("下一步")])],1)]},proxy:!0}])},[a("div",{staticClass:"write-off-main"},[e.nextFlag?e._e():a("el-alert",{staticStyle:{color:"#ff7a36",height:"40px"},attrs:{closable:!1,title:e.pageConst.alert,type:"warning","show-icon":""}}),a("div",{staticClass:"write-amount"},[a("span",[e._v(e._s(e.pageConst.amountText))]),a("span",{staticClass:"amount"},[e._v(e._s(e.notAmount))])]),e.nextFlag?[a("div",{staticClass:"write-off-query write-off-next"},[a("div",{staticClass:"next-head"},[a("span",{staticClass:"label"},[e._v(e._s(e.pageConst.queryText))]),a("div",{staticStyle:{"margin-left":"auto",color:"#a4b2c2","margin-right":"5px"}},[a("el-popover",{attrs:{placement:"top",trigger:"hover",content:e.pageConst.searchTip}},[a("div",{staticClass:"tip",attrs:{slot:"reference"},slot:"reference"},[a("tg-icon",{attrs:{name:"ico-question"}})],1)])],1),a("el-input",{staticClass:"next-input",attrs:{size:"mini",placeholder:e.pageConst.queryPlaceholder},nativeOn:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchHandler.apply(null,arguments)}},model:{value:e.achievementId,callback:function(t){e.achievementId=t},expression:"achievementId"}},[a("span",{staticClass:"el-icon-search suffix-search",attrs:{slot:"suffix"},on:{click:e.searchHandler},slot:"suffix"})])],1),a("div",{staticClass:"query-table"},[a("el-table",{attrs:{stripe:"",data:e.queryData,height:"88px"},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",[a("div",{staticStyle:{"margin-top":"-45px"}},[a("span",{staticStyle:{"font-size":"14px",color:"#a4b2c2"}},[e._v("暂无数据")])])])]},proxy:!0}],null,!1,105308473)},e._l(e.pageConst.secondColumn,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),1)],1)]),a("div",{staticClass:"write-off-selected write-off-next"},[a("div",{staticClass:"next-head"},[a("span",{staticClass:"label"},[e._v(e._s(e.pageConst.writeOffText))])]),a("div",{staticClass:"selected-table"},[a("el-table",{attrs:{stripe:"",data:e.selectedYxywIsActualIncome,height:"260px"},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",{staticClass:"selected-table-empty"},[a("empty-common")],1)]},proxy:!0}],null,!1,742276989)},e._l(e.thirdColumn,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),1)],1)])]:a("div",{staticClass:"write-off-table"},[a("div",{staticClass:"table-title"},[e._v(e._s(e.pageConst.projectText))]),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{stripe:"",data:e.data,height:"426px"},on:{"selection-change":e.handleSelectionChange},scopedSlots:e._u([{key:"empty",fn:function(){return[a("div",{staticClass:"pdt-20"},[a("empty-common")],1)]},proxy:!0}])},e._l(e.pageConst.firstColumn,(function(t,i){return a("el-table-column",e._b({key:i},"el-table-column",t,!1))})),1)],1)],2)])},s=[],l=(a(26699),a(97434)),n=a(61282),o=a(17352);const r={type:"isReceivable",queryText:"业绩查询",searchTip:"付款编号仅支持实收发生的退款付款编号搜索",queryPlaceholder:"请输入收款或付款编号",dialogTitle:"应收核销",alert:"注意：如果需要核销到其他项目的实收，请点击下一步后添加。",queryAjax:o.Nm,yxSameProjectAjax:o.gg,yxSubmitAjax:o.l5,dbSameProjectAjax:o.Nq,dbSubmitAjax:o.BH,amountText:"应收单可核销金额",projectText:"同项目实收单",writeOffText:"实收核销列表",firstColumn:[{type:"selection",align:"center",headerAlign:"center",width:60},{label:"收款编号",property:"uid"},{label:"实收金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.gather_amount,"")},{label:"",width:110},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")},{label:"",width:110}],secondColumn:[{label:"收/付款编号",property:"uid",width:168},{label:"实收/实付金额 (元)",align:"right",headerAlign:"right",width:120,formatter:e=>{let t=e.gather_amount;return 2===e.search_type&&(t=-1*e.gather_amount),(0,n.dN)(t,"")}},{label:"项目名称",formatter:e=>e.project_name||"--",minWidth:300},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:110,formatter:e=>{let t=e.not_write_off_amount;return 2===e.search_type&&(t=-1*e.not_write_off_amount),(0,n.dN)(t,"")}}]},c={type:"isActualIncome",queryText:"应收查询",queryPlaceholder:"请输入应收编号",dialogTitle:"实收核销",alert:"注意：如果需要核销到其他项目的应收，请点击下一步后添加。",queryAjax:o.vJ,yxSameProjectAjax:o.nE,yxSubmitAjax:o.l5,dbSameProjectAjax:o.gi,dbSubmitAjax:o.BH,amountText:"实收可核销金额",projectText:"同项目应收单",writeOffText:"应收核销列表",firstColumn:[{type:"selection",align:"center",headerAlign:"center",width:60},{label:"应收编号",property:"uid"},{label:"应收金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.receivable_amount,"")},{label:"",width:110},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")},{label:"",width:110}],secondColumn:[{label:"应收编号",property:"uid",width:168},{label:"应收金额 (元)",align:"right",headerAlign:"right",width:120,formatter:e=>(0,n.dN)(e.receivable_amount,"")},{label:"项目名称",minWidth:300,showOverflowTooltip:!0,formatter:e=>e.project_name||"--"},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:110,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")}]},u={type:"isPayable",queryText:"收/付款查询",searchTip:"收款编号仅支持实付发生的退款收款编号搜索",queryPlaceholder:"请输入收款或付款编号",dialogTitle:"应付核销",alert:"注意：如果需要核销到其他项目的实付，请点击下一步后添加。",queryAjax:o.AX,yxSameProjectAjax:o.AX,yxSubmitAjax:o.Xc,dbSameProjectAjax:o.AX,dbSubmitAjax:o.Xc,amountText:"应付单可核销金额",projectText:"同项目实收单",writeOffText:"实付核销列表",firstColumn:[{type:"selection",align:"center",headerAlign:"center",width:60},{label:"付款编号",property:"id"},{label:"实付金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.cost_amount,"")},{label:"",width:110},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")},{label:"",width:110}],secondColumn:[{label:"收/付款编号",width:168,formatter:e=>4===e.search_type?e.uid:e.id},{label:"实收/实付金额 (元)",align:"right",headerAlign:"right",width:120,formatter:e=>{let t=e.cost_amount;return 4===e.search_type&&(t=-1*e.cost_amount),(0,n.dN)(t,"")}},{label:"项目名称",minWidth:300,showOverflowTooltip:!0,formatter:e=>e.project_name||"--"},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:110,formatter:e=>{let t=e.not_write_off_amount;return 4===e.search_type&&(t=-1*e.not_write_off_amount),(0,n.dN)(t,"")}}]},d={type:"isActual",queryText:"应付查询",queryPlaceholder:"请输入应付编号",dialogTitle:"实付核销",alert:"注意：如果需要核销到其他项目的应付，请点击下一步后添加。",queryAjax:o.t6,yxSameProjectAjax:o.eD,yxSubmitAjax:o.Xc,dbSameProjectAjax:o.eD,dbSubmitAjax:o.Xc,amountText:"实付单可核销金额",projectText:"同项目应付单",writeOffText:"应付核销列表",firstColumn:[{type:"selection",align:"center",headerAlign:"center",width:60},{label:"应付编号",property:"uid"},{label:"应付金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.payable_amount,"")},{label:"",width:110},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:126,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")},{label:"",width:110}],secondColumn:[{label:"应付编号",property:"uid",width:168},{label:"应付金额 (元)",align:"right",headerAlign:"right",width:120,formatter:e=>(0,n.dN)(e.payable_amount,"")},{label:"项目名称",minWidth:300,showOverflowTooltip:!0,formatter:e=>e.project_name||"--"},{label:"未核销金额 (元)",align:"right",headerAlign:"right",width:110,formatter:e=>(0,n.dN)(e.not_write_off_amount,"")}]};var p=a(64236),m=a(82741),_=a(85937),f=a.n(_),v=a(67910);const h=e=>(0,n.SJ)(new(f())(e)),g=e=>{const t=(0,l.ref)([]),a=(0,l.ref)([]),i=(0,l.ref)(!1),s=(0,l.ref)(!1),n=(0,l.ref)(!1),o=async(a,s)=>{i.value=!0;const[{data:l}]=await Promise.all([await s(a),await(0,p._v)(500)]);i.value=!1,l.success?(l.data.forEach((e=>e.write_off_amount=void 0)),t.value=l.data):e.root.$message({type:"warning",message:l.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},r=async(t,i)=>{s.value=!0;const[{data:l}]=await Promise.all([await i(t),await(0,p._v)(500)]);s.value=!1,l.success?(l.data.write_off_amount=void 0,a.value=[l.data]):e.root.$message({type:"warning",message:l.message??"查询失败，稍后重试",duration:2e3,showClose:!0})},c=async(t,a)=>{n.value=!0;const[{data:i}]=await Promise.all([await a(t),await(0,p._v)(500)]);return n.value=!1,i.success?Promise.resolve(!0):(e.root.$message({type:"warning",message:i.message??"查询失败，稍后重试",duration:2e3,showClose:!0}),Promise.reject())};return{loading:i,data:t,queryData:a,loadDataList:o,loadAchievement:r,submitAjax:c,submitLoading:n}};var y=(0,l.defineComponent)({setup(e,t){const a=(0,l.ref)(c),i=(0,l.ref)(1),s=(0,l.ref)(""),o=g(t),p=(0,l.ref)(!1),_=(0,l.ref)(""),f=(0,l.ref)(!1),y=(0,l.ref)([]),b=({gather_amount:e})=>void 0===e?"--":`￥${h(e)}`,w=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(b(e)))),(0,n.QN)("实收金额")))),C=({payable_amount:e})=>void 0===e?"--":`￥${h(e)}`,k=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(C(e)))),(0,n.QN)("应收金额")))),x=({receivable_amount:e})=>void 0===e?"--":`￥${h(e)}`,S=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(x(e)))),(0,n.QN)("应付金额")))),A=({cost_amount:e,search_type:t})=>void 0===e?"--":`￥${h(4===t?-1*Number(e):e)}`,j=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(A(e)))),(0,n.QN)("实付金额")))),D=e=>`￥${h(e.not_write_off_amount)}`,F=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(D(e)))),(0,n.QN)("未核销金额")))),$=e=>`${e.uid}`,P=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)($(e)))),(0,n.QN)("收款编号")))),R=e=>`${e.id}`,I=e=>e.project_name?e.project_name.length<=13?e.project_name:e.project_name.substr(0,13)+"...":"--",T=({project_name:e})=>e?e.length<=13?e:(0,l.h)("el-tooltip",{props:{effect:"light",placement:"top-start",content:e}},[(0,l.h)("span",void 0,e.substr(0,13)+"...")]):"--",O=(0,l.computed)((()=>Math.max(...y.value.map((e=>(0,n.QN)(I(e)))),(0,n.QN)("项目名称")))),L=(0,l.computed)((()=>[{label:"核销金额 (元)",width:122,formatter:e=>(0,l.h)("el-input",{on:{input:t=>{Q(t,e)},blur:()=>{U(e)}},attrs:{size:"mini",placeholder:"0.00"},props:{value:e.write_off_amount}})},{label:"操作",width:70,formatter:(e,t,a,i)=>(0,l.h)("a",{on:{click:()=>{G(i)}}},["移除"])}])),N=(0,l.computed)((()=>[{label:"应收编号",property:"uid",minWidth:P.value,formatter:$},{label:"应收金额",align:"right",minWidth:S.value+20,formatter:e=>x(e)},{label:"项目名称",minWidth:O.value,formatter:T},{label:"未核销金额",align:"right",headerAlign:"right",minWidth:F.value+20,formatter:D},...L.value])),q=(0,l.computed)((()=>[{label:"收/付款编号",property:"uid",minWidth:P.value,formatter:$},{label:"实收/实付金额",align:"right",headerAlign:"right",minWidth:w.value+40,formatter:b},{label:"项目名称",minWidth:O.value,formatter:T},{label:"未核销金额",align:"right",headerAlign:"right",minWidth:F.value+20,formatter:D},...L.value])),V=(0,l.computed)((()=>[{label:"应付编号",property:"uid",minWidth:P.value,formatter:$},{label:"应付金额",align:"right",headerAlign:"right",minWidth:k.value+20,formatter:e=>C(e)},{label:"项目名称",minWidth:220,formatter:T},{label:"未核销金额",align:"right",headerAlign:"right",minWidth:F.value+20,formatter:D},...L.value])),W=(0,l.computed)((()=>[{label:"收/付款编号",property:"id",minWidth:(0,v.zY)(y,"收/付款编号",$).value,formatter:e=>4===e.search_type?$(e):R(e)},{label:"实付金额",align:"right",headerAlign:"right",minWidth:j.value+20,formatter:e=>A(e)},{label:"项目名称",minWidth:220,formatter:T},{label:"未核销金额",align:"right",headerAlign:"right",minWidth:F.value+20,formatter:D},...L.value])),Z=(0,l.computed)((()=>"isActualIncome"===a.value.type?N.value:"isReceivable"===a.value.type?q.value:"isActual"===a.value.type?V.value:"isPayable"===a.value.type?W.value:[]));let B=0,M="",z="live";const Y=()=>{f.value=!1,p.value=!1,y.value=[],s.value="",_.value="",o.queryData.value=[]},E=()=>{let e=o.queryData.value[0];2!==e?.search_type&&4!==e?.search_type||(e={...e},e.gather_amount=Number("-"+e.gather_amount),e.not_write_off_amount=Number("-"+e.not_write_off_amount)),y.value.unshift(e),o.queryData.value=[]},X=e=>{y.value=e},J={label:" ",align:"right",formatter:e=>{const t=y.value.map((e=>e.id));return(0,l.h)("el-button",{on:{click:()=>{E()}},attrs:{size:"mini",type:"primary",disabled:t.includes(e.id)}},["添加"])}},G=e=>{y.value.splice(e,1)},U=e=>{if(2===e?.search_type||4===e?.search_type){const t=e.write_off_amount;if(t){const t=Number("-"+e.write_off_amount);isNaN(t)?e.write_off_amount=e.write_off_amount?.includes("-")?e.write_off_amount:"-"+e.write_off_amount:t>=e.not_write_off_amount?e.write_off_amount=t+"":e.write_off_amount=e.not_write_off_amount+""}}},Q=(e,t)=>{t.search_type&&1!==t.search_type?t.write_off_amount=(0,n.nA)(e):Number(e)>t.not_write_off_amount?t.write_off_amount=t.not_write_off_amount+"":t.write_off_amount=(0,n.nA)(e)},H=()=>{if(!_.value.trim())return;const e={},t=location.pathname.split("/"),s=t.find((e=>/\d/.test(e)));"isReceivable"===a.value.type?(e.achievement_uid=_.value,e.receivable_type=i.value,e.project_id=s):"isActualIncome"===a.value.type?(e.receivable_uid=_.value,e.receivable_type=i.value):"isPayable"===a.value.type?(e.cost_id=_.value,e.payable_type=i.value,e.project_type=z,e.project_id=s):"isActual"===a.value.type&&(e.payable_uid=_.value,e.payable_type=i.value),o.loadAchievement(e,a.value.queryAjax),_.value=""},K=({type:e="isActualIncome",id:t,leaf:l,amount:n,busType:p,receivable_uid:m,cost_split_id:_})=>{f.value=!0;const v={};"isActualIncome"===e?(a.value=c,v.achievement_id=t):"isReceivable"===e?(a.value=r,v.receivable_id=t):"isActual"===e?(a.value=d,v.cost_id=t,v.project_type=l,"live"===l&&(v.cost_split_id=_)):"isPayable"===e&&(a.value=u,v.project_type=l,v.payable_id=t),a.value.secondColumn[4]=J,i.value=p,B=n,M=m,z=l,s.value=h(n),o.loadDataList(v,"coop"===l?a.value.yxSameProjectAjax:a.value.dbSameProjectAjax)},ee=()=>{p.value=!0},te=async()=>{const e=y.value.find((e=>"0"===e.write_off_amount));if(e)return void t.root.$message({type:"warning",message:"核销金额不能小于等于0",duration:2e3,showClose:!0});const i=y.value.filter((e=>e.write_off_amount)).map((e=>e.write_off_amount)),s=i.reduce(((e,t)=>1*e+1*t),0),l=y.value.map((e=>"isReceivable"===a.value.type?{receivable_uid:M,receipt_uid:e.uid,write_off_amount:e.write_off_amount}:"isActualIncome"===a.value.type?{receivable_uid:e.uid,receipt_uid:M,write_off_amount:e.write_off_amount}:"isActual"===a.value.type?{paid_uid:M,payable_uid:e.uid,write_off_amount:e.write_off_amount}:"isPayable"===a.value.type?{paid_uid:4===e.search_type?e.uid:e.id,payable_uid:M,write_off_amount:e.write_off_amount}:void 0));if(s>B)return void t.root.$message({type:"warning",message:"输入核销金额不能超过可核销金额",duration:2e3,showClose:!0});if(!s||s<=0)return void t.root.$message({type:"warning",message:"核销金额不能小于等于0",duration:2e3,showClose:!0});const n=await(0,m.I)(t,{title:"确认进行核销？操作成功后不可撤销"});if(n){const e={list:l,confirm:!0,project_type:z},i="live"===z?a.value.dbSubmitAjax:a.value.yxSubmitAjax;o.submitAjax(e,i).then((()=>{Y(),t.root.$message({type:"success",message:"核销成功",duration:2e3,showClose:!0}),t.emit("submit")}))}};return{writeOffVisible:f,closeHandler:Y,nextFlag:p,show:K,nextStep:ee,submitHandler:te,...o,notAmount:s,pageConst:a,handleSelectionChange:X,achievementId:_,searchHandler:H,selectedYxywIsActualIncome:y,thirdColumn:Z}}}),b=y,w=a(1001),C=(0,w.Z)(b,i,s,!1,null,null,null),k=C.exports},10114:function(e,t,a){a.d(t,{Z:function(){return d}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"tg-dialog-classic tg-dialog-vcenter-new tg-write-off-confirm-dialog",attrs:{visible:e.visible,"close-on-click-modal":!1,width:"440px"},on:{close:e.close},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("单据冲销")]},proxy:!0},{key:"footer",fn:function(){return[a("tg-button",{on:{click:e.close}},[e._v("取消")]),a("tg-button",{attrs:{type:"primary",disabled:e.isConfirmButtonDisabled},on:{click:e.onConfirm}},[e._v("保存")])]},proxy:!0}])},[a("div",{staticStyle:{padding:"24px"}},[a("div",{staticClass:"star"},[e._v("冲销原因")]),a("div",{staticStyle:{"margin-top":"7px"}},[a("el-input",{attrs:{type:"textarea",placeholder:"请输入冲销原因",clearable:"",maxlength:100,"show-word-limit":""},model:{value:e.reverse_reason,callback:function(t){e.reverse_reason=t},expression:"reverse_reason"}})],1)])])},s=[],l=a(97434),n=a(58861),o=(0,l.defineComponent)({setup(e,t){const a=(0,l.ref)(""),i=(0,l.ref)(null),{visible:s,setVisible:o}=(0,n.Z)(),r=()=>{a.value="",o()},c=(0,l.computed)((()=>""===a.value.trim())),u=async()=>{if(""===a.value.trim())return void t.root.$message.warning("请填写冲销原因");const e=await(i.value?.(a.value));e&&(a.value="",o())},d=(e,t="")=>{a.value=t,i.value=e,o(!0)};return{visible:s,open:d,reverse_reason:a,close:r,onConfirm:u,isConfirmButtonDisabled:c}}}),r=o,c=a(1001),u=(0,c.Z)(r,i,s,!1,null,null,null),d=u.exports},39716:function(e,t,a){a.d(t,{Z:function(){return D}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-drawer",{attrs:{title:"开票申请详情",visible:e.visible,height:"100vh",size:"612",wrapperClosable:!1},on:{close:e.close}},[e.loading?a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"420px"}}):e._e(),e.detail?a("div",{staticClass:"invoice-dialog-content"},[a("div",{staticClass:"main"},[a("div",{staticClass:"invoice-info-header"},[a("div",{staticClass:"invoice-info-header-list"},[a("div",{staticClass:"invoice-info-header-item"},[a("span",[e._v("申请人:")]),a("span",[e._v(e._s(e.detail.username))])]),a("div",{staticClass:"invoice-info-header-item"},[a("span",[e._v("申请部门:")]),a("span",[e._v(e._s(e.detail.create_department))])]),a("div",{staticClass:"invoice-info-header-item"},[a("span",[e._v("发起时间:")]),a("span",[e._v(e._s(e.detail.gmt_create))])])]),a("a",{on:{click:function(t){return e.exportPdf(e.detail.approval_id)}}},[e._v("下载PDF")])]),a("div",{staticClass:"invoice-info-body"},[a("div",{staticClass:"invoice-info-uid"},[a("span",{staticClass:"uid"},[e._v("审批编号："+e._s(e.detail.approval_uid))]),a("div",{staticClass:"invoice-tag",attrs:{"data-text":e.ApprovalStatusText}},[e._v(e._s(e.ApprovalStatusText))])]),a("div",{staticClass:"invoice-info-base base-grid"},[a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("开票类型：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.发票类型))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("关联客户合同：")]),a("div",{staticClass:"base-grid-item-content"},[a("a",{on:{click:e.jumpContract}},[e._v(e._s(e.detail.contract_uid))])])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("开票金额：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.开票金额))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("关联业绩：")]),a("div",{staticClass:"base-grid-item-content"},[a("a",{on:{click:e.jumpAchievement}},[e._v(e._s(e.detail.achievement_uid))])])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("款项是否收到：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.款项是否收到))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v(e._s(e.收款时间标签))]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.收款时间))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("发票寄送方式：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.发票寄送方式))])])]),a("el-divider",{staticStyle:{margin:"17px 0"}}),a("div",{staticClass:"invoice-info-title"},[e._v("开票信息")]),a("div",{staticClass:"invoice-info-base base-grid",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("公司名称：")]),a("div",{staticClass:"base-grid-item-content line-clamp-1"},[e._v(" "+e._s(e.detail.collecting_company||"--")+" ")])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("纳税人识别号：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.tax_number||"--"))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("地址：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.address||"--"))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("电话：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.phone||"--"))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("开户行：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.bank_of_deposit||"--"))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("账号：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.bank_card_number||"--"))])]),a("div",{staticClass:"base-grid-item"},[a("div",{staticClass:"base-grid-item-lbl"},[e._v("备注：")]),a("div",{staticClass:"base-grid-item-content"},[e._v(e._s(e.detail.remark||"--"))])])])],1)]),a("el-divider",{staticStyle:{margin:"17px 0"}}),a("div",{staticClass:"flow",staticStyle:{"padding-top":"12px"}},[a("div",{staticClass:"invoice-info-title"},[e._v("审批流程")]),a("tg-steps",{attrs:{direction:"vertical",steps:e.steps,active:e.activeNumber}})],1)],1):e._e()])},s=[],l=a(97434),n=a(56082),o=a(64479),r=a(64236),c=a(57325),u=a(17890),d=a(1763),p=a(49187),m=a(6933),_=a.n(m),f=a(4249),v=a(51351),h=a(17809),g=a(32622);const y=new p.ZP,b=e=>""===e||void 0===e?"--":`￥${y.format(e,p.WL.Yuan)}`,w=()=>{const e=e=>{(0,o.m)(e)};return{exportPdf:e}},C=(e,t)=>{const a=(0,l.computed)((()=>u.yR.get(t.value?.approval_status??u.Kb.Processing))),i=(0,l.computed)((()=>t.value?.level_two_types?n.IK.get(t.value?.level_two_types)??"--":"--")),s=()=>{if(!t.value?.contract_id)return;const{href:a}=e.root.$router.resolve({name:d.l6.contracts.customer.detail,params:{id:`${t.value?.contract_id??""}`},query:{partner_type:"2"}});window.open(a,"_blank")},o=(0,l.computed)((()=>b(t.value?.invoice_amount))),r=()=>{if(!t.value?.achievement_id)return;const a=t.value?.achievement_uid?.substring(0,2)??"",i="DY"===a||"TD"===a||"TB"===a||"YX"===a?d.B_.receive:d.Z8.achievement,{href:s}=e.root.$router.resolve({name:i,query:{source:"dialog",achievement:t.value?.achievement_uid}});window.open(s,"_blank")},c=(0,l.computed)((()=>(t.value?.is_received?"预计":"")+"收款时间：")),p=(0,l.computed)((()=>_()(t.value?.received_date).format("YYYY.MM.DD"))),m=(0,l.computed)((()=>1===t.value?.is_received?"是":"否")),f=(0,l.computed)((()=>1===t.value?.invoice_send_type?"快递寄送":"自行送达"));return{ApprovalStatusText:a,"发票类型":i,jumpContract:s,"开票金额":o,jumpAchievement:r,"收款时间标签":c,"收款时间":p,"款项是否收到":m,"发票寄送方式":f}},k=new Map;var x=(0,l.defineComponent)({name:"TgInvoiceDetail",components:{ApprovalFlow:f.Z},props:{},setup(e,t){const a=(0,l.ref)(!1),i=(0,l.ref)(!1),s=(0,l.ref)(void 0),n=()=>{a.value=!0},u=()=>{a.value=!1};t.root.$store.hasModule("workbench")||t.root.$store.registerModule("workbench",h.T);const d=async e=>{i.value=!0;const a=k.get(e);if(n(),void 0!==a)await(0,r._v)(500),s.value=a;else{const[{data:a}]=await Promise.all([await(0,o.Z)({approval_id:e}),await(0,r._v)(500)]);a.success?(s.value=a.data,k.set(e,a.data)):(t.root.$message.error(a.message??"获取审批单详情失败"),u())}const{data:l}=await(0,v.OC)({approval_id:e});l.success?t.root.$store.dispatch("workbench/setApproval",{...l.data}):t.root.$message.error(l.message??"获取审批详情失败"),i.value=!1},p=()=>{u(),s.value=void 0};return{visible:a,loading:i,open:d,close:p,detail:s,fixFileToken:c.W,...w(),...C(t,s),...(0,g.o)(t)}}}),S=x,A=a(1001),j=(0,A.Z)(S,i,s,!1,null,null,null),D=j.exports},89935:function(e,t,a){a.d(t,{$X:function(){return w},CE:function(){return u},E1:function(){return P},E9:function(){return c},Fj:function(){return $},G7:function(){return x},H2:function(){return l},KL:function(){return k},KS:function(){return n},L8:function(){return j},OI:function(){return s},Q:function(){return f},Rd:function(){return g},Sx:function(){return A},Vd:function(){return d},XQ:function(){return _},YE:function(){return r},YK:function(){return b},aX:function(){return o},bM:function(){return D},dQ:function(){return h},gZ:function(){return R},hi:function(){return S},iN:function(){return p},qw:function(){return F},sk:function(){return m},tv:function(){return C},u_:function(){return v},w1:function(){return y}});var i=a(93889);const s=[{value:1,label:"美妆"},{value:2,label:"个护"},{value:3,label:"服饰"},{value:4,label:"美食"},{value:5,label:"母婴"},{value:6,label:"数码"},{value:7,label:"家居"},{value:8,label:"保健"},{value:9,label:"萌宠"},{value:10,label:"箱包"},{value:11,label:"配饰"}],l=[{value:0,label:"混播"},{value:1,label:"专场"}],n=[{value:0,label:"0 ~ 100"},{value:1,label:"100 ~ 200"},{value:2,label:"200以上"}],o=[{value:"每小时观看人数",color:"#7484b7"},{value:"每小时观看数",color:"#4dcdb1"},{value:"场均观看人数",color:"#f895e7"},{value:"场均观看数",color:"#ffbf40"},{value:"粉丝精准度",color:"#5273d3"},{value:"日均开播场次",color:"#d87a80"},{value:"日均开播时长",color:"#b6a2de"},{value:"人均点击数",color:"#FFB980"},{value:"每小时互动数",color:"#d075c4"},{value:"人均互动数",color:"#fd936e"}],r=[{value:"最近15天",label:15},{value:"最近1个月",label:30},{value:"最近3个月",label:90}],c=[{value:"每小时观看人数",color:"#4dcdb1"},{value:"每小时观看数",color:"#7484b7"},{value:"观看数",color:"#b4c4f5"},{value:"观看人数",color:"#f895e7"},{value:"时长",color:"#5ab1ef"}],u=[{value:"最近7场",num:7},{value:"最近15场",num:15},{value:"最近30场",num:30},{value:"最近90场",num:90}],d=["最近15天","最近1个月","最近3个月"],p=[{value:0,label:"白天"},{value:1,label:"晚上"}],m=[{value:3,label:"0 ~ 5分钟"},{value:0,label:"5 ~ 10分钟"},{value:1,label:"10 ~ 15分钟"},{value:2,label:"15 ~ 20分钟"},{value:4,label:"20分钟以上"}],_=[{value:1,label:"预售场"},{value:2,label:"预热场"},{value:0,label:"非预售场"},{value:-1,label:"未录入"}],f=[{value:1,label:"预售场"},{value:2,label:"预热场"},{value:0,label:"非预售场"}],v=[{value:1,label:"未出单"},{value:2,label:"已出单"}],h=[{value:7,label:"最近一周"},{value:15,label:"最近15天"},{value:30,label:"最近一个月"}],g=[{value:i.RJ.Sales,label:"销售合同"},{value:i.RJ.Framework,label:"框架合同"}],y=[{value:1,label:"客户合同"},{value:2,label:"供应商合同"}],b=[{value:3,label:"采买合同"},{value:4,label:"框架合同"}],w=[{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"}],C=[{value:1,label:"营销业务"},{value:3,label:"抖音店播"},{value:2,label:"淘宝店播"},{value:4,label:"区域业务"},{value:5,label:"S2B2C"}],k=[{value:1,label:"小红书"},{value:2,label:"微信公众号"},{value:3,label:"新浪微博"},{value:4,label:"抖音"},{value:5,label:"快手"},{value:6,label:"哔哩哔哩"},{value:7,label:"淘宝直播"},{value:8,label:"一直播"},{value:9,label:"淘宝图文"},{value:10,label:"淘宝短视频"},{value:11,label:"线下场地搭建"},{value:12,label:"线下视觉设计"},{value:13,label:"活动策划执行"}],x=[{value:1,label:"长视频"},{value:2,label:"短视频"},{value:3,label:"直播"}];var S,A;(function(e){e[e["ServiceCharge"]=1]="ServiceCharge",e[e["Commission"]=2]="Commission",e[e["Other"]=3]="Other",e[e["Refund"]=5]="Refund"})(S||(S={})),function(e){e[e["writeoff_no"]=0]="writeoff_no",e[e["writeoff_partial"]=1]="writeoff_partial",e[e["writeoff_yes"]=2]="writeoff_yes"}(A||(A={}));const j=[{label:"未核销",value:A.writeoff_no},{label:"部分核销",value:A.writeoff_partial},{label:"已核销",value:A.writeoff_yes}],D=new Map([[S.ServiceCharge,"服务费"],[S.Commission,"佣金"],[S.Other,"其他"],[S.Refund,"退款"]]),F=[{label:"服务费",value:S.ServiceCharge},{label:"佣金",value:S.Commission},{label:"其他",value:S.Other},{label:"退款",value:S.Refund}],$=[{label:"V任务",value:1},{label:"支付宝",value:2},{label:"对公银行",value:3}],P=[...$,{label:"阿里妈妈",value:4},{label:"巨量百应",value:5}],R=[{label:"网络营销师",value:1},{label:"练习生",value:2}]},17352:function(e,t,a){a.d(t,{AX:function(){return y},BH:function(){return v},Nm:function(){return _},Nq:function(){return u},T:function(){return l},UM:function(){return n},Xc:function(){return w},eD:function(){return g},eV:function(){return r},gg:function(){return p},gi:function(){return d},iY:function(){return c},l5:function(){return h},nE:function(){return m},pF:function(){return o},t6:function(){return b},vJ:function(){return f}});var i=a(76012),s=a(64236);const l=async e=>(0,i.dX)("/api/coop/query_cooperation_achievement",{params:{...(0,s.jG)(e)}}),n=async e=>(0,i.dX)("/api/receivable/query_marketing_receivables",{params:{...(0,s.jG)(e)}}),o=async e=>(0,i.dX)("/api/receivable/query_shop_live_receivables",{params:{...(0,s.jG)(e)}}),r=async e=>(0,i.SO)("/api/coop/del_achievement",{...(0,s.jG)(e)}),c=async e=>(0,i.SO)("/api/coop/save_achievement",{...(0,s.jG)(e)}),u=async e=>(0,i.dX)("/api/receivable/query_shop_live_achievements_for_write_off",{params:{...(0,s.jG)(e)}}),d=async e=>(0,i.dX)("/api/receivable/query_shop_live_receivables_for_write_off",{params:{...(0,s.jG)(e)}}),p=async e=>(0,i.dX)("/api/receivable/query_marketing_achievements_for_write_off",{params:{...(0,s.jG)(e)}}),m=async e=>(0,i.dX)("/api/receivable/query_marketing_receivables_for_write_off",{params:{...(0,s.jG)(e)}}),_=async e=>(0,i.dX)("/api/receivable/search_achievement_for_write_off",{params:{...(0,s.jG)(e)}}),f=async e=>(0,i.dX)("/api/receivable/search_receivable_for_write_off",{params:{...(0,s.jG)(e)}}),v=async e=>(0,i.SO)("/api/receivable/shop_live/write_off",{...(0,s.jG)(e)}),h=async e=>(0,i.SO)("/api/receivable/marketing/write_off",{...(0,s.jG)(e)}),g=async e=>(0,i.dX)("/api/payable/query_payables_for_write_off/"+e.project_type,{params:{...(0,s.jG)(e)}}),y=async e=>(0,i.dX)("/api/payable/query_costs_for_write_off/"+e.project_type,{params:{...(0,s.jG)(e)}}),b=async e=>(0,i.dX)("/api/payable/search_payable_for_write_off",{params:{...(0,s.jG)(e)}}),w=async e=>(0,i.SO)("/api/payable/write_off/"+e.project_type,{...(0,s.jG)(e)})},64479:function(e,t,a){a.d(t,{Z:function(){return c},m:function(){return u}});var i=a(76012),s=a(25702),l=a(64236),n=a(74750);const o=(0,n.LP)(),r=!1,c=async e=>(0,i.dX)(s.MI,{params:e});function u(e){const t=`/api/approval/export_approval_info_pdf?approval_id=${e}&Authorization=${o}`,a=r?`${window.location.protocol}${window.location.host}${t}`:`https://data.goumee.com${t}`;(0,l.qz)(a)}},93889:function(e,t,a){a.d(t,{GD:function(){return u},MT:function(){return n.Kb},N5:function(){return l},RJ:function(){return i},TZ:function(){return o},Vx:function(){return r},cC:function(){return s},kD:function(){return p},kV:function(){return m},nd:function(){return c},wk:function(){return d}});var i,s,l,n=a(17890);(function(e){e[e["Sales"]=1]="Sales",e[e["Framework"]=2]="Framework",e[e["Purchase"]=3]="Purchase",e[e["SupplierFramework"]=4]="SupplierFramework",e[e["ServiceContract"]=5]="ServiceContract",e[e["SupplierContract"]=6]="SupplierContract",e[e["AnchorContract"]=7]="AnchorContract"})(i||(i={})),function(e){e[e["initial"]=0]="initial",e[e["waiting"]=1]="waiting",e[e["passed"]=2]="passed",e[e["refused"]=3]="refused"}(s||(s={})),function(e){e[e["Type1"]=1]="Type1",e[e["Type2"]=2]="Type2",e[e["Type3"]=3]="Type3"}(l||(l={}));const o=new Map([[l.Type1,"不用印章"],[l.Type2,"公章"],[l.Type3,"合同章"]]),r=[{label:"公章",value:l.Type2},{label:"合同章",value:l.Type3},{label:"不用印章",value:l.Type1}],c=new Map([[n.Kb.Pending,"待审批"],[n.Kb.Normal,"审批成功"],[n.Kb.Failure,"审批失败"],[n.Kb.Processing,"审批中"],[n.Kb.Invalid,"作废"]]);var u;(function(e){e[e["Bank"]=1]="Bank",e[e["Alipay"]=2]="Alipay",e[e["VTask"]=3]="VTask",e[e["Alimama"]=4]="Alimama",e[e["Buyin"]=5]="Buyin"})(u||(u={}));const d=new Map([[u.Bank,"对公银行"],[u.Alipay,"支付宝"],[u.VTask,"V任务"],[u.Alimama,"淘宝联盟"],[u.Buyin,"巨量百应"]]),p=[{value:u.Bank,label:"对公银行"},{value:u.Alipay,label:"支付宝"},{value:u.VTask,label:"V任务"},{value:u.Alimama,label:"淘宝联盟"},{value:u.Buyin,label:"巨量百应"}],m=new Map([[1,"单次合作"],[2,"框架合同"],[3,"长期合作"],[4,"合作协议"],[-1,"补充协议"],[-2,"从合同"],[-3,"解除协议"],[-4,"结算协议"],[11,"销售合同"],[12,"采买合同"]]);new Map([[0,"其它"],[1,"固定服务费"],[2,"固定服务费+佣金"],[3,"纯佣金"]])},17890:function(e,t,a){var i,s;a.d(t,{Kb:function(){return i},OX:function(){return r},l7:function(){return o},yR:function(){return l}}),function(e){e[e["Pending"]=1]="Pending",e[e["Normal"]=2]="Normal",e[e["Failure"]=3]="Failure",e[e["Processing"]=4]="Processing",e[e["Invalid"]=5]="Invalid"}(i||(i={})),function(e){e[e["Yes"]=0]="Yes",e[e["No"]=1]="No",e[e["Reject"]=2]="Reject"}(s||(s={}));const l=new Map([[i.Pending,"待审批"],[i.Normal,"审批成功"],[i.Failure,"审批失败"],[i.Processing,"审批中"],[i.Invalid,"已作废"]]),n=new Map([[s.Yes,"未上传"],[s.No,"已上传"],[s.Reject,"已驳回"]]),o=[i.Normal,i.Failure,i.Processing,i.Invalid].map((e=>({value:e,label:l.get(e)??""}))),r=[s.Yes,s.No,s.Reject].map((e=>({value:e,label:n.get(e)??""})))},56082:function(e,t,a){a.d(t,{IK:function(){return i},LD:function(){return l},TZ:function(){return n},dU:function(){return o},zi:function(){return r}});const i=new Map([[1,"普通发票"],[2,"专用发票"],[3,"电子发票"],[4,"收据"]]);var s;(function(e){e[e["Marketing"]=1]="Marketing",e[e["shop_live_taobao"]=2]="shop_live_taobao",e[e["shop_live_douuyin"]=3]="shop_live_douuyin",e[e["area"]=4]="area",e[e["mcn"]=5]="mcn",e[e["yufeng_put"]=6]="yufeng_put",e[e["shop_live_douuyin_shanghai"]=7]="shop_live_douuyin_shanghai",e[e["other"]=8]="other"})(s||(s={}));const l=new Map([[1,"构美（浙江）信息科技有限公司"],[2,"杭州煜丰电子商务有限公司"],[3,"构美（浙江）信息科技有限公司上海分公司"]]),n=new Map([[1,"公章"],[2,"法人章"],[3,"财务专用章"],[4,"合同章"]]),o=new Map([[1,"个人类型"],[2,"公司类型"]]),r=new Map([[s.Marketing,"营销业务"],[s.shop_live_taobao,"淘宝店播"],[s.shop_live_douuyin,"抖音店播"],[s.area,"区域业务"],[s.mcn,"MCN业务"],[s.yufeng_put,"煜丰投放"],[s.shop_live_douuyin_shanghai,"抖音店播(上海)"],[s.other,"其他"]])},32622:function(e,t,a){a.d(t,{o:function(){return s}});var i=a(97434);const s=e=>{const t=(0,i.computed)((()=>e.root.$store.state.workbench)),a=(0,i.computed)((()=>t.value.approval)),s=(0,i.computed)((()=>{const e=a.value?.approval_flow_detail.map((e=>({...e}))).reverse()??[],t=e.map((e=>{const t=e.approval_result?1===e.approval_result?"（已同意）":"（已拒绝）":"";return{title:e.role_name,description:()=>(0,i.h)("div",[(0,i.h)("div",[`审批人：${e.operatorName}${t}`]),(0,i.h)("div",[e.operateDate])])}}));if(1===a.value?.approval_status){const a=e[e.length-1];t.push({title:a.receivedPersons,description:""})}else 4===a.value?.approval_status&&t.push({title:"申请人",description:()=>(0,i.h)("div",[(0,i.h)("div",[a.value?.username+"（已撤销）"]),(0,i.h)("div",[a.value?.gmt_modified])])});return t})),l=(0,i.computed)((()=>void 0===a.value?0:1===a.value?.approval_status?s.value.length-1:s.value.length));return{steps:s,activeNumber:l}}},43847:function(e,t,a){a.d(t,{Pc:function(){return n},oR:function(){return l}});var i=a(77944),s=a(97434);const l=()=>i.Z,n=()=>{const e=l(),t=(0,s.computed)((()=>e.getters["user/getUserInfo"]));return t}},45781:function(e,t,a){var i=a(49187),s=a(8581),l=a(61282);const n=new i.ZP;t["Z"]={formatEmpty(e,t){return null===e||void 0===e||""===e||e instanceof Array&&e.length<=0?"--":void 0!==t?`${e}${t}`:e},formatTime(e){try{return null===e||void 0===e||""===e?"--":e.replace(/-/g,".")}catch(t){return e}},formatTimespan(e){try{if(null===e||void 0===e||""===e)return"--";const t=new Date;return t.setTime(1e3*e),(0,s.WU)(t,"YYYY.mm.dd")}catch(t){return e}},formatPrice(e,t=i.WL.Fen,a=!0){try{if(null===e||void 0===e||""===e)return"--";const i=n.format(n.parse(e,t));return a?`￥${i}`:i}catch(s){return e}},formatPriceFormYuan(e,t=2,a=!0){try{if(null===e||void 0===e||""===e)return"--";let i=e;return i=e>1e8?(e/1e8).toFixed(t)+"亿":e>1e4?(e/1e4).toFixed(t)+"w":(e-0).toFixed(t),a&&(i=`￥${i}`),i}catch(i){return e}},formatPriceToThousand(e,t=2,a=!0,i=!1){try{if(null===e||void 0===e||""===e)return"--";let s=e;return e>1e4?s=(e/1e4).toFixed(t)+"w":(s=(e-0).toFixed(t),i&&(s=(e-0).toFixed(0))),a&&(s=`￥${s}`),s}catch(s){return e}},formatPriceToThousandformatAmount(e,t=2,a=!0,i=!1){try{if(null===e||void 0===e||""===e)return"--";let s=e;return e>1e4?s=(0,l.dN)((e/1e4).toFixed(2),"None")+"w":(s=(0,l.dN)((e-0).toFixed(t),"None",0===t),i&&(s=(e-0).toFixed(0))),a&&(s=`￥${s}`),s}catch(s){return e}},tranNumber(e,t=2){if(null===e||void 0===e||""===e)return"--";if(!(e>=0))return e||"-";e+="";const a=e.toString(),i=a.split(".")[0],s=i.length;if(s<5)return a;if(s>8){const e=i.substring(i.length-8,i.length-8+t);return parseFloat(parseInt(i/1e8+"",10)+"."+e)+"亿"}if(s>4){const e=i.substring(i.length-4,i.length-4+t);return parseFloat(parseInt(i/1e4+"",10)+"."+e)+"w"}}}},40290:function(e,t,a){a.d(t,{k:function(){return s}});var i=a(1763);const s=e=>{const t={jumpProjectDetail:e=>{const a={name:i.FB.project.detail,params:{id:`${e.project_id}`,tab:e.tab??"projectInfo",liveType:e.liveType??"calendar"}},s=e.newWindow??!1;t.jump(a,s)},jumpLiveDisplayDetail:e=>{const a={name:i.FB.display.detail,params:{id:`${e.project_id}`,liveId:`${e.live_id}`,tab:"live",liveType:e.liveType??"calendar"}},s=e.newWindow??!1;t.jump(a,s)},jump:(t,a=!1)=>{if(a){const{href:a}=e.root.$router.resolve(t);window.open(a,"_blank")}else e.root.$router.push(t)}};return{...t}}},4249:function(e,t,a){a(26699);var i=a(97434);t["Z"]=(0,i.defineComponent)({name:"ApprovalFlow",setup(e,t){const a=(0,i.computed)((()=>t.root.$store.state.workbench)),s=(0,i.computed)((()=>a.value.approval)),l=(0,i.computed)((()=>(s.value?.approval_flow_detail??[]).length>=0&&0===s.value?.approval_stream.length)),n=(0,i.computed)((()=>{if(void 0===s.value)return 0;const e=[2,3].includes(s.value.approval_status??-1);return l.value?s.value.approval_flow_detail.length:s.value.steps+(e?1:0)})),o=(0,i.computed)((()=>void 0===s.value?[]:s.value.approval_flow_detail.length>0?s.value.approval_flow_detail.map((e=>({...e,username:e.receivedPersons}))):s.value.approval_stream));return{approval:s,step_status:n,flowDetail:o,isFromOA:l}},render(){const e=arguments[0],t=this.approval,a=this.isFromOA,i=this.step_status,s=this.flowDetail;if(void 0===t)return e("div");const l=e("el-steps",{class:"steps-line",props:{active:i,direction:"vertical"}},[...s.map(((i,s)=>{const l=804===i.role_code?[e("span",{class:"size-medium",slot:"title"},[i.role_name+"（用款金额大于10万元）"])]:802===i.role_code?[e("span",{class:"size-medium",slot:"title"},[i.role_name+"（用款金额大于50万元）"])]:[e("span",{class:"size-medium",slot:"title"},[i.role_name])],n=2===t.approval_status?"last-color":"",o=1===i.approval_result?"color-3":2===i.approval_result?"refuse":"",r=["flow-select",o,n];return e("el-step",{key:s,class:"step-children"},[e("tg-icon",{attrs:{name:"ico-step-finish"},slot:"icon"}),l,e("div",{slot:"description"},[e("span",{class:r},["审批人："]),i.approval_result?e("span",[1===i.approval_result?e("span",{class:[o,n]},[a?i.operatorName:i.username,"（已同意）"]):"",2===i.approval_result?e("span",{class:["flow-select","refuse"]},[a?i.operatorName:i.username,"（已拒绝）"]):""]):e("span",{class:"flow-select"},[a?i.operatorName:i.username]),""!==i.remark||""!==i.oa_review_result?e("p",{class:"refuse"},[i.remark?"理由:"+(i.oa_review_result||i.remark):""]):"",i.approval_date?e("p",{class:["flow-select",2===i.approval_result?"refuse":"",n]},[a?`${i.operateDate} ${i.operateTime}`:`${i.approval_date}`]):""])])})),...a&&![2,3,4].includes(t.approval_status)?[e("el-step",{style:"height: 82px !important",class:"step-children"},[e("tg-icon",{attrs:{name:"ico-waiting"},slot:"icon"}),e("span",{class:"size-medium",slot:"title"},[s[s.length-1].receivedPersons])])]:[]]);return e("div",{class:"steps-exted",attrs:{id:"steps-exted"}},[a?"":e("el-steps",{attrs:{direction:"vertical",active:1},class:"step-username"},[e("el-step",{style:"height: 82px"},[e("div",{style:"font-size: 14px",slot:"title"},["申请人"]),e("div",{slot:"description"},[e("span",{class:"color-3"},[t.username]),e("p",{class:"flow-select"},[t.gmt_create_datetime])])])]),l,4===t.approval_status?e("el-steps",{attrs:{direction:"vertical",active:1},class:"step-username revocation"},[e("el-step",{style:"height: 82px"},[e("div",{style:"font-size: 14px",slot:"title"},["申请人"]),e("div",{slot:"description"},[e("span",{class:"flow-select revocation-color"},[t.username,"（已撤销）"]),e("p",{class:"flow-select revocation-color"},[t.gmt_modified])])])]):""])}})}}]);